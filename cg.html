<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>MaracaLoop Suite</title>

<meta name="theme-color" content="#0a0c10">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
:root{
  --bg:#0a0c10; --text:#e8eeff; --muted:#8894b8;
  --stroke:#232b3e; --stroke2:#181f30; --shadow:0 12px 36px rgba(0,0,0,.55);
  --red:#ff3535; --green:#3dffb0; --cyan:#3ddaff; --yellow:#ffda44;
  --radius:16px;
}
*{box-sizing:border-box; margin:0; padding:0; -webkit-tap-highlight-color:transparent;}
html,body{height:100%; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
body{
  background:
    radial-gradient(1400px 800px at 25% 10%, #111b35 0%, transparent 60%),
    radial-gradient(1000px 600px at 80% 40%, #0d2820 0%, transparent 60%),
    var(--bg);
  overflow:hidden;
}
a{color:inherit}
button{font-family:inherit}
/* Layout */
.shell{position:fixed; inset:0; display:flex; flex-direction:column;}
.topbar{
  position:sticky; top:0; z-index:10;
  display:flex; align-items:center; gap:10px; flex-wrap:wrap;
  padding:10px 14px;
  background:rgba(10,12,16,.88);
  backdrop-filter:blur(14px); -webkit-backdrop-filter:blur(14px);
  border-bottom:1px solid rgba(35,43,62,.6);
}
.brand{display:flex; flex-direction:column; gap:1px; min-width:220px;}
.brand .t{font-size:15px; font-weight:900; letter-spacing:.08em;}
.brand .s{font-size:11px; color:var(--muted); letter-spacing:.06em;}
.pill{
  padding:7px 12px; border-radius:999px; border:1px solid var(--stroke);
  background:rgba(255,255,255,.03); color:var(--muted);
  display:inline-flex; align-items:center; gap:8px; font-size:13px;
}
.dot{width:9px;height:9px;border-radius:50%;background:#444;}
.dot.on{background:var(--green); box-shadow:0 0 6px rgba(61,255,176,.5);}
.sep{flex:1}
.btn{
  border:1px solid var(--stroke);
  background:linear-gradient(180deg,rgba(255,255,255,.07),rgba(255,255,255,.02));
  color:var(--text); padding:9px 12px; border-radius:12px;
  box-shadow:0 4px 14px rgba(0,0,0,.28);
  cursor:pointer; user-select:none;
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  font-size:13px; white-space:nowrap; transition:filter .12s, transform .06s;
}
.btn:hover{ filter:brightness(1.08); border-color:#3a4566; }
.btn:active{ transform:translateY(1px); filter:brightness(.96); }
.btn:disabled{ opacity:.45; cursor:not-allowed; filter:none; }
.btn-cyan{ border-color:rgba(61,218,255,.38); }
.btn-green{ border-color:rgba(61,255,176,.38); }
.btn-yellow{ border-color:rgba(255,218,68,.38); }
.btn-red{ border-color:rgba(255,53,53,.38); }
.main{flex:1; min-height:0; display:flex;}
/* Home */
.home{
  flex:1; overflow:auto; padding:18px;
}
.wrap{width:min(1200px, 96vw); margin:0 auto;}
.hero{
  border:1px solid var(--stroke);
  border-radius:calc(var(--radius) + 2px);
  background:linear-gradient(160deg,rgba(255,255,255,.05),rgba(255,255,255,.015));
  box-shadow:var(--shadow);
  padding:16px;
  display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end; justify-content:space-between;
}
.hero h1{font-size:22px; font-weight:900; letter-spacing:.06em;}
.hero h1 span{color:var(--cyan)}
.hero p{margin-top:6px; color:var(--muted); line-height:1.45; font-size:13px; max-width:70ch;}
.grid{
  margin-top:14px;
  display:grid; grid-template-columns:repeat(3, minmax(0, 1fr)); gap:14px;
}
@media(max-width:980px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
@media(max-width:560px){ .grid{grid-template-columns:1fr;} .brand{min-width:160px} }
.tile{
  border:1px solid var(--stroke);
  border-radius:var(--radius);
  background:linear-gradient(160deg,rgba(255,255,255,.045),rgba(255,255,255,.015));
  box-shadow:var(--shadow);
  padding:14px;
  position:relative;
  overflow:hidden;
  cursor:pointer;
  user-select:none;
  touch-action:manipulation;
  min-height:132px;
  transition:border-color .18s, transform .08s, filter .18s;
}
.tile:before{
  content:"";
  position:absolute; inset:-35% -30%;
  background:
    radial-gradient(420px 220px at 30% 35%, rgba(61,218,255,.10), transparent 60%),
    radial-gradient(380px 240px at 70% 65%, rgba(61,255,176,.08), transparent 60%);
  transform:rotate(-8deg);
  pointer-events:none;
}
.tile:hover{ border-color:#3a4566; filter:brightness(1.04); }
.tile:active{ transform:scale(.99); }
.tile > *{ position:relative; }
.tileTop{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px;}
.badge{
  padding:4px 10px; border-radius:999px;
  border:1px solid var(--stroke2); background:rgba(0,0,0,.22);
  font-size:11px; letter-spacing:.10em; text-transform:uppercase; color:var(--muted);
}
.kicker{font-size:18px; font-weight:950; letter-spacing:.04em;}
.desc{margin-top:6px; color:var(--muted); font-size:12.5px; line-height:1.45;}
/* App view */
.viewer{flex:1; min-height:0; display:none;}
.viewer.on{display:flex; flex-direction:column;}
.viewerTop{
  padding:10px 14px;
  display:flex; align-items:center; gap:10px; flex-wrap:wrap;
  border-bottom:1px solid rgba(35,43,62,.6);
  background:rgba(10,12,16,.88);
  backdrop-filter:blur(14px); -webkit-backdrop-filter:blur(14px);
}
.viewerTitle{font-weight:900; letter-spacing:.06em;}
.iframeWrap{flex:1; min-height:0; background:#000;}
iframe{width:100%; height:100%; border:0; background:#000;}
.notice{display:none; margin-left:auto; color:var(--muted); font-size:12px; line-height:1.35; max-width:52ch;}
@media(max-width:720px){ .notice{display:none} }
/* Tiny helper */
kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace; font-size:12px;
  padding:2px 6px; border-radius:7px; border:1px solid var(--stroke2); background:rgba(0,0,0,.22); color:var(--text);
}
</style>
</head>
<body>
<div class="shell">
  <div class="topbar">
    <div class="brand">
      <div class="t">MARACA<span style="color:var(--cyan)">LOOP</span> ‚Ä¢ Suite</div>
      <div class="s">Tutto in un file ‚Ä¢ UI unificata ‚Ä¢ Responsive</div>
    </div>
    <div class="pill" title="Stato del contenitore (non dell'audio interno alle app)">
      <span class="dot on" id="dotReady"></span>
      <span>Pronto</span>
    </div>
    <div class="sep"></div>
    <button class="btn btn-cyan" id="btnHome">üè† Index</button>
    <button class="btn btn-green" id="btnOpenWin" disabled>üóî Apri app</button>
  </div>

  <div class="main">
    <section class="home" id="home">
      <div class="wrap">
        <div class="hero">
          <div>
            <h1>Index <span>MaracaLoop</span></h1>
            <p>
              Seleziona un modulo. Ogni app viene eseguita isolata in un <b>iframe</b> interno (srcdoc),
              cos√¨ rimane compatibile e ‚Äútutto in uno‚Äù.
              Per microfono/audio, usa <b>HTTPS</b> o <b>localhost</b> (regola dei browser).
            </p>
          </div>
          <div class="pill" title="Suggerimento">
            Tip: su mobile, metti in full screen e usa <kbd>Index</kbd> per tornare.
          </div>
        </div>

        <div class="grid" id="grid">
          <div class="tile" data-app="Loop" role="button" tabindex="0">
            <div class="tileTop">
              <div class="badge">Looper</div>
              <div class="pill" style="gap:6px"><span style="color:var(--cyan)">‚óè</span><span>MaracaLoop PRO</span></div>
            </div>
            <div class="kicker">Loop / Metronomo</div>
            <div class="desc">Looper multi-traccia con metronomo, LED, waveform e controlli rapidi.</div>
          </div>

          <div class="tile" data-app="Pad" role="button" tabindex="0">
            <div class="tileTop">
              <div class="badge">Pads</div>
              <div class="pill" style="gap:6px"><span style="color:var(--green)">‚ñ†</span><span>MaracaPad PRO</span></div>
            </div>
            <div class="kicker">Pad / Samples</div>
            <div class="desc">Griglia pad, trasporto, beat lights e gestione campioni.</div>
          </div>

          <div class="tile" data-app="Synth" role="button" tabindex="0">
            <div class="tileTop">
              <div class="badge">Synth</div>
              <div class="pill" style="gap:6px"><span style="color:var(--yellow)">‚ñ≤</span><span>8-Voice Synth</span></div>
            </div>
            <div class="kicker">Sintetizzatore</div>
            <div class="desc">Somma fino a 8 voci, ADSR, limiter anti-clipping, oscilloscopio.</div>
          </div>

          <div class="tile" data-app="DJ" role="button" tabindex="0">
            <div class="tileTop">
              <div class="badge">DJ</div>
              <div class="pill" style="gap:6px"><span style="color:var(--red)">‚óÜ</span><span>MaracaDJ PRO</span></div>
            </div>
            <div class="kicker">Console 4 Deck</div>
            <div class="desc">4 deck, sync, cue/loop, key lock, beat offset e mixer.</div>
          </div>

          <div class="tile" data-app="Accordatore" role="button" tabindex="0">
            <div class="tileTop">
              <div class="badge">Tuner</div>
              <div class="pill" style="gap:6px"><span style="color:var(--cyan)">‚üÇ</span><span>Accordatore</span></div>
            </div>
            <div class="kicker">Accordatore (Mic)</div>
            <div class="desc">Rilevazione nota/frequenza in tempo reale con LA di riferimento configurabile.</div>
          </div>

        </div>

        <div style="margin-top:14px; color:var(--muted); font-size:12px; line-height:1.6;">
          Nota compatibilit√†: le app sono incluse cos√¨ come sono (HTML completo) e vengono caricate in <b>srcdoc</b>.
          Se un browser blocca il microfono nell'iframe, usa <b>Apri app</b> per aprirla in una nuova scheda.
        </div>
      </div>
    </section>

    <section class="viewer" id="viewer" aria-label="Viewer applicazione">
      <div class="viewerTop">
        <button class="btn btn-cyan" id="btnBack">‚Üê Index</button>
        <div class="viewerTitle" id="viewerTitle">‚Äî</div>
        <div class="sep"></div>
        <div class="notice" id="notice">
          Se audio/microfono non partono: usa ‚ÄúApri app‚Äù (nuova scheda) oppure assicurati di essere in HTTPS/localhost.
        </div>
      </div>
      <div class="iframeWrap">
        <iframe id="appFrame" allow="microphone; autoplay; clipboard-read; clipboard-write"></iframe>
      </div>
    </section>
  </div>
</div>

<script type="application/json" id="appData">{"Accordatore": "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9Iml0Ij4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9IlVURi04IiAvPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLGluaXRpYWwtc2NhbGU9MS4wLHZpZXdwb3J0LWZpdD1jb3ZlciIgLz4KPHRpdGxlPm1hcmFjYW5hdWRpbyDigJMgQWNjb3JkYXRvcmU8L3RpdGxlPgoKPG1ldGEgbmFtZT0idGhlbWUtY29sb3IiIGNvbnRlbnQ9IiMwMDAwMDAiPgo8bWV0YSBuYW1lPSJtb2JpbGUtd2ViLWFwcC1jYXBhYmxlIiBjb250ZW50PSJ5ZXMiPgo8bWV0YSBuYW1lPSJhcHBsZS1tb2JpbGUtd2ViLWFwcC1jYXBhYmxlIiBjb250ZW50PSJ5ZXMiPgo8bWV0YSBuYW1lPSJhcHBsZS1tb2JpbGUtd2ViLWFwcC1zdGF0dXMtYmFyLXN0eWxlIiBjb250ZW50PSJibGFjay10cmFuc2x1Y2VudCI+Cgo8c3R5bGU+Cip7bWFyZ2luOjA7cGFkZGluZzowO2JveC1zaXppbmc6Ym9yZGVyLWJveDt9Cmh0bWwsYm9keXt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO2JhY2tncm91bmQ6IzAwMDtvdmVyZmxvdzpoaWRkZW47Zm9udC1mYW1pbHk6c3lzdGVtLXVpLC1hcHBsZS1zeXN0ZW0sU2Vnb2UgVUksUm9ib3RvLEFyaWFsLHNhbnMtc2VyaWY7fQouYXBwe3Bvc2l0aW9uOmZpeGVkO2luc2V0OjA7ZGlzcGxheTpmbGV4O2JhY2tncm91bmQ6cmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCBjZW50ZXIsIzE1MTUxNSAwJSwjMDAwIDcwJSk7Y29sb3I6I2ZmZjt9Ci50dW5lcntmbGV4OjE7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjthbGlnbi1pdGVtczpzdHJldGNoO2p1c3RpZnktY29udGVudDpmbGV4LXN0YXJ0O3BhZGRpbmc6MTJweDtnYXA6MTBweDt9Ci50b3BSb3d7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6OHB4O30KLnBpbGx7ZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjhweDtwYWRkaW5nOjhweCAxMnB4O2JvcmRlci1yYWRpdXM6MTRweDtiYWNrZ3JvdW5kOnJnYmEoMjU1LDI1NSwyNTUsMC4wOCk7Ym9yZGVyOjFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMTIpO2ZvbnQtd2VpZ2h0OjkwMDt9Ci5idG57Ym9yZGVyOm5vbmU7Y3Vyc29yOnBvaW50ZXI7cGFkZGluZzoxMHB4IDE0cHg7Ym9yZGVyLXJhZGl1czoxNHB4O2ZvbnQtd2VpZ2h0OjkwMDtjb2xvcjojZmZmO2JhY2tncm91bmQ6IzJhNTI5ODt0cmFuc2l0aW9uOnRyYW5zZm9ybSAuMTJzIGVhc2U7dXNlci1zZWxlY3Q6bm9uZTt9Ci5idG46YWN0aXZle3RyYW5zZm9ybTpzY2FsZSgwLjk4KTt9Ci5idG4uc2Vjb25kYXJ5e2JhY2tncm91bmQ6cmdiYSgyNTUsMjU1LDI1NSwwLjEyKTt9Ci5idG4uZGFuZ2Vye2JhY2tncm91bmQ6I2RjMzU0NTt9Ci5yZWFkb3V0e2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo0cHg7cGFkZGluZy10b3A6MnB4O30KLm5vdGVMaW5le2ZvbnQtc2l6ZTo0OHB4O2ZvbnQtd2VpZ2h0OjEwMDA7dGV4dC1zaGFkb3c6MCAwIDE4cHggcmdiYSgwLDI1NSwwLDAuMzUpO30KLmZyZXFMaW5le2ZvbnQtc2l6ZToyMnB4O2ZvbnQtd2VpZ2h0OjkwMDt9Ci5kZWx0YUxpbmV7Zm9udC1zaXplOjE4cHg7Zm9udC13ZWlnaHQ6OTAwO2NvbG9yOiNmZmQ3MDA7fQoubWV0ZXJ7cG9zaXRpb246cmVsYXRpdmU7ZmxleDoxO21pbi1oZWlnaHQ6MTQwcHg7Ym9yZGVyLXJhZGl1czoxOHB4O2JhY2tncm91bmQ6bGluZWFyLWdyYWRpZW50KDE4MGRlZyxyZ2JhKDI1NSwyNTUsMjU1LDAuMDYpLHJnYmEoMjU1LDI1NSwyNTUsMC4wMikpO2JvcmRlcjoxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjEyKTtvdmVyZmxvdzpoaWRkZW47fQouc2NhbGV7cG9zaXRpb246YWJzb2x1dGU7aW5zZXQ6MDtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47cGFkZGluZzowIDI0cHg7fQoubWFya3t3aWR0aDoycHg7YmFja2dyb3VuZDpyZ2JhKDI1NSwyNTUsMjU1LDAuMik7cG9zaXRpb246cmVsYXRpdmU7fQoubWFyay5jZW50ZXJ7d2lkdGg6M3B4O2JhY2tncm91bmQ6IzAwZmYwMDtib3gtc2hhZG93OjAgMCAxNnB4IHJnYmEoMCwyNTUsMCwwLjYpO30KLmxhYmVse3Bvc2l0aW9uOmFic29sdXRlO2JvdHRvbTo4cHg7bGVmdDo1MCU7dHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTUwJSk7Zm9udC1zaXplOjEycHg7Zm9udC13ZWlnaHQ6OTAwO29wYWNpdHk6MC43O3doaXRlLXNwYWNlOm5vd3JhcDt9Ci5uZWVkbGV7cG9zaXRpb246YWJzb2x1dGU7dG9wOjEwJTtoZWlnaHQ6ODAlO3dpZHRoOjRweDtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTtib3JkZXItcmFkaXVzOjJweDtiYWNrZ3JvdW5kOiNmZjMzMzM7Ym94LXNoYWRvdzowIDAgMTZweCByZ2JhKDI1NSwwLDAsMC42KTt0cmFuc2l0aW9uOmxlZnQgLjA4cyBlYXNlLW91dDt9Ci5uZWVkbGUub2t7YmFja2dyb3VuZDojMDBmZjAwO2JveC1zaGFkb3c6MCAwIDE4cHggcmdiYSgwLDI1NSwwLDAuNyk7fQouc3RhdHVze3RleHQtYWxpZ246Y2VudGVyO3BhZGRpbmc6OHB4O2JvcmRlci1yYWRpdXM6MTRweDtmb250LXdlaWdodDoxMDAwO2JhY2tncm91bmQ6cmdiYSgyNTUsMjU1LDI1NSwwLjA2KTtib3JkZXI6MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4xMik7fQouc3RhdHVzLmdvb2R7YmFja2dyb3VuZDpyZ2JhKDAsMjU1LDAsMC4xOCk7Y29sb3I6I2Q5ZmZkOTtib3JkZXItY29sb3I6cmdiYSgwLDI1NSwwLDAuMjUpO30KLnN0YXR1cy5sb3d7YmFja2dyb3VuZDpyZ2JhKDI1NSw2OCw2OCwwLjE4KTtib3JkZXItY29sb3I6cmdiYSgyNTUsNjgsNjgsMC4yNSk7fQouc3RhdHVzLmhpZ2h7YmFja2dyb3VuZDpyZ2JhKDI1NSwxMzYsMCwwLjE4KTtib3JkZXItY29sb3I6cmdiYSgyNTUsMTM2LDAsMC4yNSk7fQoKLm92ZXJsYXl7cG9zaXRpb246Zml4ZWQ7aW5zZXQ6MDtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpjZW50ZXI7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLC44Mik7ei1pbmRleDo5OTk7cGFkZGluZzoxNHB4O30KLm92ZXJsYXlDYXJke3dpZHRoOm1pbig1MjBweCw5NnZ3KTtiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzExMTtib3JkZXItcmFkaXVzOjE4cHg7cGFkZGluZzoxOHB4O2JveC1zaGFkb3c6MCAxOHB4IDcwcHggcmdiYSgwLDAsMCwwLjQ1KTt0ZXh0LWFsaWduOmNlbnRlcjt9Ci5vdmVybGF5Q2FyZCBoMntmb250LXNpemU6MjBweDtmb250LXdlaWdodDoxMDAwO21hcmdpbi1ib3R0b206OHB4O30KLm92ZXJsYXlDYXJkIHB7Zm9udC1zaXplOjE0cHg7Zm9udC13ZWlnaHQ6NzUwO2NvbG9yOiM0NDQ7bGluZS1oZWlnaHQ6MS40O21hcmdpbi1ib3R0b206MTRweDt9Ci5vdmVybGF5Um93e2Rpc3BsYXk6ZmxleDtnYXA6MTBweDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2ZsZXgtd3JhcDp3cmFwO30KLm92ZXJsYXlSb3cgLmJ0bnttaW4td2lkdGg6MTYwcHg7fQouZXJye2Rpc3BsYXk6bm9uZTttYXJnaW4tdG9wOjEycHg7Y29sb3I6I2IwMDAyMDtmb250LXdlaWdodDo5MDA7Zm9udC1zaXplOjEzcHg7d2hpdGUtc3BhY2U6cHJlLXdyYXA7fQoKLnJlZk1vZGFse3Bvc2l0aW9uOmZpeGVkO2luc2V0OjA7ZGlzcGxheTpub25lO2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjcyKTt6LWluZGV4OjEyMDA7cGFkZGluZzoxNHB4O30KLnJlZk1vZGFsLnNob3d7ZGlzcGxheTpmbGV4O30KLnJlZkNhcmR7d2lkdGg6bWluKDUyMHB4LDk2dncpO2JhY2tncm91bmQ6I2ZmZjtjb2xvcjojMTExO2JvcmRlci1yYWRpdXM6MThweDtwYWRkaW5nOjE4cHg7dGV4dC1hbGlnbjpsZWZ0O2JveC1zaGFkb3c6MCAxOHB4IDcwcHggcmdiYSgwLDAsMCwwLjQ1KTt9Ci5yZWZDYXJkIGgze2ZvbnQtc2l6ZToxOHB4O2ZvbnQtd2VpZ2h0OjEwMDA7bWFyZ2luLWJvdHRvbToxMHB4O30KLnJlZlJvd3tkaXNwbGF5OmZsZXg7Z2FwOjEwcHg7YWxpZ24taXRlbXM6Y2VudGVyO30KLnJlZlJvdyBpbnB1dHtmbGV4OjE7cGFkZGluZzoxMnB4IDEycHg7Ym9yZGVyLXJhZGl1czoxNHB4O2JvcmRlcjoycHggc29saWQgI2RkZDtmb250LXNpemU6MTZweDtmb250LXdlaWdodDo5MDA7b3V0bGluZTpub25lO30KLmhpbnR7bWFyZ2luLXRvcDoxMHB4O2ZvbnQtc2l6ZToxM3B4O2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjojNTU1O30KCkBtZWRpYSAob3JpZW50YXRpb246bGFuZHNjYXBlKSBhbmQgKG1heC1oZWlnaHQ6NTIwcHgpewogIC50b3BSb3d7ZGlzcGxheTpub25lO30KICAucmVhZG91dHtnYXA6MnB4O30KICAubm90ZUxpbmV7Zm9udC1zaXplOjMwcHg7fQogIC5mcmVxTGluZXtmb250LXNpemU6MTZweDt9CiAgLmRlbHRhTGluZXtmb250LXNpemU6MTRweDt9CiAgLm1ldGVye2ZsZXg6MTttaW4taGVpZ2h0OjE2MHB4O30KICAuc3RhdHVze2ZvbnQtc2l6ZToxNHB4O3BhZGRpbmc6NnB4O30KfQo8L3N0eWxlPgo8L2hlYWQ+Cgo8Ym9keT4KPGRpdiBjbGFzcz0iYXBwIj4KICA8ZGl2IGNsYXNzPSJ0dW5lciIgaWQ9InR1bmVyUm9vdCI+CiAgICA8ZGl2IGNsYXNzPSJ0b3BSb3ciPgogICAgICA8ZGl2IGNsYXNzPSJwaWxsIj5BNCA8c3BhbiBpZD0icmVmVmFsIj40NDAuMCBIejwvc3Bhbj48L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDo4cHg7YWxpZ24taXRlbXM6Y2VudGVyOyI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIHNlY29uZGFyeSIgaWQ9InJlZkJ0biI+TEEgKEE0KTwvYnV0dG9uPgogICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBkYW5nZXIiIGlkPSJzdG9wQnRuIiBzdHlsZT0iZGlzcGxheTpub25lOyI+U1RPUDwvYnV0dG9uPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9InJlYWRvdXQiPgogICAgICA8ZGl2IGNsYXNzPSJub3RlTGluZSIgaWQ9Im5vdGVOYW1lIj7igJQ8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iZnJlcUxpbmUiIGlkPSJmcmVxTm93Ij7igJQgSHo8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iZGVsdGFMaW5lIiBpZD0iZGVsdGFOb3ciPjAgY2VudHM8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9Im1ldGVyIiBpZD0ibWV0ZXIiPgogICAgICA8ZGl2IGNsYXNzPSJzY2FsZSIgaWQ9InNjYWxlIj48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0ibmVlZGxlIiBpZD0ibmVlZGxlIj48L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9InN0YXR1cyIgaWQ9InN0YXR1cyI+VG9jY2EgQVZWSUEgcGVyIGluaXppYXJlPC9kaXY+CiAgPC9kaXY+CjwvZGl2PgoKPGRpdiBjbGFzcz0ib3ZlcmxheSIgaWQ9InN0YXJ0T3ZlcmxheSI+CiAgPGRpdiBjbGFzcz0ib3ZlcmxheUNhcmQiPgogICAgPGgyPkFjY29yZGF0b3JlPC9oMj4KICAgIDxwPgogICAgICBUb2NjYSAiQVZWSUEiIHBlciBhdHRpdmFyZSBpbCBtaWNyb2Zvbm8uPGJyLz4KICAgICAgTEEgZGkgcmlmZXJpbWVudG86IDxiIGlkPSJvdmVybGF5UmVmIj40NDAuMCBIejwvYj4KICAgIDwvcD4KICAgIDxkaXYgY2xhc3M9Im92ZXJsYXlSb3ciPgogICAgICA8YnV0dG9uIGNsYXNzPSJidG4gc2Vjb25kYXJ5IiBpZD0ib3ZlcmxheVJlZkJ0biI+Q2FtYmlhIExBPC9idXR0b24+CiAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgaWQ9InN0YXJ0QnRuIj5BVlZJQTwvYnV0dG9uPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJlcnIiIGlkPSJvdmVybGF5RXJyIj48L2Rpdj4KICA8L2Rpdj4KPC9kaXY+Cgo8ZGl2IGNsYXNzPSJyZWZNb2RhbCIgaWQ9InJlZk1vZGFsIj4KICA8ZGl2IGNsYXNzPSJyZWZDYXJkIj4KICAgIDxoMz5JbXBvc3RhIExBIChBNCkgbWFudWFsbWVudGU8L2gzPgogICAgPGRpdiBjbGFzcz0icmVmUm93Ij4KICAgICAgPGlucHV0IGlkPSJyZWZJbnB1dCIgdHlwZT0ibnVtYmVyIiBtaW49IjM4MCIgbWF4PSI1MjAiIHN0ZXA9IjAuMSIgdmFsdWU9IjQ0MC4wIiAvPgogICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJyZWZBcHBseSI+QXBwbGljYTwvYnV0dG9uPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJoaW50Ij5TdWdnZXJpdGk6IDQ0MCAoc3RhbmRhcmQpLCA0MzIsIDQ0Mi48L2Rpdj4KICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6MTBweDttYXJnaW4tdG9wOjEycHg7Ij4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIHNlY29uZGFyeSIgaWQ9InJlZkNsb3NlIj5DaGl1ZGk8L2J1dHRvbj4KICAgIDwvZGl2PgogIDwvZGl2Pgo8L2Rpdj4KCjxzY3JpcHQ+CiJ1c2Ugc3RyaWN0IjsKCi8vIOKUgOKUgOKUgCBFUlJPUkUgVUkg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmZ1bmN0aW9uIHNob3dFcnIobXNnKXsgb3ZlcmxheUVyci5zdHlsZS5kaXNwbGF5PSJibG9jayI7IG92ZXJsYXlFcnIudGV4dENvbnRlbnQ9bXNnOyB9CmZ1bmN0aW9uIGhpZGVFcnIoKXsgb3ZlcmxheUVyci5zdHlsZS5kaXNwbGF5PSJub25lIjsgb3ZlcmxheUVyci50ZXh0Q29udGVudD0iIjsgfQoKLy8g4pSA4pSA4pSAIFNUQVRPIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgApsZXQgYXVkaW9Db250ZXh0LCBhbmFseXNlciwgbWljU291cmNlLCBzdHJlYW1SZWYsIHJhZklkOwpsZXQgaXNSdW5uaW5nID0gZmFsc2U7CmxldCByZWZlcmVuY2VBNCA9IDQ0MC4wOwoKLy8g4pSA4pSA4pSAIERPTSDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKY29uc3QgcmVmVmFsICAgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWZWYWwnKTsKY29uc3Qgb3ZlcmxheVJlZiAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdmVybGF5UmVmJyk7CmNvbnN0IG5vdGVOYW1lRWwgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm90ZU5hbWUnKTsKY29uc3QgZnJlcU5vd0VsICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmcmVxTm93Jyk7CmNvbnN0IGRlbHRhTm93RWwgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsdGFOb3cnKTsKY29uc3Qgc3RhdHVzRWwgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0dXMnKTsKY29uc3QgbmVlZGxlRWwgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWVkbGUnKTsKY29uc3Qgc2NhbGVFbCAgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2FsZScpOwpjb25zdCBzdG9wQnRuICAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0b3BCdG4nKTsKY29uc3Qgc3RhcnRPdmVybGF5ICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydE92ZXJsYXknKTsKY29uc3Qgc3RhcnRCdG4gICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydEJ0bicpOwpjb25zdCBvdmVybGF5UmVmQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ292ZXJsYXlSZWZCdG4nKTsKY29uc3Qgb3ZlcmxheUVyciAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdmVybGF5RXJyJyk7CmNvbnN0IHJlZkJ0biAgICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVmQnRuJyk7CmNvbnN0IHJlZk1vZGFsICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVmTW9kYWwnKTsKY29uc3QgcmVmSW5wdXQgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWZJbnB1dCcpOwpjb25zdCByZWZBcHBseSAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZkFwcGx5Jyk7CmNvbnN0IHJlZkNsb3NlICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVmQ2xvc2UnKTsKCi8vIOKUgOKUgOKUgCBOT1RFIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgApjb25zdCBOT1RFX1NIQVJQID0gWyJDIiwiQyMiLCJEIiwiRCMiLCJFIiwiRiIsIkYjIiwiRyIsIkcjIiwiQSIsIkEjIiwiQiJdOwpjb25zdCBOT1RFX0ZMQVQgID0gWyJDIiwiRGIiLCJEIiwiRWIiLCJFIiwiRiIsIkdiIiwiRyIsIkFiIiwiQSIsIkJiIiwiQiJdOwpjb25zdCBjbGFtcCA9IChuLGEsYikgPT4gTWF0aC5tYXgoYSxNYXRoLm1pbihiLG4pKTsKCmZ1bmN0aW9uIGZyZXFUb01pZGkoZikgIHsgcmV0dXJuIDY5ICsgMTIqTWF0aC5sb2cyKGYvcmVmZXJlbmNlQTQpOyB9CmZ1bmN0aW9uIG1pZGlUb0ZyZXEobSkgIHsgcmV0dXJuIHJlZmVyZW5jZUE0Kk1hdGgucG93KDIsKG0tNjkpLzEyKTsgfQpmdW5jdGlvbiBtaWRpVG9OYW1lKG1pZGksIHByZWZlckZsYXRzKXsKICBjb25zdCBuPU1hdGgucm91bmQobWlkaSk7CiAgY29uc3Qgb2N0YXZlPU1hdGguZmxvb3Iobi8xMiktMTsKICBjb25zdCBpZHg9KG4lMTIrMTIpJTEyOwogIGNvbnN0IG5hbWU9cHJlZmVyRmxhdHM/Tk9URV9GTEFUW2lkeF06Tk9URV9TSEFSUFtpZHhdOwogIHJldHVybiB7bmFtZSxvY3RhdmV9Owp9CmZ1bmN0aW9uIGNlbnRzRGlmZihmcmVxLHRhcmdldCl7IHJldHVybiAxMjAwKk1hdGgubG9nMihmcmVxL3RhcmdldCk7IH0KZnVuY3Rpb24gZm9ybWF0TmFtZUJvdGgobWlkaSl7CiAgY29uc3Qgcz1taWRpVG9OYW1lKG1pZGksZmFsc2UpLCBmPW1pZGlUb05hbWUobWlkaSx0cnVlKTsKICBpZihzLm5hbWUhPT1mLm5hbWUpIHJldHVybiBgJHtzLm5hbWV9JHtzLm9jdGF2ZX0gLyAke2YubmFtZX0ke2Yub2N0YXZlfWA7CiAgcmV0dXJuIGAke3MubmFtZX0ke3Mub2N0YXZlfWA7Cn0KCi8vIOKUgOKUgOKUgCBTQ0FMQSBWSVNJVkEg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmZ1bmN0aW9uIGdldFpvb21SYW5nZShhYnNDKXsKICBpZihhYnNDPjgwKSAgcmV0dXJuIDE1MDsKICBpZihhYnNDPjQwKSAgcmV0dXJuIDgwOwogIGlmKGFic0M+MjApICByZXR1cm4gNDA7CiAgaWYoYWJzQz4xMCkgIHJldHVybiAyMDsKICBpZihhYnNDPjUpICAgcmV0dXJuIDEwOwogIHJldHVybiA1Owp9CmZ1bmN0aW9uIGRyYXdTY2FsZShyYW5nZSl7CiAgc2NhbGVFbC5pbm5lckhUTUw9IiI7CiAgbGV0IHN0ZXA9MTA7CiAgaWYocmFuZ2U8PTIwKSBzdGVwPTU7CiAgaWYocmFuZ2U8PTEwKSBzdGVwPTI7CiAgaWYocmFuZ2U8PTUpICBzdGVwPTE7CiAgZm9yKGxldCBjPS1yYW5nZTtjPD1yYW5nZTtjKz1zdGVwKXsKICAgIGNvbnN0IG1hcms9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBtYXJrLmNsYXNzTmFtZT0oYz09PTApPyJtYXJrIGNlbnRlciI6Im1hcmsiOwogICAgY29uc3QgbWFqb3I9KHJhbmdlPj04MCk/MjA6KHJhbmdlPj00MD8xMDoocmFuZ2U+PTIwPzEwOihyYW5nZT49MTA/NToyKSkpOwogICAgaWYoYz09PTAgfHwgKE1hdGguYWJzKGMpJW1ham9yPT09MCkpewogICAgICBjb25zdCBsYWI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgICBsYWIuY2xhc3NOYW1lPSJsYWJlbCI7IGxhYi50ZXh0Q29udGVudD1jOwogICAgICBtYXJrLmFwcGVuZENoaWxkKGxhYik7CiAgICB9CiAgICBzY2FsZUVsLmFwcGVuZENoaWxkKG1hcmspOwogIH0KfQoKLy8g4pSA4pSA4pSAIENPU1RBTlRJIERJIFJJTEVWQVpJT05FIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgApjb25zdCBGRlRfU0laRSA9IDQwOTY7ICAgICAgICAgIC8vIOKGkSBlcmEgMjA0OCDigJQgcGnDuSBjYW1waW9uaSA9IHBpw7kgcmlzb2x1emlvbmUgdGVtcG9yYWxlIHBlciBub3RlIGFjdXRlCmNvbnN0IFJNU19NSU4gID0gMC4wMTU7CmNvbnN0IENPTkZfTUlOID0gMC44MjsgICAgICAgICAgLy8g4oaRIHNvZ2xpYSBwacO5IGFsdGEgcGVyIHJpZHVycmUgZmFsc2kgcG9zaXRpdmkKY29uc3QgTk9URV9IWVNURVJFU0lTX0NFTlRTID0gMjI7CmNvbnN0IFNUQUJMRV9GUkFNRVNfUkVRVUlSRUQgPSAzOwoKLy8gUmFuZ2UgY2hpdGFycmEgc3RhbmRhcmQ6IEUyKDgySHopIOKAkyBFNSgxMzE5SHopCmNvbnN0IEZSRVFfTUlOID0gNzA7CmNvbnN0IEZSRVFfTUFYID0gMTQwMDsKCi8vIOKUgOKUgOKUgCBBTEdPUklUTU8gREkgUElUQ0gg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACi8vIFVzYSBZSU4gc2VtcGxpZmljYXRvICsgY29ycmV6aW9uZSBkJ290dGF2YSB2aWEgSFBTIChIYXJtb25pYyBQcm9kdWN0IFNwZWN0cnVtKQovLyBZSU4gw6ggbW9sdG8gcGnDuSBhY2N1cmF0byBkZWxsJ2F1dG9jb3JyZWxhemlvbmUgc2VtcGxpY2UgcGVyIG5vdGUgYWN1dGUKCmZ1bmN0aW9uIGNhbGNSTVMoYnVmKXsKICBsZXQgcz0wOwogIGZvcihsZXQgaT0wO2k8YnVmLmxlbmd0aDtpKyspIHMrPWJ1ZltpXSpidWZbaV07CiAgcmV0dXJuIE1hdGguc3FydChzL2J1Zi5sZW5ndGgpOwp9CgovLyBEaWZmZXJlbnphIHF1YWRyYXRpY2EgbWVkaWEgKGNvcmUgZGkgWUlOKQpmdW5jdGlvbiB5aW5EaWZmZXJlbmNlKGJ1ZiwgVyl7CiAgY29uc3QgZCA9IG5ldyBGbG9hdDMyQXJyYXkoVyk7CiAgZFswXSA9IDA7CiAgZm9yKGxldCB0YXU9MTt0YXU8Vzt0YXUrKyl7CiAgICBsZXQgcz0wOwogICAgZm9yKGxldCBpPTA7aTxXO2krKyl7CiAgICAgIGNvbnN0IGRpZmYgPSBidWZbaV0gLSBidWZbaSt0YXVdOwogICAgICBzICs9IGRpZmYqZGlmZjsKICAgIH0KICAgIGRbdGF1XSA9IHM7CiAgfQogIHJldHVybiBkOwp9CgovLyBEaWZmZXJlbnphIGN1bXVsYXRpdmEgbm9ybWFsaXp6YXRhCmZ1bmN0aW9uIHlpbkNNTkQoZCl7CiAgY29uc3QgY21uZCA9IG5ldyBGbG9hdDMyQXJyYXkoZC5sZW5ndGgpOwogIGNtbmRbMF0gPSAxOwogIGxldCBydW5uaW5nU3VtID0gMDsKICBmb3IobGV0IHRhdT0xO3RhdTxkLmxlbmd0aDt0YXUrKyl7CiAgICBydW5uaW5nU3VtICs9IGRbdGF1XTsKICAgIGNtbmRbdGF1XSA9IChydW5uaW5nU3VtID09PSAwKSA/IDAgOiBkW3RhdV0gKiB0YXUgLyBydW5uaW5nU3VtOwogIH0KICByZXR1cm4gY21uZDsKfQoKLy8gUGFyYWJvbGljIGludGVycG9sYXRpb24gcGVyIHN1Yi1zYW1wbGUgcHJlY2lzaW9uCmZ1bmN0aW9uIHBhcmFib2xpY0ludGVycChhcnIsIHgpewogIGlmKHg8PTAgfHwgeD49YXJyLmxlbmd0aC0xKSByZXR1cm4geDsKICBjb25zdCBhPWFyclt4LTFdLCBiPWFyclt4XSwgYz1hcnJbeCsxXTsKICBjb25zdCBkZW5vbSA9IDIqKGEgLSAyKmIgKyBjKTsKICBpZihNYXRoLmFicyhkZW5vbSk8MWUtMTApIHJldHVybiB4OwogIHJldHVybiB4ICsgKGEgLSBjKS9kZW5vbTsKfQoKLy8gUmlsZXZhemlvbmUgcGl0Y2ggcHJpbmNpcGFsZSBjb24gWUlOCmZ1bmN0aW9uIGRldGVjdFBpdGNoWUlOKGJ1Ziwgc3IpewogIGNvbnN0IHJtcyA9IGNhbGNSTVMoYnVmKTsKICBpZihybXMgPCBSTVNfTUlOKSByZXR1cm4ge2ZyZXE6LTEsIGNvbmZpZGVuY2U6MCwgcm1zfTsKCiAgY29uc3QgVyA9IE1hdGguZmxvb3IoYnVmLmxlbmd0aCAvIDIpOwogIGNvbnN0IGQgICAgPSB5aW5EaWZmZXJlbmNlKGJ1ZiwgVyk7CiAgY29uc3QgY21uZCA9IHlpbkNNTkQoZCk7CgogIC8vIENhbGNvbGEgdGF1X21pbiBjb3JyaXNwb25kZW50ZSBhIEZSRVFfTUFYCiAgLy8gQ2FsY29sYSB0YXVfbWF4IGNvcnJpc3BvbmRlbnRlIGEgRlJFUV9NSU4KICBjb25zdCB0YXVNaW4gPSBNYXRoLmZsb29yKHNyIC8gRlJFUV9NQVgpOwogIGNvbnN0IHRhdU1heCA9IE1hdGgubWluKFctMSwgTWF0aC5jZWlsKHNyIC8gRlJFUV9NSU4pKTsKCiAgY29uc3QgdGhyZXNob2xkID0gMC4xMDsgLy8gWUlOIHRocmVzaG9sZCDigJQgcGnDuSBiYXNzbyA9IHBpw7kgc2Vuc2liaWxlCgogIC8vIENlcmNhIGlsIHByaW1vIG1pbmltbyBzb3R0byBsYSBzb2dsaWEKICBsZXQgYmVzdFRhdSA9IC0xOwogIGxldCBiZXN0VmFsID0gMTsKCiAgLy8gUHJpbWEgcGFzczogY2VyY2EgbWluaW1vIHNvdHRvIHNvZ2xpYQogIGZvcihsZXQgdGF1PXRhdU1pbjsgdGF1PD10YXVNYXg7IHRhdSsrKXsKICAgIGlmKGNtbmRbdGF1XSA8IHRocmVzaG9sZCl7CiAgICAgIC8vIFZlcmlmaWNhIGNoZSBzaWEgdW4gbWluaW1vIGxvY2FsZQogICAgICB3aGlsZSh0YXUrMTw9dGF1TWF4ICYmIGNtbmRbdGF1KzFdPGNtbmRbdGF1XSkgdGF1Kys7CiAgICAgIGJlc3RUYXUgPSB0YXU7CiAgICAgIGJlc3RWYWwgPSBjbW5kW3RhdV07CiAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgLy8gU2Ugbm9uIHRyb3ZhdG8gc290dG8gc29nbGlhLCB1c2EgaWwgbWluaW1vIGFzc29sdXRvCiAgaWYoYmVzdFRhdSA9PT0gLTEpewogICAgZm9yKGxldCB0YXU9dGF1TWluOyB0YXU8PXRhdU1heDsgdGF1KyspewogICAgICBpZihjbW5kW3RhdV0gPCBiZXN0VmFsKXsgYmVzdFZhbD1jbW5kW3RhdV07IGJlc3RUYXU9dGF1OyB9CiAgICB9CiAgfQoKICBpZihiZXN0VGF1ID09PSAtMSB8fCBiZXN0VmFsID4gMC4zNSkgcmV0dXJuIHtmcmVxOi0xLCBjb25maWRlbmNlOjAsIHJtc307CgogIC8vIFN1Yi1zYW1wbGUgY29uIGludGVycG9sYXppb25lIHBhcmFib2xpY2EKICBjb25zdCB0YXVJbnRlcnAgPSBwYXJhYm9saWNJbnRlcnAoY21uZCwgYmVzdFRhdSk7CiAgY29uc3QgZnJlcSA9IHNyIC8gdGF1SW50ZXJwOwoKICBpZihmcmVxIDwgRlJFUV9NSU4gfHwgZnJlcSA+IEZSRVFfTUFYKSByZXR1cm4ge2ZyZXE6LTEsIGNvbmZpZGVuY2U6MCwgcm1zfTsKCiAgLy8gQ29uZmlkZW5jZTogcGnDuSBiYXNzbyBjbW5kID0gcGnDuSBzaWN1cm87IHNjYWxhIGludmVydGl0YQogIGNvbnN0IGNvbmZpZGVuY2UgPSBjbGFtcCgxIC0gYmVzdFZhbCwgMCwgMSkgKiBjbGFtcChybXMvMC4wNSwgMC4xLCAxKTsKCiAgcmV0dXJuIHtmcmVxLCBjb25maWRlbmNlLCBybXN9Owp9CgovLyDilIDilIDilIAgQ09SUkVaSU9ORSBPVFRBVkEgdmlhIEhQUyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKLy8gU2UgbGEgbm90YSByaWxldmF0YSDDqCB0cm9wcG8gYmFzc2EgcmlzcGV0dG8gYWwgc2VnbmFsZSBGRlQsIGNvcnJlZ2dpIGFsbCdvdHRhdmEgc3VwZXJpb3JlLgovLyBRdWVzdG8gcmlzb2x2ZSBpbCBwcm9ibGVtYSBjbGFzc2ljbyBkaSBjaGl0YXJyYSBkb3ZlIHNpIHJpbGV2YSBsYSBmb25kYW1lbnRhbGUgc2JhZ2xpYXRhLgpmdW5jdGlvbiBjb3JyZWN0T2N0YXZlSFBTKGRldGVjdGVkRnJlcSwgZmZ0QnVmLCBzcil7CiAgaWYoIWZmdEJ1ZiB8fCBmZnRCdWYubGVuZ3RoID09PSAwKSByZXR1cm4gZGV0ZWN0ZWRGcmVxOwoKICAvLyBGdW56aW9uZSBwZXIgb3R0ZW5lcmUgYW1waWV6emEgRkZUIGEgdW5hIGNlcnRhIGZyZXF1ZW56YSAoaW50ZXJwb2xhemlvbmUgbGluZWFyZSkKICBjb25zdCBnZXRBbXAgPSAoZikgPT4gewogICAgY29uc3QgYmluID0gZiAqIGZmdEJ1Zi5sZW5ndGggLyBzcjsKICAgIGNvbnN0IGkgPSBNYXRoLmZsb29yKGJpbik7CiAgICBpZihpPDAgfHwgaT49ZmZ0QnVmLmxlbmd0aC0xKSByZXR1cm4gMDsKICAgIGNvbnN0IGZyYWMgPSBiaW4gLSBpOwogICAgLy8gZmZ0QnVmIGNvbnRpZW5lIGRCIChkYSBnZXRGbG9hdEZyZXF1ZW5jeURhdGEpLCBub3JtYWxpenphCiAgICBjb25zdCBhID0gTWF0aC5wb3coMTAsIGZmdEJ1ZltpXS8yMCk7CiAgICBjb25zdCBiID0gTWF0aC5wb3coMTAsIGZmdEJ1ZltpKzFdLzIwKTsKICAgIHJldHVybiBhKigxLWZyYWMpICsgYipmcmFjOwogIH07CgogIGNvbnN0IGYxID0gZGV0ZWN0ZWRGcmVxOwogIGNvbnN0IGYyID0gZGV0ZWN0ZWRGcmVxICogMjsgLy8gb3R0YXZhIHNvcHJhCiAgaWYoZjIgPiBGUkVRX01BWCkgcmV0dXJuIGYxOwoKICBjb25zdCBhbXAxID0gZ2V0QW1wKGYxKTsKICBjb25zdCBhbXAyID0gZ2V0QW1wKGYyKTsKCiAgLy8gU2UgbCdhcm1vbmljYSAyeCDDqCBzaWduaWZpY2F0aXZhbWVudGUgcGnDuSBmb3J0ZSBkZWxsYSBmb25kYW1lbnRhbGUgcmlsZXZhdGEsCiAgLy8gw6ggcHJvYmFiaWxlIGNoZSBsYSB2ZXJhIGZvbmRhbWVudGFsZSBzaWEgZjIgKHByb2JsZW1hIGRpIHBpdGNoIGRpbWV6emF0bykKICAvLyBQZXIgY2hpdGFycmEsIGxlIGNvcmRlIGFjdXRlIChCIGUgRSkgc3Blc3NvIGhhbm5vIGFybW9uaWNoZSBwacO5IGZvcnRpCiAgaWYoYW1wMiA+IGFtcDEgKiAxLjYpewogICAgLy8gVmVyaWZpY2EgY2hlIGYyIHNpYSB1bmEgbm90YSB2YWxpZGEgZGkgY2hpdGFycmEKICAgIGlmKGYyID49IEZSRVFfTUlOICYmIGYyIDw9IEZSRVFfTUFYKSByZXR1cm4gZjI7CiAgfQoKICByZXR1cm4gZjE7Cn0KCi8vIOKUgOKUgOKUgCBTTU9PVEhJTkcgRSBTVEFUTyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKbGV0IHNtb290aEZyZXE9bnVsbCwgbGFzdFN0YWJsZU1pZGk9bnVsbCwgc3RhYmxlRnJhbWVzPTA7CgpmdW5jdGlvbiBhZGFwdGl2ZUFscGhhKGZyZXEpewogIC8vIFBlciBub3RlIGFjdXRlICg+NTAwSHopIHNtb290aGluZyBwacO5IHZlbG9jZSBwZXIgbm9uIHBlcmRlcmUgc3RhYmlsaXTDoAogIGlmKGZyZXEgPiA1MDApIHJldHVybiAwLjQ1OwogIGlmKGZyZXEgPiAyNTApIHJldHVybiAwLjMyOwogIHJldHVybiAwLjIyOwp9CgovLyDilIDilIDilIAgVVBEQVRFIFVJIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgApsZXQgbGFzdFJhbmdlPTE1MDsKZnVuY3Rpb24gc2V0U3RhdHVzKHR5cGUsdGV4dCl7CiAgc3RhdHVzRWwuY2xhc3NOYW1lPSJzdGF0dXMiKyh0eXBlPygiICIrdHlwZSk6IiIpOwogIHN0YXR1c0VsLnRleHRDb250ZW50PXRleHQ7Cn0KZnVuY3Rpb24gdXBkYXRlVUkoZnJlcSl7CiAgY29uc3QgbWlkaT1mcmVxVG9NaWRpKGZyZXEpOwogIGNvbnN0IG1pZGlSPU1hdGgucm91bmQobWlkaSk7CiAgY29uc3QgdGFyZ2V0PW1pZGlUb0ZyZXEobWlkaVIpOwogIGNvbnN0IGNlbnRzPWNlbnRzRGlmZihmcmVxLHRhcmdldCk7CiAgY29uc3QgYWJzQz1NYXRoLmFicyhjZW50cyk7CiAgY29uc3QgcmFuZ2U9Z2V0Wm9vbVJhbmdlKGFic0MpOwoKICBpZihyYW5nZSE9PWxhc3RSYW5nZSl7IGxhc3RSYW5nZT1yYW5nZTsgZHJhd1NjYWxlKHJhbmdlKTsgfQoKICBjb25zdCBjbGFtcGVkPWNsYW1wKGNlbnRzLC1yYW5nZSxyYW5nZSk7CiAgY29uc3QgbWF4UGN0PTQ4OwogIGNvbnN0IHBjdD0oY2xhbXBlZC9yYW5nZSkqbWF4UGN0OwogIG5lZWRsZUVsLnN0eWxlLmxlZnQ9YGNhbGMoNTAlICsgJHtwY3R9JSlgOwoKICBpZihhYnNDPD0zKSBuZWVkbGVFbC5jbGFzc0xpc3QuYWRkKCJvayIpOyBlbHNlIG5lZWRsZUVsLmNsYXNzTGlzdC5yZW1vdmUoIm9rIik7CgogIG5vdGVOYW1lRWwudGV4dENvbnRlbnQ9Zm9ybWF0TmFtZUJvdGgobWlkaSk7CiAgZnJlcU5vd0VsLnRleHRDb250ZW50PWAke2ZyZXEudG9GaXhlZCgyKX0gSHpgOwogIGRlbHRhTm93RWwudGV4dENvbnRlbnQ9YCR7Y2VudHM+PTA/IisiOiIifSR7TWF0aC5yb3VuZChjZW50cyl9IGNlbnRzYDsKCiAgaWYoYWJzQzw9MykgICAgICBzZXRTdGF0dXMoImdvb2QiLCLinJMgUGVyZmV0dG8gKMKxMyBjZW50cykiKTsKICBlbHNlIGlmKGFic0M8PTgpIHNldFN0YXR1cyhjZW50czwwPyJsb3ciOiJoaWdoIiwgY2VudHM8MD8i4oaTIEFsemEgbGVnZ2VybWVudGUiOiLihpEgQWJiYXNzYSBsZWdnZXJtZW50ZSIpOwogIGVsc2UgICAgICAgICAgICAgc2V0U3RhdHVzKGNlbnRzPDA/ImxvdyI6ImhpZ2giLCBjZW50czwwPyLihpMgVHJvcHBvIGJhc3NhICh0aXJhKSI6IuKGkSBUcm9wcG8gYWx0YSAobW9sbGEpIik7Cn0KCi8vIOKUgOKUgOKUgCBCVUZGRVIgRkZUIFNFUEFSQVRPIHBlciBIUFMg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmNvbnN0IEZGVF9GUkVRX1NJWkUgPSA4MTkyOyAvLyBncmFuZGUgcGVyIHJpc29sdXppb25lIGluIGZyZXF1ZW56YQpsZXQgYW5hbHlzZXJGcmVxOwpjb25zdCBGUkVRX0JVRiA9IG5ldyBGbG9hdDMyQXJyYXkoRkZUX0ZSRVFfU0laRS8yKTsKCi8vIOKUgOKUgOKUgCBCVUZGRVIgUFJJTkNJUEFMRSDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKY29uc3QgQlVGID0gbmV3IEZsb2F0MzJBcnJheShGRlRfU0laRSk7CgovLyDilIDilIDilIAgTE9PUCBQUklOQ0lQQUxFIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgApmdW5jdGlvbiB0aWNrKCl7CiAgaWYoIWlzUnVubmluZykgcmV0dXJuOwoKICBhbmFseXNlci5nZXRGbG9hdFRpbWVEb21haW5EYXRhKEJVRik7CgogIC8vIENvcGlhIGJ1ZmZlciBwZXIgWUlOCiAgY29uc3QgdG1wID0gbmV3IEZsb2F0MzJBcnJheShCVUYpOwoKICAvLyBQaXRjaCBkZXRlY3Rpb24gY29uIFlJTgogIGxldCB7ZnJlcSwgY29uZmlkZW5jZSwgcm1zfSA9IGRldGVjdFBpdGNoWUlOKHRtcCwgYXVkaW9Db250ZXh0LnNhbXBsZVJhdGUpOwoKICBjb25zdCB2YWxpZCA9IChmcmVxID4gRlJFUV9NSU4gJiYgZnJlcSA8IEZSRVFfTUFYICYmIGNvbmZpZGVuY2UgPj0gQ09ORl9NSU4pOwoKICBpZighdmFsaWQpewogICAgc3RhYmxlRnJhbWVzID0gMDsKICAgIHNldFN0YXR1cygiIiwgIkFzY29sdG/igKYgKHN1b25hIHVuYSBub3RhKSIpOwogICAgcmFmSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGljayk7CiAgICByZXR1cm47CiAgfQoKICAvLyBDb3JyZXppb25lIG90dGF2YSBjb24gRkZUCiAgaWYoYW5hbHlzZXJGcmVxKXsKICAgIGFuYWx5c2VyRnJlcS5nZXRGbG9hdEZyZXF1ZW5jeURhdGEoRlJFUV9CVUYpOwogICAgZnJlcSA9IGNvcnJlY3RPY3RhdmVIUFMoZnJlcSwgRlJFUV9CVUYsIGF1ZGlvQ29udGV4dC5zYW1wbGVSYXRlKTsKICB9CgogIC8vIFNtb290aGluZyBhZGF0dGl2bwogIGNvbnN0IGFscGhhID0gYWRhcHRpdmVBbHBoYShmcmVxKTsKICBzbW9vdGhGcmVxID0gKHNtb290aEZyZXEgPT0gbnVsbCkgPyBmcmVxIDogKHNtb290aEZyZXEqKDEtYWxwaGEpICsgZnJlcSphbHBoYSk7CgogIGNvbnN0IG1pZGlOb3cgPSBmcmVxVG9NaWRpKHNtb290aEZyZXEpOwogIGNvbnN0IG1pZGlSICAgPSBNYXRoLnJvdW5kKG1pZGlOb3cpOwoKICBpZihsYXN0U3RhYmxlTWlkaSA9PSBudWxsKXsgbGFzdFN0YWJsZU1pZGk9bWlkaVI7IHN0YWJsZUZyYW1lcz0xOyB9CiAgZWxzZXsKICAgIGNvbnN0IHRhcmdldCA9IG1pZGlUb0ZyZXEobGFzdFN0YWJsZU1pZGkpOwogICAgY29uc3QgY2VudHNGcm9tID0gY2VudHNEaWZmKHNtb290aEZyZXEsIHRhcmdldCk7CiAgICBpZihNYXRoLmFicyhjZW50c0Zyb20pIDw9IE5PVEVfSFlTVEVSRVNJU19DRU5UUyl7CiAgICAgIHN0YWJsZUZyYW1lcysrOwogICAgfSBlbHNlIHsKICAgICAgc3RhYmxlRnJhbWVzID0gTWF0aC5tYXgoMCwgc3RhYmxlRnJhbWVzLTEpOwogICAgICBpZihzdGFibGVGcmFtZXMgPD0gMCl7IGxhc3RTdGFibGVNaWRpPW1pZGlSOyBzdGFibGVGcmFtZXM9MTsgfQogICAgfQogIH0KCiAgaWYoc3RhYmxlRnJhbWVzID49IFNUQUJMRV9GUkFNRVNfUkVRVUlSRUQpIHVwZGF0ZVVJKHNtb290aEZyZXEpOwogIGVsc2Ugc2V0U3RhdHVzKCIiLCAiU3RhYmlsaXp6b+KApiIpOwoKICByYWZJZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aWNrKTsKfQoKLy8g4pSA4pSA4pSAIEZVTExTQ1JFRU4g4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmFzeW5jIGZ1bmN0aW9uIGVudGVyRnVsbHNjcmVlbigpewogIHRyeXsKICAgIGlmKCFkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCl7CiAgICAgIGF3YWl0IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZXF1ZXN0RnVsbHNjcmVlbih7bmF2aWdhdGlvblVJOiJoaWRlIn0pOwogICAgfQogIH1jYXRjaChlKXt9Cn0KYXN5bmMgZnVuY3Rpb24gZXhpdEZ1bGxzY3JlZW4oKXsKICB0cnl7IGlmKGRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50KSBhd2FpdCBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpOyB9Y2F0Y2goZSl7fQp9CgovLyDilIDilIDilIAgU1RBUlQg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmFzeW5jIGZ1bmN0aW9uIHN0YXJ0KCl7CiAgaGlkZUVycigpOwogIGlmKCF3aW5kb3cuaXNTZWN1cmVDb250ZXh0KXsKICAgIHNob3dFcnIoIkVSUk9SRTogbWljcm9mb25vIHJpY2hpZWRlIEhUVFBTLlxuQXByaSBsYSBwYWdpbmEgc3UgaHR0cHM6Ly8gKG5vbiBmaWxlOi8vKS4iKTsKICAgIHJldHVybjsKICB9CiAgaWYoIW5hdmlnYXRvci5tZWRpYURldmljZXMgfHwgIW5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKXsKICAgIHNob3dFcnIoIkVSUk9SRTogZ2V0VXNlck1lZGlhIG5vbiBzdXBwb3J0YXRvIGRhbCBicm93c2VyLiIpOwogICAgcmV0dXJuOwogIH0KCiAgc3RhcnRCdG4uZGlzYWJsZWQ9dHJ1ZTsKICBzdGFydEJ0bi50ZXh0Q29udGVudD0iQVZWSU/igKYiOwoKICB0cnl7CiAgICBzdHJlYW1SZWYgPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7CiAgICAgIGF1ZGlvOnsgZWNob0NhbmNlbGxhdGlvbjpmYWxzZSwgbm9pc2VTdXBwcmVzc2lvbjpmYWxzZSwgYXV0b0dhaW5Db250cm9sOmZhbHNlIH0KICAgIH0pOwoKICAgIGF1ZGlvQ29udGV4dCA9IG5ldyAod2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KSgpOwogICAgaWYoYXVkaW9Db250ZXh0LnN0YXRlPT09InN1c3BlbmRlZCIpIGF3YWl0IGF1ZGlvQ29udGV4dC5yZXN1bWUoKTsKCiAgICAvLyBBbmFseXNlciBwcmluY2lwYWxlIHBlciB0aW1lLWRvbWFpbiAoWUlOKQogICAgYW5hbHlzZXIgPSBhdWRpb0NvbnRleHQuY3JlYXRlQW5hbHlzZXIoKTsKICAgIGFuYWx5c2VyLmZmdFNpemUgPSBGRlRfU0laRTsKICAgIGFuYWx5c2VyLnNtb290aGluZ1RpbWVDb25zdGFudCA9IDA7IC8vIG5lc3N1bm8gc21vb3RoaW5nIGludGVybm8g4oCUIGxvIGZhY2NpYW1vIG5vaQoKICAgIC8vIEFuYWx5c2VyIHNlY29uZGFyaW8gcGVyIGZyZXF1ZW56ZSAoSFBTIG9jdGF2ZSBjb3JyZWN0aW9uKQogICAgYW5hbHlzZXJGcmVxID0gYXVkaW9Db250ZXh0LmNyZWF0ZUFuYWx5c2VyKCk7CiAgICBhbmFseXNlckZyZXEuZmZ0U2l6ZSA9IEZGVF9GUkVRX1NJWkU7CiAgICBhbmFseXNlckZyZXEuc21vb3RoaW5nVGltZUNvbnN0YW50ID0gMC41OwoKICAgIC8vIEZpbHRybyBwYXNzYS1hbHRvOiBlbGltaW5hIHJ1bW9yaSBzb3R0byB+NzBIeiAoYm90dGksIHZpYnJhemlvbmksIEFDKQogICAgY29uc3QgaGlwYXNzID0gYXVkaW9Db250ZXh0LmNyZWF0ZUJpcXVhZEZpbHRlcigpOwogICAgaGlwYXNzLnR5cGUgPSAiaGlnaHBhc3MiOwogICAgaGlwYXNzLmZyZXF1ZW5jeS52YWx1ZSA9IDcwOwogICAgaGlwYXNzLlEudmFsdWUgPSAwLjc7CgogICAgLy8gRmlsdHJvIHBhc3NhLWJhc3NvOiBlbGltaW5hIGZyZXF1ZW56ZSBzb3ByYSByYW5nZSBjaGl0YXJyYSAofjE0MDBIeikKICAgIGNvbnN0IGxvcGFzcyA9IGF1ZGlvQ29udGV4dC5jcmVhdGVCaXF1YWRGaWx0ZXIoKTsKICAgIGxvcGFzcy50eXBlID0gImxvd3Bhc3MiOwogICAgbG9wYXNzLmZyZXF1ZW5jeS52YWx1ZSA9IDE0MDA7CiAgICBsb3Bhc3MuUS52YWx1ZSA9IDAuNzsKCiAgICBtaWNTb3VyY2UgPSBhdWRpb0NvbnRleHQuY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2Uoc3RyZWFtUmVmKTsKICAgIG1pY1NvdXJjZS5jb25uZWN0KGhpcGFzcyk7CiAgICBoaXBhc3MuY29ubmVjdChsb3Bhc3MpOwogICAgbG9wYXNzLmNvbm5lY3QoYW5hbHlzZXIpOwogICAgbG9wYXNzLmNvbm5lY3QoYW5hbHlzZXJGcmVxKTsKCiAgICBpc1J1bm5pbmcgPSB0cnVlOwogICAgc21vb3RoRnJlcT1udWxsOyBsYXN0U3RhYmxlTWlkaT1udWxsOyBzdGFibGVGcmFtZXM9MDsKCiAgICBsYXN0UmFuZ2UgPSA5OTk7CiAgICBkcmF3U2NhbGUoMTUwKTsKICAgIGxhc3RSYW5nZSA9IDE1MDsKCiAgICBzZXRTdGF0dXMoIiIsICJBc2NvbHRv4oCmIChzdW9uYSB1bmEgbm90YSkiKTsKICAgIHN0b3BCdG4uc3R5bGUuZGlzcGxheT0iaW5saW5lLWZsZXgiOwogICAgc3RhcnRPdmVybGF5LnN0eWxlLmRpc3BsYXk9Im5vbmUiOwoKICAgIGF3YWl0IGVudGVyRnVsbHNjcmVlbigpOwoKICAgIGlmKHJhZklkKSBjYW5jZWxBbmltYXRpb25GcmFtZShyYWZJZCk7CiAgICByYWZJZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aWNrKTsKCiAgfWNhdGNoKGVycil7CiAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICBjb25zdCBuYW1lID0gZXJyICYmIGVyci5uYW1lID8gZXJyLm5hbWUgOiAiIjsKICAgIGxldCBtc2cgPSAiUGVybWVzc28gbWljcm9mb25vIG5lZ2F0by9ub24gZGlzcG9uaWJpbGUuXG4iOwogICAgaWYobmFtZT09PSJOb3RBbGxvd2VkRXJyb3IifHxuYW1lPT09IlNlY3VyaXR5RXJyb3IiKSBtc2crPSJDb25zZW50aSBpbCBtaWNyb2Zvbm8gKGx1Y2NoZXR0byBkZWwgYnJvd3NlcikgZSByaWNhcmljYS4iOwogICAgZWxzZSBpZihuYW1lPT09Ik5vdEZvdW5kRXJyb3IiKSBtc2crPSJOZXNzdW4gbWljcm9mb25vIHJpbGV2YXRvIHN1bCBkaXNwb3NpdGl2by4iOwogICAgZWxzZSBpZihuYW1lPT09Ik5vdFJlYWRhYmxlRXJyb3IiKSBtc2crPSJNaWNyb2Zvbm8gb2NjdXBhdG8gZGEgdW4nYWx0cmEgYXBwLiBDaGl1ZGkgYWx0cmUgYXBwIGUgcmlwcm92YS4iOwogICAgZWxzZSBtc2crPSJSaXByb3ZhIG8gY2FtYmlhIGJyb3dzZXIgKENocm9tZS9FZGdlL1NhZmFyaSkuIjsKICAgIHNob3dFcnIobXNnKTsKICAgIHN0YXJ0T3ZlcmxheS5zdHlsZS5kaXNwbGF5PSJmbGV4IjsKICB9IGZpbmFsbHkgewogICAgc3RhcnRCdG4uZGlzYWJsZWQ9ZmFsc2U7CiAgICBzdGFydEJ0bi50ZXh0Q29udGVudD0iQVZWSUEiOwogIH0KfQoKLy8g4pSA4pSA4pSAIFNUT1Ag4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmZ1bmN0aW9uIHN0b3AoKXsKICBpc1J1bm5pbmc9ZmFsc2U7CiAgaWYocmFmSWQpIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHJhZklkKTsKICByYWZJZD1udWxsOwoKICB0cnl7IGlmKG1pY1NvdXJjZSkgbWljU291cmNlLmRpc2Nvbm5lY3QoKTsgfWNhdGNoKGUpe30KICB0cnl7IGlmKGF1ZGlvQ29udGV4dCkgYXVkaW9Db250ZXh0LmNsb3NlKCk7IH1jYXRjaChlKXt9CiAgaWYoc3RyZWFtUmVmKXsgdHJ5eyBzdHJlYW1SZWYuZ2V0VHJhY2tzKCkuZm9yRWFjaCh0PT50LnN0b3AoKSk7IH1jYXRjaChlKXt9IH0KCiAgbWljU291cmNlPW51bGw7IGFuYWx5c2VyPW51bGw7IGFuYWx5c2VyRnJlcT1udWxsOyBhdWRpb0NvbnRleHQ9bnVsbDsgc3RyZWFtUmVmPW51bGw7CiAgc21vb3RoRnJlcT1udWxsOyBsYXN0U3RhYmxlTWlkaT1udWxsOyBzdGFibGVGcmFtZXM9MDsKCiAgc3RvcEJ0bi5zdHlsZS5kaXNwbGF5PSJub25lIjsKICBzZXRTdGF0dXMoIiIsICJGZXJtYXRvIik7CiAgbm90ZU5hbWVFbC50ZXh0Q29udGVudD0i4oCUIjsKICBmcmVxTm93RWwudGV4dENvbnRlbnQ9IuKAlCBIeiI7CiAgZGVsdGFOb3dFbC50ZXh0Q29udGVudD0iMCBjZW50cyI7CiAgbmVlZGxlRWwuc3R5bGUubGVmdD0iNTAlIjsKICBuZWVkbGVFbC5jbGFzc0xpc3QucmVtb3ZlKCJvayIpOwoKICBzdGFydE92ZXJsYXkuc3R5bGUuZGlzcGxheT0iZmxleCI7CiAgZXhpdEZ1bGxzY3JlZW4oKTsKfQoKLy8g4pSA4pSA4pSAIFJJRkVSSU1FTlRPIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgApmdW5jdGlvbiBzZXRSZWZlcmVuY2UodmFsKXsKICByZWZlcmVuY2VBNCA9IGNsYW1wKE51bWJlcih2YWx8fDQ0MCksIDM4MCwgNTIwKTsKICByZWZWYWwudGV4dENvbnRlbnQgID0gYCR7cmVmZXJlbmNlQTQudG9GaXhlZCgxKX0gSHpgOwogIG92ZXJsYXlSZWYudGV4dENvbnRlbnQgPSBgJHtyZWZlcmVuY2VBNC50b0ZpeGVkKDEpfSBIemA7CiAgcmVmSW5wdXQudmFsdWUgPSByZWZlcmVuY2VBNC50b0ZpeGVkKDEpOwp9CnNldFJlZmVyZW5jZSg0NDApOwoKZnVuY3Rpb24gb3BlblJlZk1vZGFsKCl7IHJlZk1vZGFsLmNsYXNzTGlzdC5hZGQoInNob3ciKTsgfQpmdW5jdGlvbiBjbG9zZVJlZk1vZGFsKCl7IHJlZk1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoInNob3ciKTsgfQoKLy8g4pSA4pSA4pSAIEVWRU5USSDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKc3RhcnRCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBzdGFydCk7CnN0b3BCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBzdG9wKTsKb3ZlcmxheVJlZkJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIG9wZW5SZWZNb2RhbCk7CnJlZkJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIG9wZW5SZWZNb2RhbCk7CnJlZkFwcGx5LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCk9Pnsgc2V0UmVmZXJlbmNlKHJlZklucHV0LnZhbHVlKTsgY2xvc2VSZWZNb2RhbCgpOyB9KTsKcmVmQ2xvc2UuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBjbG9zZVJlZk1vZGFsKTsKcmVmTW9kYWwuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoZSk9PnsgaWYoZS50YXJnZXQ9PT1yZWZNb2RhbCkgY2xvc2VSZWZNb2RhbCgpOyB9KTsKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigidmlzaWJpbGl0eWNoYW5nZSIsICgpPT57IGlmKGRvY3VtZW50LmhpZGRlbiAmJiBpc1J1bm5pbmcpIHN0b3AoKTsgfSk7CgpzdGFydE92ZXJsYXkuc3R5bGUuZGlzcGxheT0iZmxleCI7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K", "Loop": "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9Iml0Ij4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCxpbml0aWFsLXNjYWxlPTEiIC8+CiAgPHRpdGxlPm1hcmFjYWxvb3AgUFJPPC90aXRsZT4KICA8c3R5bGU+CiAgICA6cm9vdHsKICAgICAgLS1iZzojMGEwYzEwOyAtLXRleHQ6I2U4ZWVmZjsgLS1tdXRlZDojODg5NGI4OwogICAgICAtLXN0cm9rZTojMjMyYjNlOyAtLXN0cm9rZTI6IzE4MWYzMDsgLS1zaGFkb3c6MCAxMnB4IDM2cHggcmdiYSgwLDAsMCwuNTUpOwogICAgICAtLXJlZDojZmYzNTM1OyAtLWdyZWVuOiMzZGZmYjA7IC0tY3lhbjojM2RkYWZmOyAtLXllbGxvdzojZmZkYTQ0OwogICAgICAtLXJhZGl1czoxNnB4OwogICAgfQogICAgKntib3gtc2l6aW5nOmJvcmRlci1ib3g7IG1hcmdpbjowOyBwYWRkaW5nOjA7fQogICAgYm9keXsKICAgICAgY29sb3I6dmFyKC0tdGV4dCk7CiAgICAgIGZvbnQtZmFtaWx5OnN5c3RlbS11aSwtYXBwbGUtc3lzdGVtLFNlZ29lIFVJLFJvYm90byxBcmlhbCxzYW5zLXNlcmlmOwogICAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoMTQwMHB4IDgwMHB4IGF0IDI1JSAxMCUsICMxMTFiMzUgMCUsIHRyYW5zcGFyZW50IDYwJSksCiAgICAgICAgICAgICAgICAgIHJhZGlhbC1ncmFkaWVudCgxMDAwcHggNjAwcHggYXQgODAlIDQwJSwgIzBkMjgyMCAwJSwgdHJhbnNwYXJlbnQgNjAlKSwKICAgICAgICAgICAgICAgICAgdmFyKC0tYmcpOwogICAgICBtaW4taGVpZ2h0OjEwMHZoOyBkaXNwbGF5OmZsZXg7IGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgfQoKICAgIC8qID09PT09IEZMT0FUSU5HIFNUUklQID09PT09ICovCiAgICAubWV0cm8tZmxvYXR7CiAgICAgIHBvc2l0aW9uOnN0aWNreTsgdG9wOjA7IHotaW5kZXg6MTAwMDsKICAgICAgd2lkdGg6MTAwJTsgcGFkZGluZzo4cHggMjRweDsKICAgICAgZGlzcGxheTpmbGV4OyBhbGlnbi1pdGVtczpjZW50ZXI7IGdhcDoxNnB4OwogICAgICBiYWNrZ3JvdW5kOnJnYmEoMTAsMTIsMTYsLjg4KTsKICAgICAgYmFja2Ryb3AtZmlsdGVyOmJsdXIoMTRweCk7IC13ZWJraXQtYmFja2Ryb3AtZmlsdGVyOmJsdXIoMTRweCk7CiAgICAgIGJvcmRlci1ib3R0b206MXB4IHNvbGlkIHJnYmEoMzUsNDMsNjIsLjYpOwogICAgfQogICAgLm1mLWluZm97IGRpc3BsYXk6ZmxleDsgZmxleC1kaXJlY3Rpb246Y29sdW1uOyBnYXA6MXB4OyBtaW4td2lkdGg6ODBweDsgfQogICAgLm1mLWxhYmVseyBmb250LXNpemU6MTBweDsgbGV0dGVyLXNwYWNpbmc6LjE0ZW07IGNvbG9yOnZhcigtLW11dGVkKTsgdGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlOyB9CiAgICAubWYtYnBteyBmb250LXNpemU6MjBweDsgZm9udC13ZWlnaHQ6ODAwOyBsZXR0ZXItc3BhY2luZzouMDRlbTsgfQogICAgLm1mLXNpZ3sgZm9udC1zaXplOjEycHg7IGNvbG9yOnZhcigtLW11dGVkKTsgfQogICAgLm1mLWxlZHN7IGRpc3BsYXk6ZmxleDsgYWxpZ24taXRlbXM6Y2VudGVyOyBnYXA6OXB4OyBmbGV4OjE7IH0KICAgIC5tZi1yaWdodHsgZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgYWxpZ24taXRlbXM6Y2VudGVyOyBtYXJnaW4tbGVmdDphdXRvOyB9CgogICAgLyogPT09PT0gTEVEUyA9PT09PSAqLwogICAgLmxlZHN7IGRpc3BsYXk6ZmxleDsgZ2FwOjdweDsgYWxpZ24taXRlbXM6Y2VudGVyOyB9CiAgICAubGVkewogICAgICB3aWR0aDoxMXB4OyBoZWlnaHQ6MTFweDsgYm9yZGVyLXJhZGl1czo1MCU7CiAgICAgIGJhY2tncm91bmQ6IzI1MmIzYTsKICAgICAgYm94LXNoYWRvdzowIDAgMCAxcHggcmdiYSgyNTUsMjU1LDI1NSwuMDQpIGluc2V0OwogICAgICB0cmFuc2l0aW9uOmJhY2tncm91bmQgLjA0cywgZmlsdGVyIC4wNHMsIHRyYW5zZm9ybSAuMDRzOwogICAgfQogICAgLmxlZC5vbnsKICAgICAgYmFja2dyb3VuZDp2YXIoLS1jeWFuKTsKICAgICAgZmlsdGVyOmRyb3Atc2hhZG93KDAgMCA4cHggcmdiYSg2MSwyMTgsMjU1LC43KSk7CiAgICAgIHRyYW5zZm9ybTpzY2FsZSgxLjE4KTsKICAgIH0KICAgIC5sZWQuYmFyLWxlZHsgd2lkdGg6MTNweDsgaGVpZ2h0OjEzcHg7IGJhY2tncm91bmQ6IzNhMWExYTsgfQogICAgLmxlZC5iYXItbGVkLm9uewogICAgICBiYWNrZ3JvdW5kOnZhcigtLXJlZCk7CiAgICAgIGZpbHRlcjpkcm9wLXNoYWRvdygwIDAgMTBweCByZ2JhKDI1NSw1Myw1MywuOCkpOwogICAgICB0cmFuc2Zvcm06c2NhbGUoMS4yMik7CiAgICB9CiAgICAubGVkLnByZWNvdW50eyB3aWR0aDoxMXB4OyBoZWlnaHQ6MTFweDsgYmFja2dyb3VuZDojMmEyMjAwOyB9CiAgICAubGVkLnByZWNvdW50Lm9uewogICAgICBiYWNrZ3JvdW5kOnZhcigtLXllbGxvdyk7CiAgICAgIGZpbHRlcjpkcm9wLXNoYWRvdygwIDAgOHB4IHJnYmEoMjU1LDIxOCw2OCwuNykpOwogICAgICB0cmFuc2Zvcm06c2NhbGUoMS4xOCk7CiAgICB9CgogICAgLyogPT09PT0gSEVBREVSID09PT09ICovCiAgICBoZWFkZXJ7CiAgICAgIHdpZHRoOm1pbigxMjAwcHgsOTZ2dyk7IHBhZGRpbmc6MTZweCA4cHggMTBweDsKICAgICAgZGlzcGxheTpmbGV4OyBhbGlnbi1pdGVtczpjZW50ZXI7IGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOyBnYXA6MTRweDsgZmxleC13cmFwOndyYXA7CiAgICB9CiAgICAudGl0bGV7IGZvbnQtc2l6ZToyNnB4OyBmb250LXdlaWdodDo4MDA7IGxldHRlci1zcGFjaW5nOi4wNmVtOyB9CiAgICAudGl0bGUgc3BhbnsgY29sb3I6dmFyKC0tY3lhbik7IH0KICAgIC50b3AtYnRuc3sgZGlzcGxheTpmbGV4OyBnYXA6OHB4OyBmbGV4LXdyYXA6d3JhcDsgYWxpZ24taXRlbXM6Y2VudGVyOyB9CgogICAgLyogPT09PT0gQlVUVE9OUyA9PT09PSAqLwogICAgLmJ0bnsKICAgICAgYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1zdHJva2UpOwogICAgICBiYWNrZ3JvdW5kOmxpbmVhci1ncmFkaWVudCgxODBkZWcscmdiYSgyNTUsMjU1LDI1NSwuMDcpLHJnYmEoMjU1LDI1NSwyNTUsLjAyKSk7CiAgICAgIGNvbG9yOnZhcigtLXRleHQpOyBwYWRkaW5nOjlweCAxNHB4OyBib3JkZXItcmFkaXVzOjExcHg7CiAgICAgIGJveC1zaGFkb3c6MCA0cHggMTRweCByZ2JhKDAsMCwwLC4yOCk7CiAgICAgIGN1cnNvcjpwb2ludGVyOyB1c2VyLXNlbGVjdDpub25lOwogICAgICBkaXNwbGF5OmlubGluZS1mbGV4OyBhbGlnbi1pdGVtczpjZW50ZXI7IGp1c3RpZnktY29udGVudDpjZW50ZXI7IGdhcDo3cHg7CiAgICAgIGZvbnQtc2l6ZToxM3B4OyB3aGl0ZS1zcGFjZTpub3dyYXA7IHRyYW5zaXRpb246ZmlsdGVyIC4xMnM7CiAgICB9CiAgICAuYnRuOmhvdmVyeyBmaWx0ZXI6YnJpZ2h0bmVzcygxLjA4KTsgYm9yZGVyLWNvbG9yOiMzYTQ1NjY7IH0KICAgIC5idG46YWN0aXZleyBmaWx0ZXI6YnJpZ2h0bmVzcyguOTIpOyB9CiAgICAuYnRuOmRpc2FibGVkeyBvcGFjaXR5Oi40OyBjdXJzb3I6bm90LWFsbG93ZWQ7IGZpbHRlcjpub25lOyB9CiAgICAuYnRuLWN5YW57IGJvcmRlci1jb2xvcjpyZ2JhKDYxLDIxOCwyNTUsLjM4KTsgfQogICAgLmJ0bi1ncmVlbnsgYm9yZGVyLWNvbG9yOnJnYmEoNjEsMjU1LDE3NiwuMzgpOyB9CiAgICAuYnRuLXJlZHsgYm9yZGVyLWNvbG9yOnJnYmEoMjU1LDUzLDUzLC4zOCk7IH0KICAgIC5idG4teWVsbG93eyBib3JkZXItY29sb3I6cmdiYSgyNTUsMjE4LDY4LC4zOCk7IH0KICAgIC5idG4tc217IHBhZGRpbmc6N3B4IDEwcHg7IGZvbnQtc2l6ZToxMnB4OyBib3JkZXItcmFkaXVzOjlweDsgfQoKICAgIC8qID09PT09IE1FVFJPIFBBTkVMID09PT09ICovCiAgICAubWV0cm8td3JhcHsKICAgICAgd2lkdGg6bWluKDEyMDBweCw5NnZ3KTsgcGFkZGluZzowIDhweCAxMnB4OwogICAgfQogICAgLm1ldHJvewogICAgICBib3JkZXI6MXB4IHNvbGlkIHZhcigtLXN0cm9rZSk7IGJvcmRlci1yYWRpdXM6dmFyKC0tcmFkaXVzKTsKICAgICAgYmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQoMTgwZGVnLHJnYmEoMjU1LDI1NSwyNTUsLjA0KSxyZ2JhKDI1NSwyNTUsMjU1LC4wMTUpKTsKICAgICAgYm94LXNoYWRvdzp2YXIoLS1zaGFkb3cpOwogICAgICBwYWRkaW5nOjEycHggMTZweDsKICAgICAgZGlzcGxheTpmbGV4OyBmbGV4LXdyYXA6d3JhcDsgZ2FwOjEwcHg7IGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgIH0KICAgIC5tZ3sKICAgICAgZGlzcGxheTpmbGV4OyBnYXA6OHB4OyBhbGlnbi1pdGVtczpjZW50ZXI7IGZsZXgtd3JhcDp3cmFwOwogICAgICBwYWRkaW5nOjdweCAxMHB4OyBib3JkZXI6MXB4IHNvbGlkIHZhcigtLXN0cm9rZTIpOwogICAgICBib3JkZXItcmFkaXVzOjEycHg7IGJhY2tncm91bmQ6cmdiYSgwLDAsMCwuMik7CiAgICB9CiAgICAubWcgbGFiZWx7IGZvbnQtc2l6ZToxMXB4OyBjb2xvcjp2YXIoLS1tdXRlZCk7IHRleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTsgbGV0dGVyLXNwYWNpbmc6LjA4ZW07IH0KICAgIC5tZyBzZWxlY3QsIC5tZyBpbnB1dFt0eXBlPSJudW1iZXIiXXsKICAgICAgYmFja2dyb3VuZDpyZ2JhKDAsMCwwLC4zKTsgYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1zdHJva2UyKTsKICAgICAgY29sb3I6dmFyKC0tdGV4dCk7IHBhZGRpbmc6NnB4IDlweDsgYm9yZGVyLXJhZGl1czo5cHg7IG91dGxpbmU6bm9uZTsgZm9udC1zaXplOjEzcHg7CiAgICB9CiAgICAubWcgaW5wdXRbdHlwZT0ibnVtYmVyIl17IHdpZHRoOjg4cHg7IH0KICAgIC5tZyBpbnB1dFt0eXBlPSJyYW5nZSJdewogICAgICAtd2Via2l0LWFwcGVhcmFuY2U6bm9uZTsgYXBwZWFyYW5jZTpub25lOwogICAgICB3aWR0aDoxNDBweDsgaGVpZ2h0OjhweDsgYm9yZGVyLXJhZGl1czo5OTlweDsKICAgICAgYmFja2dyb3VuZDpyZ2JhKDI1NSwyNTUsMjU1LC4xKTsgb3V0bGluZTpub25lOwogICAgfQogICAgLm1nIGlucHV0W3R5cGU9InJhbmdlIl06Oi13ZWJraXQtc2xpZGVyLXRodW1iewogICAgICAtd2Via2l0LWFwcGVhcmFuY2U6bm9uZTsgYXBwZWFyYW5jZTpub25lOwogICAgICB3aWR0aDoxN3B4OyBoZWlnaHQ6MTdweDsgYm9yZGVyLXJhZGl1czo1MCU7CiAgICAgIGJhY2tncm91bmQ6cmdiYSgyNTUsMjU1LDI1NSwuODgpOyBib3JkZXI6MnB4IHNvbGlkIHJnYmEoMCwwLDAsLjMpOwogICAgICBib3gtc2hhZG93OjAgNHB4IDE0cHggcmdiYSgwLDAsMCwuNDUpOyBjdXJzb3I6cG9pbnRlcjsKICAgIH0KICAgIC5icG0tdmFseyBmb250LXdlaWdodDo4MDA7IG1pbi13aWR0aDo1NHB4OyB0ZXh0LWFsaWduOnJpZ2h0OyBmb250LXNpemU6MThweDsgfQoKICAgIC8qID09PT09IFNUQVRVUyBCQVIgPT09PT0gKi8KICAgIC5zdGF0dXNiYXJ7CiAgICAgIHdpZHRoOm1pbigxMjAwcHgsOTZ2dyk7IHBhZGRpbmc6MCA4cHggMTRweDsKICAgICAgZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgZmxleC13cmFwOndyYXA7IGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgIH0KICAgIC5iYWRnZXsKICAgICAgcGFkZGluZzo1cHggMTBweDsgYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1zdHJva2UpOyBiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsLjIpOwogICAgICBib3JkZXItcmFkaXVzOjk5OXB4OyBkaXNwbGF5OmlubGluZS1mbGV4OyBhbGlnbi1pdGVtczpjZW50ZXI7IGdhcDo3cHg7CiAgICAgIGZvbnQtc2l6ZToxMnB4OyBjb2xvcjp2YXIoLS1tdXRlZCk7CiAgICB9CiAgICAuZG90e3dpZHRoOjlweDtoZWlnaHQ6OXB4O2JvcmRlci1yYWRpdXM6NTAlO2JhY2tncm91bmQ6IzQ0NDt9CiAgICAuZG90Lm9ue2JhY2tncm91bmQ6dmFyKC0tZ3JlZW4pOyBib3gtc2hhZG93OjAgMCA2cHggcmdiYSg2MSwyNTUsMTc2LC41KTt9CiAgICAuZG90LnJlY3tiYWNrZ3JvdW5kOnZhcigtLXJlZCk7IGJveC1zaGFkb3c6MCAwIDZweCByZ2JhKDI1NSw1Myw1MywuNSk7fQogICAgLmRvdC5wbGF5e2JhY2tncm91bmQ6dmFyKC0tY3lhbik7IGJveC1zaGFkb3c6MCAwIDZweCByZ2JhKDYxLDIxOCwyNTUsLjUpO30KCiAgICAvKiA9PT09PSBHUklEID09PT09ICovCiAgICBtYWluewogICAgICB3aWR0aDptaW4oMTIwMHB4LDk2dncpOyBwYWRkaW5nOjAgOHB4IDMycHg7CiAgICAgIGRpc3BsYXk6Z3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOnJlcGVhdCg0LG1pbm1heCgwLDFmcikpOyBnYXA6MTRweDsKICAgIH0KICAgIEBtZWRpYShtYXgtd2lkdGg6OTYwcHgpeyBtYWlueyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6cmVwZWF0KDIsbWlubWF4KDAsMWZyKSk7IH0gfQogICAgQG1lZGlhKG1heC13aWR0aDo1MDBweCl7IG1haW57IGdyaWQtdGVtcGxhdGUtY29sdW1uczoxZnI7IH0gfQoKICAgIC8qID09PT09IFRSQUNLIENBUkQgPT09PT0gKi8KICAgIC50cmFja3sKICAgICAgYmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQoMTYwZGVnLHJnYmEoMjU1LDI1NSwyNTUsLjA0NSkscmdiYSgyNTUsMjU1LDI1NSwuMDE1KSk7CiAgICAgIGJvcmRlcjoxcHggc29saWQgdmFyKC0tc3Ryb2tlKTsgYm9yZGVyLXJhZGl1czp2YXIoLS1yYWRpdXMpOwogICAgICBib3gtc2hhZG93OnZhcigtLXNoYWRvdyk7IHBhZGRpbmc6MTNweDsgcG9zaXRpb246cmVsYXRpdmU7IG92ZXJmbG93OmhpZGRlbjsKICAgICAgdG91Y2gtYWN0aW9uOm1hbmlwdWxhdGlvbjsKICAgICAgdHJhbnNpdGlvbjpib3JkZXItY29sb3IgLjJzOwogICAgfQogICAgLnRyYWNrLmlzLXJlY3sgYm9yZGVyLWNvbG9yOnJnYmEoMjU1LDUzLDUzLC40NSk7IH0KICAgIC50cmFjay5pcy1wbGF5eyBib3JkZXItY29sb3I6cmdiYSg2MSwyMTgsMjU1LC4zNSk7IH0KICAgIC50cmFjay5pcy1jb3VudHsgYm9yZGVyLWNvbG9yOnJnYmEoMjU1LDIxOCw2OCwuMzUpOyB9CiAgICAudHJhY2s6OmJlZm9yZXsKICAgICAgY29udGVudDoiIjsgcG9zaXRpb246YWJzb2x1dGU7IGluc2V0Oi0zMCUgLTQwJTsKICAgICAgYmFja2dyb3VuZDpyYWRpYWwtZ3JhZGllbnQoMzgwcHggMjAwcHggYXQgNDAlIDM1JSxyZ2JhKDYxLDIxOCwyNTUsLjA3KSx0cmFuc3BhcmVudCA2MCUpLAogICAgICAgICAgICAgICAgIHJhZGlhbC1ncmFkaWVudCgzNDBweCAyMjBweCBhdCA3MCUgNjUlLHJnYmEoNjEsMjU1LDE3NiwuMDUpLHRyYW5zcGFyZW50IDYwJSk7CiAgICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7IHRyYW5zZm9ybTpyb3RhdGUoLThkZWcpOwogICAgfQogICAgLnRyYWNrID4gKnsgcG9zaXRpb246cmVsYXRpdmU7IH0KCiAgICAudHJhY2staGVhZHsKICAgICAgZGlzcGxheTpmbGV4OyBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OyBqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjsgZ2FwOjhweDsgbWFyZ2luLWJvdHRvbToxMHB4OwogICAgfQogICAgLnRyYWNrLW51bXsgZm9udC13ZWlnaHQ6OTAwOyBmb250LXNpemU6MjBweDsgbGluZS1oZWlnaHQ6MTsgfQogICAgLnRyYWNrLXN0YXR1c3sgZGlzcGxheTpmbGV4OyBmbGV4LWRpcmVjdGlvbjpjb2x1bW47IGFsaWduLWl0ZW1zOmZsZXgtZW5kOyBnYXA6NHB4OyB9CiAgICAudGFnewogICAgICBmb250LXNpemU6MTFweDsgcGFkZGluZzozcHggOHB4OyBib3JkZXI6MXB4IHNvbGlkIHZhcigtLXN0cm9rZTIpOwogICAgICBib3JkZXItcmFkaXVzOjk5OXB4OyBjb2xvcjp2YXIoLS1tdXRlZCk7IGJhY2tncm91bmQ6cmdiYSgwLDAsMCwuMjUpOwogICAgICBsZXR0ZXItc3BhY2luZzouMDZlbTsgdGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlOyB3aGl0ZS1zcGFjZTpub3dyYXA7CiAgICB9CiAgICAudGFnLnJlY3sgYm9yZGVyLWNvbG9yOnJnYmEoMjU1LDUzLDUzLC40KTsgY29sb3I6I2ZmZDBkMDsgfQogICAgLnRhZy5wbGF5eyBib3JkZXItY29sb3I6cmdiYSg2MSwyMTgsMjU1LC40KTsgY29sb3I6I2QwZjhmZjsgfQogICAgLnRhZy5jb3VudHsgYm9yZGVyLWNvbG9yOnJnYmEoMjU1LDIxOCw2OCwuNCk7IGNvbG9yOiNmZmY2YzA7IH0KICAgIC50YWcuYXJteyBib3JkZXItY29sb3I6cmdiYSgyNTUsMTYwLDMwLC40KTsgY29sb3I6I2ZmZTBiMDsgfQoKICAgIC50cmFjay1sYWJlbHsgZm9udC1zaXplOjEycHg7IGNvbG9yOnZhcigtLW11dGVkKTsgbWluLWhlaWdodDoxNnB4OyB0ZXh0LWFsaWduOnJpZ2h0OyB9CgogICAgLyogQmlnIGJ1dHRvbiAqLwogICAgLnRyYWNrLWJvZHl7IGRpc3BsYXk6Z3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmciA1OHB4OyBnYXA6MTBweDsgYWxpZ24taXRlbXM6Y2VudGVyOyBtYXJnaW4tYm90dG9tOjEwcHg7IH0KICAgIC5iaWctYnRuewogICAgICB3aWR0aDoxMTBweDsgaGVpZ2h0OjExMHB4OyBib3JkZXItcmFkaXVzOjUwJTsgbWFyZ2luOjRweCBhdXRvIDA7CiAgICAgIGJvcmRlcjoxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMDkpOwogICAgICBiYWNrZ3JvdW5kOnJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMzIlIDI4JSxyZ2JhKDI1NSwyNTUsMjU1LC4xMSkscmdiYSgwLDAsMCwuMjUpIDYwJSksIHJnYmEoMCwwLDAsLjIpOwogICAgICBkaXNwbGF5OmdyaWQ7IHBsYWNlLWl0ZW1zOmNlbnRlcjsgY3Vyc29yOnBvaW50ZXI7IHVzZXItc2VsZWN0Om5vbmU7CiAgICAgIGJveC1zaGFkb3c6MCAxNnB4IDM4cHggcmdiYSgwLDAsMCwuNDgpOyBwb3NpdGlvbjpyZWxhdGl2ZTsKICAgICAgdHJhbnNpdGlvbjpib3gtc2hhZG93IC4xMnM7CiAgICB9CiAgICAuYmlnLWJ0bjpob3ZlcnsgYm94LXNoYWRvdzowIDIwcHggNDRweCByZ2JhKDAsMCwwLC41Nik7IH0KICAgIC5iaWctYnRuIC5yaW5newogICAgICBwb3NpdGlvbjphYnNvbHV0ZTsgaW5zZXQ6LTdweDsgYm9yZGVyLXJhZGl1czo1MCU7CiAgICAgIGJvcmRlcjo5cHggc29saWQgcmdiYSgyNTUsNTMsNTMsLjcpOwogICAgICBib3JkZXItdG9wLWNvbG9yOnJnYmEoMjU1LDUzLDUzLC4xNSk7IGJvcmRlci1sZWZ0LWNvbG9yOnJnYmEoMjU1LDUzLDUzLC40KTsKICAgIH0KICAgIC5iaWctYnRuIC5yaW5nMnsKICAgICAgcG9zaXRpb246YWJzb2x1dGU7IGluc2V0OjlweDsgYm9yZGVyLXJhZGl1czo1MCU7CiAgICAgIGJvcmRlcjo1cHggc29saWQgcmdiYSg2MSwyNTUsMTc2LC41KTsKICAgICAgYm9yZGVyLXJpZ2h0LWNvbG9yOnJnYmEoNjEsMjU1LDE3NiwuMTIpOyBib3JkZXItYm90dG9tLWNvbG9yOnJnYmEoNjEsMjU1LDE3NiwuMyk7CiAgICB9CiAgICAuaWNvbnsKICAgICAgd2lkdGg6NTBweDsgaGVpZ2h0OjUwcHg7IGJvcmRlci1yYWRpdXM6NTAlOyBkaXNwbGF5OmdyaWQ7IHBsYWNlLWl0ZW1zOmNlbnRlcjsKICAgICAgYmFja2dyb3VuZDpyZ2JhKDAsMCwwLC4zOCk7IGJvcmRlcjoxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMDkpOwogICAgfQogICAgLmJpZy1idG4gc3ZneyB3aWR0aDoyNnB4OyBoZWlnaHQ6MjZweDsgZmlsbDpub25lOyBzdHJva2Utd2lkdGg6Mi41OyB9CgogICAgLyogV2F2ZWZvcm0gbWluaSBjYW52YXMgKi8KICAgIC53YXZlY2FudmFzewogICAgICB3aWR0aDoxMDAlOyBoZWlnaHQ6MzJweDsgZGlzcGxheTpibG9jazsgYm9yZGVyLXJhZGl1czo4cHg7CiAgICAgIGJhY2tncm91bmQ6cmdiYSgwLDAsMCwuMjUpOyBib3JkZXI6MXB4IHNvbGlkIHZhcigtLXN0cm9rZTIpOwogICAgICBtYXJnaW4tYm90dG9tOjhweDsKICAgIH0KCiAgICAvKiBGYWRlciAqLwogICAgLmZhZGVyewogICAgICBkaXNwbGF5OmZsZXg7IGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsgYWxpZ24taXRlbXM6Y2VudGVyOyBnYXA6NnB4OwogICAgICBwYWRkaW5nOjdweCA1cHg7IGJvcmRlci1yYWRpdXM6MTJweDsgYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1zdHJva2UyKTsgYmFja2dyb3VuZDpyZ2JhKDAsMCwwLC4yKTsKICAgIH0KICAgIC5mYWRlciBsYWJlbHsgZm9udC1zaXplOjExcHg7IGNvbG9yOnZhcigtLW11dGVkKTsgdGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlOyBsZXR0ZXItc3BhY2luZzouMDZlbTsgfQogICAgaW5wdXRbdHlwZT0icmFuZ2UiXS52b2x7CiAgICAgIC13ZWJraXQtYXBwZWFyYW5jZTpub25lOyBhcHBlYXJhbmNlOm5vbmU7CiAgICAgIHdpZHRoOjEyOHB4OyBoZWlnaHQ6OHB4OyBib3JkZXItcmFkaXVzOjk5OXB4OyBiYWNrZ3JvdW5kOnJnYmEoMjU1LDI1NSwyNTUsLjEpOwogICAgICBvdXRsaW5lOm5vbmU7IHRyYW5zZm9ybTpyb3RhdGUoLTkwZGVnKTsgbWFyZ2luOjQ4cHggMDsKICAgIH0KICAgIGlucHV0W3R5cGU9InJhbmdlIl0udm9sOjotd2Via2l0LXNsaWRlci10aHVtYnsKICAgICAgLXdlYmtpdC1hcHBlYXJhbmNlOm5vbmU7IGFwcGVhcmFuY2U6bm9uZTsKICAgICAgd2lkdGg6MTdweDsgaGVpZ2h0OjE3cHg7IGJvcmRlci1yYWRpdXM6NTAlOwogICAgICBiYWNrZ3JvdW5kOnJnYmEoMjU1LDI1NSwyNTUsLjg4KTsgYm9yZGVyOjJweCBzb2xpZCByZ2JhKDAsMCwwLC4zKTsKICAgICAgYm94LXNoYWRvdzowIDRweCAxNHB4IHJnYmEoMCwwLDAsLjQ1KTsgY3Vyc29yOnBvaW50ZXI7CiAgICB9CgogICAgLyogVHJhY2sgc2V0dGluZ3MgKi8KICAgIC50cmFjay1zZXR0aW5nc3sKICAgICAgZGlzcGxheTpmbGV4OyBnYXA6N3B4OyBmbGV4LXdyYXA6d3JhcDsgbWFyZ2luLXRvcDowcHg7CiAgICAgIHBhZGRpbmc6OHB4OyBib3JkZXItcmFkaXVzOjEycHg7IGJvcmRlcjoxcHggc29saWQgdmFyKC0tc3Ryb2tlMik7CiAgICAgIGJhY2tncm91bmQ6cmdiYSgwLDAsMCwuMTgpOwogICAgfQogICAgLnRzLXBpbGx7CiAgICAgIGRpc3BsYXk6ZmxleDsgYWxpZ24taXRlbXM6Y2VudGVyOyBnYXA6NnB4OwogICAgICBwYWRkaW5nOjVweCA4cHg7IGJvcmRlcjoxcHggc29saWQgdmFyKC0tc3Ryb2tlMik7IGJvcmRlci1yYWRpdXM6OXB4OwogICAgICBiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsLjE4KTsgZm9udC1zaXplOjEycHg7IGNvbG9yOnZhcigtLW11dGVkKTsKICAgIH0KICAgIC50cy1waWxsIHNlbGVjdHsgYmFja2dyb3VuZDpyZ2JhKDAsMCwwLC4zKTsgYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1zdHJva2UyKTsgY29sb3I6dmFyKC0tdGV4dCk7IHBhZGRpbmc6NHB4IDdweDsgYm9yZGVyLXJhZGl1czo3cHg7IG91dGxpbmU6bm9uZTsgZm9udC1zaXplOjEycHg7IH0KICAgIC50cy1waWxsIGlucHV0W3R5cGU9Im51bWJlciJdeyBiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsLjMpOyBib3JkZXI6MXB4IHNvbGlkIHZhcigtLXN0cm9rZTIpOyBjb2xvcjp2YXIoLS10ZXh0KTsgcGFkZGluZzo0cHggN3B4OyBib3JkZXItcmFkaXVzOjdweDsgb3V0bGluZTpub25lOyBmb250LXNpemU6MTJweDsgd2lkdGg6NjJweDsgfQoKICAgIC8qIFRyYWNrIGFjdGlvbnMgKi8KICAgIC50cmFjay1hY3Rpb25zeyBkaXNwbGF5OmZsZXg7IGdhcDo2cHg7IG1hcmdpbi10b3A6OHB4OyB9CiAgICAudHJhY2stYWN0aW9ucyAuYnRueyBmbGV4OjE7IHBhZGRpbmc6OHB4IDZweDsgZm9udC1zaXplOjEycHg7IGJvcmRlci1yYWRpdXM6OXB4OyB9CgogICAgLyogVW5kbyBiYXIgKi8KICAgIC51bmRvLWJhcnsKICAgICAgZGlzcGxheTpub25lOyBhbGlnbi1pdGVtczpjZW50ZXI7IGdhcDo4cHg7IGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgICAgIG1hcmdpbi10b3A6N3B4OyBwYWRkaW5nOjZweCAxMHB4OyBib3JkZXItcmFkaXVzOjEwcHg7CiAgICAgIGJhY2tncm91bmQ6cmdiYSgyNTUsMjE4LDY4LC4wOCk7IGJvcmRlcjoxcHggc29saWQgcmdiYSgyNTUsMjE4LDY4LC4yNSk7CiAgICAgIGZvbnQtc2l6ZToxMnB4OyBjb2xvcjp2YXIoLS15ZWxsb3cpOwogICAgfQogICAgLnVuZG8tYmFyIC5idG4tdW5kb3sKICAgICAgYmFja2dyb3VuZDpyZ2JhKDI1NSwyMTgsNjgsLjEyKTsgYm9yZGVyOjFweCBzb2xpZCByZ2JhKDI1NSwyMTgsNjgsLjMpOwogICAgICBjb2xvcjp2YXIoLS15ZWxsb3cpOyBwYWRkaW5nOjRweCAxMHB4OyBib3JkZXItcmFkaXVzOjdweDsgY3Vyc29yOnBvaW50ZXI7IGZvbnQtc2l6ZToxMnB4OwogICAgfQoKICAgIC8qIGNvdW50IGJhZGdlICovCiAgICAuY291bnQtYmFkZ2V7CiAgICAgIGRpc3BsYXk6bm9uZTsgcG9zaXRpb246YWJzb2x1dGU7IHRvcDoxMHB4OyBsZWZ0OjUwJTsgdHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTUwJSk7CiAgICAgIGJhY2tncm91bmQ6cmdiYSgyNTUsMjE4LDY4LC4xMik7IGJvcmRlcjoxcHggc29saWQgcmdiYSgyNTUsMjE4LDY4LC4zKTsKICAgICAgY29sb3I6dmFyKC0teWVsbG93KTsgcGFkZGluZzo0cHggMTJweDsgYm9yZGVyLXJhZGl1czo5OTlweDsgZm9udC1zaXplOjEycHg7CiAgICAgIHdoaXRlLXNwYWNlOm5vd3JhcDsgei1pbmRleDoxMDsgcG9pbnRlci1ldmVudHM6bm9uZTsKICAgIH0KCiAgICAvKiBQcm9ncmVzcyByaW5nIGZvciByZWNvcmRpbmcgKi8KICAgIC5yZWMtcHJvZ3Jlc3N7CiAgICAgIHBvc2l0aW9uOmFic29sdXRlOyBpbnNldDotN3B4OyBib3JkZXItcmFkaXVzOjUwJTsKICAgICAgc3Ryb2tlLWRhc2hhcnJheToyNDA7IHN0cm9rZS1kYXNob2Zmc2V0OjI0MDsKICAgICAgdHJhbnNpdGlvbjpzdHJva2UtZGFzaG9mZnNldCAuMnMgbGluZWFyOwogICAgICBwb2ludGVyLWV2ZW50czpub25lOwogICAgfQoKICAgIGZvb3Rlcnsgd2lkdGg6bWluKDEyMDBweCw5NnZ3KTsgcGFkZGluZzowIDhweCAzMnB4OyBjb2xvcjp2YXIoLS1tdXRlZCk7IGZvbnQtc2l6ZToxMnB4OyBsaW5lLWhlaWdodDoxLjc7IH0KICAgIGZvb3RlciBjb2RleyBiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsLjI1KTsgcGFkZGluZzoxcHggNXB4OyBib3JkZXItcmFkaXVzOjZweDsgYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1zdHJva2UyKTsgfQoKICAgIC8qIHBpbGwgc2VsZWN0ICovCiAgICAucGlsbHsKICAgICAgcGFkZGluZzo3cHggMTJweDsgYm9yZGVyLXJhZGl1czo5OTlweDsgYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1zdHJva2UpOwogICAgICBiYWNrZ3JvdW5kOnJnYmEoMjU1LDI1NSwyNTUsLjAzKTsgY29sb3I6dmFyKC0tbXV0ZWQpOyBkaXNwbGF5OmZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjhweDsgZm9udC1zaXplOjEzcHg7CiAgICB9CiAgICAucGlsbCBzZWxlY3R7IGJhY2tncm91bmQ6cmdiYSgwLDAsMCwuMjUpOyBib3JkZXI6MXB4IHNvbGlkIHZhcigtLXN0cm9rZTIpOyBjb2xvcjp2YXIoLS10ZXh0KTsgcGFkZGluZzo2cHggOHB4OyBib3JkZXItcmFkaXVzOjlweDsgb3V0bGluZTpub25lOyBmb250LXNpemU6MTNweDsgfQoKICAgIC5zZXB7IGZsZXg6MTsgfQogIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CgogIDwhLS0gRmxvYXRpbmcgbWV0cm8gc3RyaXAgLS0+CiAgPGRpdiBjbGFzcz0ibWV0cm8tZmxvYXQiIGFyaWEtbGFiZWw9Ik1ldHJvbm9tbyBmaXNzbyI+CiAgICA8ZGl2IGNsYXNzPSJtZi1pbmZvIj4KICAgICAgPHNwYW4gY2xhc3M9Im1mLWxhYmVsIj5NRVRSTzwvc3Bhbj4KICAgICAgPHNwYW4gY2xhc3M9Im1mLWJwbSIgaWQ9Im1mQnBtIj45MDwvc3Bhbj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0ibWYtaW5mbyI+CiAgICAgIDxzcGFuIGNsYXNzPSJtZi1sYWJlbCI+U0lHPC9zcGFuPgogICAgICA8c3BhbiBjbGFzcz0ibWYtc2lnIiBpZD0ibWZTaWciPjQvNDwvc3Bhbj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0ibWYtbGVkcyI+CiAgICAgIDxkaXYgY2xhc3M9ImxlZHMiIGlkPSJiZWF0TGVkc0Zsb2F0Ij48L2Rpdj4KICAgICAgPHNwYW4gY2xhc3M9ImxlZCBiYXItbGVkIiBpZD0iYmFyTGVkRmxvYXQiPjwvc3Bhbj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0ibWYtcmlnaHQiPgogICAgICA8ZGl2IGNsYXNzPSJiYWRnZSI+PHNwYW4gY2xhc3M9ImRvdCIgaWQ9ImRvdEF1ZGlvIj48L3NwYW4+IEF1ZGlvPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImJhZGdlIj48c3BhbiBjbGFzcz0iZG90IiBpZD0iZG90SW5wdXQiPjwvc3Bhbj4gSW48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iYmFkZ2UiIGlkPSJncmlkQmFkZ2UiIHRpdGxlPSJTdGF0byBncmlnbGlhIj7ij7Eg4oCUPC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCiAgPGhlYWRlcj4KICAgIDxkaXYgY2xhc3M9InRpdGxlIj5tYXJhY2Fsb29wIDxzcGFuPlBSTzwvc3Bhbj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9InRvcC1idG5zIj4KICAgICAgPGRpdiBjbGFzcz0icGlsbCI+CiAgICAgICAgPHNwYW4+U29yZ2VudGU8L3NwYW4+CiAgICAgICAgPHNlbGVjdCBpZD0ic291cmNlU2VsZWN0Ij4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9Im1pYyI+TWljcm9mb25vPC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJzY3JlZW4iPlNjaGVybW8gKyBhdWRpbzwvb3B0aW9uPgogICAgICAgIDwvc2VsZWN0PgogICAgICA8L2Rpdj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1jeWFuIiBpZD0iYnRuSW5pdCI+MSkgQXR0aXZhIEF1ZGlvPC9idXR0b24+CiAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tZ3JlZW4iIGlkPSJidG5QbGF5QWxsIiBkaXNhYmxlZD7ilrYgUGxheSBBbGw8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1yZWQiIGlkPSJidG5TdG9wQWxsIiBkaXNhYmxlZD7ilqAgU3RvcCBBbGw8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0iYnRuQ2xlYXJBbGwiIGRpc2FibGVkPkNsZWFyIEFsbDwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJidG5TYXZlQWxsIiBkaXNhYmxlZD5TYXZlIFdBVjwvYnV0dG9uPgogICAgPC9kaXY+CiAgPC9oZWFkZXI+CgogIDwhLS0gTWV0cm8gcGFuZWwgLS0+CiAgPGRpdiBjbGFzcz0ibWV0cm8td3JhcCI+CiAgICA8ZGl2IGNsYXNzPSJtZXRybyI+CiAgICAgIDxkaXYgY2xhc3M9Im1nIj4KICAgICAgICA8bGFiZWw+TWV0cm9ub21vPC9sYWJlbD4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXNtIiBpZD0iYnRuTWV0cm8iPk9OPC9idXR0b24+CiAgICAgICAgPGRpdiBjbGFzcz0ibGVkcyIgaWQ9ImJlYXRMZWRzIj48L2Rpdj4KICAgICAgICA8c3BhbiBjbGFzcz0ibGVkIGJhci1sZWQiIGlkPSJiYXJMZWQiPjwvc3Bhbj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJtZyI+CiAgICAgICAgPGxhYmVsPkJQTTwvbGFiZWw+CiAgICAgICAgPGlucHV0IGlkPSJicG0iIHR5cGU9InJhbmdlIiBtaW49IjQwIiBtYXg9IjI0MCIgc3RlcD0iMSIgdmFsdWU9IjkwIj4KICAgICAgICA8ZGl2IGNsYXNzPSJicG0tdmFsIj48c3BhbiBpZD0iYnBtVmFsIj45MDwvc3Bhbj48L2Rpdj4KICAgICAgICA8aW5wdXQgaWQ9ImJwbU51bSIgdHlwZT0ibnVtYmVyIiBtaW49IjQwIiBtYXg9IjI0MCIgc3RlcD0iMSIgdmFsdWU9IjkwIiBzdHlsZT0id2lkdGg6NzJweCI+CiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBjbGFzcz0ibWciPgogICAgICAgIDxsYWJlbD5NaXN1cmE8L2xhYmVsPgogICAgICAgIDxzZWxlY3QgaWQ9InRzaWciPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iMiI+Mi80PC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIzIj4zLzQ8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjQiIHNlbGVjdGVkPjQvNDwvb3B0aW9uPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iNSI+NS80PC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSI2Ij42Lzg8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjciPjcvNDwvb3B0aW9uPgogICAgICAgIDwvc2VsZWN0PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9Im1nIj4KICAgICAgICA8bGFiZWw+U3luYzwvbGFiZWw+CiAgICAgICAgPHNlbGVjdCBpZD0ic3luY01vZGUiPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ib24iIHNlbGVjdGVkPk9OIChncmlnbGlhKTwvb3B0aW9uPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ib2ZmIj5PRkYgKGxpYmVybyk8L29wdGlvbj4KICAgICAgICA8L3NlbGVjdD4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJtZyI+CiAgICAgICAgPGxhYmVsPkFudGljaXBvIFJFQyAobXMpPC9sYWJlbD4KICAgICAgICA8aW5wdXQgaWQ9ImxlYWRNcyIgdHlwZT0ibnVtYmVyIiBtaW49IjAiIG1heD0iMzAwMCIgc3RlcD0iMTAiIHZhbHVlPSI4ODAiIC8+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4teWVsbG93IiBpZD0iYnRuQ2FsaWJyYXRlIiBkaXNhYmxlZCB0aXRsZT0iQ2FsaWJyYSBsYXRlbnphIGF1dG9tYXRpY2FtZW50ZSI+QXV0by1DYWxpYnJhPC9idXR0b24+CiAgICAgICAgPHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLW11dGVkKTtmb250LXNpemU6MTFweDsiIGlkPSJjYWxpYlN0YXR1cyI+4oCUPC9zcGFuPgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9Im1nIj4KICAgICAgICA8bGFiZWw+RXh0cmEtYmVhdCBmaW5lPC9sYWJlbD4KICAgICAgICA8c2VsZWN0IGlkPSJleHRyYUJlYXRzIj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjAiPjA8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjEiPjE8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjIiIHNlbGVjdGVkPjI8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjMiPjM8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjQiPjQ8L29wdGlvbj4KICAgICAgICA8L3NlbGVjdD4KICAgICAgICA8bGFiZWw+MS80PC9sYWJlbD4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJtZyIgc3R5bGU9Im1hcmdpbi1sZWZ0OmF1dG87Ij4KICAgICAgICA8bGFiZWw+QmVhdDwvbGFiZWw+PHNwYW4gaWQ9ImJlYXRNcyIgc3R5bGU9ImZvbnQtc2l6ZToxM3B4O21pbi13aWR0aDo1NHB4OyI+4oCUPC9zcGFuPjxsYWJlbD5tczwvbGFiZWw+CiAgICAgICAgPGxhYmVsPkJhcjwvbGFiZWw+PHNwYW4gaWQ9ImJhck1zIiBzdHlsZT0iZm9udC1zaXplOjEzcHg7bWluLXdpZHRoOjYwcHg7Ij7igJQ8L3NwYW4+PGxhYmVsPm1zPC9sYWJlbD4KICAgICAgICA8bGFiZWw+U1I8L2xhYmVsPjxzcGFuIGlkPSJzciIgc3R5bGU9ImZvbnQtc2l6ZToxM3B4OyI+4oCUPC9zcGFuPgogICAgICAgIDxsYWJlbD5Db2RlYzwvbGFiZWw+PHNwYW4gaWQ9ImNvZGVjIiBzdHlsZT0iZm9udC1zaXplOjEzcHg7Y29sb3I6dmFyKC0tbXV0ZWQpOyI+4oCUPC9zcGFuPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8bWFpbiBpZD0iZ3JpZCI+PC9tYWluPgoKICA8Zm9vdGVyPgogICAgPGI+bWFyYWNhbG9vcCBQUk88L2I+IOKAlCBJbCBwcmVjb3VudCBjb250YSBsZSBiYXR0dXRlIGluIGFudGljaXBvLCBwb2kgcmVnaXN0cmEgYWxsaW5lYXRvIGFsbGEgZ3JpZ2xpYS4gCiAgICDigKIgPGI+UHJpbW8gdGFwPC9iPiBzZW56YSB0cmFjY2lhID0gYXZ2aWEgY291bnQtaW4sIHBvaSBSRUMuIOKAoiA8Yj5EdXJhbnRlIFJFQzwvYj4gPSBzdG9wIG1hbnVhbGUuIAogICAg4oCiIDxiPkNvbiB0cmFjY2lhPC9iPiA9IHBsYXkvc3RvcC4g4oCiIDxiPlRhc3RvIENsZWFyPC9iPiA9IGNhbmNlbGxhIGNvbiB1bmRvIDVzLiAKICAgIOKAoiA8Yj5Mb25nIHByZXNzPC9iPiAoM3MpIHN1bCBjZXJjaGlvID0gY2FuY2VsbGEgaW1tZWRpYXRvLiAKICAgIOKAoiA8Yj5DYWxpYnJhPC9iPjogZmFpIHNlbnRpcmUgaWwgY2xpYyBhbCBtaWNyb2Zvbm8gcGVyIGF1dG8tYWdnaXVzdGFyZSBsJ2FudGljaXBvIFJFQy4gCiAgICDigKIgRXNwb3J0YSBXQVYgUENNIDE2LWJpdCwgbW9ubyBvIHN0ZXJlby4gU2FtcGxlIHJhdGU6IHF1ZWxsbyBkZWwgYnJvd3NlciAoPGNvZGUgaWQ9ImZvb3RlclNyIj7igJQ8L2NvZGU+KS4KICA8L2Zvb3Rlcj4KCjxzY3JpcHQ+CigoKSA9PiB7CiAgJ3VzZSBzdHJpY3QnOwoKICBjb25zdCBUUkFDS1MgPSA4OwoKICAvLyAtLS0tIHN0YXRlIC0tLS0KICBsZXQgYXVkaW9DdHggPSBudWxsOwogIGxldCBpbnB1dFN0cmVhbSA9IG51bGw7CiAgbGV0IG1hc3RlckdhaW4gPSBudWxsOwoKICAvLyBHcmlkIHRyYW5zcG9ydDogQXVkaW9Db250ZXh0IHRpbWUgb2YgYmFyLTAgYmVhdC0wCiAgbGV0IGdyaWRPcmlnaW5UaW1lID0gbnVsbDsgICAvLyBhYnNvbHV0ZSBBdWRpb0NvbnRleHQgdGltZSBvZiBncmlkIHN0YXJ0CiAgbGV0IGdyaWRTdGFydGVkID0gZmFsc2U7CgogIC8vIE1ldHJvbm9tZQogIGxldCBtZXRyb09uID0gZmFsc2U7CiAgbGV0IG1ldHJvU2NoZWR1bGVyID0gbnVsbDsgICAvLyBzZXRJbnRlcnZhbCBoYW5kbGUKICBsZXQgbmV4dEJlYXRDb250ZXh0VGltZSA9IDA7IC8vIEF1ZGlvQ29udGV4dCB0aW1lIG9mIG5leHQgc2NoZWR1bGVkIGJlYXQKICBsZXQgbWV0cm9CZWF0SW5kZXggPSAwOwoKICBjb25zdCBjb3VudGRvd25zID0gbmV3IE1hcCgpOwogIGNvbnN0IHNjaGVkdWxlcyAgPSBuZXcgTWFwKCk7CgogIGNvbnN0IHRyYWNrcyA9IFtdOwoKICAvLyAtLS0tIERPTSByZWZzIC0tLS0KICBjb25zdCBncmlkRWwgICAgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJncmlkIik7CiAgY29uc3QgYnRuSW5pdCAgICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnRuSW5pdCIpOwogIGNvbnN0IGJ0blBsYXlBbGwgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ0blBsYXlBbGwiKTsKICBjb25zdCBidG5TdG9wQWxsICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJidG5TdG9wQWxsIik7CiAgY29uc3QgYnRuQ2xlYXJBbGwgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnRuQ2xlYXJBbGwiKTsKICBjb25zdCBidG5TYXZlQWxsICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJidG5TYXZlQWxsIik7CiAgY29uc3Qgc291cmNlU2VsZWN0ICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic291cmNlU2VsZWN0Iik7CiAgY29uc3QgZG90QXVkaW8gICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZG90QXVkaW8iKTsKICBjb25zdCBkb3RJbnB1dCAgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkb3RJbnB1dCIpOwogIGNvbnN0IHNyRWwgICAgICAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNyIik7CiAgY29uc3QgY29kZWNFbCAgICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29kZWMiKTsKICBjb25zdCBiZWF0TXNFbCAgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJiZWF0TXMiKTsKICBjb25zdCBiYXJNc0VsICAgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJiYXJNcyIpOwogIGNvbnN0IGJ0bk1ldHJvICAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ0bk1ldHJvIik7CiAgY29uc3QgYnBtUmFuZ2UgICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnBtIik7CiAgY29uc3QgYnBtTnVtICAgICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnBtTnVtIik7CiAgY29uc3QgYnBtVmFsICAgICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnBtVmFsIik7CiAgY29uc3QgdHNpZyAgICAgICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidHNpZyIpOwogIGNvbnN0IGJlYXRMZWRzICAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJlYXRMZWRzIik7CiAgY29uc3QgYmFyTGVkICAgICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYmFyTGVkIik7CiAgY29uc3QgYmVhdExlZHNGbG9hdCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYmVhdExlZHNGbG9hdCIpOwogIGNvbnN0IGJhckxlZEZsb2F0ICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJhckxlZEZsb2F0Iik7CiAgY29uc3QgbWZCcG0gICAgICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibWZCcG0iKTsKICBjb25zdCBtZlNpZyAgICAgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtZlNpZyIpOwogIGNvbnN0IHN5bmNNb2RlU2VsICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInN5bmNNb2RlIik7CiAgY29uc3QgbGVhZE1zRWwgICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVhZE1zIik7CiAgY29uc3QgZXh0cmFCZWF0c1NlbCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZXh0cmFCZWF0cyIpOwogIGNvbnN0IGJ0bkNhbGlicmF0ZSAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ0bkNhbGlicmF0ZSIpOwogIGNvbnN0IGNhbGliU3RhdHVzICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNhbGliU3RhdHVzIik7CiAgY29uc3QgZ3JpZEJhZGdlICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ3JpZEJhZGdlIik7CiAgY29uc3QgZm9vdGVyU3IgICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZm9vdGVyU3IiKTsKCiAgLy8gLS0tLSBoZWxwZXJzIC0tLS0KICBmdW5jdGlvbiBnZXRCcG0oKSAgICAgICB7IHJldHVybiBNYXRoLm1heCgxLCBwYXJzZUludChicG1SYW5nZS52YWx1ZSwgMTApKTsgfQogIGZ1bmN0aW9uIGdldE51bWVyYXRvcigpIHsgcmV0dXJuIHBhcnNlSW50KHRzaWcudmFsdWUsIDEwKTsgfQogIGZ1bmN0aW9uIGJlYXRTZWMoKSAgICAgIHsgcmV0dXJuIDYwIC8gZ2V0QnBtKCk7IH0KICBmdW5jdGlvbiBiYXJTZWMoKSAgICAgICB7IHJldHVybiBnZXROdW1lcmF0b3IoKSAqIGJlYXRTZWMoKTsgfQogIGZ1bmN0aW9uIHN5bmNPbigpICAgICAgIHsgcmV0dXJuIHN5bmNNb2RlU2VsLnZhbHVlID09PSAib24iOyB9CiAgZnVuY3Rpb24gZ2V0TGVhZFNlYygpICAgeyByZXR1cm4gTWF0aC5tYXgoMCwgcGFyc2VGbG9hdChsZWFkTXNFbC52YWx1ZSB8fCAiMCIpIC8gMTAwMCk7IH0KICBmdW5jdGlvbiBnZXRFeHRyYUJlYXRzKCl7IHJldHVybiBwYXJzZUludChleHRyYUJlYXRzU2VsLnZhbHVlLCAxMCk7IH0KCiAgZnVuY3Rpb24gc2V0Q2FsaWJTdGF0dXModCl7IGlmIChjYWxpYlN0YXR1cykgY2FsaWJTdGF0dXMudGV4dENvbnRlbnQgPSB0OyB9CiAgZnVuY3Rpb24gc2V0RG90cygpewogICAgZG90QXVkaW8uY2xhc3NMaXN0LnRvZ2dsZSgib24iLCAhIWF1ZGlvQ3R4ICYmIGF1ZGlvQ3R4LnN0YXRlID09PSAicnVubmluZyIpOwogICAgZG90SW5wdXQuY2xhc3NMaXN0LnRvZ2dsZSgib24iLCAhIWlucHV0U3RyZWFtKTsKICAgIGRvdEF1ZGlvLmNsYXNzTGlzdC50b2dnbGUoInJlYyIsIGZhbHNlKTsKICB9CiAgZnVuY3Rpb24gdXBkYXRlVGltaW5nTGFiZWxzKCl7CiAgICBjb25zdCBidiA9IGdldEJwbSgpOwogICAgYnBtVmFsLnRleHRDb250ZW50ID0gYnY7CiAgICBtZkJwbS50ZXh0Q29udGVudCAgPSBidjsKICAgIG1mU2lnLnRleHRDb250ZW50ICA9IGdldE51bWVyYXRvcigpICsgIi80IjsKICAgIGJlYXRNc0VsLnRleHRDb250ZW50ID0gTWF0aC5yb3VuZChiZWF0U2VjKCkqMTAwMCk7CiAgICBiYXJNc0VsLnRleHRDb250ZW50ICA9IE1hdGgucm91bmQoYmFyU2VjKCkqMTAwMCk7CiAgfQogIGZ1bmN0aW9uIGFueUJ1ZmZlcnMoKXsgcmV0dXJuIHRyYWNrcy5zb21lKHQgPT4gISF0LmJ1ZmZlcik7IH0KICBmdW5jdGlvbiB1cGRhdGVHbG9iYWxCdXR0b25zKCl7CiAgICBjb25zdCBhbnlCdWYgID0gYW55QnVmZmVycygpOwogICAgY29uc3QgYW55UGxheSA9IHRyYWNrcy5zb21lKHQgPT4gdC5pc1BsYXlpbmcpOwogICAgY29uc3QgYW55QnVzeSA9IHRyYWNrcy5zb21lKHQgPT4gdC5pc1JlY29yZGluZyB8fCB0LmlzQXJtZWRSZWNvcmQgfHwgdC5pc0NvdW50aW5nSW4pOwogICAgYnRuUGxheUFsbC5kaXNhYmxlZCAgPSAhYXVkaW9DdHggfHwgIWFueUJ1ZjsKICAgIGJ0blN0b3BBbGwuZGlzYWJsZWQgID0gIWF1ZGlvQ3R4IHx8ICghYW55UGxheSAmJiAhYW55QnVzeSk7CiAgICBidG5DbGVhckFsbC5kaXNhYmxlZCA9ICFhdWRpb0N0eCB8fCAhYW55QnVmOwogICAgYnRuU2F2ZUFsbC5kaXNhYmxlZCAgPSAhYW55QnVmOwogIH0KCiAgLy8gLS0tLSBHcmlkIC0tLS0KICAvLyBncmlkT3JpZ2luVGltZTogQXVkaW9Db250ZXh0IHRpbWUgb2YgYmFyLTAtYmVhdC0wLgogIC8vIFdoZW4gZmlyc3QgdHJhY2sgcmVjb3Jkcywgd2UgcmVzZXQgdGhlIGdyaWQgdG8gYWxpZ24gd2l0aCBuZXh0IGJhci4KCiAgZnVuY3Rpb24gcmVzZXRHcmlkKGZyb21Db250ZXh0VGltZSl7CiAgICAvLyBTbmFwIHRvIGEgY2xlYW4gYmFyIGJvdW5kYXJ5IHN0YXJ0aW5nIGZyb20gbm93K3Rpbnkgb2Zmc2V0CiAgICBncmlkT3JpZ2luVGltZSA9IGZyb21Db250ZXh0VGltZTsKICAgIGdyaWRTdGFydGVkID0gdHJ1ZTsKICAgIHVwZGF0ZUdyaWRCYWRnZSgpOwogIH0KCiAgZnVuY3Rpb24gbmV4dEJhclRpbWUoZnJvbUNvbnRleHRUaW1lKXsKICAgIGlmICghc3luY09uKCkgfHwgIWdyaWRTdGFydGVkIHx8IGdyaWRPcmlnaW5UaW1lID09IG51bGwpIHJldHVybiBmcm9tQ29udGV4dFRpbWU7CiAgICBjb25zdCBiYXIgPSBiYXJTZWMoKTsKICAgIGNvbnN0IHJlbCA9IE1hdGgubWF4KDAsIGZyb21Db250ZXh0VGltZSAtIGdyaWRPcmlnaW5UaW1lKTsKICAgIGNvbnN0IGJhcnNQYXNzZWQgPSBNYXRoLmNlaWwocmVsIC8gYmFyKTsKICAgIGNvbnN0IG5leHQgPSBncmlkT3JpZ2luVGltZSArIGJhcnNQYXNzZWQgKiBiYXI7CiAgICByZXR1cm4gTWF0aC5tYXgoZnJvbUNvbnRleHRUaW1lLCBuZXh0KTsKICB9CgogIGZ1bmN0aW9uIGdyaWRSZWxhdGl2ZVNlYygpewogICAgaWYgKCFhdWRpb0N0eCB8fCAhZ3JpZFN0YXJ0ZWQpIHJldHVybiBudWxsOwogICAgcmV0dXJuIGF1ZGlvQ3R4LmN1cnJlbnRUaW1lIC0gZ3JpZE9yaWdpblRpbWU7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVHcmlkQmFkZ2UoKXsKICAgIGlmICghZ3JpZFN0YXJ0ZWQpIHsgZ3JpZEJhZGdlLnRleHRDb250ZW50ID0gIuKPsSDigJQiOyByZXR1cm47IH0KICAgIGNvbnN0IHJlbCA9IGdyaWRSZWxhdGl2ZVNlYygpOwogICAgaWYgKHJlbCA9PSBudWxsKSByZXR1cm47CiAgICBjb25zdCBiYXIgPSBiYXJTZWMoKTsKICAgIGNvbnN0IGJhcklkeCAgPSBNYXRoLmZsb29yKHJlbCAvIGJhcik7CiAgICBjb25zdCBiZWF0SWR4ID0gTWF0aC5mbG9vcigocmVsICUgYmFyKSAvIGJlYXRTZWMoKSk7CiAgICBncmlkQmFkZ2UudGV4dENvbnRlbnQgPSBg4o+xICR7YmFySWR4fToke2JlYXRJZHh9YDsKICB9CgogIC8vIC0tLS0gTWV0cm9ub21lIChBdWRpb0NvbnRleHQtc2NoZWR1bGVkLCBhY2N1cmF0ZSkgLS0tLQogIC8vIFdlIHVzZSBhIGxvb2thaGVhZCBzY2hlZHVsZXIgb24gQXVkaW9Db250ZXh0IGZvciBhY2N1cmF0ZSB0aW1pbmcuCiAgLy8gVmlzdWFsIGZsYXNoIHVzZXMgcmVxdWVzdEFuaW1hdGlvbkZyYW1lICsgQXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lIGNvbXBhcmlzb24uCgogIGNvbnN0IE1FVFJPX0xPT0tBSEVBRCAgPSAwLjA4OyAvLyBzZWNvbmRzIHRvIGxvb2sgYWhlYWQKICBjb25zdCBNRVRST19JTlRFUlZBTCAgID0gMjU7ICAgLy8gbXMgc2NoZWR1bGVyIGludGVydmFsCgogIGxldCBzY2hlZHVsZWRCZWF0cyA9IFtdOyAvLyB7IGNvbnRleHRUaW1lLCBiZWF0SW5CYXIgfQoKICBmdW5jdGlvbiBzdG9wTWV0cm9ub21lKCl7CiAgICBtZXRyb09uID0gZmFsc2U7CiAgICBidG5NZXRyby50ZXh0Q29udGVudCA9ICJPTiI7CiAgICBpZiAobWV0cm9TY2hlZHVsZXIpIGNsZWFySW50ZXJ2YWwobWV0cm9TY2hlZHVsZXIpOwogICAgbWV0cm9TY2hlZHVsZXIgPSBudWxsOwogICAgc2NoZWR1bGVkQmVhdHMgPSBbXTsKICAgIGFsbExlZHNPZmYoKTsKICB9CgogIGZ1bmN0aW9uIHN0YXJ0TWV0cm9ub21lKGZyb21Db250ZXh0VGltZSl7CiAgICBpZiAobWV0cm9Pbikgc3RvcE1ldHJvbm9tZSgpOwogICAgbWV0cm9PbiA9IHRydWU7CiAgICBidG5NZXRyby50ZXh0Q29udGVudCA9ICJPRkYiOwoKICAgIGNvbnN0IG5vdyA9IChhdWRpb0N0eCAmJiBhdWRpb0N0eC5zdGF0ZSA9PT0gInJ1bm5pbmciKSA/IGF1ZGlvQ3R4LmN1cnJlbnRUaW1lIDogMDsKICAgIGNvbnN0IG9yaWdpbiA9IGZyb21Db250ZXh0VGltZSAhPSBudWxsID8gZnJvbUNvbnRleHRUaW1lIDogbm93OwogICAgLy8gQWxpZ24gbmV4dCBiZWF0IHRvIGdyaWQgaWYgd2UgaGF2ZSBvbmUKICAgIGlmIChncmlkU3RhcnRlZCAmJiBzeW5jT24oKSl7CiAgICAgIGNvbnN0IHJlbCA9IG9yaWdpbiAtIGdyaWRPcmlnaW5UaW1lOwogICAgICBjb25zdCBiZWF0c1NpbmNlT3JpZ2luID0gTWF0aC5yb3VuZChyZWwgLyBiZWF0U2VjKCkpOwogICAgICBuZXh0QmVhdENvbnRleHRUaW1lID0gZ3JpZE9yaWdpblRpbWUgKyBiZWF0c1NpbmNlT3JpZ2luICogYmVhdFNlYygpOwogICAgICBtZXRyb0JlYXRJbmRleCA9IGJlYXRzU2luY2VPcmlnaW4gJSBnZXROdW1lcmF0b3IoKTsKICAgIH0gZWxzZSB7CiAgICAgIG5leHRCZWF0Q29udGV4dFRpbWUgPSBub3c7CiAgICAgIG1ldHJvQmVhdEluZGV4ID0gMDsKICAgIH0KCiAgICBzY2hlZHVsZWRCZWF0cyA9IFtdOwogICAgbWV0cm9TY2hlZHVsZXIgPSBzZXRJbnRlcnZhbChzY2hlZHVsZU1ldHJvQmVhdCwgTUVUUk9fSU5URVJWQUwpOwogICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGVNZXRyb0xlZHMpOwogIH0KCiAgZnVuY3Rpb24gc2NoZWR1bGVNZXRyb0JlYXQoKXsKICAgIGlmICghbWV0cm9PbiB8fCAhYXVkaW9DdHgpIHJldHVybjsKICAgIGNvbnN0IG5vdyA9IGF1ZGlvQ3R4LmN1cnJlbnRUaW1lOwogICAgd2hpbGUgKG5leHRCZWF0Q29udGV4dFRpbWUgPCBub3cgKyBNRVRST19MT09LQUhFQUQpewogICAgICAvLyBzY2hlZHVsZSBhdWRpbyBjbGljayAodmVyeSBxdWlldCBiZWVwKQogICAgICBzY2hlZHVsZU1ldHJvQ2xpY2sobmV4dEJlYXRDb250ZXh0VGltZSwgbWV0cm9CZWF0SW5kZXggPT09IDApOwogICAgICBzY2hlZHVsZWRCZWF0cy5wdXNoKHsgY29udGV4dFRpbWU6IG5leHRCZWF0Q29udGV4dFRpbWUsIGJlYXRJbkJhcjogbWV0cm9CZWF0SW5kZXggfSk7CiAgICAgIG1ldHJvQmVhdEluZGV4ID0gKG1ldHJvQmVhdEluZGV4ICsgMSkgJSBnZXROdW1lcmF0b3IoKTsKICAgICAgbmV4dEJlYXRDb250ZXh0VGltZSArPSBiZWF0U2VjKCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzY2hlZHVsZU1ldHJvQ2xpY2soYXRUaW1lLCBpc0Rvd25iZWF0KXsKICAgIGlmICghYXVkaW9DdHgpIHJldHVybjsKICAgIGNvbnN0IG9zYyA9IGF1ZGlvQ3R4LmNyZWF0ZU9zY2lsbGF0b3IoKTsKICAgIG9zYy50eXBlID0gInNpbmUiOwogICAgb3NjLmZyZXF1ZW5jeS52YWx1ZSA9IGlzRG93bmJlYXQgPyAxMDAwIDogNjAwOwogICAgY29uc3QgZyA9IGF1ZGlvQ3R4LmNyZWF0ZUdhaW4oKTsKICAgIGcuZ2Fpbi5zZXRWYWx1ZUF0VGltZSgwLjAwMDEsIGF0VGltZSk7CiAgICBnLmdhaW4uZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZSgwLjEyLCBhdFRpbWUgKyAwLjAwMyk7CiAgICBnLmdhaW4uZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZSgwLjAwMDEsIGF0VGltZSArIDAuMDQpOwogICAgb3NjLmNvbm5lY3QoZyk7IGcuY29ubmVjdChtYXN0ZXJHYWluIHx8IGF1ZGlvQ3R4LmRlc3RpbmF0aW9uKTsKICAgIG9zYy5zdGFydChhdFRpbWUpOyBvc2Muc3RvcChhdFRpbWUgKyAwLjA1KTsKICAgIG9zYy5vbmVuZGVkID0gKCkgPT4geyB0cnl7IG9zYy5kaXNjb25uZWN0KCk7IGcuZGlzY29ubmVjdCgpOyB9IGNhdGNoe30gfTsKICB9CgogIGZ1bmN0aW9uIGFuaW1hdGVNZXRyb0xlZHMoKXsKICAgIGlmICghbWV0cm9PbikgcmV0dXJuOwogICAgaWYgKCFhdWRpb0N0eCkgeyByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZU1ldHJvTGVkcyk7IHJldHVybjsgfQogICAgY29uc3Qgbm93ID0gYXVkaW9DdHguY3VycmVudFRpbWU7CiAgICAvLyBmaW5kIHRoZSBsYXRlc3QgYmVhdCB0aGF0IHNob3VsZCBiZSBmbGFzaGluZyBub3cKICAgIGxldCB0b0ZsYXNoID0gbnVsbDsKICAgIGZvciAobGV0IGkgPSBzY2hlZHVsZWRCZWF0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSl7CiAgICAgIGNvbnN0IGIgPSBzY2hlZHVsZWRCZWF0c1tpXTsKICAgICAgaWYgKGIuY29udGV4dFRpbWUgPD0gbm93ICsgMC4wMDUpewogICAgICAgIHRvRmxhc2ggPSBiOwogICAgICAgIC8vIGNsZWFuIHVwIG9sZCBvbmVzCiAgICAgICAgc2NoZWR1bGVkQmVhdHMgPSBzY2hlZHVsZWRCZWF0cy5zbGljZShpKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaWYgKHRvRmxhc2gpewogICAgICBmbGFzaEJlYXQodG9GbGFzaC5iZWF0SW5CYXIpOwogICAgICBzY2hlZHVsZWRCZWF0cyA9IHNjaGVkdWxlZEJlYXRzLmZpbHRlcihiID0+IGIgIT09IHRvRmxhc2gpOwogICAgfQogICAgLy8gdXBkYXRlIGdyaWQgYmFkZ2UKICAgIHVwZGF0ZUdyaWRCYWRnZSgpOwogICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGVNZXRyb0xlZHMpOwogIH0KCiAgbGV0IGxhc3RGbGFzaGVkQmVhdCA9IC0xOwogIGxldCBmbGFzaFRpbWVvdXQgPSBudWxsOwogIGZ1bmN0aW9uIGZsYXNoQmVhdChiZWF0SW5CYXIpewogICAgaWYgKGJlYXRJbkJhciA9PT0gbGFzdEZsYXNoZWRCZWF0KSByZXR1cm47CiAgICBsYXN0Rmxhc2hlZEJlYXQgPSBiZWF0SW5CYXI7CgogICAgY29uc3QgbGVkcyAgPSBiZWF0TGVkcy5xdWVyeVNlbGVjdG9yQWxsKCIubGVkIik7CiAgICBjb25zdCBmTGVkcyA9IGJlYXRMZWRzRmxvYXQgPyBiZWF0TGVkc0Zsb2F0LnF1ZXJ5U2VsZWN0b3JBbGwoIi5sZWQiKSA6IG51bGw7CgogICAgbGVkcy5mb3JFYWNoKChsLCBpKSA9PiBsLmNsYXNzTGlzdC50b2dnbGUoIm9uIiwgaSA9PT0gYmVhdEluQmFyKSk7CiAgICBpZiAoZkxlZHMpIGZMZWRzLmZvckVhY2goKGwsIGkpID0+IGwuY2xhc3NMaXN0LnRvZ2dsZSgib24iLCBpID09PSBiZWF0SW5CYXIpKTsKCiAgICBpZiAoYmVhdEluQmFyID09PSAwKXsKICAgICAgYmFyTGVkLmNsYXNzTGlzdC5hZGQoIm9uIik7CiAgICAgIGlmIChiYXJMZWRGbG9hdCkgYmFyTGVkRmxvYXQuY2xhc3NMaXN0LmFkZCgib24iKTsKICAgIH0KCiAgICBpZiAoZmxhc2hUaW1lb3V0KSBjbGVhclRpbWVvdXQoZmxhc2hUaW1lb3V0KTsKICAgIGZsYXNoVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICBsZWRzLmZvckVhY2gobCA9PiBsLmNsYXNzTGlzdC5yZW1vdmUoIm9uIikpOwogICAgICBpZiAoZkxlZHMpIGZMZWRzLmZvckVhY2gobCA9PiBsLmNsYXNzTGlzdC5yZW1vdmUoIm9uIikpOwogICAgICBiYXJMZWQuY2xhc3NMaXN0LnJlbW92ZSgib24iKTsKICAgICAgaWYgKGJhckxlZEZsb2F0KSBiYXJMZWRGbG9hdC5jbGFzc0xpc3QucmVtb3ZlKCJvbiIpOwogICAgICBsYXN0Rmxhc2hlZEJlYXQgPSAtMTsKICAgIH0sIDgwKTsKICB9CgogIGZ1bmN0aW9uIGFsbExlZHNPZmYoKXsKICAgIGJlYXRMZWRzLnF1ZXJ5U2VsZWN0b3JBbGwoIi5sZWQiKS5mb3JFYWNoKGwgPT4gbC5jbGFzc0xpc3QucmVtb3ZlKCJvbiIpKTsKICAgIGlmIChiZWF0TGVkc0Zsb2F0KSBiZWF0TGVkc0Zsb2F0LnF1ZXJ5U2VsZWN0b3JBbGwoIi5sZWQiKS5mb3JFYWNoKGwgPT4gbC5jbGFzc0xpc3QucmVtb3ZlKCJvbiIpKTsKICAgIGJhckxlZC5jbGFzc0xpc3QucmVtb3ZlKCJvbiIpOwogICAgaWYgKGJhckxlZEZsb2F0KSBiYXJMZWRGbG9hdC5jbGFzc0xpc3QucmVtb3ZlKCJvbiIpOwogIH0KCiAgZnVuY3Rpb24gYnVpbGRCZWF0TGVkcygpewogICAgYmVhdExlZHMuaW5uZXJIVE1MID0gIiI7CiAgICBpZiAoYmVhdExlZHNGbG9hdCkgYmVhdExlZHNGbG9hdC5pbm5lckhUTUwgPSAiIjsKICAgIGNvbnN0IG4gPSBnZXROdW1lcmF0b3IoKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKXsKICAgICAgY29uc3QgcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsgcy5jbGFzc05hbWUgPSAibGVkIjsgYmVhdExlZHMuYXBwZW5kQ2hpbGQocyk7CiAgICAgIGlmIChiZWF0TGVkc0Zsb2F0KXsgY29uc3QgZiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsgZi5jbGFzc05hbWUgPSAibGVkIjsgYmVhdExlZHNGbG9hdC5hcHBlbmRDaGlsZChmKTsgfQogICAgfQogIH0KCiAgLy8gLS0tLSBBdWRpbyBJbnB1dCAtLS0tCiAgYXN5bmMgZnVuY3Rpb24gZ2V0SW5wdXRTdHJlYW0oKXsKICAgIGlmIChzb3VyY2VTZWxlY3QudmFsdWUgPT09ICJtaWMiKXsKICAgICAgcmV0dXJuIGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHsKICAgICAgICBhdWRpbzp7IGVjaG9DYW5jZWxsYXRpb246ZmFsc2UsIG5vaXNlU3VwcHJlc3Npb246ZmFsc2UsIGF1dG9HYWluQ29udHJvbDpmYWxzZSwgbGF0ZW5jeTowLjAwMyB9LAogICAgICAgIHZpZGVvOmZhbHNlCiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0RGlzcGxheU1lZGlhKHsgYXVkaW86dHJ1ZSwgdmlkZW86dHJ1ZSB9KTsKICB9CgogIGZ1bmN0aW9uIHN0b3BBbGxJbnB1dCgpewogICAgaWYgKGlucHV0U3RyZWFtKXsgaW5wdXRTdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaCh0ciA9PiB0ci5zdG9wKCkpOyBpbnB1dFN0cmVhbSA9IG51bGw7IH0KICB9CgogIC8vIC0tLS0gQ29kZWMgLS0tLQogIGZ1bmN0aW9uIHBpY2tCZXN0TWltZVR5cGUoKXsKICAgIGZvciAoY29uc3QgYyBvZiBbJ2F1ZGlvL3dlYm07Y29kZWNzPW9wdXMnLCdhdWRpby93ZWJtJywnYXVkaW8vbXA0JywnYXVkaW8vb2dnO2NvZGVjcz1vcHVzJywnYXVkaW8vb2dnJ10pewogICAgICBpZiAod2luZG93Lk1lZGlhUmVjb3JkZXIgJiYgTWVkaWFSZWNvcmRlci5pc1R5cGVTdXBwb3J0ZWQgJiYgTWVkaWFSZWNvcmRlci5pc1R5cGVTdXBwb3J0ZWQoYykpIHJldHVybiBjOwogICAgfQogICAgcmV0dXJuICcnOwogIH0KCiAgLy8gLS0tLSBCdWZmZXIgdXRpbHMgLS0tLQogIGFzeW5jIGZ1bmN0aW9uIGJsb2JUb0F1ZGlvQnVmZmVyKGJsb2IpewogICAgY29uc3QgYWIgPSBhd2FpdCBibG9iLmFycmF5QnVmZmVyKCk7CiAgICByZXR1cm4gYXdhaXQgYXVkaW9DdHguZGVjb2RlQXVkaW9EYXRhKGFiKTsKICB9CgogIGZ1bmN0aW9uIG1peFRvTW9ubyhkZWNvZGVkKXsKICAgIGlmIChkZWNvZGVkLm51bWJlck9mQ2hhbm5lbHMgPD0gMSkgcmV0dXJuIGRlY29kZWQ7CiAgICBjb25zdCBtb25vID0gYXVkaW9DdHguY3JlYXRlQnVmZmVyKDEsIGRlY29kZWQubGVuZ3RoLCBkZWNvZGVkLnNhbXBsZVJhdGUpOwogICAgY29uc3Qgb3V0ID0gbW9uby5nZXRDaGFubmVsRGF0YSgwKTsKICAgIGZvciAobGV0IGNoID0gMDsgY2ggPCBkZWNvZGVkLm51bWJlck9mQ2hhbm5lbHM7IGNoKyspewogICAgICBjb25zdCBkID0gZGVjb2RlZC5nZXRDaGFubmVsRGF0YShjaCk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZC5sZW5ndGg7IGkrKykgb3V0W2ldICs9IGRbaV0gLyBkZWNvZGVkLm51bWJlck9mQ2hhbm5lbHM7CiAgICB9CiAgICByZXR1cm4gbW9ubzsKICB9CgogIGZ1bmN0aW9uIHNsaWNlQnVmZmVyKGJ1Ziwgc3RhcnRTZWMsIGxlbmd0aFNlYyl7CiAgICBjb25zdCBzciA9IGJ1Zi5zYW1wbGVSYXRlOwogICAgY29uc3Qgc3RhcnRTYW1wbGUgPSBNYXRoLm1heCgwLCBNYXRoLnJvdW5kKHN0YXJ0U2VjICogc3IpKTsKICAgIGNvbnN0IGxlblNhbXBsZXMgID0gTWF0aC5tYXgoMSwgTWF0aC5yb3VuZChsZW5ndGhTZWMgKiBzcikpOwogICAgY29uc3QgZW5kU2FtcGxlICAgPSBNYXRoLm1pbihidWYubGVuZ3RoLCBzdGFydFNhbXBsZSArIGxlblNhbXBsZXMpOwogICAgY29uc3QgYWN0dWFsTGVuICAgPSBlbmRTYW1wbGUgLSBzdGFydFNhbXBsZTsKICAgIGNvbnN0IG91dCA9IGF1ZGlvQ3R4LmNyZWF0ZUJ1ZmZlcihidWYubnVtYmVyT2ZDaGFubmVscywgTWF0aC5tYXgoMSwgYWN0dWFsTGVuKSwgc3IpOwogICAgZm9yIChsZXQgY2ggPSAwOyBjaCA8IGJ1Zi5udW1iZXJPZkNoYW5uZWxzOyBjaCsrKXsKICAgICAgb3V0LmdldENoYW5uZWxEYXRhKGNoKS5zZXQoYnVmLmdldENoYW5uZWxEYXRhKGNoKS5zdWJhcnJheShzdGFydFNhbXBsZSwgZW5kU2FtcGxlKSk7CiAgICB9CiAgICByZXR1cm4gb3V0OwogIH0KCiAgZnVuY3Rpb24gYXBwbHlGYWRlcyhidWYsIGZpbk1zLCBmb3V0TXMpewogICAgY29uc3Qgc3IgPSBidWYuc2FtcGxlUmF0ZTsKICAgIGNvbnN0IG91dCA9IGF1ZGlvQ3R4LmNyZWF0ZUJ1ZmZlcihidWYubnVtYmVyT2ZDaGFubmVscywgYnVmLmxlbmd0aCwgc3IpOwogICAgY29uc3QgZmluICA9IE1hdGgubWF4KDAsIE1hdGgucm91bmQoKGZpbk1zICAvIDEwMDApICogc3IpKTsKICAgIGNvbnN0IGZvdXQgPSBNYXRoLm1heCgwLCBNYXRoLnJvdW5kKChmb3V0TXMgLyAxMDAwKSAqIHNyKSk7CiAgICBmb3IgKGxldCBjaCA9IDA7IGNoIDwgYnVmLm51bWJlck9mQ2hhbm5lbHM7IGNoKyspewogICAgICBjb25zdCBzcmMgPSBidWYuZ2V0Q2hhbm5lbERhdGEoY2gpOwogICAgICBjb25zdCBkc3QgPSBvdXQuZ2V0Q2hhbm5lbERhdGEoY2gpOwogICAgICBkc3Quc2V0KHNyYyk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5taW4oZmluLCBkc3QubGVuZ3RoKTsgaSsrKQogICAgICAgIGRzdFtpXSAqPSBpIC8gTWF0aC5tYXgoMSwgZmluIC0gMSk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5taW4oZm91dCwgZHN0Lmxlbmd0aCk7IGkrKyl7CiAgICAgICAgZHN0W2RzdC5sZW5ndGggLSAxIC0gaV0gKj0gaSAvIE1hdGgubWF4KDEsIGZvdXQgLSAxKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG91dDsKICB9CgogIC8vIC0tLS0gVHJhY2sgbW9kZWwgLS0tLQogIGZ1bmN0aW9uIGNyZWF0ZVRyYWNrKGluZGV4KXsKICAgIHJldHVybiB7CiAgICAgIGluZGV4LAogICAgICByYXdCdWZmZXI6IG51bGwsIGJ1ZmZlcjogbnVsbCwKICAgICAgc291cmNlOiBudWxsLCBnYWluTm9kZTogbnVsbCwKICAgICAgcmVjb3JkZXI6IG51bGwsIHJlY0NodW5rczogW10sCiAgICAgIGlzUmVjb3JkaW5nOiBmYWxzZSwgaXNQbGF5aW5nOiBmYWxzZSwKICAgICAgaXNDb3VudGluZ0luOiBmYWxzZSwgaXNBcm1lZFJlY29yZDogZmFsc2UsCiAgICAgIGJhcnM6IDgsIGNvdW50SW5CYXJzOiA0LAogICAgICBmYWRlSW5NczogOCwgZmFkZU91dE1zOiA4LAogICAgICBwbGFubmVkTGVhZFNlYzogMCwgcGxhbm5lZExlblNlYzogMCwKICAgICAgcmVjU3RhcnRDb250ZXh0VGltZTogMCwgICAgLy8gQXVkaW9Db250ZXh0IHRpbWUgd2hlbiByZWNvcmRpbmcgYWN0dWFsbHkgc3RhcnRlZAogICAgICBsb29wQmFyU3RhcnRDb250ZXh0VGltZTogMCwgLy8gQXVkaW9Db250ZXh0IHRpbWUgb2YgbG9vcCBiZWF0LTAKICAgICAgbG9vcENvdW50OiAwLCBsb29wVGltZXI6IG51bGwsCiAgICAgIGxvbmdQcmVzc1RpbWVyOiBudWxsLCBsb25nUHJlc3NGaXJlZDogZmFsc2UsCiAgICAgIF9wcmV2Vm9sOiAwLjg1LAogICAgICBfdW5kb0J1ZmZlcjogbnVsbCwgX3VuZG9SYXc6IG51bGwsIF91bmRvVGltZXI6IG51bGwsCiAgICAgIHVpOiB7fQogICAgfTsKICB9CgogIC8vIC0tLS0gUGxheWJhY2sgLS0tLQogIGZ1bmN0aW9uIHN0b3BQbGF5YmFjayh0KXsKICAgIGlmICh0LnNvdXJjZSl7IHRyeXsgdC5zb3VyY2Uuc3RvcCgpOyB9IGNhdGNoe30gdHJ5eyB0LnNvdXJjZS5kaXNjb25uZWN0KCk7IH0gY2F0Y2h7fSB0LnNvdXJjZSA9IG51bGw7IH0KICAgIHQuaXNQbGF5aW5nID0gZmFsc2U7CiAgICBpZiAodC5sb29wVGltZXIpeyBjbGVhckludGVydmFsKHQubG9vcFRpbWVyKTsgdC5sb29wVGltZXIgPSBudWxsOyB9CiAgICB0Lmxvb3BDb3VudCA9IDA7CiAgICB1cGRhdGVUcmFja1VJKHQpOwogICAgdXBkYXRlR2xvYmFsQnV0dG9ucygpOwogIH0KCiAgZnVuY3Rpb24gc3RhcnRQbGF5YmFjayh0LCBhdENvbnRleHRUaW1lKXsKICAgIGlmICghYXVkaW9DdHggfHwgIXQuYnVmZmVyKSByZXR1cm47CiAgICBzdG9wUGxheWJhY2sodCk7CgogICAgY29uc3Qgc3JjID0gYXVkaW9DdHguY3JlYXRlQnVmZmVyU291cmNlKCk7CiAgICBzcmMuYnVmZmVyID0gdC5idWZmZXI7CiAgICBzcmMubG9vcCA9IHRydWU7CiAgICBzcmMubG9vcFN0YXJ0ID0gMDsKICAgIHNyYy5sb29wRW5kID0gdC5idWZmZXIuZHVyYXRpb247CiAgICBzcmMuY29ubmVjdCh0LmdhaW5Ob2RlKTsKCiAgICBsZXQgc3RhcnRBdCA9IGF0Q29udGV4dFRpbWUgIT0gbnVsbCA/IGF0Q29udGV4dFRpbWUgOiAoYXVkaW9DdHguY3VycmVudFRpbWUgKyAwLjAyKTsKICAgIGlmIChhdENvbnRleHRUaW1lID09IG51bGwgJiYgc3luY09uKCkgJiYgZ3JpZFN0YXJ0ZWQpewogICAgICBzdGFydEF0ID0gbmV4dEJhclRpbWUoYXVkaW9DdHguY3VycmVudFRpbWUgKyAwLjA0KTsKICAgIH0KICAgIHRyeXsgc3JjLnN0YXJ0KHN0YXJ0QXQpOyB9IGNhdGNoeyBzcmMuc3RhcnQoKTsgfQoKICAgIHQuc291cmNlID0gc3JjOwogICAgdC5pc1BsYXlpbmcgPSB0cnVlOwogICAgdC5sb29wQmFyU3RhcnRDb250ZXh0VGltZSA9IHN0YXJ0QXQ7CgogICAgLy8gbG9vcCBjb3VudGVyCiAgICBjb25zdCBkdXIgPSB0LmJ1ZmZlci5kdXJhdGlvbjsKICAgIGlmIChkdXIgPiAwLjA1KXsKICAgICAgdC5sb29wVGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgaWYgKCF0LmlzUGxheWluZykgcmV0dXJuOwogICAgICAgIHQubG9vcENvdW50Kys7CiAgICAgICAgdXBkYXRlVHJhY2tVSSh0KTsKICAgICAgfSwgTWF0aC5tYXgoNTAsIGR1ciAqIDEwMDApKTsKICAgIH0KCiAgICB1cGRhdGVUcmFja1VJKHQpOwogICAgdXBkYXRlR2xvYmFsQnV0dG9ucygpOwogIH0KCiAgLy8gLS0tLSBSZWNvcmRpbmcgLS0tLQogIGZ1bmN0aW9uIGNhbmNlbENvdW50ZG93bih0KXsKICAgIGNvbnN0IHN0ID0gY291bnRkb3ducy5nZXQodC5pbmRleCk7CiAgICBpZiAoIXN0KSByZXR1cm47CiAgICBzdC5hY3RpdmUgPSBmYWxzZTsKICAgIGlmIChzdC50aW1lcikgY2xlYXJUaW1lb3V0KHN0LnRpbWVyKTsKICAgIGNvdW50ZG93bnMuZGVsZXRlKHQuaW5kZXgpOwogICAgdC5pc0NvdW50aW5nSW4gPSBmYWxzZTsKICAgIHQudWkuY291bnRCYWRnZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgdXBkYXRlVHJhY2tVSSh0KTsgdXBkYXRlR2xvYmFsQnV0dG9ucygpOwogIH0KCiAgZnVuY3Rpb24gY2FuY2VsU2NoZWR1bGUodCl7CiAgICBjb25zdCBzY2ggPSBzY2hlZHVsZXMuZ2V0KHQuaW5kZXgpOwogICAgaWYgKCFzY2gpIHJldHVybjsKICAgIGlmIChzY2guc3RvcFRpbWVvdXQpIGNsZWFyVGltZW91dChzY2guc3RvcFRpbWVvdXQpOwogICAgc2NoZWR1bGVzLmRlbGV0ZSh0LmluZGV4KTsKICAgIHQuaXNBcm1lZFJlY29yZCA9IGZhbHNlOwogICAgdXBkYXRlVHJhY2tVSSh0KTsgdXBkYXRlR2xvYmFsQnV0dG9ucygpOwogIH0KCiAgZnVuY3Rpb24gY2xlYXJUcmFjayh0LCBpbW1lZGlhdGUpewogICAgLy8gU2F2ZSB1bmRvIHN0YXRlCiAgICBpZiAodC5idWZmZXIgJiYgIWltbWVkaWF0ZSl7CiAgICAgIHQuX3VuZG9CdWZmZXIgPSB0LmJ1ZmZlcjsKICAgICAgdC5fdW5kb1JhdyAgICA9IHQucmF3QnVmZmVyOwogICAgICBpZiAodC5fdW5kb1RpbWVyKSBjbGVhclRpbWVvdXQodC5fdW5kb1RpbWVyKTsKICAgICAgdC5fdW5kb1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdC5fdW5kb0J1ZmZlciA9IG51bGw7IHQuX3VuZG9SYXcgPSBudWxsOyB0Ll91bmRvVGltZXIgPSBudWxsOwogICAgICAgIHQudWkudW5kb0Jhci5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICB9LCA1MDAwKTsKICAgICAgdC51aS51bmRvQmFyLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CiAgICB9CiAgICBjYW5jZWxDb3VudGRvd24odCk7IGNhbmNlbFNjaGVkdWxlKHQpOwogICAgaWYgKHQuaXNSZWNvcmRpbmcpIHN0b3BSZWNvcmRpbmcodCwgeyBhdXRvUGxheTpmYWxzZSB9KTsKICAgIHN0b3BQbGF5YmFjayh0KTsKICAgIHQuYnVmZmVyID0gbnVsbDsgdC5yYXdCdWZmZXIgPSBudWxsOwogICAgdXBkYXRlVHJhY2tVSSh0KTsgdXBkYXRlR2xvYmFsQnV0dG9ucygpOwogICAgZHJhd1dhdmVmb3JtKHQpOwogIH0KCiAgZnVuY3Rpb24gdW5kb0NsZWFyKHQpewogICAgaWYgKCF0Ll91bmRvQnVmZmVyKSByZXR1cm47CiAgICB0LmJ1ZmZlciAgICA9IHQuX3VuZG9CdWZmZXI7CiAgICB0LnJhd0J1ZmZlciA9IHQuX3VuZG9SYXc7CiAgICB0Ll91bmRvQnVmZmVyID0gbnVsbDsgdC5fdW5kb1JhdyA9IG51bGw7CiAgICBpZiAodC5fdW5kb1RpbWVyKXsgY2xlYXJUaW1lb3V0KHQuX3VuZG9UaW1lcik7IHQuX3VuZG9UaW1lciA9IG51bGw7IH0KICAgIHQudWkudW5kb0Jhci5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgdXBkYXRlVHJhY2tVSSh0KTsgdXBkYXRlR2xvYmFsQnV0dG9ucygpOwogICAgZHJhd1dhdmVmb3JtKHQpOwogIH0KCiAgZnVuY3Rpb24gc3RhcnRSZWNvcmRpbmdOb3codCl7CiAgICBpZiAoIWF1ZGlvQ3R4IHx8ICFpbnB1dFN0cmVhbSkgcmV0dXJuOwogICAgaWYgKCF3aW5kb3cuTWVkaWFSZWNvcmRlcikgeyBhbGVydCgiTWVkaWFSZWNvcmRlciBub24gZGlzcG9uaWJpbGUuIik7IHJldHVybjsgfQogICAgaWYgKHQuaXNSZWNvcmRpbmcpIHJldHVybjsKCiAgICBzdG9wUGxheWJhY2sodCk7CiAgICB0LnJlY0NodW5rcyA9IFtdOwogICAgY29uc3QgbWltZSA9IHBpY2tCZXN0TWltZVR5cGUoKTsKICAgIGNvZGVjRWwudGV4dENvbnRlbnQgPSBtaW1lIHx8ICIoYXV0bykiOwoKICAgIGxldCByZWM7CiAgICB0cnkgeyByZWMgPSBuZXcgTWVkaWFSZWNvcmRlcihpbnB1dFN0cmVhbSwgbWltZSA/IHsgbWltZVR5cGU6bWltZSB9IDogdW5kZWZpbmVkKTsgfQogICAgY2F0Y2ggeyByZWMgPSBuZXcgTWVkaWFSZWNvcmRlcihpbnB1dFN0cmVhbSk7IGNvZGVjRWwudGV4dENvbnRlbnQgPSAiKGZhbGxiYWNrKSI7IH0KCiAgICB0LnJlY29yZGVyID0gcmVjOwogICAgdC5pc1JlY29yZGluZyA9IHRydWU7CiAgICB0LmlzQXJtZWRSZWNvcmQgPSBmYWxzZTsKICAgIHQucmVjU3RhcnRDb250ZXh0VGltZSA9IGF1ZGlvQ3R4LmN1cnJlbnRUaW1lICsgMC4wMjsgLy8gYXBwcm94aW1hdGUKCiAgICByZWMub25kYXRhYXZhaWxhYmxlID0gKGV2KSA9PiB7IGlmIChldi5kYXRhICYmIGV2LmRhdGEuc2l6ZSA+IDApIHQucmVjQ2h1bmtzLnB1c2goZXYuZGF0YSk7IH07CiAgICByZWMub25lcnJvciA9IChldikgPT4gewogICAgICBjb25zb2xlLmVycm9yKCJSZWNvcmRlciBlcnJvciIsIGV2KTsKICAgICAgdC5pc1JlY29yZGluZyA9IGZhbHNlOyB0LnJlY29yZGVyID0gbnVsbDsgdC5yZWNDaHVua3MgPSBbXTsKICAgICAgdXBkYXRlVHJhY2tVSSh0KTsgdXBkYXRlR2xvYmFsQnV0dG9ucygpOwogICAgfTsKCiAgICByZWMuc3RhcnQoMTAwKTsgLy8gMTAwbXMgY2h1bmtzIGZvciBhY2N1cmFjeQogICAgdXBkYXRlVHJhY2tVSSh0KTsgdXBkYXRlR2xvYmFsQnV0dG9ucygpOwogICAgc3RhcnRSZWNQcm9ncmVzc0FuaW0odCk7CiAgfQoKICBmdW5jdGlvbiBzdG9wUmVjb3JkaW5nKHQsIHsgYXV0b1BsYXkgfSA9IHsgYXV0b1BsYXk6dHJ1ZSB9KXsKICAgIGlmICghdC5yZWNvcmRlciB8fCAhdC5pc1JlY29yZGluZykgcmV0dXJuOwogICAgY29uc3QgcmVjID0gdC5yZWNvcmRlcjsKICAgIHN0b3BSZWNQcm9ncmVzc0FuaW0odCk7CgogICAgcmVjLm9uc3RvcCA9IGFzeW5jICgpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IodC5yZWNDaHVua3MsIHsgdHlwZTogcmVjLm1pbWVUeXBlIHx8ICdhdWRpby93ZWJtJyB9KTsKICAgICAgICBpZiAoYmxvYi5zaXplIDwgMTUwMCl7IHQuYnVmZmVyID0gbnVsbDsgdC5yYXdCdWZmZXIgPSBudWxsOyByZXR1cm47IH0KCiAgICAgICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IGJsb2JUb0F1ZGlvQnVmZmVyKGJsb2IpOwogICAgICAgIGNvbnN0IG1vbm8gPSBtaXhUb01vbm8oZGVjb2RlZCk7CgogICAgICAgIC8vIC0tLS0gVFJJTSBMT0dJQyAtLS0tCiAgICAgICAgLy8gcGxhbm5lZExlYWRTZWMgPSB0aW1lIGZyb20gcmVjb3JkZXItc3RhcnQgdG8gbG9vcC1iZWF0LTAKICAgICAgICAvLyBXZSBhbHNvIGFkZCBnZXRMZWFkU2VjKCkgKHVzZXItY2FsaWJyYXRlZCBsYXRlbmN5IHRyaW0pCiAgICAgICAgY29uc3QgbG9vcExlbiAgID0gdC5wbGFubmVkTGVuU2VjICB8fCAoTWF0aC5tYXgoMSwgdC5iYXJzKSAqIGJhclNlYygpKTsKICAgICAgICBjb25zdCBleHRyYUVuZCAgPSBnZXRFeHRyYUJlYXRzKCkgICogYmVhdFNlYygpOwogICAgICAgIGNvbnN0IHRyaW1TdGFydCA9IE1hdGgubWF4KDAsICh0LnBsYW5uZWRMZWFkU2VjIHx8IDApICsgZ2V0TGVhZFNlYygpKTsKCiAgICAgICAgY29uc3Qgd2l0aEV4dHJhID0gc2xpY2VCdWZmZXIobW9ubywgdHJpbVN0YXJ0LCBsb29wTGVuICsgZXh0cmFFbmQpOwogICAgICAgIGNvbnN0IGZpeGVkICAgICA9IHNsaWNlQnVmZmVyKHdpdGhFeHRyYSwgMCwgbG9vcExlbik7CgogICAgICAgIHQucmF3QnVmZmVyID0gZml4ZWQ7CiAgICAgICAgY29uc3QgZmkgPSBNYXRoLm1heCgzLCB0LmZhZGVJbk1zKTsKICAgICAgICBjb25zdCBmbyA9IE1hdGgubWF4KDMsIHQuZmFkZU91dE1zKTsKICAgICAgICB0LmJ1ZmZlciAgPSBhcHBseUZhZGVzKHQucmF3QnVmZmVyLCBmaSwgZm8pOwoKICAgICAgICBkcmF3V2F2ZWZvcm0odCk7CiAgICAgICAgaWYgKGF1dG9QbGF5KXsKICAgICAgICAgIC8vIFN0YXJ0IHBsYXliYWNrIGFsaWduZWQgdG8gZ3JpZAogICAgICAgICAgY29uc3Qgc3RhcnRBdCA9IHN5bmNPbigpICYmIGdyaWRTdGFydGVkCiAgICAgICAgICAgID8gbmV4dEJhclRpbWUoYXVkaW9DdHguY3VycmVudFRpbWUgKyAwLjA0KQogICAgICAgICAgICA6IChhdWRpb0N0eC5jdXJyZW50VGltZSArIDAuMDQpOwogICAgICAgICAgc3RhcnRQbGF5YmFjayh0LCBzdGFydEF0KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2goZSl7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBhbGVydCgiRXJyb3JlIGRlY29kaWZpY2EgYXVkaW86ICIgKyAoZT8ubWVzc2FnZSB8fCBlKSk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdC5pc1JlY29yZGluZyAgID0gZmFsc2U7CiAgICAgICAgdC5yZWNvcmRlciAgICAgID0gbnVsbDsKICAgICAgICB0LnJlY0NodW5rcyAgICAgPSBbXTsKICAgICAgICB0LnBsYW5uZWRMZWFkU2VjID0gMDsKICAgICAgICB0LnBsYW5uZWRMZW5TZWMgID0gMDsKICAgICAgICB1cGRhdGVUcmFja1VJKHQpOyB1cGRhdGVHbG9iYWxCdXR0b25zKCk7CiAgICAgIH0KICAgIH07CgogICAgdHJ5IHsgcmVjLnN0b3AoKTsgfSBjYXRjaHt9CiAgICB1cGRhdGVUcmFja1VJKHQpOyB1cGRhdGVHbG9iYWxCdXR0b25zKCk7CiAgfQoKICAvLyAtLS0tIENvdW50LWluICsgYXJtIHJlY29yZCAtLS0tCiAgZnVuY3Rpb24gc3RhcnRDb3VudGRvd25UaGVuUmVjb3JkKHQpewogICAgY2FuY2VsQ291bnRkb3duKHQpOwogICAgY29uc3QgYmFyc1RvQ291bnQgPSBNYXRoLm1heCgwLCB0LmNvdW50SW5CYXJzIHx8IDApOwoKICAgIC8vIElmIHRoaXMgaXMgdGhlIHZlcnkgZmlyc3QgdHJhY2sgYmVpbmcgcmVjb3JkZWQsIHJlc2V0L3N0YXJ0IHRoZSBncmlkCiAgICBjb25zdCBpc0ZpcnN0VHJhY2sgPSAhdHJhY2tzLnNvbWUodHggPT4gdHggIT09IHQgJiYgKHR4LmJ1ZmZlciB8fCB0eC5pc1JlY29yZGluZyB8fCB0eC5pc0FybWVkUmVjb3JkKSk7CgogICAgaWYgKGJhcnNUb0NvdW50ID09PSAwKXsKICAgICAgaWYgKGlzRmlyc3RUcmFjaykgaW5pdEdyaWRGb3JGaXJzdFRyYWNrKHQsIDApOwogICAgICBlbHNlIGFybVJlY29yZFdpdGhQcmV0aW1lKHQpOwogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKCFtZXRyb09uKSBzdGFydE1ldHJvbm9tZSgpOwoKICAgIHQuaXNDb3VudGluZ0luID0gdHJ1ZTsKICAgIHVwZGF0ZVRyYWNrVUkodCk7IHVwZGF0ZUdsb2JhbEJ1dHRvbnMoKTsKCiAgICBjb25zdCB0b3RhbEJlYXRzICA9IGJhcnNUb0NvdW50ICogZ2V0TnVtZXJhdG9yKCk7CiAgICBjb25zdCBiZWF0TXMgICAgICA9IGJlYXRTZWMoKSAqIDEwMDA7CgogICAgLy8gU2hvdyBwcmVjb3VudCBMRURzCiAgICBjb25zdCBwcmVjb3VudExlZHMgPSB0LnVpLnByZWNvdW50TGVkczsKICAgIGlmIChwcmVjb3VudExlZHMpewogICAgICBwcmVjb3VudExlZHMuaW5uZXJIVE1MID0gIiI7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdG90YWxCZWF0czsgaSsrKXsKICAgICAgICBjb25zdCBsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOyBsLmNsYXNzTmFtZSA9ICJsZWQgcHJlY291bnQiOyBwcmVjb3VudExlZHMuYXBwZW5kQ2hpbGQobCk7CiAgICAgIH0KICAgIH0KCiAgICBsZXQgYmVhdHNEb25lID0gMDsKICAgIGNvbnN0IHN0YXRlID0geyBhY3RpdmU6dHJ1ZSwgdGltZXI6bnVsbCB9OwogICAgY291bnRkb3ducy5zZXQodC5pbmRleCwgc3RhdGUpOwoKICAgIGNvbnN0IHN0ZXAgPSAoKSA9PiB7CiAgICAgIGlmICghc3RhdGUuYWN0aXZlKSByZXR1cm47CiAgICAgIGNvbnN0IHN0ID0gY291bnRkb3ducy5nZXQodC5pbmRleCk7CiAgICAgIGlmICghc3QgfHwgIXN0LmFjdGl2ZSkgcmV0dXJuOwoKICAgICAgLy8gTGlnaHQgdXAgcHJlY291bnQgTEVEcwogICAgICBpZiAocHJlY291bnRMZWRzKXsKICAgICAgICBjb25zdCBsZWRzID0gcHJlY291bnRMZWRzLnF1ZXJ5U2VsZWN0b3JBbGwoIi5sZWQiKTsKICAgICAgICBsZWRzLmZvckVhY2goKGwsIGkpID0+IGwuY2xhc3NMaXN0LnRvZ2dsZSgib24iLCBpIDwgYmVhdHNEb25lKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGJhcklkeCAgID0gTWF0aC5mbG9vcihiZWF0c0RvbmUgLyBnZXROdW1lcmF0b3IoKSk7CiAgICAgIGNvbnN0IGJlYXRJZHggID0gYmVhdHNEb25lICUgZ2V0TnVtZXJhdG9yKCk7CiAgICAgIHQudWkuY291bnRCYWRnZS50ZXh0Q29udGVudCA9IGBQUkUgJHtiYXJJZHggKyAxfS8ke2JhcnNUb0NvdW50fSDigKIgJHtiZWF0SWR4ICsgMX1gOwogICAgICB0LnVpLmNvdW50QmFkZ2Uuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtZmxleCI7CgogICAgICBiZWF0c0RvbmUrKzsKCiAgICAgIGlmIChiZWF0c0RvbmUgPj0gdG90YWxCZWF0cyl7CiAgICAgICAgdC51aS5jb3VudEJhZGdlLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgdC5pc0NvdW50aW5nSW4gPSBmYWxzZTsKICAgICAgICBpZiAocHJlY291bnRMZWRzKSBwcmVjb3VudExlZHMuaW5uZXJIVE1MID0gIiI7CiAgICAgICAgY291bnRkb3ducy5kZWxldGUodC5pbmRleCk7CiAgICAgICAgdXBkYXRlVHJhY2tVSSh0KTsgdXBkYXRlR2xvYmFsQnV0dG9ucygpOwogICAgICAgIGlmIChpc0ZpcnN0VHJhY2spIGluaXRHcmlkRm9yRmlyc3RUcmFjayh0LCBiYXJzVG9Db3VudCk7CiAgICAgICAgZWxzZSBhcm1SZWNvcmRXaXRoUHJldGltZSh0KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHN0LnRpbWVyID0gc2V0VGltZW91dChzdGVwLCBiZWF0TXMpOwogICAgfTsKCiAgICBzdGVwKCk7CiAgfQoKICBmdW5jdGlvbiBpbml0R3JpZEZvckZpcnN0VHJhY2sodCwgY291bnRlZEJhcnMpewogICAgLy8gU3RhcnQgZ3JpZCBOT1cgKGFmdGVyIGNvdW50LWluKSwgc3luY2hyb25pc2UgbWV0cm9ub21lIHRvIGl0CiAgICBpZiAoIWF1ZGlvQ3R4KSByZXR1cm47CiAgICBjb25zdCBub3cgPSBhdWRpb0N0eC5jdXJyZW50VGltZTsKCiAgICAvLyBUaGUgZ3JpZCBvcmlnaW4gaXMgdGhlIG5leHQgYmFyIGJvdW5kYXJ5IChvciBub3cgKyB0aW55IG9mZnNldCkKICAgIGxldCBvcmlnaW47CiAgICBpZiAoc3luY09uKCkgJiYgZ3JpZFN0YXJ0ZWQpewogICAgICBvcmlnaW4gPSBuZXh0QmFyVGltZShub3cgKyAwLjAyKTsKICAgIH0gZWxzZSB7CiAgICAgIG9yaWdpbiA9IG5vdyArIDAuMDU7CiAgICAgIHJlc2V0R3JpZChvcmlnaW4pOwogICAgfQogICAgcmVzZXRHcmlkKG9yaWdpbik7CgogICAgLy8gUmVzdGFydCBtZXRyb25vbWUgaW4gc3luYyB3aXRoIGdyaWQKICAgIHN0YXJ0TWV0cm9ub21lKG9yaWdpbik7CgogICAgLy8gQXJtIHJlY29yZCBmcm9tIG9yaWdpbgogICAgYXJtUmVjb3JkQXQodCwgb3JpZ2luKTsKICB9CgogIGZ1bmN0aW9uIGFybVJlY29yZFdpdGhQcmV0aW1lKHQpewogICAgaWYgKCFhdWRpb0N0eCkgcmV0dXJuOwogICAgY29uc3Qgbm93ID0gYXVkaW9DdHguY3VycmVudFRpbWU7CiAgICBjb25zdCBkZXNpcmVkU3RhcnQgPSBzeW5jT24oKSAmJiBncmlkU3RhcnRlZAogICAgICA/IG5leHRCYXJUaW1lKG5vdyArIDAuMDQpCiAgICAgIDogKG5vdyArIDAuMDQpOwogICAgYXJtUmVjb3JkQXQodCwgZGVzaXJlZFN0YXJ0KTsKICB9CgogIGZ1bmN0aW9uIGFybVJlY29yZEF0KHQsIGRlc2lyZWRTdGFydENvbnRleHRUaW1lKXsKICAgIGlmICghYXVkaW9DdHgpIHJldHVybjsKICAgIGNvbnN0IG5vdyA9IGF1ZGlvQ3R4LmN1cnJlbnRUaW1lOwoKICAgIGNvbnN0IGJhcnMgICAgPSBNYXRoLm1heCgxLCB0LmJhcnMpOwogICAgY29uc3QgbG9vcExlbiA9IGJhcnMgKiBiYXJTZWMoKTsKICAgIGNvbnN0IGV4dHJhICAgPSBnZXRFeHRyYUJlYXRzKCkgKiBiZWF0U2VjKCk7CgogICAgLy8gU3RhcnQgcmVjb3JkZXIgaW1tZWRpYXRlbHkgKHRvIGNhcHR1cmUgbGVhZGluZyBhdWRpbyBmb3IgYWNjdXJhdGUgdHJpbSkKICAgIGNvbnN0IHJlY1N0YXJ0Tm93ID0gbm93ICsgMC4wMjsKICAgIGNvbnN0IHByZXRpbWUgPSBNYXRoLm1heCgwLCBkZXNpcmVkU3RhcnRDb250ZXh0VGltZSAtIHJlY1N0YXJ0Tm93KTsKCiAgICB0LnBsYW5uZWRMZWFkU2VjID0gcHJldGltZTsKICAgIHQucGxhbm5lZExlblNlYyAgPSBsb29wTGVuOwogICAgdC5sb29wQmFyU3RhcnRDb250ZXh0VGltZSA9IGRlc2lyZWRTdGFydENvbnRleHRUaW1lOwoKICAgIGNhbmNlbFNjaGVkdWxlKHQpOwogICAgdC5pc0FybWVkUmVjb3JkID0gdHJ1ZTsKICAgIHVwZGF0ZVRyYWNrVUkodCk7IHVwZGF0ZUdsb2JhbEJ1dHRvbnMoKTsKCiAgICBzdGFydFJlY29yZGluZ05vdyh0KTsKCiAgICBjb25zdCBzdG9wQXQgID0gZGVzaXJlZFN0YXJ0Q29udGV4dFRpbWUgKyBsb29wTGVuICsgZXh0cmE7CiAgICBjb25zdCBzdG9wRGVsYXlNcyA9IE1hdGgubWF4KDEwMCwgKHN0b3BBdCAtIGF1ZGlvQ3R4LmN1cnJlbnRUaW1lKSAqIDEwMDApOwogICAgY29uc3Qgc3RvcFRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHN0b3BSZWNvcmRpbmcodCwgeyBhdXRvUGxheTp0cnVlIH0pLCBzdG9wRGVsYXlNcyk7CiAgICBzY2hlZHVsZXMuc2V0KHQuaW5kZXgsIHsgc3RvcFRpbWVvdXQgfSk7CgogICAgdC51aS5jb3VudEJhZGdlLnRleHRDb250ZW50ID0gYFJFQyBQUkUgJHtNYXRoLnJvdW5kKHByZXRpbWUqMTAwMCl9bXNgOwogICAgdC51aS5jb3VudEJhZGdlLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWZsZXgiOwogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIGNvbnN0IHN0ID0gY291bnRkb3ducy5nZXQodC5pbmRleCk7CiAgICAgIGlmICghc3QgJiYgIXQuaXNDb3VudGluZ0luKSB0LnVpLmNvdW50QmFkZ2Uuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgIH0sIDE1MDApOwogIH0KCiAgLy8gLS0tLSBNYWluIHRhcCBoYW5kbGVyIC0tLS0KICBhc3luYyBmdW5jdGlvbiBvbk1haW5UYXAodCl7CiAgICBpZiAoIWF1ZGlvQ3R4KSB7IGFsZXJ0KCJQcmltYSBjbGljY2E6IEF0dGl2YSBBdWRpbyIpOyByZXR1cm47IH0KICAgIHRyeSB7IGF3YWl0IGF1ZGlvQ3R4LnJlc3VtZSgpOyB9IGNhdGNoe30KCiAgICBpZiAodC5pc0NvdW50aW5nSW4peyAgY2FuY2VsQ291bnRkb3duKHQpOyAgcmV0dXJuOyB9CiAgICBpZiAodC5pc0FybWVkUmVjb3JkKXsgY2FuY2VsU2NoZWR1bGUodCk7ICAgcmV0dXJuOyB9CgogICAgaWYgKCF0LmJ1ZmZlciAmJiAhdC5pc1JlY29yZGluZyl7CiAgICAgIGlmIChzeW5jT24oKSAmJiAhZ3JpZFN0YXJ0ZWQpewogICAgICAgIC8vIEZpcnN0IHRhcDogYXJtICsgc3RhcnQgZ3JpZAogICAgICAgIGNvbnN0IG5vdyA9IGF1ZGlvQ3R4LmN1cnJlbnRUaW1lOwogICAgICAgIHJlc2V0R3JpZChub3cgKyAwLjA1KTsKICAgICAgICBzdGFydE1ldHJvbm9tZShub3cgKyAwLjA1KTsKICAgICAgfQogICAgICBzdGFydENvdW50ZG93blRoZW5SZWNvcmQodCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAodC5pc1JlY29yZGluZyl7CiAgICAgIHN0b3BSZWNvcmRpbmcodCwgeyBhdXRvUGxheTp0cnVlIH0pOwogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKHQuaXNQbGF5aW5nKSBzdG9wUGxheWJhY2sodCk7CiAgICBlbHNlIHN0YXJ0UGxheWJhY2sodCk7CiAgfQoKICAvLyAtLS0tIFJlY29yZGluZyBwcm9ncmVzcyBhbmltYXRpb24gLS0tLQogIGxldCByZWNBbmltRnJhbWVzID0gbmV3IE1hcCgpOwogIGZ1bmN0aW9uIHN0YXJ0UmVjUHJvZ3Jlc3NBbmltKHQpewogICAgY29uc3Qgc3ZnID0gdC51aS5yZWNQcm9ncmVzc1N2ZzsKICAgIGlmICghc3ZnKSByZXR1cm47CiAgICBzdmcuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgogICAgY29uc3QgYW5pbWF0ZSA9ICgpID0+IHsKICAgICAgaWYgKCF0LmlzUmVjb3JkaW5nKXsgc3ZnLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7IHJldHVybjsgfQogICAgICBjb25zdCBlbGFwc2VkICA9IGF1ZGlvQ3R4ID8gKGF1ZGlvQ3R4LmN1cnJlbnRUaW1lIC0gdC5sb29wQmFyU3RhcnRDb250ZXh0VGltZSkgOiAwOwogICAgICBjb25zdCB0b3RhbER1ciA9ICh0LnBsYW5uZWRMZW5TZWMgPiAwKSA/IHQucGxhbm5lZExlblNlYyA6ICh0LmJhcnMgKiBiYXJTZWMoKSk7CiAgICAgIGNvbnN0IHBjdCA9IE1hdGgubWluKDEsIE1hdGgubWF4KDAsIGVsYXBzZWQgLyB0b3RhbER1cikpOwogICAgICBjb25zdCBjaXJjbGUgPSBzdmcucXVlcnlTZWxlY3RvcigiY2lyY2xlIik7CiAgICAgIGlmIChjaXJjbGUpewogICAgICAgIGNvbnN0IGNpcmMgPSAyICogTWF0aC5QSSAqIDQ3OwogICAgICAgIGNpcmNsZS5zdHlsZS5zdHJva2VEYXNoYXJyYXkgID0gYCR7Y2lyY31gOwogICAgICAgIGNpcmNsZS5zdHlsZS5zdHJva2VEYXNob2Zmc2V0ID0gYCR7Y2lyYyAqICgxIC0gcGN0KX1gOwogICAgICB9CiAgICAgIHJlY0FuaW1GcmFtZXMuc2V0KHQuaW5kZXgsIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKSk7CiAgICB9OwogICAgcmVjQW5pbUZyYW1lcy5zZXQodC5pbmRleCwgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpKTsKICB9CgogIGZ1bmN0aW9uIHN0b3BSZWNQcm9ncmVzc0FuaW0odCl7CiAgICBjb25zdCByYWYgPSByZWNBbmltRnJhbWVzLmdldCh0LmluZGV4KTsKICAgIGlmIChyYWYpIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHJhZik7CiAgICByZWNBbmltRnJhbWVzLmRlbGV0ZSh0LmluZGV4KTsKICAgIGlmICh0LnVpLnJlY1Byb2dyZXNzU3ZnKSB0LnVpLnJlY1Byb2dyZXNzU3ZnLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgfQoKICAvLyAtLS0tIFdhdmVmb3JtIC0tLS0KICBmdW5jdGlvbiBkcmF3V2F2ZWZvcm0odCl7CiAgICBjb25zdCBjYW52YXMgPSB0LnVpLndhdmVDYW52YXM7CiAgICBpZiAoIWNhbnZhcykgcmV0dXJuOwogICAgY29uc3QgY3R4MmQgPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgIGNvbnN0IFcgPSBjYW52YXMub2Zmc2V0V2lkdGggfHwgMjAwOwogICAgY29uc3QgSCA9IGNhbnZhcy5vZmZzZXRIZWlnaHQgfHwgMzI7CiAgICBjYW52YXMud2lkdGggID0gVzsKICAgIGNhbnZhcy5oZWlnaHQgPSBIOwogICAgY3R4MmQuY2xlYXJSZWN0KDAsIDAsIFcsIEgpOwoKICAgIGNvbnN0IGJ1ZiA9IHQucmF3QnVmZmVyOwogICAgaWYgKCFidWYpeyBjdHgyZC5maWxsU3R5bGUgPSAicmdiYSgwLDAsMCwuMjUpIjsgY3R4MmQuZmlsbFJlY3QoMCwwLFcsSCk7IHJldHVybjsgfQoKICAgIGNvbnN0IGRhdGEgICAgPSBidWYuZ2V0Q2hhbm5lbERhdGEoMCk7CiAgICBjb25zdCBzdGVwICAgID0gTWF0aC5tYXgoMSwgTWF0aC5mbG9vcihkYXRhLmxlbmd0aCAvIFcpKTsKICAgIGNvbnN0IG1pZCAgICAgPSBIIC8gMjsKICAgIGNvbnN0IHNjYWxlICAgPSBtaWQgKiAwLjk7CgogICAgY3R4MmQuZmlsbFN0eWxlID0gInJnYmEoMCwwLDAsLjI1KSI7CiAgICBjdHgyZC5maWxsUmVjdCgwLDAsVyxIKTsKCiAgICAvLyBncmFkaWVudAogICAgY29uc3QgZ3JhZCA9IGN0eDJkLmNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDAsIFcsIDApOwogICAgZ3JhZC5hZGRDb2xvclN0b3AoMCwgICAicmdiYSg2MSwyMTgsMjU1LC41NSkiKTsKICAgIGdyYWQuYWRkQ29sb3JTdG9wKDAuNSwgInJnYmEoNjEsMjU1LDE3NiwuNjUpIik7CiAgICBncmFkLmFkZENvbG9yU3RvcCgxLCAgICJyZ2JhKDYxLDIxOCwyNTUsLjU1KSIpOwogICAgY3R4MmQuZmlsbFN0eWxlID0gZ3JhZDsKCiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFc7IHgrKyl7CiAgICAgIGxldCBtYXggPSAwOwogICAgICBjb25zdCBvZmYgPSB4ICogc3RlcDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGVwOyBpKyspewogICAgICAgIGNvbnN0IHYgPSBNYXRoLmFicyhkYXRhW29mZiArIGldIHx8IDApOwogICAgICAgIGlmICh2ID4gbWF4KSBtYXggPSB2OwogICAgICB9CiAgICAgIGNvbnN0IGggPSBtYXggKiBzY2FsZTsKICAgICAgY3R4MmQuZmlsbFJlY3QoeCwgbWlkIC0gaCwgMSwgaCAqIDIpOwogICAgfQogIH0KCiAgLy8gLS0tLSBVSSBVcGRhdGUgLS0tLQogIGZ1bmN0aW9uIHVwZGF0ZVRyYWNrVUkodCl7CiAgICBjb25zdCB7IHRhZywgbGFiZWwsIGRvdCwgdm9sLCB2b2xwY3QsIGNsZWFyQnRuLCBzYXZlQnRuIH0gPSB0LnVpOwoKICAgIHQudWkuZWwuY2xhc3NMaXN0LnRvZ2dsZSgiaXMtcmVjIiwgICB0LmlzUmVjb3JkaW5nKTsKICAgIHQudWkuZWwuY2xhc3NMaXN0LnRvZ2dsZSgiaXMtcGxheSIsICB0LmlzUGxheWluZyk7CiAgICB0LnVpLmVsLmNsYXNzTGlzdC50b2dnbGUoImlzLWNvdW50IiwgdC5pc0NvdW50aW5nSW4pOwoKICAgIGlmICh0LmlzQ291bnRpbmdJbil7CiAgICAgIHRhZy50ZXh0Q29udGVudCA9ICJDT1VOVCI7IHRhZy5jbGFzc05hbWUgPSAidGFnIGNvdW50IjsKICAgICAgZG90LmNsYXNzTmFtZSAgID0gImRvdCByZWMiOwogICAgICBsYWJlbC50ZXh0Q29udGVudCA9IGBwcmVjb3VudCAke3QuY291bnRJbkJhcnN9IGJhcnPigKZgOwogICAgfSBlbHNlIGlmICh0LmlzQXJtZWRSZWNvcmQpewogICAgICB0YWcudGV4dENvbnRlbnQgPSAiQVJNIjsgdGFnLmNsYXNzTmFtZSA9ICJ0YWcgYXJtIjsKICAgICAgZG90LmNsYXNzTmFtZSAgID0gImRvdCByZWMiOwogICAgICBsYWJlbC50ZXh0Q29udGVudCA9IGBhcm0g4oCiICR7dC5iYXJzfSBiYXJzYDsKICAgIH0gZWxzZSBpZiAodC5pc1JlY29yZGluZyl7CiAgICAgIHRhZy50ZXh0Q29udGVudCA9ICJSRUMiOyB0YWcuY2xhc3NOYW1lID0gInRhZyByZWMiOwogICAgICBkb3QuY2xhc3NOYW1lICAgPSAiZG90IHJlYyI7CiAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gYHJlZ2lzdHJhemlvbmXigKYgKCR7dC5iYXJzfSBiYXJzKWA7CiAgICB9IGVsc2UgaWYgKHQuaXNQbGF5aW5nKXsKICAgICAgdGFnLnRleHRDb250ZW50ID0gIlBMQVkiOyB0YWcuY2xhc3NOYW1lID0gInRhZyBwbGF5IjsKICAgICAgZG90LmNsYXNzTmFtZSAgID0gImRvdCBwbGF5IjsKICAgICAgY29uc3QgbGMgPSB0Lmxvb3BDb3VudCA/ICIg4oCiIMOXIiArIHQubG9vcENvdW50IDogIiI7CiAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gYGxvb3AgKCR7dC5iYXJzfSBiYXJzKWAgKyBsYzsKICAgIH0gZWxzZSB7CiAgICAgIHRhZy50ZXh0Q29udGVudCA9ICJTVE9QIjsgdGFnLmNsYXNzTmFtZSA9ICJ0YWciOwogICAgICBkb3QuY2xhc3NOYW1lICAgPSAiZG90IjsKICAgICAgbGFiZWwudGV4dENvbnRlbnQgPSB0LmJ1ZmZlcgogICAgICAgID8gYHByb250byDigKIgJHt0LmJhcnN9IGJhcnMg4oCiICR7TWF0aC5yb3VuZCh0LmJ1ZmZlci5kdXJhdGlvbiAqIDEwMDApfW1zYAogICAgICAgIDogYHZ1b3RvIOKAoiAke3QuYmFyc30gYmFyc2A7CiAgICB9CgogICAgLy8gQmlnIGJ1dHRvbiBTVkcKICAgIGNvbnN0IHN2ZyAgPSB0LnVpLmJ0bk1haW4ucXVlcnlTZWxlY3Rvcigic3ZnIik7CiAgICBjb25zdCBwYXRoID0gc3ZnLnF1ZXJ5U2VsZWN0b3IoInBhdGgiKTsKICAgIGlmICh0LmlzQ291bnRpbmdJbiB8fCB0LmlzQXJtZWRSZWNvcmQpewogICAgICBwYXRoLnNldEF0dHJpYnV0ZSgiZCIsIk0xNiAxMGE2IDYgMCAxIDAgMCAxMmE2IDYgMCAwIDAgMC0xMloiKTsKICAgICAgc3ZnLnN0eWxlLnN0cm9rZSA9ICJyZ2JhKDI1NSwyMTgsNjgsLjk1KSI7CiAgICB9IGVsc2UgaWYgKHQuaXNSZWNvcmRpbmcpewogICAgICBwYXRoLnNldEF0dHJpYnV0ZSgiZCIsIk05IDloMTR2MTRIOXoiKTsKICAgICAgc3ZnLnN0eWxlLnN0cm9rZSA9ICJyZ2JhKDI1NSw1Myw1MywuOTUpIjsKICAgIH0gZWxzZSBpZiAoIXQuYnVmZmVyKXsKICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoImQiLCJNMTYgMTBhNiA2IDAgMSAwIDAgMTJhNiA2IDAgMCAwIDAtMTJaIik7CiAgICAgIHN2Zy5zdHlsZS5zdHJva2UgPSAicmdiYSgyNTUsNTMsNTMsLjk1KSI7CiAgICB9IGVsc2UgaWYgKHQuaXNQbGF5aW5nKXsKICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoImQiLCJNOSA5aDE0djE0SDl6Iik7CiAgICAgIHN2Zy5zdHlsZS5zdHJva2UgPSAicmdiYSg2MSwyMTgsMjU1LC45NSkiOwogICAgfSBlbHNlIHsKICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoImQiLCJNMTIgMTBsMTIgNi0xMiA2VjEweiIpOwogICAgICBzdmcuc3R5bGUuc3Ryb2tlID0gInJnYmEoNjEsMjU1LDE3NiwuOTUpIjsKICAgIH0KCiAgICBjbGVhckJ0bi5kaXNhYmxlZCA9ICF0LmJ1ZmZlciAmJiAhdC5pc1JlY29yZGluZyAmJiAhdC5pc0NvdW50aW5nSW4gJiYgIXQuaXNBcm1lZFJlY29yZDsKICAgIHNhdmVCdG4uZGlzYWJsZWQgID0gIXQuYnVmZmVyOwoKICAgIGNvbnN0IHYgPSBwYXJzZUZsb2F0KHZvbC52YWx1ZSk7CiAgICB2b2xwY3QudGV4dENvbnRlbnQgPSBNYXRoLnJvdW5kKHYgKiAxMDApICsgIiUiOwogIH0KCiAgLy8gLS0tLSBMb25nIHByZXNzIC0tLS0KICBmdW5jdGlvbiBhdHRhY2hMb25nUHJlc3ModCwgYnRuKXsKICAgIGNvbnN0IHN0YXJ0ID0gKGV2KSA9PiB7CiAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHQubG9uZ1ByZXNzRmlyZWQgPSBmYWxzZTsKICAgICAgdC5sb25nUHJlc3NUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHQubG9uZ1ByZXNzRmlyZWQgPSB0cnVlOwogICAgICAgIGNsZWFyVHJhY2sodCwgdHJ1ZSk7CiAgICAgIH0sIDI1MDApOwogICAgfTsKICAgIGNvbnN0IGVuZCA9ICgpID0+IHsgaWYgKHQubG9uZ1ByZXNzVGltZXIpIGNsZWFyVGltZW91dCh0LmxvbmdQcmVzc1RpbWVyKTsgdC5sb25nUHJlc3NUaW1lciA9IG51bGw7IH07CiAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBzdGFydCwgeyBwYXNzaXZlOmZhbHNlIH0pOwogICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsICAgZW5kKTsKICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyY2FuY2VsIiwgZW5kKTsKICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybGVhdmUiLCBlbmQpOwogICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKGV2KSA9PiB7CiAgICAgIGlmICh0LmxvbmdQcmVzc0ZpcmVkKXsgZXYucHJldmVudERlZmF1bHQoKTsgZXYuc3RvcFByb3BhZ2F0aW9uKCk7IHQubG9uZ1ByZXNzRmlyZWQgPSBmYWxzZTsgcmV0dXJuOyB9CiAgICAgIG9uTWFpblRhcCh0KTsKICAgIH0pOwogICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCAoZXYpID0+IHsKICAgICAgaWYgKGV2LmtleSA9PT0gIkVudGVyIiB8fCBldi5rZXkgPT09ICIgIil7IGV2LnByZXZlbnREZWZhdWx0KCk7IG9uTWFpblRhcCh0KTsgfQogICAgfSk7CiAgfQoKICAvLyAtLS0tIEJ1aWxkIFRyYWNrIENhcmQgLS0tLQogIGZ1bmN0aW9uIGJ1aWxkVHJhY2tDYXJkKHQpewogICAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWN0aW9uIik7CiAgICBlbC5jbGFzc05hbWUgPSAidHJhY2siOwogICAgZWwuaW5uZXJIVE1MID0gYAogICAgICA8ZGl2IGNsYXNzPSJjb3VudC1iYWRnZSIgaWQ9ImNvdW50QmFkZ2UiPjwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJ0cmFjay1oZWFkIj4KICAgICAgICA8ZGl2IGNsYXNzPSJ0cmFjay1udW0iPiR7dC5pbmRleCArIDF9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0idHJhY2stc3RhdHVzIj4KICAgICAgICAgIDxkaXYgY2xhc3M9Im1pbmkiIHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo2cHg7Ij4KICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRvdCIgaWQ9ImRvdCI+PC9zcGFuPgogICAgICAgICAgICA8c3BhbiBjbGFzcz0idGFnIiBpZD0idGFnIj5TVE9QPC9zcGFuPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJ0cmFjay1sYWJlbCIgaWQ9ImxhYmVsIj52dW90bzwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxjYW52YXMgY2xhc3M9IndhdmVjYW52YXMiIGlkPSJ3YXZlQ2FudmFzIiBoZWlnaHQ9IjMyIj48L2NhbnZhcz4KCiAgICAgIDxkaXYgY2xhc3M9InRyYWNrLWJvZHkiPgogICAgICAgIDxkaXYgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyOyBwb3NpdGlvbjpyZWxhdGl2ZTsiPgogICAgICAgICAgPGRpdiBjbGFzcz0iYmlnLWJ0biIgaWQ9ImJ0bk1haW4iIHJvbGU9ImJ1dHRvbiIgdGFiaW5kZXg9IjAiIGFyaWEtbGFiZWw9IlJlY29yZC9QbGF5L1N0b3AiPgogICAgICAgICAgICA8IS0tIHByb2dyZXNzIHJpbmcgU1ZHIC0tPgogICAgICAgICAgICA8c3ZnIGlkPSJyZWNQcm9ncmVzc1N2ZyIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjphYnNvbHV0ZTtpbnNldDotN3B4O3dpZHRoOmNhbGMoMTAwJSsxNHB4KTtoZWlnaHQ6Y2FsYygxMDAlKzE0cHgpO292ZXJmbG93OnZpc2libGU7IiB2aWV3Qm94PSItNyAtNyAxMjQgMTI0Ij4KICAgICAgICAgICAgICA8Y2lyY2xlIGN4PSI1NSIgY3k9IjU1IiByPSI0NyIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2JhKDI1NSw1Myw1MywuNykiIHN0cm9rZS13aWR0aD0iNSIKICAgICAgICAgICAgICAgIHN0cm9rZS1kYXNoYXJyYXk9IjI5NSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjI5NSIKICAgICAgICAgICAgICAgIHRyYW5zZm9ybT0icm90YXRlKC05MCA1NSA1NSkiCiAgICAgICAgICAgICAgICBzdHlsZT0idHJhbnNpdGlvbjpzdHJva2UtZGFzaG9mZnNldCAuMXMgbGluZWFyOyIvPgogICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icmluZyI+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJpbmcyIj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iaWNvbiI+CiAgICAgICAgICAgICAgPHN2ZyB2aWV3Qm94PSIwIDAgMzIgMzIiIHN0cm9rZT0icmdiYSgyNTUsNTMsNTMsLjk1KSI+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTYgMTBhNiA2IDAgMSAwIDAgMTJhNiA2IDAgMCAwIDAtMTJaIj48L3BhdGg+CiAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGlkPSJwcmVjb3VudExlZHMiIHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjVweDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2ZsZXgtd3JhcDp3cmFwO21hcmdpbi10b3A6NnB4O21pbi1oZWlnaHQ6MTZweDsiPjwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJmYWRlciI+CiAgICAgICAgICA8bGFiZWw+Vk9MPC9sYWJlbD4KICAgICAgICAgIDxpbnB1dCBjbGFzcz0idm9sIiBpZD0idm9sIiB0eXBlPSJyYW5nZSIgbWluPSIwIiBtYXg9IjEuMyIgc3RlcD0iMC4wMSIgdmFsdWU9IjAuODUiIC8+CiAgICAgICAgICA8bGFiZWwgaWQ9InZvbHBjdCI+ODUlPC9sYWJlbD4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJ0cmFjay1zZXR0aW5ncyI+CiAgICAgICAgPGRpdiBjbGFzcz0idHMtcGlsbCI+CiAgICAgICAgICA8c3Bhbj5SRUM8L3NwYW4+CiAgICAgICAgICA8c2VsZWN0IGlkPSJiYXJzU2VsIj4KICAgICAgICAgICAgPG9wdGlvbj4xPC9vcHRpb24+PG9wdGlvbj4yPC9vcHRpb24+PG9wdGlvbj40PC9vcHRpb24+CiAgICAgICAgICAgIDxvcHRpb24gc2VsZWN0ZWQ+ODwvb3B0aW9uPjxvcHRpb24+MTY8L29wdGlvbj48b3B0aW9uPjMyPC9vcHRpb24+CiAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgIDxzcGFuPmJhcnM8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0idHMtcGlsbCI+CiAgICAgICAgICA8c3Bhbj5DT1VOVDwvc3Bhbj4KICAgICAgICAgIDxzZWxlY3QgaWQ9ImNvdW50U2VsIj4KICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iMCI+MDwvb3B0aW9uPgogICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIxIj4xPC9vcHRpb24+CiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjIiPjI8L29wdGlvbj4KICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iNCIgc2VsZWN0ZWQ+NDwvb3B0aW9uPgogICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSI4Ij44PC9vcHRpb24+CiAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgIDxzcGFuPnByZTwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJ0cy1waWxsIj4KICAgICAgICAgIDxzcGFuPkZJPC9zcGFuPgogICAgICAgICAgPGlucHV0IGlkPSJmYWRlSW5NcyIgdHlwZT0ibnVtYmVyIiBtaW49IjAiIG1heD0iNTAwIiBzdGVwPSIxIiB2YWx1ZT0iOCIvPgogICAgICAgICAgPHNwYW4+bXM8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0idHMtcGlsbCI+CiAgICAgICAgICA8c3Bhbj5GTzwvc3Bhbj4KICAgICAgICAgIDxpbnB1dCBpZD0iZmFkZU91dE1zIiB0eXBlPSJudW1iZXIiIG1pbj0iMCIgbWF4PSI1MDAiIHN0ZXA9IjEiIHZhbHVlPSI4Ii8+CiAgICAgICAgICA8c3Bhbj5tczwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJ0cmFjay1hY3Rpb25zIj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJzYXZlQnRuIiBkaXNhYmxlZD5TYXZlIFdBVjwvYnV0dG9uPgogICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgaWQ9Im11dGVCdG4iPk11dGU8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXJlZCIgaWQ9ImNsZWFyQnRuIiBkaXNhYmxlZD5DbGVhcjwvYnV0dG9uPgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9InVuZG8tYmFyIiBpZD0idW5kb0JhciI+CiAgICAgICAgVHJhY2NpYSBjYW5jZWxsYXRhCiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLXVuZG8iIGlkPSJ1bmRvQnRuIj5Bbm51bGxhICg1cyk8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICBgOwoKICAgIGNvbnN0IGJ0bk1haW4gICAgICAgID0gZWwucXVlcnlTZWxlY3RvcigiI2J0bk1haW4iKTsKICAgIGNvbnN0IHRhZyAgICAgICAgICAgID0gZWwucXVlcnlTZWxlY3RvcigiI3RhZyIpOwogICAgY29uc3QgbGFiZWwgICAgICAgICAgPSBlbC5xdWVyeVNlbGVjdG9yKCIjbGFiZWwiKTsKICAgIGNvbnN0IGRvdCAgICAgICAgICAgID0gZWwucXVlcnlTZWxlY3RvcigiI2RvdCIpOwogICAgY29uc3Qgdm9sICAgICAgICAgICAgPSBlbC5xdWVyeVNlbGVjdG9yKCIjdm9sIik7CiAgICBjb25zdCB2b2xwY3QgICAgICAgICA9IGVsLnF1ZXJ5U2VsZWN0b3IoIiN2b2xwY3QiKTsKICAgIGNvbnN0IHNhdmVCdG4gICAgICAgID0gZWwucXVlcnlTZWxlY3RvcigiI3NhdmVCdG4iKTsKICAgIGNvbnN0IG11dGVCdG4gICAgICAgID0gZWwucXVlcnlTZWxlY3RvcigiI211dGVCdG4iKTsKICAgIGNvbnN0IGNsZWFyQnRuICAgICAgID0gZWwucXVlcnlTZWxlY3RvcigiI2NsZWFyQnRuIik7CiAgICBjb25zdCBiYXJzU2VsICAgICAgICA9IGVsLnF1ZXJ5U2VsZWN0b3IoIiNiYXJzU2VsIik7CiAgICBjb25zdCBjb3VudFNlbCAgICAgICA9IGVsLnF1ZXJ5U2VsZWN0b3IoIiNjb3VudFNlbCIpOwogICAgY29uc3QgZmFkZUluTXNFbCAgICAgPSBlbC5xdWVyeVNlbGVjdG9yKCIjZmFkZUluTXMiKTsKICAgIGNvbnN0IGZhZGVPdXRNc0VsICAgID0gZWwucXVlcnlTZWxlY3RvcigiI2ZhZGVPdXRNcyIpOwogICAgY29uc3QgY291bnRCYWRnZSAgICAgPSBlbC5xdWVyeVNlbGVjdG9yKCIjY291bnRCYWRnZSIpOwogICAgY29uc3Qgd2F2ZUNhbnZhcyAgICAgPSBlbC5xdWVyeVNlbGVjdG9yKCIjd2F2ZUNhbnZhcyIpOwogICAgY29uc3QgcmVjUHJvZ3Jlc3NTdmcgPSBlbC5xdWVyeVNlbGVjdG9yKCIjcmVjUHJvZ3Jlc3NTdmciKTsKICAgIGNvbnN0IHByZWNvdW50TGVkcyAgID0gZWwucXVlcnlTZWxlY3RvcigiI3ByZWNvdW50TGVkcyIpOwogICAgY29uc3QgdW5kb0JhciAgICAgICAgPSBlbC5xdWVyeVNlbGVjdG9yKCIjdW5kb0JhciIpOwogICAgY29uc3QgdW5kb0J0biAgICAgICAgPSBlbC5xdWVyeVNlbGVjdG9yKCIjdW5kb0J0biIpOwoKICAgIHQudWkgPSB7IGVsLCBidG5NYWluLCB0YWcsIGxhYmVsLCBkb3QsIHZvbCwgdm9scGN0LCBzYXZlQnRuLCBtdXRlQnRuLCBjbGVhckJ0biwKICAgICAgICAgICAgIGJhcnNTZWwsIGNvdW50U2VsLCBmYWRlSW5Nc0VsLCBmYWRlT3V0TXNFbCwgY291bnRCYWRnZSwKICAgICAgICAgICAgIHdhdmVDYW52YXMsIHJlY1Byb2dyZXNzU3ZnLCBwcmVjb3VudExlZHMsIHVuZG9CYXIgfTsKCiAgICAvLyBFdmVudHMKICAgIGJhcnNTZWwudmFsdWUgPSBTdHJpbmcodC5iYXJzKTsKICAgIGJhcnNTZWwuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCkgPT4geyB0LmJhcnMgPSBwYXJzZUludChiYXJzU2VsLnZhbHVlLCAxMCk7IHVwZGF0ZVRyYWNrVUkodCk7IHVwZGF0ZUdsb2JhbEJ1dHRvbnMoKTsgfSk7CgogICAgY291bnRTZWwudmFsdWUgPSBTdHJpbmcodC5jb3VudEluQmFycyk7CiAgICBjb3VudFNlbC5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCAoKSA9PiB7IHQuY291bnRJbkJhcnMgPSBwYXJzZUludChjb3VudFNlbC52YWx1ZSwgMTApOyB1cGRhdGVUcmFja1VJKHQpOyB9KTsKCiAgICBmYWRlSW5Nc0VsLnZhbHVlID0gU3RyaW5nKHQuZmFkZUluTXMpOwogICAgZmFkZUluTXNFbC5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCAoKSA9PiB7CiAgICAgIHQuZmFkZUluTXMgPSBNYXRoLm1heCgwLCBwYXJzZUludChmYWRlSW5Nc0VsLnZhbHVlIHx8ICIwIiwgMTApKTsKICAgICAgaWYgKHQucmF3QnVmZmVyKXsgdC5idWZmZXIgPSBhcHBseUZhZGVzKHQucmF3QnVmZmVyLCBNYXRoLm1heCgzLHQuZmFkZUluTXMpLCBNYXRoLm1heCgzLHQuZmFkZU91dE1zKSk7IH0KICAgICAgdXBkYXRlVHJhY2tVSSh0KTsKICAgIH0pOwoKICAgIGZhZGVPdXRNc0VsLnZhbHVlID0gU3RyaW5nKHQuZmFkZU91dE1zKTsKICAgIGZhZGVPdXRNc0VsLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsICgpID0+IHsKICAgICAgdC5mYWRlT3V0TXMgPSBNYXRoLm1heCgwLCBwYXJzZUludChmYWRlT3V0TXNFbC52YWx1ZSB8fCAiMCIsIDEwKSk7CiAgICAgIGlmICh0LnJhd0J1ZmZlcil7IHQuYnVmZmVyID0gYXBwbHlGYWRlcyh0LnJhd0J1ZmZlciwgTWF0aC5tYXgoMyx0LmZhZGVJbk1zKSwgTWF0aC5tYXgoMyx0LmZhZGVPdXRNcykpOyBpZiAodC5pc1BsYXlpbmcpIHN0YXJ0UGxheWJhY2sodCk7IH0KICAgICAgdXBkYXRlVHJhY2tVSSh0KTsKICAgIH0pOwoKICAgIHZvbC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsICgpID0+IHsKICAgICAgY29uc3QgdiA9IHBhcnNlRmxvYXQodm9sLnZhbHVlKTsKICAgICAgaWYgKHQuZ2Fpbk5vZGUpIHQuZ2Fpbk5vZGUuZ2Fpbi5zZXRUYXJnZXRBdFRpbWUodiwgYXVkaW9DdHguY3VycmVudFRpbWUsIDAuMDEpOwogICAgICB1cGRhdGVUcmFja1VJKHQpOwogICAgfSk7CgogICAgbXV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgaWYgKCF0LmdhaW5Ob2RlKSByZXR1cm47CiAgICAgIGNvbnN0IGN1ciA9IHQuZ2Fpbk5vZGUuZ2Fpbi52YWx1ZTsKICAgICAgaWYgKGN1ciA+IDAuMDAxKXsKICAgICAgICB0Ll9wcmV2Vm9sID0gcGFyc2VGbG9hdCh2b2wudmFsdWUpOwogICAgICAgIHQuZ2Fpbk5vZGUuZ2Fpbi5zZXRUYXJnZXRBdFRpbWUoMCwgYXVkaW9DdHguY3VycmVudFRpbWUsIDAuMDEpOwogICAgICAgIHZvbC52YWx1ZSA9ICIwIjsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBwdiA9IHQuX3ByZXZWb2wgfHwgMC44NTsKICAgICAgICB0LmdhaW5Ob2RlLmdhaW4uc2V0VGFyZ2V0QXRUaW1lKHB2LCBhdWRpb0N0eC5jdXJyZW50VGltZSwgMC4wMSk7CiAgICAgICAgdm9sLnZhbHVlID0gU3RyaW5nKHB2KTsKICAgICAgfQogICAgICB2b2wuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImlucHV0IikpOwogICAgfSk7CgogICAgY2xlYXJCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiBjbGVhclRyYWNrKHQsIGZhbHNlKSk7CiAgICB1bmRvQnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgICgpID0+IHVuZG9DbGVhcih0KSk7CgogICAgc2F2ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgaWYgKCF0LmJ1ZmZlcikgcmV0dXJuOwogICAgICBjb25zdCB3YXYgPSBhdWRpb0J1ZmZlclRvV2F2QmxvYih0LmJ1ZmZlcik7CiAgICAgIGRvd25sb2FkQmxvYih3YXYsIHRyYWNrV2F2TmFtZSh0KSk7CiAgICB9KTsKCiAgICBhdHRhY2hMb25nUHJlc3ModCwgYnRuTWFpbik7CiAgICB1cGRhdGVUcmFja1VJKHQpOwogICAgcmV0dXJuIGVsOwogIH0KCiAgLy8gLS0tLSBXQVYgRXhwb3J0IC0tLS0KICBmdW5jdGlvbiBhdWRpb0J1ZmZlclRvV2F2QmxvYihidWZmZXIpewogICAgY29uc3QgbnVtQ2ggPSBidWZmZXIubnVtYmVyT2ZDaGFubmVscywgc3IgPSBidWZmZXIuc2FtcGxlUmF0ZSwgbiA9IGJ1ZmZlci5sZW5ndGg7CiAgICBjb25zdCBpbnRlcmxlYXZlZCA9IG5ldyBGbG9hdDMyQXJyYXkobiAqIG51bUNoKTsKICAgIGZvciAobGV0IGNoID0gMDsgY2ggPCBudW1DaDsgY2grKyl7CiAgICAgIGNvbnN0IGQgPSBidWZmZXIuZ2V0Q2hhbm5lbERhdGEoY2gpOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG47IGkrKykgaW50ZXJsZWF2ZWRbaSAqIG51bUNoICsgY2hdID0gZFtpXTsKICAgIH0KICAgIGNvbnN0IGJwcyA9IDIsIGJhID0gbnVtQ2ggKiBicHMsIGJyID0gc3IgKiBiYSwgZGF0YVNpemUgPSBpbnRlcmxlYXZlZC5sZW5ndGggKiBicHM7CiAgICBjb25zdCBhYiA9IG5ldyBBcnJheUJ1ZmZlcig0NCArIGRhdGFTaXplKTsKICAgIGNvbnN0IHYgID0gbmV3IERhdGFWaWV3KGFiKTsKICAgIGNvbnN0IHdzID0gKG8sIHMpID0+IHsgZm9yIChsZXQgaT0wO2k8cy5sZW5ndGg7aSsrKSB2LnNldFVpbnQ4KG8raSwgcy5jaGFyQ29kZUF0KGkpKTsgfTsKICAgIHdzKDAsIlJJRkYiKTsgdi5zZXRVaW50MzIoNCwgMzYrZGF0YVNpemUsIHRydWUpOyB3cyg4LCJXQVZFIik7CiAgICB3cygxMiwiZm10ICIpOyB2LnNldFVpbnQzMigxNiwxNix0cnVlKTsgdi5zZXRVaW50MTYoMjAsMSx0cnVlKTsgdi5zZXRVaW50MTYoMjIsbnVtQ2gsdHJ1ZSk7CiAgICB2LnNldFVpbnQzMigyNCxzcix0cnVlKTsgdi5zZXRVaW50MzIoMjgsYnIsdHJ1ZSk7IHYuc2V0VWludDE2KDMyLGJhLHRydWUpOyB2LnNldFVpbnQxNigzNCwxNix0cnVlKTsKICAgIHdzKDM2LCJkYXRhIik7IHYuc2V0VWludDMyKDQwLGRhdGFTaXplLHRydWUpOwogICAgbGV0IG9mZiA9IDQ0OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnRlcmxlYXZlZC5sZW5ndGg7IGkrKyl7CiAgICAgIGxldCBzID0gTWF0aC5tYXgoLTEsIE1hdGgubWluKDEsIGludGVybGVhdmVkW2ldKSk7CiAgICAgIHYuc2V0SW50MTYob2ZmLCBzIDwgMCA/IE1hdGgucm91bmQocyozMjc2OCkgOiBNYXRoLnJvdW5kKHMqMzI3NjcpLCB0cnVlKTsKICAgICAgb2ZmICs9IDI7CiAgICB9CiAgICByZXR1cm4gbmV3IEJsb2IoW2FiXSwgeyB0eXBlOiJhdWRpby93YXYiIH0pOwogIH0KCiAgZnVuY3Rpb24gZG93bmxvYWRCbG9iKGJsb2IsIG5hbWUpewogICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7IGEuaHJlZiA9IHVybDsgYS5kb3dubG9hZCA9IG5hbWU7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpOyBhLmNsaWNrKCk7IGEucmVtb3ZlKCk7CiAgICBzZXRUaW1lb3V0KCgpID0+IFVSTC5yZXZva2VPYmplY3RVUkwodXJsKSwgMjAwMCk7CiAgfQoKICBmdW5jdGlvbiB0cmFja1dhdk5hbWUodCl7CiAgICByZXR1cm4gYHRyYWNrXyR7dC5pbmRleCsxfV8ke3QuYmFyc31iYXJzXyR7Z2V0TnVtZXJhdG9yKCl9LTRfJHtnZXRCcG0oKX1icG0ud2F2YDsKICB9CgogIC8vIC0tLS0gQ2FsaWJyYXRpb24gLS0tLQogIGZ1bmN0aW9uIGRldGVjdENsaWNrU2VjKGJ1Zil7CiAgICBjb25zdCBkID0gYnVmLmdldENoYW5uZWxEYXRhKDApOwogICAgbGV0IG1heCA9IDA7CiAgICBmb3IgKGxldCBpPTA7aTxkLmxlbmd0aDtpKyspIHsgY29uc3QgYT1NYXRoLmFicyhkW2ldKTsgaWYoYT5tYXgpIG1heD1hOyB9CiAgICBpZiAobWF4IDwgMC4wMikgcmV0dXJuIG51bGw7CiAgICBjb25zdCB0aHIgPSBtYXggKiAwLjM7CiAgICBmb3IgKGxldCBpPTA7aTxkLmxlbmd0aDtpKyspIGlmIChNYXRoLmFicyhkW2ldKT49dGhyKSByZXR1cm4gaS9idWYuc2FtcGxlUmF0ZTsKICAgIHJldHVybiBudWxsOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gcnVuQ2FsaWJyYXRpb24oKXsKICAgIGlmICghYXVkaW9DdHggfHwgIWlucHV0U3RyZWFtKSByZXR1cm47CiAgICBidG5DYWxpYnJhdGUuZGlzYWJsZWQgPSB0cnVlOwogICAgc2V0Q2FsaWJTdGF0dXMoImFybeKApiIpOwoKICAgIGF3YWl0IGF1ZGlvQ3R4LnJlc3VtZSgpOwogICAgY29uc3Qgbm93ID0gYXVkaW9DdHguY3VycmVudFRpbWU7CiAgICBjb25zdCBjbGlja0F0ID0gc3luY09uKCkgJiYgZ3JpZFN0YXJ0ZWQKICAgICAgPyBuZXh0QmFyVGltZShub3cgKyAwLjIwKQogICAgICA6IChub3cgKyAwLjIwKTsKCiAgICBjb25zdCBsZWFkICAgID0gZ2V0TGVhZFNlYygpOwogICAgY29uc3QgcmVjU3RhcnRBdCAgPSBNYXRoLm1heChub3cgKyAwLjAyLCBjbGlja0F0IC0gbGVhZCk7CiAgICBjb25zdCBlZmZlY3RMZWFkICA9IE1hdGgubWF4KDAsIGNsaWNrQXQgLSByZWNTdGFydEF0KTsKICAgIGNvbnN0IHJlY0xlbiAgPSAyICogYmFyU2VjKCkgKyBnZXRFeHRyYUJlYXRzKCkgKiBiZWF0U2VjKCk7CiAgICBjb25zdCBzdG9wQXQgID0gY2xpY2tBdCArIHJlY0xlbjsKCiAgICAvLyBTY2hlZHVsZSBjbGljawogICAgY29uc3Qgb3NjID0gYXVkaW9DdHguY3JlYXRlT3NjaWxsYXRvcigpOwogICAgb3NjLnR5cGUgPSAic3F1YXJlIjsgb3NjLmZyZXF1ZW5jeS52YWx1ZSA9IDEyMDA7CiAgICBjb25zdCBnID0gYXVkaW9DdHguY3JlYXRlR2FpbigpOyBnLmdhaW4udmFsdWUgPSAwLjAwMDE7CiAgICBvc2MuY29ubmVjdChnKTsgZy5jb25uZWN0KGF1ZGlvQ3R4LmRlc3RpbmF0aW9uKTsKICAgIGcuZ2Fpbi5zZXRWYWx1ZUF0VGltZSgwLjAwMDEsIGNsaWNrQXQpOwogICAgZy5nYWluLmV4cG9uZW50aWFsUmFtcFRvVmFsdWVBdFRpbWUoMC4xNSwgY2xpY2tBdCswLjAwMyk7CiAgICBnLmdhaW4uZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZSgwLjAwMDEsIGNsaWNrQXQrMC4wMTUpOwogICAgb3NjLnN0YXJ0KGNsaWNrQXQpOyBvc2Muc3RvcChjbGlja0F0KzAuMDIpOwogICAgb3NjLm9uZW5kZWQgPSAoKSA9PiB7IHRyeXtvc2MuZGlzY29ubmVjdCgpO2cuZGlzY29ubmVjdCgpO31jYXRjaHt9IH07CgogICAgY29uc3QgbWltZSA9IHBpY2tCZXN0TWltZVR5cGUoKTsKICAgIGxldCByZWM7CiAgICB0cnl7IHJlYyA9IG5ldyBNZWRpYVJlY29yZGVyKGlucHV0U3RyZWFtLCBtaW1lID8ge21pbWVUeXBlOm1pbWV9IDogdW5kZWZpbmVkKTsgfQogICAgY2F0Y2h7IHJlYyA9IG5ldyBNZWRpYVJlY29yZGVyKGlucHV0U3RyZWFtKTsgfQoKICAgIGNvbnN0IGNodW5rcyA9IFtdOwogICAgcmVjLm9uZGF0YWF2YWlsYWJsZSA9IGV2ID0+IHsgaWYoZXYuZGF0YSYmZXYuZGF0YS5zaXplKSBjaHVua3MucHVzaChldi5kYXRhKTsgfTsKCiAgICBjb25zdCByZWNTdGFydERlbGF5ID0gTWF0aC5tYXgoMCwgKHJlY1N0YXJ0QXQgLSBhdWRpb0N0eC5jdXJyZW50VGltZSkgKiAxMDAwKTsKICAgIGNvbnN0IHJlY1N0b3BEZWxheSAgPSBNYXRoLm1heCgwLCAoc3RvcEF0ICAgIC0gYXVkaW9DdHguY3VycmVudFRpbWUpICogMTAwMCk7CgogICAgc2V0Q2FsaWJTdGF0dXMoYHN0YXJ0IGluICR7KHJlY1N0YXJ0RGVsYXkvMTAwMCkudG9GaXhlZCgyKX1zYCk7CgogICAgY29uc3QgdDEgPSBzZXRUaW1lb3V0KCgpID0+IHsgdHJ5eyByZWMuc3RhcnQoMTAwKTsgc2V0Q2FsaWJTdGF0dXMoInJlZ2lzdHJhbmRv4oCmIik7IH1jYXRjaChlKXsgY29uc29sZS5lcnJvcihlKTsgfSB9LCByZWNTdGFydERlbGF5KTsKICAgIGNvbnN0IHQyID0gc2V0VGltZW91dCgoKSA9PiB7IHRyeXsgcmVjLnN0b3AoKTsgfWNhdGNoe30gfSwgcmVjU3RvcERlbGF5KTsKCiAgICByZWMub25zdG9wID0gYXN5bmMgKCkgPT4gewogICAgICBjbGVhclRpbWVvdXQodDEpOyBjbGVhclRpbWVvdXQodDIpOwogICAgICB0cnl7CiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKGNodW5rcywgeyB0eXBlOiByZWMubWltZVR5cGV8fCJhdWRpby93ZWJtIiB9KTsKICAgICAgICBpZiAoYmxvYi5zaXplIDwgMjAwMCl7IHNldENhbGliU3RhdHVzKCJhdWRpbyB0cm9wcG8gcGljY29sbyIpOyByZXR1cm47IH0KICAgICAgICBjb25zdCBkZWNvZGVkID0gYXdhaXQgYmxvYlRvQXVkaW9CdWZmZXIoYmxvYik7CiAgICAgICAgY29uc3QgbW9ubyAgICA9IG1peFRvTW9ubyhkZWNvZGVkKTsKICAgICAgICBjb25zdCB0cmltbWVkID0gc2xpY2VCdWZmZXIobW9ubywgZWZmZWN0TGVhZCwgTWF0aC5taW4obW9uby5kdXJhdGlvbiwgMypiYXJTZWMoKSkpOwogICAgICAgIGNvbnN0IGNsaWNrVCAgPSBkZXRlY3RDbGlja1NlYyh0cmltbWVkKTsKICAgICAgICBpZiAoY2xpY2tUID09IG51bGwpeyBzZXRDYWxpYlN0YXR1cygiY2xpY2sgbm9uIHJpbGV2YXRvIik7IHJldHVybjsgfQogICAgICAgIGNvbnN0IGVyck1zID0gY2xpY2tUICogMTAwMDsKICAgICAgICBjb25zdCBjdXIgICA9IE1hdGgubWF4KDAsIHBhcnNlRmxvYXQobGVhZE1zRWwudmFsdWV8fCIwIikpOwogICAgICAgIGNvbnN0IG5ld01zID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMzAwMCwgTWF0aC5yb3VuZChjdXIgKyBlcnJNcykpKTsKICAgICAgICBsZWFkTXNFbC52YWx1ZSA9IFN0cmluZyhuZXdNcyk7CiAgICAgICAgc2V0Q2FsaWJTdGF0dXMoYOKckyArJHtNYXRoLnJvdW5kKGVyck1zKX1tcyDihpIgbGVhZCAke25ld01zfW1zYCk7CiAgICAgIH0gY2F0Y2goZSl7IGNvbnNvbGUuZXJyb3IoZSk7IHNldENhbGliU3RhdHVzKCJlcnJvcmUgY2FsaWJyYXppb25lIik7IH0KICAgICAgZmluYWxseXsgYnRuQ2FsaWJyYXRlLmRpc2FibGVkID0gZmFsc2U7IH0KICAgIH07CiAgfQoKICAvLyAtLS0tIEluaXQgQXVkaW8gLS0tLQogIGFzeW5jIGZ1bmN0aW9uIGluaXRBdWRpbygpewogICAgaWYgKGF1ZGlvQ3R4KSByZXR1cm47CiAgICBhdWRpb0N0eCA9IG5ldyAod2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KSgpOwogICAgYXdhaXQgYXVkaW9DdHgucmVzdW1lKCk7CgogICAgc3JFbC50ZXh0Q29udGVudCAgICAgPSBhdWRpb0N0eC5zYW1wbGVSYXRlICsgIiBIeiI7CiAgICBmb290ZXJTci50ZXh0Q29udGVudCA9IGF1ZGlvQ3R4LnNhbXBsZVJhdGUgKyAiIEh6IjsKCiAgICBtYXN0ZXJHYWluID0gYXVkaW9DdHguY3JlYXRlR2FpbigpOwogICAgbWFzdGVyR2Fpbi5nYWluLnZhbHVlID0gMC45MjsKICAgIG1hc3RlckdhaW4uY29ubmVjdChhdWRpb0N0eC5kZXN0aW5hdGlvbik7CgogICAgaW5wdXRTdHJlYW0gPSBhd2FpdCBnZXRJbnB1dFN0cmVhbSgpOwoKICAgIGZvciAoY29uc3QgdCBvZiB0cmFja3MpewogICAgICB0LmdhaW5Ob2RlID0gYXVkaW9DdHguY3JlYXRlR2FpbigpOwogICAgICB0LmdhaW5Ob2RlLmdhaW4udmFsdWUgPSBwYXJzZUZsb2F0KHQudWkudm9sLnZhbHVlKTsKICAgICAgdC5nYWluTm9kZS5jb25uZWN0KG1hc3RlckdhaW4pOwogICAgfQoKICAgIHNldERvdHMoKTsKICAgIGJ0bkluaXQudGV4dENvbnRlbnQgPSAiQXVkaW8gYXR0aXZvIOKckyI7CiAgICBidG5Jbml0LmRpc2FibGVkID0gdHJ1ZTsKICAgIGJ0bkNhbGlicmF0ZS5kaXNhYmxlZCA9IGZhbHNlOwogICAgc2V0Q2FsaWJTdGF0dXMoInByb250byIpOwogICAgdXBkYXRlR2xvYmFsQnV0dG9ucygpOwogIH0KCiAgLy8gLS0tLSBCdWlsZCBVSSAtLS0tCiAgZnVuY3Rpb24gYnVpbGRVSSgpewogICAgZ3JpZEVsLmlubmVySFRNTCA9ICIiOwogICAgdHJhY2tzLmxlbmd0aCA9IDA7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IFRSQUNLUzsgaSsrKXsKICAgICAgY29uc3QgdCA9IGNyZWF0ZVRyYWNrKGkpOwogICAgICB0cmFja3MucHVzaCh0KTsKICAgICAgZ3JpZEVsLmFwcGVuZENoaWxkKGJ1aWxkVHJhY2tDYXJkKHQpKTsKICAgIH0KICAgIHVwZGF0ZUdsb2JhbEJ1dHRvbnMoKTsKICB9CgogIC8vIC0tLS0gR2xvYmFsIGV2ZW50IGxpc3RlbmVycyAtLS0tCiAgYnRuSW5pdC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGFzeW5jICgpID0+IHsKICAgIHRyeXsgYXdhaXQgaW5pdEF1ZGlvKCk7IH0KICAgIGNhdGNoKGUpeyBjb25zb2xlLmVycm9yKGUpOyBhbGVydCgiSW1wb3NzaWJpbGUgYXR0aXZhcmUgYXVkaW86ICIrKGU/Lm1lc3NhZ2V8fGUpKTsgc3RvcEFsbElucHV0KCk7IH0KICAgIGZpbmFsbHl7IHNldERvdHMoKTsgdXBkYXRlR2xvYmFsQnV0dG9ucygpOyB9CiAgfSk7CgogIGJ0blBsYXlBbGwuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICBjb25zdCBzdGFydEF0ID0gc3luY09uKCkgJiYgZ3JpZFN0YXJ0ZWQgPyBuZXh0QmFyVGltZShhdWRpb0N0eC5jdXJyZW50VGltZSArIDAuMDQpIDogbnVsbDsKICAgIGZvciAoY29uc3QgdCBvZiB0cmFja3MpIGlmICh0LmJ1ZmZlciAmJiAhdC5pc1BsYXlpbmcpIHN0YXJ0UGxheWJhY2sodCwgc3RhcnRBdCk7CiAgICB1cGRhdGVHbG9iYWxCdXR0b25zKCk7CiAgfSk7CgogIGJ0blN0b3BBbGwuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICBmb3IgKGNvbnN0IHQgb2YgdHJhY2tzKXsKICAgICAgY2FuY2VsQ291bnRkb3duKHQpOyBjYW5jZWxTY2hlZHVsZSh0KTsKICAgICAgaWYgKHQuaXNSZWNvcmRpbmcpIHN0b3BSZWNvcmRpbmcodCwgeyBhdXRvUGxheTpmYWxzZSB9KTsKICAgICAgaWYgKHQuaXNQbGF5aW5nKSAgIHN0b3BQbGF5YmFjayh0KTsKICAgICAgdC51aS5jb3VudEJhZGdlLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICB9CiAgICB1cGRhdGVHbG9iYWxCdXR0b25zKCk7CiAgfSk7CgogIGJ0bkNsZWFyQWxsLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgaWYgKCFjb25maXJtKCJDYW5jZWxsYXJlIHR1dHRlIGxlIHRyYWNjZT8iKSkgcmV0dXJuOwogICAgZm9yIChjb25zdCB0IG9mIHRyYWNrcykgY2xlYXJUcmFjayh0LCB0cnVlKTsKICAgIGdyaWRPcmlnaW5UaW1lID0gbnVsbDsgZ3JpZFN0YXJ0ZWQgPSBmYWxzZTsKICAgIHN0b3BNZXRyb25vbWUoKTsKICAgIHVwZGF0ZUdyaWRCYWRnZSgpOwogICAgdXBkYXRlR2xvYmFsQnV0dG9ucygpOwogIH0pOwoKICBidG5TYXZlQWxsLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgY29uc3QgbGlzdCA9IHRyYWNrcy5maWx0ZXIodCA9PiAhIXQuYnVmZmVyKTsKICAgIGlmICghbGlzdC5sZW5ndGgpIHJldHVybjsKICAgIGxldCBpID0gMDsKICAgIGNvbnN0IG5leHQgPSAoKSA9PiB7CiAgICAgIGlmIChpID49IGxpc3QubGVuZ3RoKSByZXR1cm47CiAgICAgIGNvbnN0IHQgPSBsaXN0W2krK107CiAgICAgIHRyeXsgZG93bmxvYWRCbG9iKGF1ZGlvQnVmZmVyVG9XYXZCbG9iKHQuYnVmZmVyKSwgdHJhY2tXYXZOYW1lKHQpKTsgfSBmaW5hbGx5eyBzZXRUaW1lb3V0KG5leHQsIDcwMCk7IH0KICAgIH07CiAgICBuZXh0KCk7CiAgfSk7CgogIGJ0bkNhbGlicmF0ZS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHJ1bkNhbGlicmF0aW9uKCkpOwoKICBidG5NZXRyby5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgIGlmICghYXVkaW9DdHgpeyBhbGVydCgiUHJpbWEgYXR0aXZhIGF1ZGlvLiIpOyByZXR1cm47IH0KICAgIGlmIChtZXRyb09uKSBzdG9wTWV0cm9ub21lKCk7CiAgICBlbHNlIHN0YXJ0TWV0cm9ub21lKCk7CiAgfSk7CgogIGZ1bmN0aW9uIG9uVGltaW5nQ2hhbmdlKCl7CiAgICB1cGRhdGVUaW1pbmdMYWJlbHMoKTsKICAgIGJ1aWxkQmVhdExlZHMoKTsKICAgIGZvciAoY29uc3QgdCBvZiB0cmFja3MpewogICAgICBjYW5jZWxDb3VudGRvd24odCk7IGNhbmNlbFNjaGVkdWxlKHQpOwogICAgICB0LnVpLmNvdW50QmFkZ2Uuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgdXBkYXRlVHJhY2tVSSh0KTsKICAgIH0KICAgIHVwZGF0ZUdsb2JhbEJ1dHRvbnMoKTsKICAgIGlmIChtZXRyb09uKXsgc3RvcE1ldHJvbm9tZSgpOyBzdGFydE1ldHJvbm9tZSgpOyB9CiAgfQoKICAvLyBTeW5jIEJQTSByYW5nZSDihpQgbnVtYmVyIGlucHV0CiAgYnBtUmFuZ2UuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCAoKSA9PiB7IGJwbU51bS52YWx1ZSA9IGJwbVJhbmdlLnZhbHVlOyBvblRpbWluZ0NoYW5nZSgpOyB9KTsKICBicG1OdW0uYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCAgICgpID0+IHsKICAgIGxldCB2ID0gTWF0aC5tYXgoNDAsIE1hdGgubWluKDI0MCwgcGFyc2VJbnQoYnBtTnVtLnZhbHVlfHwiOTAiLDEwKSkpOwogICAgYnBtUmFuZ2UudmFsdWUgPSBTdHJpbmcodik7CiAgICBvblRpbWluZ0NoYW5nZSgpOwogIH0pOwogIHRzaWcuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgb25UaW1pbmdDaGFuZ2UpOwoKICBzb3VyY2VTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCkgPT4gewogICAgaWYgKGF1ZGlvQ3R4KSBhbGVydCgiU29yZ2VudGUgY2FtYmlhdGEuIFJpY2FyaWNhIGxhIHBhZ2luYSBwZXIgYXBwbGljYXJsYS4iKTsKICB9KTsKCiAgc3luY01vZGVTZWwuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCkgPT4gewogICAgZm9yIChjb25zdCB0IG9mIHRyYWNrcyl7IGNhbmNlbFNjaGVkdWxlKHQpOyB0LnVpLmNvdW50QmFkZ2Uuc3R5bGUuZGlzcGxheSA9ICJub25lIjsgdXBkYXRlVHJhY2tVSSh0KTsgfQogICAgdXBkYXRlR2xvYmFsQnV0dG9ucygpOwogIH0pOwoKICBbZXh0cmFCZWF0c1NlbCwgbGVhZE1zRWxdLmZvckVhY2goZWwgPT4gZWwuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCkgPT4gdXBkYXRlR2xvYmFsQnV0dG9ucygpKSk7CgogIC8vIFN0YXR1cyB1cGRhdGVyCiAgc2V0SW50ZXJ2YWwoc2V0RG90cywgNTAwKTsKCiAgLy8gLS0tLSBCb290IC0tLS0KICBidWlsZFVJKCk7CiAgYnVpbGRCZWF0TGVkcygpOwogIHVwZGF0ZVRpbWluZ0xhYmVscygpOwogIHVwZGF0ZUdyaWRCYWRnZSgpOwogIHNyRWwudGV4dENvbnRlbnQgPSAi4oCUIjsKICBzZXRDYWxpYlN0YXR1cygiYXR0aXZhIGF1ZGlvIik7Cgp9KSgpOwo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==", "Pad": "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9Iml0Ij4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAsIG1heGltdW0tc2NhbGU9MS4wIj4KPHRpdGxlPk1hcmFjYVBhZCBQUk88L3RpdGxlPgo8bGluayBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PU9yYml0cm9uOndnaHRANDAwOzcwMDs5MDAmZmFtaWx5PUludGVyOndnaHRAMzAwOzQwMDs2MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgo8c3R5bGU+Cjpyb290IHsKICAtLWJnOiAjMGEwYTBmOwogIC0tc3VyZmFjZTogIzExMTExODsKICAtLXN1cmZhY2UyOiAjMWExYTI0OwogIC0tYm9yZGVyOiAjMmEyYTNhOwogIC0tYWNjZW50OiAjMDBmNWEwOwogIC0tYWNjZW50MjogIzAwYzhmNTsKICAtLWRhbmdlcjogI2Y1MzA2MDsKICAtLXdhcm46ICNmNWE4MDA7CiAgLS10ZXh0OiAjZTBlMGYwOwogIC0tbXV0ZWQ6ICM1YTVhN2E7CiAgLS1nbG93OiAwIDAgMjBweCByZ2JhKDAsMjQ1LDE2MCwwLjQpOwogIC0tZ2xvdzI6IDAgMCAyMHB4IHJnYmEoMCwyMDAsMjQ1LDAuNCk7Cn0KCiogeyBib3gtc2l6aW5nOiBib3JkZXItYm94OyBtYXJnaW46IDA7IHBhZGRpbmc6IDA7IC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogdHJhbnNwYXJlbnQ7IH0KCmh0bWwsIGJvZHkgewogIGJhY2tncm91bmQ6IHZhcigtLWJnKTsKICBjb2xvcjogdmFyKC0tdGV4dCk7CiAgZm9udC1mYW1pbHk6ICdJbnRlcicsIHNhbnMtc2VyaWY7CiAgbWluLWhlaWdodDogMTAwdmg7CiAgb3ZlcmZsb3cteDogaGlkZGVuOwp9Cgpib2R5OjpiZWZvcmUgewogIGNvbnRlbnQ6ICcnOwogIHBvc2l0aW9uOiBmaXhlZDsKICBpbnNldDogMDsKICBiYWNrZ3JvdW5kOiAKICAgIHJhZGlhbC1ncmFkaWVudChlbGxpcHNlIDYwJSA0MCUgYXQgMjAlIDEwJSwgcmdiYSgwLDI0NSwxNjAsMC4wNSkgMCUsIHRyYW5zcGFyZW50IDYwJSksCiAgICByYWRpYWwtZ3JhZGllbnQoZWxsaXBzZSA1MCUgNTAlIGF0IDgwJSA5MCUsIHJnYmEoMCwyMDAsMjQ1LDAuMDUpIDAlLCB0cmFuc3BhcmVudCA2MCUpOwogIHBvaW50ZXItZXZlbnRzOiBub25lOwogIHotaW5kZXg6IDA7Cn0KCi5hcHAgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICB6LWluZGV4OiAxOwogIG1heC13aWR0aDogMTEwMHB4OwogIG1hcmdpbjogMCBhdXRvOwogIHBhZGRpbmc6IDE2cHg7Cn0KCi8qID09PT09IEhFQURFUiA9PT09PSAqLwpoZWFkZXIgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgcGFkZGluZzogMTJweCAwIDIwcHg7CiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHZhcigtLWJvcmRlcik7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKICBmbGV4LXdyYXA6IHdyYXA7CiAgZ2FwOiAxMHB4Owp9CgoubG9nbyB7CiAgZm9udC1mYW1pbHk6ICdPcmJpdHJvbicsIHNhbnMtc2VyaWY7CiAgZm9udC13ZWlnaHQ6IDkwMDsKICBmb250LXNpemU6IGNsYW1wKDE4cHgsIDR2dywgMjhweCk7CiAgbGV0dGVyLXNwYWNpbmc6IDJweDsKICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHZhcigtLWFjY2VudCksIHZhcigtLWFjY2VudDIpKTsKICAtd2Via2l0LWJhY2tncm91bmQtY2xpcDogdGV4dDsKICAtd2Via2l0LXRleHQtZmlsbC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgYmFja2dyb3VuZC1jbGlwOiB0ZXh0OwogIHRleHQtc2hhZG93OiBub25lOwogIGxpbmUtaGVpZ2h0OiAxLjE7Cn0KCi5sb2dvIHNwYW4gewogIGRpc3BsYXk6IGJsb2NrOwogIGZvbnQtc2l6ZTogMC40ZW07CiAgbGV0dGVyLXNwYWNpbmc6IDRweDsKICBmb250LXdlaWdodDogNDAwOwogIGJhY2tncm91bmQ6IG5vbmU7CiAgLXdlYmtpdC10ZXh0LWZpbGwtY29sb3I6IHZhcigtLW11dGVkKTsKICBjb2xvcjogdmFyKC0tbXV0ZWQpOwogIG1hcmdpbi10b3A6IDJweDsKfQoKLmxvYWQtYnRuIHsKICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsKICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1hY2NlbnQyKTsKICBjb2xvcjogdmFyKC0tYWNjZW50Mik7CiAgcGFkZGluZzogOHB4IDE2cHg7CiAgYm9yZGVyLXJhZGl1czogNnB4OwogIGZvbnQtc2l6ZTogMTJweDsKICBmb250LWZhbWlseTogJ09yYml0cm9uJywgc2Fucy1zZXJpZjsKICBjdXJzb3I6IHBvaW50ZXI7CiAgbGV0dGVyLXNwYWNpbmc6IDFweDsKICB0cmFuc2l0aW9uOiBhbGwgMC4yczsKfQoubG9hZC1idG46aG92ZXIgeyBiYWNrZ3JvdW5kOiByZ2JhKDAsMjAwLDI0NSwwLjEpOyBib3gtc2hhZG93OiB2YXIoLS1nbG93Mik7IH0KLmxvYWQtYnRuOmFjdGl2ZSB7IHRyYW5zZm9ybTogc2NhbGUoMC45Nyk7IH0KCi8qID09PT09IFRSQU5TUE9SVCBCQVIgPT09PT0gKi8KLnRyYW5zcG9ydCB7CiAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZSk7CiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyKTsKICBib3JkZXItcmFkaXVzOiAxMnB4OwogIHBhZGRpbmc6IDE2cHg7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGdhcDogMTZweDsKICBmbGV4LXdyYXA6IHdyYXA7CiAgbWFyZ2luLWJvdHRvbTogMTZweDsKfQoKLmN0cmwtZ3JvdXAgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBnYXA6IDRweDsKfQoKLmN0cmwtbGFiZWwgewogIGZvbnQtc2l6ZTogOXB4OwogIGxldHRlci1zcGFjaW5nOiAycHg7CiAgY29sb3I6IHZhcigtLW11dGVkKTsKICBmb250LWZhbWlseTogJ09yYml0cm9uJywgc2Fucy1zZXJpZjsKICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwp9CgovKiBCUE0gKi8KLmJwbS13cmFwIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgZ2FwOiA4cHg7Cn0KCi5icG0taW5wdXQgewogIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UyKTsKICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXIpOwogIGNvbG9yOiB2YXIoLS1hY2NlbnQpOwogIGZvbnQtZmFtaWx5OiAnT3JiaXRyb24nLCBzYW5zLXNlcmlmOwogIGZvbnQtc2l6ZTogMjZweDsKICBmb250LXdlaWdodDogNzAwOwogIHdpZHRoOiA3NnB4OwogIHRleHQtYWxpZ246IGNlbnRlcjsKICBib3JkZXItcmFkaXVzOiA4cHg7CiAgcGFkZGluZzogNnB4IDRweDsKICBvdXRsaW5lOiBub25lOwogIHRyYW5zaXRpb246IGJvcmRlci1jb2xvciAwLjJzLCBib3gtc2hhZG93IDAuMnM7Cn0KLmJwbS1pbnB1dDpmb2N1cyB7IGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50KTsgYm94LXNoYWRvdzogdmFyKC0tZ2xvdyk7IH0KLmJwbS1pbnB1dDo6LXdlYmtpdC1pbm5lci1zcGluLWJ1dHRvbiB7IC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsgfQoKLmJwbS1zbGlkZXIgewogIHdpZHRoOiBjbGFtcCg4MHB4LCAxNXZ3LCAxNjBweCk7CiAgYWNjZW50LWNvbG9yOiB2YXIoLS1hY2NlbnQpOwogIGN1cnNvcjogcG9pbnRlcjsKfQoKLmJwbS1hcnJvd3MgeyBkaXNwbGF5OiBmbGV4OyBmbGV4LWRpcmVjdGlvbjogY29sdW1uOyBnYXA6IDJweDsgfQouYnBtLWFycm93cyBidXR0b24gewogIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UyKTsKICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXIpOwogIGNvbG9yOiB2YXIoLS10ZXh0KTsKICB3aWR0aDogMjZweDsKICBoZWlnaHQ6IDIycHg7CiAgZm9udC1zaXplOiAxMXB4OwogIGJvcmRlci1yYWRpdXM6IDRweDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgdHJhbnNpdGlvbjogYWxsIDAuMTVzOwogIGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOwp9Ci5icG0tYXJyb3dzIGJ1dHRvbjpob3ZlciB7IGJhY2tncm91bmQ6IHZhcigtLWFjY2VudCk7IGNvbG9yOiAjMDAwOyB9Ci5icG0tYXJyb3dzIGJ1dHRvbjphY3RpdmUgeyB0cmFuc2Zvcm06IHNjYWxlKDAuOSk7IH0KCi8qIFRpbWUgU2lnICovCi50aW1lLXNlbGVjdCB7CiAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZTIpOwogIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlcik7CiAgY29sb3I6IHZhcigtLXRleHQpOwogIHBhZGRpbmc6IDhweCAxMnB4OwogIGJvcmRlci1yYWRpdXM6IDhweDsKICBmb250LWZhbWlseTogJ09yYml0cm9uJywgc2Fucy1zZXJpZjsKICBmb250LXNpemU6IDE0cHg7CiAgb3V0bGluZTogbm9uZTsKICBjdXJzb3I6IHBvaW50ZXI7CiAgdHJhbnNpdGlvbjogYm9yZGVyLWNvbG9yIDAuMnM7Cn0KLnRpbWUtc2VsZWN0OmZvY3VzIHsgYm9yZGVyLWNvbG9yOiB2YXIoLS1hY2NlbnQpOyB9CgovKiBQbGF5L1N0b3AgKi8KLnBsYXktYnRuIHsKICBwYWRkaW5nOiAxMHB4IDI4cHg7CiAgZm9udC1mYW1pbHk6ICdPcmJpdHJvbicsIHNhbnMtc2VyaWY7CiAgZm9udC1zaXplOiAxNHB4OwogIGZvbnQtd2VpZ2h0OiA3MDA7CiAgbGV0dGVyLXNwYWNpbmc6IDJweDsKICBib3JkZXI6IG5vbmU7CiAgYm9yZGVyLXJhZGl1czogOHB4OwogIGN1cnNvcjogcG9pbnRlcjsKICB0cmFuc2l0aW9uOiBhbGwgMC4yczsKICBtaW4td2lkdGg6IDEwMHB4Owp9CgoucGxheS1idG4ucGxheSB7CiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgdmFyKC0tYWNjZW50KSwgIzAwYzg5MCk7CiAgY29sb3I6ICMwMDA7CiAgYm94LXNoYWRvdzogMCA0cHggMjBweCByZ2JhKDAsMjQ1LDE2MCwwLjMpOwp9Ci5wbGF5LWJ0bi5wbGF5OmhvdmVyIHsgYm94LXNoYWRvdzogMCA0cHggMzBweCByZ2JhKDAsMjQ1LDE2MCwwLjYpOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7IH0KCi5wbGF5LWJ0bi5zdG9wIHsKICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCB2YXIoLS1kYW5nZXIpLCAjYzAxMDNhKTsKICBjb2xvcjogI2ZmZjsKICBib3gtc2hhZG93OiAwIDRweCAyMHB4IHJnYmEoMjQ1LDQ4LDk2LDAuMyk7Cn0KLnBsYXktYnRuLnN0b3A6aG92ZXIgeyBib3gtc2hhZG93OiAwIDRweCAzMHB4IHJnYmEoMjQ1LDQ4LDk2LDAuNik7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsgfQoucGxheS1idG46YWN0aXZlIHsgdHJhbnNmb3JtOiBzY2FsZSgwLjk2KSAhaW1wb3J0YW50OyB9CgovKiBUYXAgVGVtcG8gKi8KLnRhcC1idG4gewogIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UyKTsKICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXIpOwogIGNvbG9yOiB2YXIoLS1tdXRlZCk7CiAgcGFkZGluZzogMTBweCAxNnB4OwogIGJvcmRlci1yYWRpdXM6IDhweDsKICBmb250LWZhbWlseTogJ09yYml0cm9uJywgc2Fucy1zZXJpZjsKICBmb250LXNpemU6IDExcHg7CiAgbGV0dGVyLXNwYWNpbmc6IDFweDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgdHJhbnNpdGlvbjogYWxsIDAuMTVzOwp9Ci50YXAtYnRuOmhvdmVyIHsgYm9yZGVyLWNvbG9yOiB2YXIoLS13YXJuKTsgY29sb3I6IHZhcigtLXdhcm4pOyB9Ci50YXAtYnRuLnRhcHBlZCB7IGJvcmRlci1jb2xvcjogdmFyKC0td2Fybik7IGNvbG9yOiB2YXIoLS13YXJuKTsgYm94LXNoYWRvdzogMCAwIDEycHggcmdiYSgyNDUsMTY4LDAsMC40KTsgfQoudGFwLWJ0bjphY3RpdmUgeyB0cmFuc2Zvcm06IHNjYWxlKDAuOTQpOyB9CgovKiA9PT09PSBCRUFUIExJR0hUUyA9PT09PSAqLwouYmVhdC1zZWN0aW9uIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgZ2FwOiAxMnB4OwogIG1hcmdpbi1ib3R0b206IDE2cHg7CiAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZSk7CiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyKTsKICBib3JkZXItcmFkaXVzOiAxMnB4OwogIHBhZGRpbmc6IDE0cHggMTZweDsKfQoKLmJlYXQtbGFiZWwgewogIGZvbnQtZmFtaWx5OiAnT3JiaXRyb24nLCBzYW5zLXNlcmlmOwogIGZvbnQtc2l6ZTogOXB4OwogIGxldHRlci1zcGFjaW5nOiAycHg7CiAgY29sb3I6IHZhcigtLW11dGVkKTsKICB3aGl0ZS1zcGFjZTogbm93cmFwOwp9CgojYmVhdC1saWdodHMgewogIGRpc3BsYXk6IGZsZXg7CiAgZ2FwOiA4cHg7CiAgZmxleC13cmFwOiB3cmFwOwp9CgouYmVhdC1kb3QgewogIHdpZHRoOiAxOHB4OwogIGhlaWdodDogMThweDsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZTIpOwogIGJvcmRlcjogMnB4IHNvbGlkIHZhcigtLWJvcmRlcik7CiAgdHJhbnNpdGlvbjogYWxsIDAuMDZzIGxpbmVhcjsKfQoKLmJlYXQtZG90LmFjY2VudCB7CiAgYm9yZGVyLWNvbG9yOiB2YXIoLS1kYW5nZXIpOwogIGJhY2tncm91bmQ6IHJnYmEoMjQ1LDQ4LDk2LDAuMTUpOwp9CgouYmVhdC1kb3QuYWN0aXZlIHsKICBiYWNrZ3JvdW5kOiB2YXIoLS1hY2NlbnQpOwogIGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50KTsKICBib3gtc2hhZG93OiAwIDAgMTZweCB2YXIoLS1hY2NlbnQpLCAwIDAgMzBweCByZ2JhKDAsMjQ1LDE2MCwwLjUpOwogIHRyYW5zZm9ybTogc2NhbGUoMS4zKTsKfQoKLmJlYXQtZG90LmFjY2VudC5hY3RpdmUgewogIGJhY2tncm91bmQ6IHZhcigtLWRhbmdlcik7CiAgYm9yZGVyLWNvbG9yOiB2YXIoLS1kYW5nZXIpOwogIGJveC1zaGFkb3c6IDAgMCAxNnB4IHZhcigtLWRhbmdlciksIDAgMCAzMHB4IHJnYmEoMjQ1LDQ4LDk2LDAuNSk7Cn0KCi8qIEJhciBjb3VudGVyICovCi5iYXItY291bnRlciB7CiAgbWFyZ2luLWxlZnQ6IGF1dG87CiAgZm9udC1mYW1pbHk6ICdPcmJpdHJvbicsIHNhbnMtc2VyaWY7CiAgZm9udC1zaXplOiAxMXB4OwogIGNvbG9yOiB2YXIoLS1tdXRlZCk7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKfQouYmFyLWNvdW50ZXIgc3BhbiB7CiAgY29sb3I6IHZhcigtLWFjY2VudDIpOwogIGZvbnQtc2l6ZTogMTVweDsKICBmb250LXdlaWdodDogNzAwOwp9CgovKiA9PT09PSBQQURTIEdSSUQgPT09PT0gKi8KI3BhZHMtZ3JpZCB7CiAgZGlzcGxheTogZ3JpZDsKICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCg0LCAxZnIpOwogIGdhcDogMTBweDsKfQoKQG1lZGlhIChtYXgtd2lkdGg6IDcwMHB4KSB7CiAgI3BhZHMtZ3JpZCB7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDMsIDFmcik7IGdhcDogOHB4OyB9CiAgLnRyYW5zcG9ydCB7IHBhZGRpbmc6IDEycHg7IGdhcDogMTBweDsgfQp9CgpAbWVkaWEgKG1heC13aWR0aDogNDgwcHgpIHsKICAjcGFkcy1ncmlkIHsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoMiwgMWZyKTsgZ2FwOiA4cHg7IH0KfQoKLyogPT09PT0gUEFEID09PT09ICovCi5wYWQtd3JhcCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlKTsKICBib3JkZXI6IDJweCBzb2xpZCB2YXIoLS1ib3JkZXIpOwogIHRyYW5zaXRpb246IGJvcmRlci1jb2xvciAwLjJzLCB0cmFuc2Zvcm0gMC4xczsKICBjdXJzb3I6IHBvaW50ZXI7CiAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKICBhc3BlY3QtcmF0aW86IDE7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwp9CgoucGFkLXdyYXA6aG92ZXIgeyBib3JkZXItY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC4yKTsgfQoucGFkLXdyYXAubG9hZGVkIHsgYm9yZGVyLWNvbG9yOiB2YXIoLS1hY2NlbnQpICFpbXBvcnRhbnQ7IH0KLnBhZC13cmFwLnBsYXlpbmcgeyAKICB0cmFuc2Zvcm06IHNjYWxlKDAuOTQpOwogIGJveC1zaGFkb3c6IDAgMCA0MHB4IHZhcigtLXBhZC1jb2xvciwgdmFyKC0tYWNjZW50KSksIGluc2V0IDAgMCAyMHB4IHJnYmEoMjU1LDI1NSwyNTUsMC4xNSk7Cn0KLnBhZC13cmFwLnBsYXlpbmcgLnBhZC1mYWNlIHsgZmlsdGVyOiBicmlnaHRuZXNzKDEuMyk7IH0KCi5wYWQtZmFjZSB7CiAgZmxleDogMTsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICBwYWRkaW5nOiA4cHg7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHRyYW5zaXRpb246IGZpbHRlciAwLjFzOwp9CgoucGFkLWJnIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgaW5zZXQ6IDA7CiAgb3BhY2l0eTogMC4xODsKICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuMXM7Cn0KCi5wYWQtd3JhcC5wbGF5aW5nIC5wYWQtYmcgeyBvcGFjaXR5OiAwLjQ7IH0KCi5wYWQtbnVtYmVyIHsKICBmb250LWZhbWlseTogJ09yYml0cm9uJywgc2Fucy1zZXJpZjsKICBmb250LXNpemU6IGNsYW1wKDhweCwgMS44dncsIDEzcHgpOwogIGZvbnQtd2VpZ2h0OiA5MDA7CiAgbGV0dGVyLXNwYWNpbmc6IDFweDsKICBjb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwwLjUpOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDZweDsKICBsZWZ0OiA4cHg7Cn0KCi5wYWQtaWNvbiB7CiAgZm9udC1zaXplOiBjbGFtcCgyMnB4LCA0dncsIDM2cHgpOwogIG1hcmdpbi1ib3R0b206IDRweDsKICBwb2ludGVyLWV2ZW50czogbm9uZTsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgei1pbmRleDogMTsKfQoKLnBhZC1uYW1lIHsKICBmb250LXNpemU6IGNsYW1wKDdweCwgMS4ydncsIDEwcHgpOwogIHRleHQtYWxpZ246IGNlbnRlcjsKICBjb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwwLjc1KTsKICBtYXgtd2lkdGg6IDEwMCU7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKICB3aGl0ZS1zcGFjZTogbm93cmFwOwogIHBhZGRpbmc6IDAgNnB4OwogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICB6LWluZGV4OiAxOwogIGxldHRlci1zcGFjaW5nOiAwLjVweDsKfQoKLyogPT09PT0gUEFEIENPTlRST0xTIChib3R0b20gc3RyaXApID09PT09ICovCi5wYWQtY29udHJvbHMgewogIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC40KTsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgZ2FwOiA0cHg7CiAgcGFkZGluZzogNXB4IDZweDsKICBib3JkZXItdG9wOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTsKICBmbGV4LXdyYXA6IG5vd3JhcDsKICBvdmVyZmxvdzogaGlkZGVuOwp9CgoucGFkLWN0cmwtYnRuIHsKICBmbGV4OiAxOwogIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4wNyk7CiAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjEyKTsKICBjb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwwLjYpOwogIHBhZGRpbmc6IDNweCAwOwogIGJvcmRlci1yYWRpdXM6IDRweDsKICBmb250LXNpemU6IGNsYW1wKDdweCwgMS4xdncsIDlweCk7CiAgZm9udC1mYW1pbHk6ICdPcmJpdHJvbicsIHNhbnMtc2VyaWY7CiAgY3Vyc29yOiBwb2ludGVyOwogIHRyYW5zaXRpb246IGFsbCAwLjE1czsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICBvdmVyZmxvdzogaGlkZGVuOwogIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwogIGxpbmUtaGVpZ2h0OiAxLjQ7Cn0KLnBhZC1jdHJsLWJ0bjpob3ZlciB7IGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4xNCk7IGNvbG9yOiAjZmZmOyB9Ci5wYWQtY3RybC1idG46YWN0aXZlIHsgdHJhbnNmb3JtOiBzY2FsZSgwLjkyKTsgfQoKLnBhZC1jdHJsLWJ0bi5iZWF0LW9uIHsKICBiYWNrZ3JvdW5kOiByZ2JhKDAsMjQ1LDE2MCwwLjIpOwogIGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50KTsKICBjb2xvcjogdmFyKC0tYWNjZW50KTsKICBib3gtc2hhZG93OiAwIDAgOHB4IHJnYmEoMCwyNDUsMTYwLDAuMyk7Cn0KCi8qID09PT09IFZPTFVNRSBpbmRpY2F0b3Igb24gcGFkID09PT09ICovCi5wYWQtdm9sIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgYm90dG9tOiAzNHB4OwogIHJpZ2h0OiA1cHg7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uLXJldmVyc2U7CiAgZ2FwOiAxcHg7CiAgei1pbmRleDogMjsKfQoudm9sLWJhciB7IHdpZHRoOiAzcHg7IGhlaWdodDogM3B4OyBib3JkZXItcmFkaXVzOiAxcHg7IGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4yKTsgfQoudm9sLWJhci5hY3RpdmUgeyBiYWNrZ3JvdW5kOiB2YXIoLS1hY2NlbnQpOyB9CgovKiBCZWF0IGJlYXQgaW5kaWNhdG9yIGluIGNvcm5lciAqLwouYmVhdC1pbmRpY2F0b3IgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDVweDsKICByaWdodDogNnB4OwogIHdpZHRoOiA4cHg7CiAgaGVpZ2h0OiA4cHg7CiAgYm9yZGVyLXJhZGl1czogNTAlOwogIGJhY2tncm91bmQ6IHZhcigtLWFjY2VudCk7CiAgZGlzcGxheTogbm9uZTsKICBib3gtc2hhZG93OiAwIDAgOHB4IHZhcigtLWFjY2VudCk7CiAgei1pbmRleDogMzsKICBhbmltYXRpb246IHB1bHNlIDFzIGluZmluaXRlOwp9CkBrZXlmcmFtZXMgcHVsc2UgeyAwJSwxMDAle29wYWNpdHk6MX0gNTAle29wYWNpdHk6MC40fSB9Ci5wYWQtd3JhcC5iZWF0LWFjdGl2ZSAuYmVhdC1pbmRpY2F0b3IgeyBkaXNwbGF5OiBibG9jazsgfQoKLyogPT09PT0gVElNSU5HIFNFTEVDVE9SIHBvcHVwID09PT09ICovCi5wYWQtdGltaW5nLWxhYmVsIHsKICBmb250LXNpemU6IGNsYW1wKDdweCwgMS4xdncsIDlweCk7CiAgZm9udC1mYW1pbHk6ICdPcmJpdHJvbicsIHNhbnMtc2VyaWY7CiAgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC41KTsKICB3aGl0ZS1zcGFjZTogbm93cmFwOwp9CgovKiA9PT09PSBTVEFUVVMgQkFSID09PT09ICovCi5zdGF0dXMtYmFyIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogIG1hcmdpbi10b3A6IDE0cHg7CiAgcGFkZGluZzogMTBweCAxNHB4OwogIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UpOwogIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlcik7CiAgYm9yZGVyLXJhZGl1czogMTBweDsKICBmb250LXNpemU6IDEwcHg7CiAgY29sb3I6IHZhcigtLW11dGVkKTsKICBsZXR0ZXItc3BhY2luZzogMXB4OwogIGZsZXgtd3JhcDogd3JhcDsKICBnYXA6IDhweDsKfQoKLnN0YXR1cy1iYXIgLnRhZyB7CiAgYmFja2dyb3VuZDogcmdiYSgwLDI0NSwxNjAsMC4xKTsKICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDAsMjQ1LDE2MCwwLjMpOwogIGNvbG9yOiB2YXIoLS1hY2NlbnQpOwogIHBhZGRpbmc6IDNweCA4cHg7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIGZvbnQtZmFtaWx5OiAnT3JiaXRyb24nLCBzYW5zLXNlcmlmOwogIGZvbnQtc2l6ZTogOXB4Owp9CgovKiA9PT09PSBSVU5OSU5HIGluZGljYXRvciA9PT09PSAqLwoucnVubmluZy1kb3QgewogIHdpZHRoOiA4cHg7IGhlaWdodDogOHB4OwogIGJvcmRlci1yYWRpdXM6IDUwJTsKICBiYWNrZ3JvdW5kOiB2YXIoLS1tdXRlZCk7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIG1hcmdpbi1yaWdodDogNHB4OwogIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CiAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzLCBib3gtc2hhZG93IDAuMnM7Cn0KLnJ1bm5pbmctZG90Lm9uIHsgYmFja2dyb3VuZDogdmFyKC0tYWNjZW50KTsgYm94LXNoYWRvdzogMCAwIDhweCB2YXIoLS1hY2NlbnQpOyBhbmltYXRpb246IHB1bHNlIDAuOHMgaW5maW5pdGU7IH0KCi8qID09PT09IFRPT0xUSVBTIC8gSElOVCA9PT09PSAqLwouaGludC1yb3cgewogIHRleHQtYWxpZ246IGNlbnRlcjsKICBmb250LXNpemU6IDEwcHg7CiAgY29sb3I6IHZhcigtLW11dGVkKTsKICBsZXR0ZXItc3BhY2luZzogMXB4OwogIHBhZGRpbmc6IDZweCAwIDJweDsKfQoKLyogPT09PT0gVk9MVU1FIFNMSURFUiBvbiBwYWQgKGhpZGRlbiBieSBkZWZhdWx0KSA9PT09PSAqLwoucGFkLXZvbC1zbGlkZXIgewogIGRpc3BsYXk6IG5vbmU7CiAgd2lkdGg6IDEwMCU7CiAgYWNjZW50LWNvbG9yOiB2YXIoLS1hY2NlbnQpOwogIG1hcmdpbi10b3A6IDJweDsKfQoucGFkLXdyYXAuZXhwYW5kZWQgLnBhZC12b2wtc2xpZGVyIHsgZGlzcGxheTogYmxvY2s7IH0KCi8qIFNjcm9sbGJhciBzdHlsZSAqLwo6Oi13ZWJraXQtc2Nyb2xsYmFyIHsgd2lkdGg6IDZweDsgfQo6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrIHsgYmFja2dyb3VuZDogdmFyKC0tYmcpOyB9Cjo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWIgeyBiYWNrZ3JvdW5kOiB2YXIoLS1ib3JkZXIpOyBib3JkZXItcmFkaXVzOiAzcHg7IH0KPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KPGRpdiBjbGFzcz0iYXBwIj4KCiAgPCEtLSBIRUFERVIgLS0+CiAgPGhlYWRlcj4KICAgIDxkaXYgY2xhc3M9ImxvZ28iPgogICAgICBNQVJBQ0FQQUQKICAgICAgPHNwYW4+UFJPIERSVU0gTUFDSElORTwvc3Bhbj4KICAgIDwvZGl2PgogICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDoxMHB4O2FsaWduLWl0ZW1zOmNlbnRlcjtmbGV4LXdyYXA6d3JhcDsiPgogICAgICA8YnV0dG9uIGNsYXNzPSJsb2FkLWJ0biIgb25jbGljaz0ibG9hZEZvbGRlcigpIj7wn5OBIENBUklDQSBDQVJURUxMQTwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJsb2FkLWJ0biIgb25jbGljaz0iY2xlYXJBbGwoKSIgc3R5bGU9ImJvcmRlci1jb2xvcjp2YXIoLS1kYW5nZXIpO2NvbG9yOnZhcigtLWRhbmdlcik7Ij7inJUgQ0xFQVI8L2J1dHRvbj4KICAgIDwvZGl2PgogIDwvaGVhZGVyPgoKICA8IS0tIFRSQU5TUE9SVCAtLT4KICA8ZGl2IGNsYXNzPSJ0cmFuc3BvcnQiPgoKICAgIDwhLS0gUExBWS9TVE9QIC0tPgogICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDo4cHg7Ij4KICAgICAgPGJ1dHRvbiBpZD0icGxheS1idG4iIGNsYXNzPSJwbGF5LWJ0biBwbGF5IiBvbmNsaWNrPSJ0b2dnbGVQbGF5KCkiPuKWtiBQTEFZPC9idXR0b24+CiAgICA8L2Rpdj4KCiAgICA8IS0tIEJQTSAtLT4KICAgIDxkaXYgY2xhc3M9ImN0cmwtZ3JvdXAiPgogICAgICA8ZGl2IGNsYXNzPSJjdHJsLWxhYmVsIj5CUE08L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iYnBtLXdyYXAiPgogICAgICAgIDxkaXYgY2xhc3M9ImJwbS1hcnJvd3MiPgogICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJjaGFuZ2VCUE0oMSkiPuKWsjwvYnV0dG9uPgogICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJjaGFuZ2VCUE0oLTEpIj7ilrw8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8aW5wdXQgaWQ9ImJwbS1pbnB1dCIgY2xhc3M9ImJwbS1pbnB1dCIgdHlwZT0ibnVtYmVyIiBtaW49IjMwIiBtYXg9IjMwMCIgdmFsdWU9IjkwIiAKICAgICAgICAgICAgICAgb25pbnB1dD0ic2V0QlBNRnJvbUlucHV0KCkiIG9uYmx1cj0iY2xhbXBCUE0oKSIgb25rZXlkb3duPSJicG1LZXkoZXZlbnQpIj4KICAgICAgICA8aW5wdXQgaWQ9ImJwbS1zbGlkZXIiIGNsYXNzPSJicG0tc2xpZGVyIiB0eXBlPSJyYW5nZSIgbWluPSIzMCIgbWF4PSIzMDAiIHZhbHVlPSI5MCIgCiAgICAgICAgICAgICAgIG9uaW5wdXQ9InNldEJQTUZyb21TbGlkZXIoKSI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0idGFwLWJ0biIgaWQ9InRhcC1idG4iIG9uY2xpY2s9InRhcFRlbXBvKCkiPlRBUDwvYnV0dG9uPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDwhLS0gVElNRSBTSUcgLS0+CiAgICA8ZGl2IGNsYXNzPSJjdHJsLWdyb3VwIj4KICAgICAgPGRpdiBjbGFzcz0iY3RybC1sYWJlbCI+QkFUVFVURTwvZGl2PgogICAgICA8c2VsZWN0IGNsYXNzPSJ0aW1lLXNlbGVjdCIgaWQ9InRpbWUtc2lnIiBvbmNoYW5nZT0iY2hhbmdlVGltZVNpZygpIj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSIyIj4yLzQ8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSIzIj4zLzQ8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSI0IiBzZWxlY3RlZD40LzQ8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSI1Ij41LzQ8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSI2Ij42Lzg8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSI3Ij43Lzg8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSI4Ij44Lzg8L29wdGlvbj4KICAgICAgPC9zZWxlY3Q+CiAgICA8L2Rpdj4KCiAgICA8IS0tIFNXSU5HIC0tPgogICAgPGRpdiBjbGFzcz0iY3RybC1ncm91cCI+CiAgICAgIDxkaXYgY2xhc3M9ImN0cmwtbGFiZWwiPlNXSU5HPC9kaXY+CiAgICAgIDxzZWxlY3QgY2xhc3M9InRpbWUtc2VsZWN0IiBpZD0ic3dpbmctc2VsZWN0IiBvbmNoYW5nZT0idXBkYXRlU3dpbmcoKSI+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iMCI+TkVTU1VOTzwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9IjAuMSI+TEVHR0VSTzwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9IjAuMiI+TUVESU88L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSIwLjM1Ij5GT1JURTwvb3B0aW9uPgogICAgICA8L3NlbGVjdD4KICAgIDwvZGl2PgoKICA8L2Rpdj4KCiAgPCEtLSBCRUFUIExJR0hUUyAtLT4KICA8ZGl2IGNsYXNzPSJiZWF0LXNlY3Rpb24iPgogICAgPGRpdiBjbGFzcz0iYmVhdC1sYWJlbCI+QkVBVDwvZGl2PgogICAgPGRpdiBpZD0iYmVhdC1saWdodHMiPjwvZGl2PgogICAgPGRpdiBjbGFzcz0iYmFyLWNvdW50ZXIiPk1JU1VSQSA8c3BhbiBpZD0iYmFyLWNvdW50Ij4xPC9zcGFuPjwvZGl2PgogIDwvZGl2PgoKICA8ZGl2IGNsYXNzPSJoaW50LXJvdyI+Q0xJQ0sgU1VMIFBBRCA9IFNVT05BIOKAoiDilrhCRUFUID0gTE9PUCBBVVRPIOKAoiDCvSA9IERJTUVaWkEgQkVBVCDigKIgw5cyID0gUkFERE9QUElBIEJFQVQ8L2Rpdj4KCiAgPCEtLSBQQURTIC0tPgogIDxkaXYgaWQ9InBhZHMtZ3JpZCI+PC9kaXY+CgogIDwhLS0gU1RBVFVTIC0tPgogIDxkaXYgY2xhc3M9InN0YXR1cy1iYXIiPgogICAgPGRpdj4KICAgICAgPHNwYW4gY2xhc3M9InJ1bm5pbmctZG90IiBpZD0icnVuLWRvdCI+PC9zcGFuPgogICAgICA8c3BhbiBpZD0ic3RhdHVzLXRleHQiPkZFUk1PPC9zcGFuPgogICAgPC9kaXY+CiAgICA8ZGl2PgogICAgICA8c3BhbiBjbGFzcz0idGFnIiBpZD0iYnBtLXRhZyI+OTAgQlBNPC9zcGFuPgogICAgPC9kaXY+CiAgICA8ZGl2IHN0eWxlPSJjb2xvcjp2YXIoLS1tdXRlZCk7Zm9udC1zaXplOjlweDtsZXR0ZXItc3BhY2luZzowLjVweDsiPgogICAgICBDaHJvbWUvRWRnZSBwZXIgY2FyaWNhbWVudG8gY2FydGVsbGEg4oCiIFR1dHRpIGkgZm9ybWF0aSBhdWRpbwogICAgPC9kaXY+CiAgPC9kaXY+Cgo8L2Rpdj4KCjxzY3JpcHQ+Ci8vID09PT09PT09PT09PT09PT09PT09PT0gU1RBVE8gPT09PT09PT09PT09PT09PT09PT09PQpsZXQgYnBtID0gOTA7CmxldCBiZWF0c1BlckJhciA9IDQ7CmxldCBpc1J1bm5pbmcgPSBmYWxzZTsKbGV0IGN1cnJlbnRCZWF0ID0gMDsKbGV0IGJhckNvdW50ID0gMTsKbGV0IHNjaGVkdWxlckludGVydmFsID0gbnVsbDsKbGV0IHN3aW5nQW1vdW50ID0gMDsKbGV0IHRhcFRpbWVzID0gW107Cgpjb25zdCBwYWRzID0gW107Cgpjb25zdCBQQURfQ09MT1JTID0gWwogICcjZjU1NTYwJywnI2Y1ODAzYScsJyNmNWM4NDAnLCcjOTBlMDUwJywKICAnIzNhZDRhMCcsJyMzMGE4ZjUnLCcjNTA2MGY1JywnI2EwNDBlMCcsCiAgJyNmNTUwYzAnLCcjNDBlMGQwJywnI2YwZjA0MCcsJyM1MGQwODAnCl07Cgpjb25zdCBQQURfSUNPTlMgPSBbCiAgJ/CfpYEnLCfwn464Jywn8J+OuScsJ/CfjronLCfwn463Jywn8J+OuycsJ/CfqpgnLCfwn6WBJywKICAn8J+OuCcsJ/CfjrknLCfwn461Jywn8J+OticKXTsKCmxldCBhdWRpb0N0eCA9IG51bGw7CgpmdW5jdGlvbiBnZXRBdWRpb0N0eCgpIHsKICBpZiAoIWF1ZGlvQ3R4KSBhdWRpb0N0eCA9IG5ldyAod2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KSgpOwogIHJldHVybiBhdWRpb0N0eDsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT09PSBJTklUID09PT09PT09PT09PT09PT09PT09PT0KZnVuY3Rpb24gaW5pdCgpIHsKICBidWlsZFBhZHMoKTsKICBidWlsZEJlYXRMaWdodHMoKTsKICB1cGRhdGVCcG1EaXNwbGF5KCk7Cn0KCi8vID09PT09PT09PT09PT09PT09PT09PT0gUEFEUyA9PT09PT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIGJ1aWxkUGFkcygpIHsKICBjb25zdCBncmlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhZHMtZ3JpZCcpOwogIGdyaWQuaW5uZXJIVE1MID0gJyc7CgogIGZvciAobGV0IGkgPSAwOyBpIDwgMTI7IGkrKykgewogICAgY29uc3QgcGFkID0gewogICAgICBpbmRleDogaSwKICAgICAgYnVmZmVyOiBudWxsLAogICAgICBuYW1lOiAnJywKICAgICAgdHJpZ2dlck9uQmVhdDogZmFsc2UsCiAgICAgIGJlYXREaXY6IDEsICAgICAgICAvLyAxPW9nbmkgYmVhdCwgMj1vZ25pIDIgYmVhdCAoZGltZXp6YSksIDAuNT1vZ25pIG1lenpvIGJlYXQgKHJhZGRvcHBpYSkKICAgICAgdm9sdW1lOiAxLAogICAgICBjb2xvcjogUEFEX0NPTE9SU1tpXSwKICAgICAgZWw6IG51bGwsCiAgICAgIG5hbWVFbDogbnVsbCwKICAgICAgYmVhdEJ0bjogbnVsbCwKICAgICAgaGFsZkJ0bjogbnVsbCwKICAgICAgZG91YmxlQnRuOiBudWxsLAogICAgICBiZWF0RGl2TGFiZWw6IG51bGwsCiAgICAgIGJlYXRJbmRpY2F0b3I6IG51bGwKICAgIH07CiAgICBwYWRzLnB1c2gocGFkKTsKCiAgICBjb25zdCB3cmFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB3cmFwLmNsYXNzTmFtZSA9ICdwYWQtd3JhcCc7CiAgICB3cmFwLnN0eWxlLnNldFByb3BlcnR5KCctLXBhZC1jb2xvcicsIHBhZC5jb2xvcik7CgogICAgLy8gQmFja2dyb3VuZCBjb2xvcgogICAgY29uc3QgYmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGJnLmNsYXNzTmFtZSA9ICdwYWQtYmcnOwogICAgYmcuc3R5bGUuYmFja2dyb3VuZCA9IGByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDUwJSA0MCUsICR7cGFkLmNvbG9yfSwgdHJhbnNwYXJlbnQgNzAlKWA7CgogICAgLy8gUGFkIGZhY2UKICAgIGNvbnN0IGZhY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGZhY2UuY2xhc3NOYW1lID0gJ3BhZC1mYWNlJzsKCiAgICBjb25zdCBudW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIG51bS5jbGFzc05hbWUgPSAncGFkLW51bWJlcic7CiAgICBudW0udGV4dENvbnRlbnQgPSBTdHJpbmcoaSsxKS5wYWRTdGFydCgyLCcwJyk7CgogICAgY29uc3QgaWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgaWNvbi5jbGFzc05hbWUgPSAncGFkLWljb24nOwogICAgaWNvbi50ZXh0Q29udGVudCA9IFBBRF9JQ09OU1tpXTsKCiAgICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBuYW1lLmNsYXNzTmFtZSA9ICdwYWQtbmFtZSc7CiAgICBuYW1lLnRleHRDb250ZW50ID0gJ0NBUklDQSBTVU9OTyc7CgogICAgLy8gQmVhdCBhY3RpdmUgaW5kaWNhdG9yIGRvdAogICAgY29uc3QgYkRvdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgYkRvdC5jbGFzc05hbWUgPSAnYmVhdC1pbmRpY2F0b3InOwoKICAgIC8vIFZvbHVtZSBiYXJzIGRlY29yYXRpb24KICAgIGNvbnN0IHZvbEJhcnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHZvbEJhcnMuY2xhc3NOYW1lID0gJ3BhZC12b2wnOwogICAgZm9yKGxldCB2PTA7djw1O3YrKykgewogICAgICBjb25zdCB2YiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICB2Yi5jbGFzc05hbWUgPSAndm9sLWJhcicgKyAodiA8IDMgPyAnIGFjdGl2ZScgOiAnJyk7CiAgICAgIHZvbEJhcnMuYXBwZW5kQ2hpbGQodmIpOwogICAgfQoKICAgIGZhY2UuYXBwZW5kQ2hpbGQoYmcpOwogICAgZmFjZS5hcHBlbmRDaGlsZChudW0pOwogICAgZmFjZS5hcHBlbmRDaGlsZChpY29uKTsKICAgIGZhY2UuYXBwZW5kQ2hpbGQobmFtZSk7CiAgICBmYWNlLmFwcGVuZENoaWxkKGJEb3QpOwogICAgZmFjZS5hcHBlbmRDaGlsZCh2b2xCYXJzKTsKCiAgICAvLyBDb250cm9scyBzdHJpcAogICAgY29uc3QgY3RybCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgY3RybC5jbGFzc05hbWUgPSAncGFkLWNvbnRyb2xzJzsKCiAgICBjb25zdCBiZWF0QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICBiZWF0QnRuLmNsYXNzTmFtZSA9ICdwYWQtY3RybC1idG4nOwogICAgYmVhdEJ0bi50ZXh0Q29udGVudCA9ICfilrhCRUFUJzsKICAgIGJlYXRCdG4ub25jbGljayA9IChlKSA9PiB7IGUuc3RvcFByb3BhZ2F0aW9uKCk7IHRvZ2dsZUJlYXQoaSk7IH07CgogICAgY29uc3QgaGFsZkJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgaGFsZkJ0bi5jbGFzc05hbWUgPSAncGFkLWN0cmwtYnRuJzsKICAgIGhhbGZCdG4udGV4dENvbnRlbnQgPSAnwr0nOwogICAgaGFsZkJ0bi50aXRsZSA9ICdEaW1lenphIGZyZXF1ZW56YSc7CiAgICBoYWxmQnRuLm9uY2xpY2sgPSAoZSkgPT4geyBlLnN0b3BQcm9wYWdhdGlvbigpOyBjeWNsZUJlYXREaXYoaSwgLTEpOyB9OwoKICAgIGNvbnN0IGRpdkxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICBkaXZMYWJlbC5jbGFzc05hbWUgPSAncGFkLWN0cmwtYnRuJzsKICAgIGRpdkxhYmVsLnN0eWxlLmNzc1RleHQgPSAnZmxleDowLjg7Y29sb3I6cmdiYSgyNTUsMjU1LDI1NSwwLjgpO2N1cnNvcjpkZWZhdWx0Oyc7CiAgICBkaXZMYWJlbC50ZXh0Q29udGVudCA9ICcxOjEnOwoKICAgIGNvbnN0IGRvdWJsZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgZG91YmxlQnRuLmNsYXNzTmFtZSA9ICdwYWQtY3RybC1idG4nOwogICAgZG91YmxlQnRuLnRleHRDb250ZW50ID0gJ8OXMic7CiAgICBkb3VibGVCdG4udGl0bGUgPSAnUmFkZG9wcGlhIGZyZXF1ZW56YSc7CiAgICBkb3VibGVCdG4ub25jbGljayA9IChlKSA9PiB7IGUuc3RvcFByb3BhZ2F0aW9uKCk7IGN5Y2xlQmVhdERpdihpLCAxKTsgfTsKCiAgICBjdHJsLmFwcGVuZENoaWxkKGJlYXRCdG4pOwogICAgY3RybC5hcHBlbmRDaGlsZChoYWxmQnRuKTsKICAgIGN0cmwuYXBwZW5kQ2hpbGQoZGl2TGFiZWwpOwogICAgY3RybC5hcHBlbmRDaGlsZChkb3VibGVCdG4pOwoKICAgIHdyYXAuYXBwZW5kQ2hpbGQoZmFjZSk7CiAgICB3cmFwLmFwcGVuZENoaWxkKGN0cmwpOwoKICAgIHdyYXAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBvblBhZENsaWNrKGkpKTsKICAgIHdyYXAuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIChlKSA9PiB7IGUucHJldmVudERlZmF1bHQoKTsgb25QYWRDbGljayhpKTsgfSwge3Bhc3NpdmU6ZmFsc2V9KTsKCiAgICBncmlkLmFwcGVuZENoaWxkKHdyYXApOwoKICAgIHBhZC5lbCA9IHdyYXA7CiAgICBwYWQubmFtZUVsID0gbmFtZTsKICAgIHBhZC5iZWF0QnRuID0gYmVhdEJ0bjsKICAgIHBhZC5oYWxmQnRuID0gaGFsZkJ0bjsKICAgIHBhZC5kb3VibGVCdG4gPSBkb3VibGVCdG47CiAgICBwYWQuYmVhdERpdkxhYmVsID0gZGl2TGFiZWw7CiAgICBwYWQuYmVhdEluZGljYXRvciA9IGJEb3Q7CiAgfQp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09IEJFQVQgRElWIENZQ0xFID09PT09PT09PT09PT09PT09PT09PT0KY29uc3QgQkVBVF9ESVZTID0gWzAuMjUsIDAuNSwgMSwgMiwgNF07CmNvbnN0IEJFQVRfTEFCRUxTID0gWycxOjQnLCcxOjInLCcxOjEnLCcyOjEnLCc0OjEnXTsKCmZ1bmN0aW9uIGN5Y2xlQmVhdERpdihpZHgsIGRpcikgewogIGNvbnN0IHBhZCA9IHBhZHNbaWR4XTsKICBjb25zdCBjdXJyID0gQkVBVF9ESVZTLmluZGV4T2YocGFkLmJlYXREaXYpOwogIGNvbnN0IG5leHQgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihCRUFUX0RJVlMubGVuZ3RoLTEsIGN1cnIgKyBkaXIpKTsKICBwYWQuYmVhdERpdiA9IEJFQVRfRElWU1tuZXh0XTsKICBwYWQuYmVhdERpdkxhYmVsLnRleHRDb250ZW50ID0gQkVBVF9MQUJFTFNbbmV4dF07CiAgCiAgLy8gY29sb3IgaGludAogIGlmKG5leHQgPCAyKSB7CiAgICBwYWQuYmVhdERpdkxhYmVsLnN0eWxlLmNvbG9yID0gJyNmNWE4MDAnOwogIH0gZWxzZSBpZihuZXh0ID4gMikgewogICAgcGFkLmJlYXREaXZMYWJlbC5zdHlsZS5jb2xvciA9ICcjMDBmNWEwJzsKICB9IGVsc2UgewogICAgcGFkLmJlYXREaXZMYWJlbC5zdHlsZS5jb2xvciA9ICdyZ2JhKDI1NSwyNTUsMjU1LDAuOCknOwogIH0KfQoKLy8gPT09PT09PT09PT09PT09PT09PT09PSBUT0dHTEUgQkVBVCA9PT09PT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIHRvZ2dsZUJlYXQoaWR4KSB7CiAgY29uc3QgcGFkID0gcGFkc1tpZHhdOwogIHBhZC50cmlnZ2VyT25CZWF0ID0gIXBhZC50cmlnZ2VyT25CZWF0OwogIGlmKHBhZC50cmlnZ2VyT25CZWF0KSB7CiAgICBwYWQuYmVhdEJ0bi5jbGFzc0xpc3QuYWRkKCdiZWF0LW9uJyk7CiAgICBwYWQuYmVhdEJ0bi50ZXh0Q29udGVudCA9ICfilqBCRUFUJzsKICAgIHBhZC5lbC5jbGFzc0xpc3QuYWRkKCdiZWF0LWFjdGl2ZScpOwogIH0gZWxzZSB7CiAgICBwYWQuYmVhdEJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdiZWF0LW9uJyk7CiAgICBwYWQuYmVhdEJ0bi50ZXh0Q29udGVudCA9ICfilrhCRUFUJzsKICAgIHBhZC5lbC5jbGFzc0xpc3QucmVtb3ZlKCdiZWF0LWFjdGl2ZScpOwogIH0KfQoKLy8gPT09PT09PT09PT09PT09PT09PT09PSBQQUQgQ0xJQ0sgPT09PT09PT09PT09PT09PT09PT09PQpmdW5jdGlvbiBvblBhZENsaWNrKGlkeCkgewogIGNvbnN0IHBhZCA9IHBhZHNbaWR4XTsKICBpZighcGFkLmJ1ZmZlcikgewogICAgbG9hZFNpbmdsZVNvdW5kKGlkeCk7CiAgfSBlbHNlIHsKICAgIHBsYXlQYWQoaWR4KTsKICB9Cn0KCi8vID09PT09PT09PT09PT09PT09PT09PT0gUExBWSBQQUQgPT09PT09PT09PT09PT09PT09PT09PQpmdW5jdGlvbiBwbGF5UGFkKGlkeCwgd2hlbikgewogIGNvbnN0IHBhZCA9IHBhZHNbaWR4XTsKICBpZighcGFkLmJ1ZmZlcikgcmV0dXJuOwogIAogIGNvbnN0IGN0eCA9IGdldEF1ZGlvQ3R4KCk7CiAgY29uc3Qgc291cmNlID0gY3R4LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpOwogIHNvdXJjZS5idWZmZXIgPSBwYWQuYnVmZmVyOwogIAogIGNvbnN0IGdhaW4gPSBjdHguY3JlYXRlR2FpbigpOwogIGdhaW4uZ2Fpbi52YWx1ZSA9IHBhZC52b2x1bWU7CiAgCiAgc291cmNlLmNvbm5lY3QoZ2Fpbik7CiAgZ2Fpbi5jb25uZWN0KGN0eC5kZXN0aW5hdGlvbik7CiAgCiAgaWYod2hlbiAmJiB3aGVuID4gY3R4LmN1cnJlbnRUaW1lKSB7CiAgICBzb3VyY2Uuc3RhcnQod2hlbik7CiAgfSBlbHNlIHsKICAgIHNvdXJjZS5zdGFydChjdHguY3VycmVudFRpbWUpOwogICAgLy8gVmlzdWFsIGZsYXNoCiAgICBmbGFzaFBhZChpZHgpOwogIH0KfQoKZnVuY3Rpb24gZmxhc2hQYWQoaWR4KSB7CiAgY29uc3QgcGFkID0gcGFkc1tpZHhdOwogIHBhZC5lbC5jbGFzc0xpc3QuYWRkKCdwbGF5aW5nJyk7CiAgc2V0VGltZW91dCgoKSA9PiBwYWQuZWwuY2xhc3NMaXN0LnJlbW92ZSgncGxheWluZycpLCAxNDApOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09IE1FVFJPTk9NRSBUSUNLID09PT09PT09PT09PT09PT09PT09PT0KbGV0IGJlYXRTdGVwID0gMDsgLy8gZnJhY3Rpb25hbCBiZWF0IGNvdW50ZXIgKHN1cHBvcnRzIGhhbGYvZG91YmxlKQpjb25zdCBTVEVQU19QRVJfQkVBVCA9IDQ7IC8vIHJlc29sdXRpb246IDQgc3RlcHMgcGVyIGJlYXQKbGV0IHN0ZXBDb3VudGVyID0gMDsKCmZ1bmN0aW9uIHRpY2soKSB7CiAgY29uc3Qgc3RlcCA9IHN0ZXBDb3VudGVyICUgKGJlYXRzUGVyQmFyICogU1RFUFNfUEVSX0JFQVQpOwogIGNvbnN0IGJlYXRJbmRleCA9IE1hdGguZmxvb3Ioc3RlcCAvIFNURVBTX1BFUl9CRUFUKTsKICBjb25zdCBzdWJTdGVwID0gc3RlcCAlIFNURVBTX1BFUl9CRUFUOwoKICAvLyBVcGRhdGUgYmVhdCBsaWdodHMgKG9ubHkgb24gYmVhdCBib3VuZGFyaWVzKQogIGlmKHN1YlN0ZXAgPT09IDApIHsKICAgIHVwZGF0ZUJlYXRMaWdodHMoYmVhdEluZGV4KTsKICAgIGlmKGJlYXRJbmRleCA9PT0gMCkgewogICAgICBiYXJDb3VudCsrOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFyLWNvdW50JykudGV4dENvbnRlbnQgPSBiYXJDb3VudDsKICAgIH0KICB9CgogIC8vIFRyaWdnZXIgcGFkcwogIHBhZHMuZm9yRWFjaCgocGFkLCBpZHgpID0+IHsKICAgIGlmKCFwYWQudHJpZ2dlck9uQmVhdCB8fCAhcGFkLmJ1ZmZlcikgcmV0dXJuOwogICAgCiAgICAvLyBiZWF0RGl2OiAxPW9nbmkgYmVhdCwgMj1vZ25pIDJiZWF0LCAwLjU9b2duaSBtZXp6byBiZWF0LCBldGMuCiAgICBjb25zdCBzdGVwc0ZvckRpdiA9IFNURVBTX1BFUl9CRUFUIC8gcGFkLmJlYXREaXY7CiAgICAKICAgIGlmKHN0ZXBzRm9yRGl2ID49IDEpIHsKICAgICAgLy8gdHJpZ2dlciBldmVyeSBOIHN0ZXBzCiAgICAgIGlmKHN0ZXAgJSBNYXRoLnJvdW5kKHN0ZXBzRm9yRGl2KSA9PT0gMCkgewogICAgICAgIHBsYXlQYWQoaWR4KTsKICAgICAgICBmbGFzaFBhZChpZHgpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyBtdWx0aXBsZSB0cmlnZ2VycyBwZXIgYmVhdAogICAgICBjb25zdCB0cmlnZ2Vyc1BlclN0ZXAgPSAxIC8gc3RlcHNGb3JEaXY7CiAgICAgIGlmKHN1YlN0ZXAgJSAoMS90cmlnZ2Vyc1BlclN0ZXApIDwgMC4wMSkgewogICAgICAgIHBsYXlQYWQoaWR4KTsKICAgICAgICBmbGFzaFBhZChpZHgpOwogICAgICB9CiAgICB9CiAgfSk7CgogIHN0ZXBDb3VudGVyKys7Cn0KCmZ1bmN0aW9uIHVwZGF0ZUJlYXRMaWdodHMoYmVhdEluZGV4KSB7CiAgY29uc3QgbGlnaHRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJlYXQtZG90Jyk7CiAgbGlnaHRzLmZvckVhY2goKGwsIGkpID0+IHsKICAgIGwuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICBpZihpID09PSBiZWF0SW5kZXgpIGwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgfSk7CiAgY3VycmVudEJlYXQgPSBiZWF0SW5kZXg7Cn0KCi8vID09PT09PT09PT09PT09PT09PT09PT0gUExBWS9TVE9QID09PT09PT09PT09PT09PT09PT09PT0KZnVuY3Rpb24gdG9nZ2xlUGxheSgpIHsKICBpZighYXVkaW9DdHgpIGdldEF1ZGlvQ3R4KCk7CiAgaWYoYXVkaW9DdHguc3RhdGUgPT09ICdzdXNwZW5kZWQnKSBhdWRpb0N0eC5yZXN1bWUoKTsKICAKICBpZihpc1J1bm5pbmcpIHsKICAgIHN0b3BNZXRyb25vbWUoKTsKICB9IGVsc2UgewogICAgc3RhcnRNZXRyb25vbWUoKTsKICB9Cn0KCmZ1bmN0aW9uIHN0YXJ0TWV0cm9ub21lKCkgewogIGlzUnVubmluZyA9IHRydWU7CiAgc3RlcENvdW50ZXIgPSAwOwogIGJhckNvdW50ID0gMDsKICAKICBjb25zdCBtc1BlclN0ZXAgPSAoNjAwMDAgLyBicG0pIC8gU1RFUFNfUEVSX0JFQVQ7CiAgCiAgdGljaygpOwogIHNjaGVkdWxlckludGVydmFsID0gc2V0SW50ZXJ2YWwodGljaywgbXNQZXJTdGVwKTsKICAKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheS1idG4nKS50ZXh0Q29udGVudCA9ICfilqAgU1RPUCc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXktYnRuJykuY2xhc3NOYW1lID0gJ3BsYXktYnRuIHN0b3AnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdydW4tZG90JykuY2xhc3NMaXN0LmFkZCgnb24nKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdHVzLXRleHQnKS50ZXh0Q29udGVudCA9ICdJTiBSSVBST0RVWklPTkUnOwp9CgpmdW5jdGlvbiBzdG9wTWV0cm9ub21lKCkgewogIGNsZWFySW50ZXJ2YWwoc2NoZWR1bGVySW50ZXJ2YWwpOwogIGlzUnVubmluZyA9IGZhbHNlOwogIHN0ZXBDb3VudGVyID0gMDsKICBiYXJDb3VudCA9IDE7CiAgCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXktYnRuJykudGV4dENvbnRlbnQgPSAn4pa2IFBMQVknOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5LWJ0bicpLmNsYXNzTmFtZSA9ICdwbGF5LWJ0biBwbGF5JzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncnVuLWRvdCcpLmNsYXNzTGlzdC5yZW1vdmUoJ29uJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXR1cy10ZXh0JykudGV4dENvbnRlbnQgPSAnRkVSTU8nOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYXItY291bnQnKS50ZXh0Q29udGVudCA9ICcxJzsKICAKICAvLyBDbGVhciBhbGwgbGlnaHRzCiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJlYXQtZG90JykuZm9yRWFjaChsID0+IGwuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09IEJQTSA9PT09PT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIHVwZGF0ZUJwbURpc3BsYXkoKSB7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwbS1pbnB1dCcpLnZhbHVlID0gYnBtOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicG0tc2xpZGVyJykudmFsdWUgPSBicG07CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwbS10YWcnKS50ZXh0Q29udGVudCA9IGJwbSArICcgQlBNJzsKfQoKZnVuY3Rpb24gc2V0QlBNRnJvbUlucHV0KCkgewogIGNvbnN0IHYgPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnBtLWlucHV0JykudmFsdWUpOwogIGlmKHYgPj0gMzAgJiYgdiA8PSAzMDApIHsgYnBtID0gdjsgYXBwbHlCUE0oKTsgfQp9CgpmdW5jdGlvbiBzZXRCUE1Gcm9tU2xpZGVyKCkgewogIGJwbSA9IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicG0tc2xpZGVyJykudmFsdWUpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicG0taW5wdXQnKS52YWx1ZSA9IGJwbTsKICBhcHBseUJQTSgpOwp9CgpmdW5jdGlvbiBjaGFuZ2VCUE0oZGVsdGEpIHsKICBicG0gPSBNYXRoLm1heCgzMCwgTWF0aC5taW4oMzAwLCBicG0gKyBkZWx0YSkpOwogIHVwZGF0ZUJwbURpc3BsYXkoKTsKICBhcHBseUJQTSgpOwp9CgpmdW5jdGlvbiBicG1LZXkoZSkgewogIGlmKGUua2V5PT09J0Fycm93VXAnKSB7IGUucHJldmVudERlZmF1bHQoKTsgY2hhbmdlQlBNKDEpOyB9CiAgaWYoZS5rZXk9PT0nQXJyb3dEb3duJykgeyBlLnByZXZlbnREZWZhdWx0KCk7IGNoYW5nZUJQTSgtMSk7IH0KfQoKZnVuY3Rpb24gY2xhbXBCUE0oKSB7CiAgY29uc3QgdiA9IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicG0taW5wdXQnKS52YWx1ZSk7CiAgaWYoaXNOYU4odikgfHwgdiA8IDMwKSB7IGJwbSA9IDMwOyB9CiAgZWxzZSBpZih2ID4gMzAwKSB7IGJwbSA9IDMwMDsgfQogIGVsc2UgeyBicG0gPSB2OyB9CiAgdXBkYXRlQnBtRGlzcGxheSgpOwogIGFwcGx5QlBNKCk7Cn0KCmZ1bmN0aW9uIGFwcGx5QlBNKCkgewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicG0tdGFnJykudGV4dENvbnRlbnQgPSBicG0gKyAnIEJQTSc7CiAgaWYoaXNSdW5uaW5nKSB7CiAgICBjbGVhckludGVydmFsKHNjaGVkdWxlckludGVydmFsKTsKICAgIGNvbnN0IG1zUGVyU3RlcCA9ICg2MDAwMCAvIGJwbSkgLyBTVEVQU19QRVJfQkVBVDsKICAgIHNjaGVkdWxlckludGVydmFsID0gc2V0SW50ZXJ2YWwodGljaywgbXNQZXJTdGVwKTsKICB9Cn0KCi8vID09PT09PT09PT09PT09PT09PT09PT0gVEFQIFRFTVBPID09PT09PT09PT09PT09PT09PT09PT0KZnVuY3Rpb24gdGFwVGVtcG8oKSB7CiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICB0YXBUaW1lcy5wdXNoKG5vdyk7CiAgCiAgLy8gS2VlcCBsYXN0IDQgdGFwcwogIGlmKHRhcFRpbWVzLmxlbmd0aCA+IDQpIHRhcFRpbWVzLnNoaWZ0KCk7CiAgCiAgaWYodGFwVGltZXMubGVuZ3RoID49IDIpIHsKICAgIGNvbnN0IGRpZmZzID0gW107CiAgICBmb3IobGV0IGk9MTtpPHRhcFRpbWVzLmxlbmd0aDtpKyspIGRpZmZzLnB1c2godGFwVGltZXNbaV0tdGFwVGltZXNbaS0xXSk7CiAgICBjb25zdCBhdmcgPSBkaWZmcy5yZWR1Y2UoKGEsYik9PmErYiwwKSAvIGRpZmZzLmxlbmd0aDsKICAgIGJwbSA9IE1hdGgucm91bmQoNjAwMDAgLyBhdmcpOwogICAgYnBtID0gTWF0aC5tYXgoMzAsIE1hdGgubWluKDMwMCwgYnBtKSk7CiAgICB1cGRhdGVCcG1EaXNwbGF5KCk7CiAgICBhcHBseUJQTSgpOwogIH0KICAKICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFwLWJ0bicpOwogIGJ0bi5jbGFzc0xpc3QuYWRkKCd0YXBwZWQnKTsKICBzZXRUaW1lb3V0KCgpID0+IGJ0bi5jbGFzc0xpc3QucmVtb3ZlKCd0YXBwZWQnKSwgMjAwKTsKICAKICAvLyBSZXNldCB0YXAgaWYgbm8gdGFwIGZvciAzIHNlY29uZHMKICBjbGVhclRpbWVvdXQod2luZG93Ll90YXBSZXNldCk7CiAgd2luZG93Ll90YXBSZXNldCA9IHNldFRpbWVvdXQoKCkgPT4geyB0YXBUaW1lcyA9IFtdOyB9LCAzMDAwKTsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT09PSBUSU1FIFNJR05BVFVSRSA9PT09PT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIGNoYW5nZVRpbWVTaWcoKSB7CiAgYmVhdHNQZXJCYXIgPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZS1zaWcnKS52YWx1ZSk7CiAgYnVpbGRCZWF0TGlnaHRzKCk7CiAgaWYoaXNSdW5uaW5nKSB7CiAgICBjbGVhckludGVydmFsKHNjaGVkdWxlckludGVydmFsKTsKICAgIHN0ZXBDb3VudGVyID0gMDsKICAgIGNvbnN0IG1zUGVyU3RlcCA9ICg2MDAwMCAvIGJwbSkgLyBTVEVQU19QRVJfQkVBVDsKICAgIHNjaGVkdWxlckludGVydmFsID0gc2V0SW50ZXJ2YWwodGljaywgbXNQZXJTdGVwKTsKICAgIHRpY2soKTsKICB9Cn0KCi8vID09PT09PT09PT09PT09PT09PT09PT0gQkVBVCBMSUdIVFMgPT09PT09PT09PT09PT09PT09PT09PQpmdW5jdGlvbiBidWlsZEJlYXRMaWdodHMoKSB7CiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JlYXQtbGlnaHRzJyk7CiAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnOwogIGZvcihsZXQgaT0wO2k8YmVhdHNQZXJCYXI7aSsrKSB7CiAgICBjb25zdCBkb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGRvdC5jbGFzc05hbWUgPSAnYmVhdC1kb3QnICsgKGk9PT0wPycgYWNjZW50JzonJyk7CiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZG90KTsKICB9Cn0KCi8vID09PT09PT09PT09PT09PT09PT09PT0gU1dJTkcgPT09PT09PT09PT09PT09PT09PT09PQpmdW5jdGlvbiB1cGRhdGVTd2luZygpIHsKICBzd2luZ0Ftb3VudCA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3aW5nLXNlbGVjdCcpLnZhbHVlKTsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT09PSBMT0FEIFNJTkdMRSA9PT09PT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIGxvYWRTaW5nbGVTb3VuZChpZHgpIHsKICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgaW5wdXQudHlwZSA9ICdmaWxlJzsKICBpbnB1dC5hY2NlcHQgPSAnYXVkaW8vKic7CiAgaW5wdXQub25jaGFuZ2UgPSBhc3luYyAoZSkgPT4gewogICAgY29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdOwogICAgaWYoIWZpbGUpIHJldHVybjsKICAgIGF3YWl0IGxvYWRBdWRpb0ZpbGUoaWR4LCBmaWxlKTsKICB9OwogIGlucHV0LmNsaWNrKCk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGxvYWRBdWRpb0ZpbGUoaWR4LCBmaWxlKSB7CiAgdHJ5IHsKICAgIGNvbnN0IGN0eCA9IGdldEF1ZGlvQ3R4KCk7CiAgICBjb25zdCBhYiA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKTsKICAgIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IGN0eC5kZWNvZGVBdWRpb0RhdGEoYWIpOwogICAgCiAgICBjb25zdCBwYWQgPSBwYWRzW2lkeF07CiAgICBwYWQuYnVmZmVyID0gYnVmZmVyOwogICAgcGFkLm5hbWUgPSBmaWxlLm5hbWUucmVwbGFjZSgvXC5bXi8uXSskLywnJykuc3Vic3RyaW5nKDAsMTYpLnRvVXBwZXJDYXNlKCk7CiAgICBwYWQubmFtZUVsLnRleHRDb250ZW50ID0gcGFkLm5hbWU7CiAgICBwYWQuZWwuY2xhc3NMaXN0LmFkZCgnbG9hZGVkJyk7CiAgICBwYWQuZWwucXVlcnlTZWxlY3RvcignLnBhZC1pY29uJykudGV4dENvbnRlbnQgPSAn8J+OtSc7CiAgICAKICAgIC8vIFF1aWNrIHByZXZpZXcgZmxhc2gKICAgIGZsYXNoUGFkKGlkeCk7CiAgfSBjYXRjaChlcnIpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgYXVkaW86JywgZXJyKTsKICAgIGFsZXJ0KCdFcnJvcmUgbmVsIGNhcmljYW1lbnRvOiAnICsgZXJyLm1lc3NhZ2UpOwogIH0KfQoKLy8gPT09PT09PT09PT09PT09PT09PT09PSBMT0FEIEZPTERFUiA9PT09PT09PT09PT09PT09PT09PT09CmFzeW5jIGZ1bmN0aW9uIGxvYWRGb2xkZXIoKSB7CiAgaWYoISgnc2hvd0RpcmVjdG9yeVBpY2tlcicgaW4gd2luZG93KSkgewogICAgLy8gRmFsbGJhY2s6IG11bHRpcGxlIGZpbGUgaW5wdXQKICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgIGlucHV0LnR5cGUgPSAnZmlsZSc7CiAgICBpbnB1dC5hY2NlcHQgPSAnYXVkaW8vKic7CiAgICBpbnB1dC5tdWx0aXBsZSA9IHRydWU7CiAgICBpbnB1dC5vbmNoYW5nZSA9IGFzeW5jIChlKSA9PiB7CiAgICAgIGNvbnN0IGZpbGVzID0gQXJyYXkuZnJvbShlLnRhcmdldC5maWxlcykuc29ydCgoYSxiKT0+YS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7CiAgICAgIGNvbnN0IHRvTG9hZCA9IE1hdGgubWluKDEyLCBmaWxlcy5sZW5ndGgpOwogICAgICBmb3IobGV0IGk9MDtpPHRvTG9hZDtpKyspIGF3YWl0IGxvYWRBdWRpb0ZpbGUoaSwgZmlsZXNbaV0pOwogICAgfTsKICAgIGlucHV0LmNsaWNrKCk7CiAgICByZXR1cm47CiAgfQogIAogIHRyeSB7CiAgICBjb25zdCBkaXJIYW5kbGUgPSBhd2FpdCB3aW5kb3cuc2hvd0RpcmVjdG9yeVBpY2tlcih7IHN0YXJ0SW46ICdkb3dubG9hZHMnIH0pOwogICAgY29uc3QgYXVkaW9GaWxlcyA9IFtdOwogICAgCiAgICBmb3IgYXdhaXQgKGNvbnN0IGVudHJ5IG9mIGRpckhhbmRsZS52YWx1ZXMoKSkgewogICAgICBpZihlbnRyeS5raW5kID09PSAnZmlsZScpIHsKICAgICAgICBjb25zdCBmaWxlID0gYXdhaXQgZW50cnkuZ2V0RmlsZSgpOwogICAgICAgIGlmKC9cLihtcDN8d2F2fG9nZ3xtNGF8YWFjfGZsYWN8b3B1c3x3ZWJhKSQvaS50ZXN0KGZpbGUubmFtZSkpIHsKICAgICAgICAgIGF1ZGlvRmlsZXMucHVzaChmaWxlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIAogICAgaWYoIWF1ZGlvRmlsZXMubGVuZ3RoKSB7CiAgICAgIGFsZXJ0KCdOZXNzdW4gZmlsZSBhdWRpbyB0cm92YXRvIScpOwogICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIGF1ZGlvRmlsZXMuc29ydCgoYSxiKT0+YS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7CiAgICBjb25zdCB0b0xvYWQgPSBNYXRoLm1pbigxMiwgYXVkaW9GaWxlcy5sZW5ndGgpOwogICAgCiAgICBmb3IobGV0IGk9MDtpPHRvTG9hZDtpKyspIGF3YWl0IGxvYWRBdWRpb0ZpbGUoaSwgYXVkaW9GaWxlc1tpXSk7CiAgICAKICAgIGlmKGF1ZGlvRmlsZXMubGVuZ3RoID4gMTIpIHsKICAgICAgY29uc29sZS5sb2coYENhcmljYXRpIDEyIHN1ICR7YXVkaW9GaWxlcy5sZW5ndGh9IGZpbGVgKTsKICAgIH0KICB9IGNhdGNoKGVycikgewogICAgaWYoZXJyLm5hbWUgIT09ICdBYm9ydEVycm9yJykgewogICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgIC8vIGZhbGxiYWNrIHRvIG11bHRpIGZpbGUKICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwogICAgICBpbnB1dC50eXBlID0gJ2ZpbGUnOwogICAgICBpbnB1dC5hY2NlcHQgPSAnYXVkaW8vKic7CiAgICAgIGlucHV0Lm11bHRpcGxlID0gdHJ1ZTsKICAgICAgaW5wdXQub25jaGFuZ2UgPSBhc3luYyAoZSkgPT4gewogICAgICAgIGNvbnN0IGZpbGVzID0gQXJyYXkuZnJvbShlLnRhcmdldC5maWxlcykuc29ydCgoYSxiKT0+YS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7CiAgICAgICAgY29uc3QgdG9Mb2FkID0gTWF0aC5taW4oMTIsIGZpbGVzLmxlbmd0aCk7CiAgICAgICAgZm9yKGxldCBpPTA7aTx0b0xvYWQ7aSsrKSBhd2FpdCBsb2FkQXVkaW9GaWxlKGksIGZpbGVzW2ldKTsKICAgICAgfTsKICAgICAgaW5wdXQuY2xpY2soKTsKICAgIH0KICB9Cn0KCi8vID09PT09PT09PT09PT09PT09PT09PT0gQ0xFQVIgPT09PT09PT09PT09PT09PT09PT09PQpmdW5jdGlvbiBjbGVhckFsbCgpIHsKICBpZighY29uZmlybSgnQ2FuY2VsbGFyZSB0dXR0aSBpIHN1b25pIGNhcmljYXRpPycpKSByZXR1cm47CiAgc3RvcE1ldHJvbm9tZSgpOwogIHBhZHMuZm9yRWFjaCgocGFkLCBpKSA9PiB7CiAgICBwYWQuYnVmZmVyID0gbnVsbDsKICAgIHBhZC5uYW1lID0gJyc7CiAgICBwYWQudHJpZ2dlck9uQmVhdCA9IGZhbHNlOwogICAgcGFkLmJlYXREaXYgPSAxOwogICAgcGFkLmVsLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcsJ2JlYXQtYWN0aXZlJyk7CiAgICBwYWQuZWwuc3R5bGUucmVtb3ZlUHJvcGVydHkoJy0tcGFkLWNvbG9yJyk7CiAgICBwYWQubmFtZUVsLnRleHRDb250ZW50ID0gJ0NBUklDQSBTVU9OTyc7CiAgICBwYWQuYmVhdEJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdiZWF0LW9uJyk7CiAgICBwYWQuYmVhdEJ0bi50ZXh0Q29udGVudCA9ICfilrhCRUFUJzsKICAgIHBhZC5iZWF0RGl2TGFiZWwudGV4dENvbnRlbnQgPSAnMToxJzsKICAgIHBhZC5iZWF0RGl2TGFiZWwuc3R5bGUuY29sb3IgPSAncmdiYSgyNTUsMjU1LDI1NSwwLjgpJzsKICAgIHBhZC5lbC5xdWVyeVNlbGVjdG9yKCcucGFkLWljb24nKS50ZXh0Q29udGVudCA9IFBBRF9JQ09OU1tpXTsKICB9KTsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT09PSBLRVlCT0FSRCA9PT09PT09PT09PT09PT09PT09PT09CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4gewogIGNvbnN0IGtleXMgPSBbJ3EnLCd3JywnZScsJ3InLCdhJywncycsJ2QnLCdmJywneicsJ3gnLCdjJywndiddOwogIGNvbnN0IGlkeCA9IGtleXMuaW5kZXhPZihlLmtleS50b0xvd2VyQ2FzZSgpKTsKICBpZihpZHggPj0gMCAmJiBwYWRzW2lkeF0uYnVmZmVyKSB7CiAgICBwbGF5UGFkKGlkeCk7CiAgICBmbGFzaFBhZChpZHgpOwogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogIH0KICBpZihlLmNvZGUgPT09ICdTcGFjZScpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB0b2dnbGVQbGF5KCk7IH0KfSk7CgovLyA9PT09PT09PT09PT09PT09PT09PT09IFNUQVJUID09PT09PT09PT09PT09PT09PT09PT0Kd2luZG93Lm9ubG9hZCA9IGluaXQ7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K", "DJ": "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9Iml0Ij4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgo8dGl0bGU+TWFyYWNhREogUHJvIOKAlCA0LURlY2sgU3lzdGVtPC90aXRsZT4KPHN0eWxlPgo6cm9vdCB7CiAgLS1iZzogIzExMTsKICAtLWRlY2stYmc6ICMxZTFlMWU7CiAgLS1wYW5lbDogIzI1MjUyNTsKICAtLWFjY2VudDogIzAwZmZjYzsKICAtLWFjY2VudDI6ICNmZjhjMDA7CiAgLS1tYXN0ZXI6ICNmZmQ3MDA7CiAgLS1kYW5nZXI6ICNmZjMzMzM7CiAgLS1ibHVlOiAjMjE5NkYzOwogIC0tdGV4dDogI2VlZTsKICAtLWRpbTogIzg4ODsKICAtLWJvcmRlcjogIzNhM2EzYTsKfQoqIHsgYm94LXNpemluZzogYm9yZGVyLWJveDsgfQpib2R5IHsKICBmb250LWZhbWlseTogJ1NlZ29lIFVJJywgc2Fucy1zZXJpZjsKICBiYWNrZ3JvdW5kOiB2YXIoLS1iZyk7CiAgY29sb3I6IHZhcigtLXRleHQpOwogIG1hcmdpbjogMDsKICBwYWRkaW5nOiAxMHB4OwogIG1pbi1oZWlnaHQ6IDEwMHZoOwp9CmgxIHsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICBsZXR0ZXItc3BhY2luZzogM3B4OwogIGNvbG9yOiB2YXIoLS1hY2NlbnQpOwogIG1hcmdpbjogNXB4IDAgMTVweDsKICBmb250LXNpemU6IDEuMnJlbTsKfQouY29uc29sZS1jb250YWluZXIgewogIGRpc3BsYXk6IGdyaWQ7CiAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoNCwgMWZyKTsKICBnYXA6IDEwcHg7CiAgbWF4LXdpZHRoOiAxNjAwcHg7CiAgbWFyZ2luOiAwIGF1dG87Cn0KCi8qID09PSBERUNLID09PSAqLwouZGVjayB7CiAgYmFja2dyb3VuZDogdmFyKC0tZGVjay1iZyk7CiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyKTsKICBib3JkZXItcmFkaXVzOiA4cHg7CiAgcGFkZGluZzogMTBweDsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgZ2FwOiA2cHg7CiAgcG9zaXRpb246IHJlbGF0aXZlOwp9Ci5kZWNrLmFjdGl2ZSB7IGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50KTsgYm94LXNoYWRvdzogMCAwIDhweCAjMDBmZmNjNDQ7IH0KLmRlY2subWFzdGVyLWRlY2sgeyBib3JkZXItY29sb3I6IHZhcigtLW1hc3RlcikgIWltcG9ydGFudDsgYm94LXNoYWRvdzogMCAwIDEycHggI2ZmZDcwMDY2ICFpbXBvcnRhbnQ7IH0KCi5kZWNrLWhlYWRlciB7CiAgZGlzcGxheTogZmxleDsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0tYm9yZGVyKTsKICBwYWRkaW5nLWJvdHRvbTogNnB4OwogIGdhcDogNHB4OwogIGZsZXgtd3JhcDogd3JhcDsKfQouZGVjay10aXRsZSB7IGZvbnQtd2VpZ2h0OiBib2xkOyBjb2xvcjogdmFyKC0tYWNjZW50KTsgZm9udC1zaXplOiAwLjk1cmVtOyB9Ci5tYXN0ZXItYmFkZ2UgewogIGJhY2tncm91bmQ6IHZhcigtLW1hc3Rlcik7CiAgY29sb3I6ICMwMDA7CiAgZm9udC1zaXplOiAwLjZyZW07CiAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgcGFkZGluZzogMnB4IDVweDsKICBib3JkZXItcmFkaXVzOiAzcHg7CiAgZGlzcGxheTogbm9uZTsKfQouZGVjay5tYXN0ZXItZGVjayAubWFzdGVyLWJhZGdlIHsgZGlzcGxheTogaW5saW5lOyB9CgouYnBtLXNlY3Rpb24gewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDRweDsKfQouYnBtLWRpc3BsYXkgewogIGZvbnQtZmFtaWx5OiAnQ291cmllciBOZXcnLCBtb25vc3BhY2U7CiAgZm9udC1zaXplOiAxLjNyZW07CiAgYmFja2dyb3VuZDogIzAwMDsKICBjb2xvcjogdmFyKC0tYWNjZW50KTsKICBwYWRkaW5nOiAzcHggOHB4OwogIGJvcmRlci1yYWRpdXM6IDRweDsKICBib3JkZXI6IDFweCBzb2xpZCAjMzMzOwogIGN1cnNvcjogcG9pbnRlcjsKICBtaW4td2lkdGg6IDU4cHg7CiAgdGV4dC1hbGlnbjogY2VudGVyOwp9Ci5icG0tZGlzcGxheTpob3ZlciB7IGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50KTsgfQoKLnRyYWNrLW5hbWUgewogIGZvbnQtc2l6ZTogMC43NXJlbTsKICBjb2xvcjogI2NjYzsKICB3aGl0ZS1zcGFjZTogbm93cmFwOwogIG92ZXJmbG93OiBoaWRkZW47CiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgaGVpZ2h0OiAxOHB4Owp9CgovKiA9PT0gV0FWRUZPUk0gQ0FOVkFTID09PSAqLwoud2F2ZWZvcm0td3JhcHBlciB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogODBweDsKICBiYWNrZ3JvdW5kOiAjMDAwOwogIGJvcmRlci1yYWRpdXM6IDRweDsKICBvdmVyZmxvdzogaGlkZGVuOwogIGN1cnNvcjogY3Jvc3NoYWlyOwogIGJvcmRlcjogMXB4IHNvbGlkICMzMzM7Cn0KLndhdmVmb3JtLWNhbnZhcyB7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAxMDAlOwogIGRpc3BsYXk6IGJsb2NrOwp9Ci5wbGF5aGVhZCB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogMDsKICB3aWR0aDogMnB4OwogIGhlaWdodDogMTAwJTsKICBiYWNrZ3JvdW5kOiB2YXIoLS1hY2NlbnQpOwogIHBvaW50ZXItZXZlbnRzOiBub25lOwogIGJveC1zaGFkb3c6IDAgMCA0cHggdmFyKC0tYWNjZW50KTsKfQovKiBCZWF0IG1hcmtlcnMgb3ZlcmxheSAqLwouYmVhdC1jYW52YXMgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDA7IGxlZnQ6IDA7CiAgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICBwb2ludGVyLWV2ZW50czogbm9uZTsKfQoKLyogPT09IFRJTUUgRElTUExBWSA9PT0gKi8KLnRpbWUtcm93IHsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICBmb250LWZhbWlseTogJ0NvdXJpZXIgTmV3JywgbW9ub3NwYWNlOwogIGZvbnQtc2l6ZTogMC44cmVtOwogIHBhZGRpbmc6IDJweCA0cHg7CiAgYmFja2dyb3VuZDogIzAwMDsKICBib3JkZXItcmFkaXVzOiA0cHg7Cn0KLnRpbWUtZWxhcHNlZCB7IGNvbG9yOiB2YXIoLS1hY2NlbnQpOyB9Ci50aW1lLXJlbWFpbmluZyB7IGNvbG9yOiB2YXIoLS1hY2NlbnQyKTsgfQoudGltZS10b3RhbCB7IGNvbG9yOiB2YXIoLS1kaW0pOyB9CgovKiA9PT0gQ09OVFJPTFMgPT09ICovCi5jb250cm9scyB7CiAgZGlzcGxheTogZ3JpZDsKICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7CiAgZ2FwOiA1cHg7Cn0KYnV0dG9uIHsKICBwYWRkaW5nOiA3cHggNXB4OwogIGJvcmRlcjogbm9uZTsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgY3Vyc29yOiBwb2ludGVyOwogIGZvbnQtd2VpZ2h0OiBib2xkOwogIGZvbnQtc2l6ZTogMC43MnJlbTsKICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogIHRyYW5zaXRpb246IDAuMTVzOwogIGxldHRlci1zcGFjaW5nOiAwLjVweDsKfQpidXR0b246YWN0aXZlIHsgdHJhbnNmb3JtOiBzY2FsZSgwLjk3KTsgfQouYnRuLXBsYXkgeyBiYWNrZ3JvdW5kOiAjNENBRjUwOyBjb2xvcjogI2ZmZjsgfQouYnRuLXN0b3AgeyBiYWNrZ3JvdW5kOiB2YXIoLS1kYW5nZXIpOyBjb2xvcjogI2ZmZjsgfQouYnRuLXN5bmMgeyBiYWNrZ3JvdW5kOiB2YXIoLS1ibHVlKTsgY29sb3I6ICNmZmY7IH0KLmJ0bi1tYXN0ZXIgeyBiYWNrZ3JvdW5kOiB2YXIoLS1tYXN0ZXIpOyBjb2xvcjogIzAwMDsgfQouYnRuLWN1ZSB7IGJhY2tncm91bmQ6ICM5QzI3QjA7IGNvbG9yOiAjZmZmOyB9Ci5idG4tbG9vcCB7IGJhY2tncm91bmQ6ICNGRjk4MDA7IGNvbG9yOiAjMDAwOyB9Ci5idG4taG90IHsgYmFja2dyb3VuZDogI2U5MWU2MzsgY29sb3I6ICNmZmY7IGZvbnQtc2l6ZTogMC42NXJlbTsgfQoKLmN0cmwtcm93IHsKICBkaXNwbGF5OiBncmlkOwogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDFmciAxZnIgMWZyOwogIGdhcDogNHB4Owp9CgovKiA9PT0gU0xJREVSUyA9PT0gKi8KLnNsaWRlci1ncm91cCB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogIGdhcDogMnB4Owp9CmxhYmVsIHsgZm9udC1zaXplOiAwLjcycmVtOyBjb2xvcjogdmFyKC0tZGltKTsgfQppbnB1dFt0eXBlPXJhbmdlXSB7IHdpZHRoOiAxMDAlOyBjdXJzb3I6IHBvaW50ZXI7IGFjY2VudC1jb2xvcjogdmFyKC0tYWNjZW50KTsgfQppbnB1dFt0eXBlPXJhbmdlXS5vcmFuZ2UgeyBhY2NlbnQtY29sb3I6IHZhcigtLWFjY2VudDIpOyB9CmlucHV0W3R5cGU9cmFuZ2VdLnllbGxvdyB7IGFjY2VudC1jb2xvcjogdmFyKC0tbWFzdGVyKTsgfQoKLyogS2V5IGRpc3BsYXkgKi8KLmtleS1yb3cgewogIGRpc3BsYXk6IGZsZXg7CiAgZ2FwOiA1cHg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBmbGV4LXdyYXA6IHdyYXA7Cn0KLmtleS1iYWRnZSB7CiAgYmFja2dyb3VuZDogIzAwMDsKICBib3JkZXI6IDFweCBzb2xpZCAjNDQ0OwogIGJvcmRlci1yYWRpdXM6IDNweDsKICBwYWRkaW5nOiAycHggNnB4OwogIGZvbnQtc2l6ZTogMC43MnJlbTsKICBjb2xvcjogI2FhYTsKICBtaW4td2lkdGg6IDM4cHg7CiAgdGV4dC1hbGlnbjogY2VudGVyOwp9Ci5rZXktYmFkZ2UuZGV0ZWN0ZWQgeyBjb2xvcjogdmFyKC0tYWNjZW50KTsgYm9yZGVyLWNvbG9yOiB2YXIoLS1hY2NlbnQpOyB9Ci5rZXktbG9jay1idG4gewogIGJhY2tncm91bmQ6ICMzMzM7CiAgY29sb3I6IHZhcigtLWRpbSk7CiAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICBmb250LXNpemU6IDAuNjVyZW07CiAgcGFkZGluZzogMnB4IDZweDsKICBib3JkZXItcmFkaXVzOiAzcHg7CiAgY3Vyc29yOiBwb2ludGVyOwp9Ci5rZXktbG9jay1idG4ubG9ja2VkIHsgYmFja2dyb3VuZDogIzFhNGExYTsgY29sb3I6ICM0Q0FGNTA7IGJvcmRlci1jb2xvcjogIzRDQUY1MDsgfQoKLyogPT09IFBPUFVQIE1PREFMID09PSAqLwoucG9wdXAtb3ZlcmxheSB7CiAgZGlzcGxheTogbm9uZTsKICBwb3NpdGlvbjogZml4ZWQ7CiAgaW5zZXQ6IDA7CiAgYmFja2dyb3VuZDogIzAwMGE7CiAgei1pbmRleDogMTAwMDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogY2VudGVyOwp9Ci5wb3B1cC1vdmVybGF5Lm9wZW4geyBkaXNwbGF5OiBmbGV4OyB9Ci5wb3B1cCB7CiAgYmFja2dyb3VuZDogIzIyMjsKICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1hY2NlbnQpOwogIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgcGFkZGluZzogMjBweDsKICBtaW4td2lkdGg6IDMyMHB4OwogIG1heC13aWR0aDogNDIwcHg7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGJveC1zaGFkb3c6IDAgMCAzMHB4ICMwMGZmY2M0NDsKfQoucG9wdXAgaDMgeyBtYXJnaW46IDAgMCAxNXB4OyBjb2xvcjogdmFyKC0tYWNjZW50KTsgfQoucG9wdXAgbGFiZWwgeyBjb2xvcjogdmFyKC0tZGltKTsgZm9udC1zaXplOiAwLjhyZW07IH0KLnBvcHVwIGlucHV0W3R5cGU9bnVtYmVyXSwgLnBvcHVwIGlucHV0W3R5cGU9cmFuZ2VdLCAucG9wdXAgc2VsZWN0IHsKICB3aWR0aDogMTAwJTsKICBtYXJnaW46IDRweCAwIDEycHg7CiAgcGFkZGluZzogNXB4OwogIGJhY2tncm91bmQ6ICMxMTE7CiAgY29sb3I6IHZhcigtLXRleHQpOwogIGJvcmRlcjogMXB4IHNvbGlkICM0NDQ7CiAgYm9yZGVyLXJhZGl1czogNHB4Owp9Ci5wb3B1cC1jbG9zZSB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogMTBweDsgcmlnaHQ6IDEycHg7CiAgYmFja2dyb3VuZDogbm9uZTsKICBib3JkZXI6IG5vbmU7CiAgY29sb3I6IHZhcigtLWRpbSk7CiAgZm9udC1zaXplOiAxLjJyZW07CiAgY3Vyc29yOiBwb2ludGVyOwogIHBhZGRpbmc6IDA7Cn0KLnBvcHVwLWNsb3NlOmhvdmVyIHsgY29sb3I6IHZhcigtLWRhbmdlcik7IH0KLnBvcHVwLWFjdGlvbnMgewogIGRpc3BsYXk6IGZsZXg7CiAgZ2FwOiA4cHg7CiAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDsKICBtYXJnaW4tdG9wOiAxMHB4Owp9Ci5wb3B1cC1hY3Rpb25zIGJ1dHRvbiB7IHBhZGRpbmc6IDhweCAxNnB4OyB9Ci5idG4tY29uZmlybSB7IGJhY2tncm91bmQ6IHZhcigtLWFjY2VudCk7IGNvbG9yOiAjMDAwOyB9Ci5idG4tY2FuY2VsIHsgYmFja2dyb3VuZDogIzQ0NDsgY29sb3I6ICNmZmY7IH0KCi8qID09PSBCRUFUIEdSSUQgRURJVE9SIChpbnNpZGUgcG9wdXApID09PSAqLwouYmVhdC1vZmZzZXQtZGlzcGxheSB7CiAgZm9udC1mYW1pbHk6ICdDb3VyaWVyIE5ldycsIG1vbm9zcGFjZTsKICBmb250LXNpemU6IDEuMXJlbTsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgY29sb3I6IHZhcigtLWFjY2VudCk7CiAgYmFja2dyb3VuZDogIzAwMDsKICBwYWRkaW5nOiA4cHg7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIG1hcmdpbjogOHB4IDA7Cn0KCi8qID09PSBNSVhFUiA9PT0gKi8KLm1peGVyLXNlY3Rpb24gewogIGdyaWQtY29sdW1uOiAxIC8gLTE7CiAgYmFja2dyb3VuZDogdmFyKC0tcGFuZWwpOwogIHBhZGRpbmc6IDEycHggMjBweDsKICBib3JkZXItcmFkaXVzOiA4cHg7CiAgbWFyZ2luLXRvcDogMTBweDsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgZ2FwOiAyMHB4OwogIGZsZXgtd3JhcDogd3JhcDsKICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXIpOwp9Ci5taXhlci1sYWJlbCB7IGZvbnQtc2l6ZTogMC43NXJlbTsgY29sb3I6IHZhcigtLWRpbSk7IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IH0KCi8qIGZpbGUgaW5wdXQgKi8KaW5wdXRbdHlwZT0iZmlsZSJdIHsKICBmb250LXNpemU6IDAuNzJyZW07CiAgY29sb3I6ICNhYWE7CiAgd2lkdGg6IDEwMCU7Cn0KCi8qIEhvdGN1ZXMgcm93ICovCi5ob3RjdWVzIHsgZGlzcGxheTogZmxleDsgZ2FwOiAzcHg7IGZsZXgtd3JhcDogd3JhcDsgfQouaG90Y3VlLWJ0biB7CiAgd2lkdGg6IDI4cHg7IGhlaWdodDogMjBweDsKICBmb250LXNpemU6IDAuNnJlbTsKICBib3JkZXItcmFkaXVzOiAzcHg7CiAgcGFkZGluZzogMDsKfQoKLyogRVEgcm93ICovCi5lcS1yb3cgewogIGRpc3BsYXk6IGdyaWQ7CiAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyIDFmcjsKICBnYXA6IDRweDsKfQoKQG1lZGlhIChtYXgtd2lkdGg6IDExMDBweCkgeyAuY29uc29sZS1jb250YWluZXIgeyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7IH0gfQpAbWVkaWEgKG1heC13aWR0aDogNjAwcHgpIHsgLmNvbnNvbGUtY29udGFpbmVyIHsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnI7IH0gfQo8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgoKPGgxPvCfjpsgTWFyYWNhREogUHJvIDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC42ZW07Y29sb3I6IzU1NSI+NC1EZWNrIFN5c3RlbTwvc3Bhbj48L2gxPgoKPGRpdiBjbGFzcz0iY29uc29sZS1jb250YWluZXIiIGlkPSJjb25zb2xlIj4KICA8IS0tIERlY2tzIGdlbmVyYXRpIGRhIEpTIC0tPgo8L2Rpdj4KCjwhLS0gUE9QVVAgQlBNIEVESVQgLS0+CjxkaXYgY2xhc3M9InBvcHVwLW92ZXJsYXkiIGlkPSJwb3B1cC1icG0iPgogIDxkaXYgY2xhc3M9InBvcHVwIj4KICAgIDxidXR0b24gY2xhc3M9InBvcHVwLWNsb3NlIiBvbmNsaWNrPSJjbG9zZVBvcHVwKCdwb3B1cC1icG0nKSI+4pyVPC9idXR0b24+CiAgICA8aDM+8J+OtSBNb2RpZmljYSBCUE08L2gzPgogICAgPGxhYmVsPkJQTSByaWxldmF0byAvIG1hbnVhbGU6PC9sYWJlbD4KICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJwb3B1cC1icG0tdmFsIiBtaW49IjQwIiBtYXg9IjMwMCIgc3RlcD0iMC4xIj4KICAgIDxsYWJlbD5SZWdvbGF6aW9uZSBiZWF0IG9mZnNldCAobXMpOjwvbGFiZWw+CiAgICA8ZGl2IGNsYXNzPSJiZWF0LW9mZnNldC1kaXNwbGF5IiBpZD0icG9wdXAtYmVhdC1vZmZzZXQtZGlzcGxheSI+MCBtczwvZGl2PgogICAgPGlucHV0IHR5cGU9InJhbmdlIiBpZD0icG9wdXAtYmVhdC1vZmZzZXQiIG1pbj0iLTUwMCIgbWF4PSI1MDAiIHN0ZXA9IjEiIHZhbHVlPSIwIiBvbmlucHV0PSJ1cGRhdGVCZWF0T2Zmc2V0RGlzcGxheSh0aGlzLnZhbHVlKSI+CiAgICA8ZGl2IGNsYXNzPSJwb3B1cC1hY3Rpb25zIj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLWNhbmNlbCIgb25jbGljaz0iY2xvc2VQb3B1cCgncG9wdXAtYnBtJykiPkFubnVsbGE8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLWNvbmZpcm0iIG9uY2xpY2s9ImNvbmZpcm1CUE0oKSI+QXBwbGljYTwvYnV0dG9uPgogICAgPC9kaXY+CiAgPC9kaXY+CjwvZGl2PgoKPCEtLSBQT1BVUCBLRVkvUElUQ0ggRURJVCAtLT4KPGRpdiBjbGFzcz0icG9wdXAtb3ZlcmxheSIgaWQ9InBvcHVwLWtleSI+CiAgPGRpdiBjbGFzcz0icG9wdXAiPgogICAgPGJ1dHRvbiBjbGFzcz0icG9wdXAtY2xvc2UiIG9uY2xpY2s9ImNsb3NlUG9wdXAoJ3BvcHVwLWtleScpIj7inJU8L2J1dHRvbj4KICAgIDxoMz7wn468IFRvbmFsaXTDoCAmIFBpdGNoPC9oMz4KICAgIDxsYWJlbD5LZXkgTG9jayAobWFudGllbmkgdG9uYWxpdMOgIHNlIGNhbWJpIHZlbG9jaXTDoCk6PC9sYWJlbD4KICAgIDxzZWxlY3QgaWQ9InBvcHVwLWtleWxvY2siPgogICAgICA8b3B0aW9uIHZhbHVlPSIwIj5PRkYg4oCUIHZlbG9jaXTDoCBlIHBpdGNoIGluc2llbWU8L29wdGlvbj4KICAgICAgPG9wdGlvbiB2YWx1ZT0iMSI+T04g4oCUIG1hbnRpZW5pIHRvbmFsaXTDoCBvcmlnaW5hbGU8L29wdGlvbj4KICAgIDwvc2VsZWN0PgogICAgPGxhYmVsPlRyYXNwb3NpemlvbmUgdG9uYWxpdMOgIChzZW1pdG9uaSk6PC9sYWJlbD4KICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6OHB4O2FsaWduLWl0ZW1zOmNlbnRlcjttYXJnaW46NHB4IDAgMTJweCI+CiAgICAgIDxidXR0b24gb25jbGljaz0iYWRqU2VtaXRvbmUoLTEpIiBzdHlsZT0icGFkZGluZzo1cHggMTJweDtiYWNrZ3JvdW5kOiMzMzM7Y29sb3I6I2ZmZjtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjRweDtjdXJzb3I6cG9pbnRlciI+LTE8L2J1dHRvbj4KICAgICAgPGRpdiBpZD0icG9wdXAtc2VtaXRvbmUtZGlzcGxheSIgc3R5bGU9ImZsZXg6MTt0ZXh0LWFsaWduOmNlbnRlcjtmb250LWZhbWlseTptb25vc3BhY2U7Zm9udC1zaXplOjEuMnJlbTtjb2xvcjp2YXIoLS1hY2NlbnQpO2JhY2tncm91bmQ6IzAwMDtib3JkZXItcmFkaXVzOjRweDtwYWRkaW5nOjVweCI+MCBzdDwvZGl2PgogICAgICA8YnV0dG9uIG9uY2xpY2s9ImFkalNlbWl0b25lKCsxKSIgc3R5bGU9InBhZGRpbmc6NXB4IDEycHg7YmFja2dyb3VuZDojMzMzO2NvbG9yOiNmZmY7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo0cHg7Y3Vyc29yOnBvaW50ZXIiPisxPC9idXR0b24+CiAgICA8L2Rpdj4KICAgIDxsYWJlbD5BZ2dpdXN0YW1lbnRvIGNlbnRzICjCsTEwMMKiID0gMSBzZW1pdG9ubyk6PC9sYWJlbD4KICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjZweDttYXJnaW46NHB4IDAgMTJweCI+CiAgICAgIDxpbnB1dCB0eXBlPSJyYW5nZSIgaWQ9InBvcHVwLWNlbnRzIiBtaW49Ii0xMDAiIG1heD0iMTAwIiBzdGVwPSIxIiB2YWx1ZT0iMCIgb25pbnB1dD0idXBkYXRlQ2VudHNEaXNwbGF5KHRoaXMudmFsdWUpIiBzdHlsZT0iZmxleDoxIj4KICAgICAgPHNwYW4gaWQ9InBvcHVwLWNlbnRzLWRpc3BsYXkiIHN0eWxlPSJmb250LWZhbWlseTptb25vc3BhY2U7Y29sb3I6dmFyKC0tYWNjZW50Mik7bWluLXdpZHRoOjUwcHg7dGV4dC1hbGlnbjpyaWdodCI+MCDCojwvc3Bhbj4KICAgIDwvZGl2PgogICAgPGxhYmVsPlRvbmFsaXTDoCByaWxldmF0YTo8L2xhYmVsPgogICAgPGRpdiBpZD0icG9wdXAta2V5LW9yaWdpbmFsIiBzdHlsZT0iZm9udC1mYW1pbHk6bW9ub3NwYWNlO2NvbG9yOnZhcigtLWFjY2VudCk7YmFja2dyb3VuZDojMDAwO3BhZGRpbmc6NnB4O2JvcmRlci1yYWRpdXM6NHB4O21hcmdpbi1ib3R0b206MTJweDt0ZXh0LWFsaWduOmNlbnRlciI+4oCUPC9kaXY+CiAgICA8bGFiZWw+VG9uYWxpdMOgIHJpc3VsdGFudGU6PC9sYWJlbD4KICAgIDxkaXYgaWQ9InBvcHVwLWtleS1yZXN1bHQiIHN0eWxlPSJmb250LWZhbWlseTptb25vc3BhY2U7Y29sb3I6dmFyKC0tYWNjZW50Mik7YmFja2dyb3VuZDojMDAwO3BhZGRpbmc6NnB4O2JvcmRlci1yYWRpdXM6NHB4O21hcmdpbi1ib3R0b206MTJweDt0ZXh0LWFsaWduOmNlbnRlciI+4oCUPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJwb3B1cC1hY3Rpb25zIj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLWNhbmNlbCIgb25jbGljaz0icmVzZXRLZXkoKSI+UmVzZXQ8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLWNvbmZpcm0iIG9uY2xpY2s9ImNvbmZpcm1LZXkoKSI+QXBwbGljYTwvYnV0dG9uPgogICAgPC9kaXY+CiAgPC9kaXY+CjwvZGl2PgoKPCEtLSBQT1BVUCBCRUFUIE1BTlVBTCBPRkZTRVQgLS0+CjxkaXYgY2xhc3M9InBvcHVwLW92ZXJsYXkiIGlkPSJwb3B1cC1iZWF0Ij4KICA8ZGl2IGNsYXNzPSJwb3B1cCI+CiAgICA8YnV0dG9uIGNsYXNzPSJwb3B1cC1jbG9zZSIgb25jbGljaz0iY2xvc2VQb3B1cCgncG9wdXAtYmVhdCcpIj7inJU8L2J1dHRvbj4KICAgIDxoMz7wn6WBIFNwb3N0YW1lbnRvIEJlYXQgTWFudWFsZTwvaDM+CiAgICA8cCBzdHlsZT0iZm9udC1zaXplOjAuOHJlbTtjb2xvcjp2YXIoLS1kaW0pIj5DbGljY2Egc3VsbGEgZm9ybWEgZCdvbmRhIHBlciBpbXBvc3RhcmUgaWwgcHJpbW8gYmVhdCwgb3BwdXJlIHVzYSBpIGNvbnRyb2xsaSBzb3R0by48L3A+CiAgICA8bGFiZWw+T2Zmc2V0IHByaW1vIGJlYXQgKG1zKTo8L2xhYmVsPgogICAgPGRpdiBjbGFzcz0iYmVhdC1vZmZzZXQtZGlzcGxheSIgaWQ9InBvcHVwLW1hbnVhbC1iZWF0LWRpc3BsYXkiPjAgbXM8L2Rpdj4KICAgIDxpbnB1dCB0eXBlPSJyYW5nZSIgaWQ9InBvcHVwLW1hbnVhbC1iZWF0IiBtaW49Ii0yMDAwIiBtYXg9IjIwMDAiIHN0ZXA9IjEwIiB2YWx1ZT0iMCIgb25pbnB1dD0idXBkYXRlTWFudWFsQmVhdERpc3BsYXkodGhpcy52YWx1ZSkiPgogICAgPGxhYmVsPk51ZGdlIChzcG9zdGEgYmVhdCDCsTEwbXMpOjwvbGFiZWw+CiAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjhweDttYXJnaW46NnB4IDAiPgogICAgICA8YnV0dG9uIG9uY2xpY2s9Im51ZGdlQmVhdCgtMTAwKSIgc3R5bGU9ImZsZXg6MTtiYWNrZ3JvdW5kOiMzMzM7Y29sb3I6I2ZmZjtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjRweDtwYWRkaW5nOjZweDtjdXJzb3I6cG9pbnRlciI+4peA4peAIC0xMDBtczwvYnV0dG9uPgogICAgICA8YnV0dG9uIG9uY2xpY2s9Im51ZGdlQmVhdCgtMTApIiBzdHlsZT0iZmxleDoxO2JhY2tncm91bmQ6IzMzMztjb2xvcjojZmZmO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6NHB4O3BhZGRpbmc6NnB4O2N1cnNvcjpwb2ludGVyIj7il4AgLTEwbXM8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJudWRnZUJlYXQoMTApIiBzdHlsZT0iZmxleDoxO2JhY2tncm91bmQ6IzMzMztjb2xvcjojZmZmO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6NHB4O3BhZGRpbmc6NnB4O2N1cnNvcjpwb2ludGVyIj4rMTBtcyDilrY8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJudWRnZUJlYXQoMTAwKSIgc3R5bGU9ImZsZXg6MTtiYWNrZ3JvdW5kOiMzMzM7Y29sb3I6I2ZmZjtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjRweDtwYWRkaW5nOjZweDtjdXJzb3I6cG9pbnRlciI+KzEwMG1zIOKWtuKWtjwvYnV0dG9uPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJwb3B1cC1hY3Rpb25zIj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLWNhbmNlbCIgb25jbGljaz0iY2xvc2VQb3B1cCgncG9wdXAtYmVhdCcpIj5DaGl1ZGk8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLWNvbmZpcm0iIG9uY2xpY2s9ImNvbmZpcm1CZWF0KCkiPkFwcGxpY2E8L2J1dHRvbj4KICAgIDwvZGl2PgogIDwvZGl2Pgo8L2Rpdj4KCjxzY3JpcHQ+Ci8vID09PT09PT09PT09PT09PT09PT0gQVVESU8gQ09OVEVYVCA9PT09PT09PT09PT09PT09PT09CmNvbnN0IEF1ZGlvQ29udGV4dCA9IHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dDsKY29uc3QgY3R4ID0gbmV3IEF1ZGlvQ29udGV4dCgpOwpjb25zdCBtYXN0ZXJHYWluID0gY3R4LmNyZWF0ZUdhaW4oKTsKbWFzdGVyR2Fpbi5nYWluLnZhbHVlID0gMC44OwptYXN0ZXJHYWluLmNvbm5lY3QoY3R4LmRlc3RpbmF0aW9uKTsKCmxldCBtYXN0ZXJEZWNrSW5kZXggPSAwOyAvLyBjaGkgw6ggaWwgbWFzdGVyCgpjb25zdCBOT1RFX05BTUVTID0gWydDJywnQyMnLCdEJywnRCMnLCdFJywnRicsJ0YjJywnRycsJ0cjJywnQScsJ0EjJywnQiddOwoKLy8gPT09PT09PT09PT09PT09PT09PSBERUNLIFNUQVRFID09PT09PT09PT09PT09PT09PT0KY29uc3QgZGVja3MgPSBBcnJheS5mcm9tKHtsZW5ndGg6IDR9LCAoXywgaSkgPT4gKHsKICBidWZmZXI6IG51bGwsIHNvdXJjZTogbnVsbCwKICBnYWluTm9kZTogbnVsbCwgYW5hbHlzZXJOb2RlOiBudWxsLAogIGVxTG93OiBudWxsLCBlcU1pZDogbnVsbCwgZXFIaWdoOiBudWxsLAogIHBpdGNoTm9kZTogbnVsbCwKICBicG06IDAsIG9yaWdpbmFsQnBtOiAwLAogIGlzUGxheWluZzogZmFsc2UsCiAgc3BlZWQ6IDEuMCwKICBrZXlMb2NrOiBmYWxzZSwKICBzZW1pdG9uZXM6IDAsCiAgY2VudHM6IDAsCiAgYmVhdE9mZnNldDogMCwgICAgICAgLy8gbXMgb2Zmc2V0IGZvciBiZWF0IGdyaWQKICBzdGFydFRpbWU6IDAsICAgICAgICAvLyBBdWRpb0NvbnRleHQgdGltZSB3aGVuIHBsYXliYWNrIHN0YXJ0ZWQKICBwYXVzZVBvc2l0aW9uOiAwLCAgICAvLyBwb3NpdGlvbiBpbiBidWZmZXIgd2hlbiBwYXVzZWQKICBkdXJhdGlvbjogMCwKICB3YXZlZm9ybURhdGE6IG51bGwsCiAgYmVhdHM6IFtdLCAgICAgICAgICAgLy8gZGV0ZWN0ZWQgYmVhdCBwb3NpdGlvbnMgaW4gc2Vjb25kcwogIGhvdGN1ZXM6IFtudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsXSwKICBsb29wU3RhcnQ6IG51bGwsIGxvb3BFbmQ6IG51bGwsIGxvb3BBY3RpdmU6IGZhbHNlLAogIGRldGVjdGVkS2V5OiBudWxsLAogIGFuaW1GcmFtZTogbnVsbAp9KSk7CgpsZXQgcG9wdXBEZWNrID0gMDsKCi8vID09PT09PT09PT09PT09PT09PT0gQlVJTEQgVUkgPT09PT09PT09PT09PT09PT09PQpjb25zdCBERUNLX05BTUVTID0gWydBJywnQicsJ0MnLCdEJ107CmNvbnN0IGNvbG9ycyA9IFsnIzAwZmZjYycsJyNmZjhjMDAnLCcjZTA0MGZiJywnIzQwYzRmZiddOwoKZnVuY3Rpb24gYnVpbGREZWNrcygpIHsKICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uc29sZScpOwogIERFQ0tfTkFNRVMuZm9yRWFjaCgobmFtZSwgaSkgPT4gewogICAgY29udGFpbmVyLmlubmVySFRNTCArPSBgCiAgICA8ZGl2IGNsYXNzPSJkZWNrIiBpZD0iZGVjay0ke2l9Ij4KICAgICAgPGRpdiBjbGFzcz0iZGVjay1oZWFkZXIiPgogICAgICAgIDxzcGFuIGNsYXNzPSJkZWNrLXRpdGxlIiBzdHlsZT0iY29sb3I6JHtjb2xvcnNbaV19Ij5ERUNLICR7bmFtZX08L3NwYW4+CiAgICAgICAgPHNwYW4gY2xhc3M9Im1hc3Rlci1iYWRnZSIgaWQ9Im1hc3Rlci1iYWRnZS0ke2l9Ij7imIUgTUFTVEVSPC9zcGFuPgogICAgICAgIDxkaXYgY2xhc3M9ImJwbS1zZWN0aW9uIj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJicG0tZGlzcGxheSIgaWQ9ImJwbS0ke2l9IiB0aXRsZT0iQ2xpY2sgcGVyIG1vZGlmaWNhcmUgQlBNIiBvbmNsaWNrPSJvcGVuQnBtUG9wdXAoJHtpfSkiPi0tPC9zcGFuPgogICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLW1hc3RlciIgaWQ9ImJ0bi1tYXN0ZXItJHtpfSIgb25jbGljaz0ic2V0TWFzdGVyRGVjaygke2l9KSIgc3R5bGU9ImZvbnQtc2l6ZTowLjZyZW07cGFkZGluZzozcHggNnB4OyR7aT09PTA/Jyc6J29wYWNpdHk6MC41J30iPk08L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgYWNjZXB0PSJhdWRpby8qIiBvbmNoYW5nZT0ibG9hZFRyYWNrKCR7aX0sIHRoaXMpIj4KICAgICAgPGRpdiBjbGFzcz0idHJhY2stbmFtZSIgaWQ9InRyYWNrLW5hbWUtJHtpfSI+TmVzc3VuYSB0cmFjY2lhPC9kaXY+CgogICAgICA8IS0tIFdBVkVGT1JNIC0tPgogICAgICA8ZGl2IGNsYXNzPSJ3YXZlZm9ybS13cmFwcGVyIiBpZD0id2Ytd3JhcC0ke2l9IiBvbmNsaWNrPSJzZWVrQnlDbGljaygke2l9LCBldmVudCkiPgogICAgICAgIDxjYW52YXMgY2xhc3M9IndhdmVmb3JtLWNhbnZhcyIgaWQ9IndmLSR7aX0iPjwvY2FudmFzPgogICAgICAgIDxjYW52YXMgY2xhc3M9ImJlYXQtY2FudmFzIiBpZD0iYmVhdGNhbnZhcy0ke2l9Ij48L2NhbnZhcz4KICAgICAgICA8ZGl2IGNsYXNzPSJwbGF5aGVhZCIgaWQ9InBsYXloZWFkLSR7aX0iIHN0eWxlPSJsZWZ0OjAlIj48L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8IS0tIFRJTUUgUk9XIC0tPgogICAgICA8ZGl2IGNsYXNzPSJ0aW1lLXJvdyI+CiAgICAgICAgPHNwYW4gY2xhc3M9InRpbWUtZWxhcHNlZCIgaWQ9InRpbWUtZWxhcHNlZC0ke2l9Ij4wOjAwLjA8L3NwYW4+CiAgICAgICAgPHNwYW4gY2xhc3M9InRpbWUtdG90YWwiIGlkPSJ0aW1lLXRvdGFsLSR7aX0iPjA6MDA8L3NwYW4+CiAgICAgICAgPHNwYW4gY2xhc3M9InRpbWUtcmVtYWluaW5nIiBpZD0idGltZS1yZW1haW5pbmctJHtpfSI+LTA6MDAuMDwvc3Bhbj4KICAgICAgPC9kaXY+CgogICAgICA8IS0tIENPTlRST0xTIC0tPgogICAgICA8ZGl2IGNsYXNzPSJjb250cm9scyI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLXBsYXkiIG9uY2xpY2s9InBsYXlEZWNrKCR7aX0pIiBpZD0iYnRuLXBsYXktJHtpfSI+4pa2IFBsYXk8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4tc3RvcCIgb25jbGljaz0ic3RvcERlY2soJHtpfSkiPuKWoCBTdG9wPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLWN1ZSIgb25jbGljaz0ic2V0Q3VlKCR7aX0pIj5DVUU8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4tc3luYyIgb25jbGljaz0ic3luY0RlY2soJHtpfSkiPlNZTkM8L2J1dHRvbj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJjdHJsLXJvdyI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLWxvb3AiIG9uY2xpY2s9InRvZ2dsZUxvb3AoJHtpfSkiIGlkPSJidG4tbG9vcC0ke2l9IiBzdHlsZT0iZ3JpZC1jb2x1bW46c3BhbiAyIj5MT09QPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJvcGVuQmVhdFBvcHVwKCR7aX0pIiBzdHlsZT0iYmFja2dyb3VuZDojMzMzO2NvbG9yOiNhYWE7Zm9udC1zaXplOjAuNjVyZW07Ij5CRUFUPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJvcGVuS2V5UG9wdXAoJHtpfSkiIHN0eWxlPSJiYWNrZ3JvdW5kOiMzMzM7Y29sb3I6I2FhYTtmb250LXNpemU6MC42NXJlbTsiIGlkPSJidG4ta2V5LSR7aX0iPktFWTwvYnV0dG9uPgogICAgICA8L2Rpdj4KCiAgICAgIDwhLS0gSE9UQ1VFUyAtLT4KICAgICAgPGRpdiBjbGFzcz0iaG90Y3VlcyIgaWQ9ImhvdGN1ZXMtJHtpfSI+CiAgICAgICAgJHtBcnJheS5mcm9tKHtsZW5ndGg6OH0sKF8saCk9PmA8YnV0dG9uIGNsYXNzPSJob3RjdWUtYnRuIGJ0bi1ob3QiIG9uY2xpY2s9ImhvdGN1ZUFjdGlvbigke2l9LCR7aH0pIiBpZD0iaGMtJHtpfS0ke2h9IiB0aXRsZT0iSG90Q3VlICR7aCsxfSI+JHtoKzF9PC9idXR0b24+YCkuam9pbignJyl9CiAgICAgIDwvZGl2PgoKICAgICAgPCEtLSBLRVkgZGlzcGxheSAtLT4KICAgICAgPGRpdiBjbGFzcz0ia2V5LXJvdyI+CiAgICAgICAgPHNwYW4gY2xhc3M9ImtleS1iYWRnZSIgaWQ9ImtleS1kZXRlY3RlZC0ke2l9Ij7igJQ8L3NwYW4+CiAgICAgICAgPHNwYW4gY2xhc3M9ImtleS1iYWRnZSIgaWQ9ImtleS1yZXN1bHQtJHtpfSIgc3R5bGU9ImNvbG9yOnZhcigtLWFjY2VudDIpIj7igJQ8L3NwYW4+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0ia2V5LWxvY2stYnRuIiBpZD0ia2V5bG9jay1idG4tJHtpfSIgb25jbGljaz0idG9nZ2xlS2V5TG9jaygke2l9KSI+8J+UkyBMT0NLPC9idXR0b24+CiAgICAgIDwvZGl2PgoKICAgICAgPCEtLSBTUEVFRCAvIFBJVENIIC0tPgogICAgICA8ZGl2IGNsYXNzPSJzbGlkZXItZ3JvdXAiPgogICAgICAgIDxsYWJlbD5WZWxvY2l0w6AgQlBNICg8c3BhbiBpZD0icmF0ZS12YWwtJHtpfSI+MS4wMDwvc3Bhbj54IOKAlCA8c3BhbiBpZD0iYnBtLWxpdmUtJHtpfSIgc3R5bGU9ImNvbG9yOiR7Y29sb3JzW2ldfSI+LS08L3NwYW4+IEJQTSk8L2xhYmVsPgogICAgICAgIDxpbnB1dCB0eXBlPSJyYW5nZSIgY2xhc3M9Im9yYW5nZSIgbWluPSIwLjUiIG1heD0iMi4wIiBzdGVwPSIwLjAwMSIgdmFsdWU9IjEiIGlkPSJzcGVlZC1zbGlkZXItJHtpfSIgb25pbnB1dD0ic2V0U3BlZWQoJHtpfSwgdGhpcy52YWx1ZSkiPgogICAgICA8L2Rpdj4KCiAgICAgIDwhLS0gRVEgLS0+CiAgICAgIDxkaXYgY2xhc3M9ImVxLXJvdyI+CiAgICAgICAgPGRpdiBjbGFzcz0ic2xpZGVyLWdyb3VwIj4KICAgICAgICAgIDxsYWJlbD5MT1cgPHNwYW4gaWQ9ImVxLWxvdy12YWwtJHtpfSI+MDwvc3Bhbj5kQjwvbGFiZWw+CiAgICAgICAgICA8aW5wdXQgdHlwZT0icmFuZ2UiIG1pbj0iLTE1IiBtYXg9IjYiIHN0ZXA9IjAuNSIgdmFsdWU9IjAiIG9uaW5wdXQ9InNldEVRKCR7aX0sJ2xvdycsdGhpcy52YWx1ZSkiPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InNsaWRlci1ncm91cCI+CiAgICAgICAgICA8bGFiZWw+TUlEIDxzcGFuIGlkPSJlcS1taWQtdmFsLSR7aX0iPjA8L3NwYW4+ZEI8L2xhYmVsPgogICAgICAgICAgPGlucHV0IHR5cGU9InJhbmdlIiBtaW49Ii0xNSIgbWF4PSI2IiBzdGVwPSIwLjUiIHZhbHVlPSIwIiBvbmlucHV0PSJzZXRFUSgke2l9LCdtaWQnLHRoaXMudmFsdWUpIj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJzbGlkZXItZ3JvdXAiPgogICAgICAgICAgPGxhYmVsPkhJR0ggPHNwYW4gaWQ9ImVxLWhpZ2gtdmFsLSR7aX0iPjA8L3NwYW4+ZEI8L2xhYmVsPgogICAgICAgICAgPGlucHV0IHR5cGU9InJhbmdlIiBtaW49Ii0xNSIgbWF4PSI2IiBzdGVwPSIwLjUiIHZhbHVlPSIwIiBvbmlucHV0PSJzZXRFUSgke2l9LCdoaWdoJyx0aGlzLnZhbHVlKSI+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPCEtLSBWT0xVTUUgLS0+CiAgICAgIDxkaXYgY2xhc3M9InNsaWRlci1ncm91cCI+CiAgICAgICAgPGxhYmVsPlZvbHVtZTwvbGFiZWw+CiAgICAgICAgPGlucHV0IHR5cGU9InJhbmdlIiBjbGFzcz0ieWVsbG93IiBtaW49IjAiIG1heD0iMSIgc3RlcD0iMC4wMSIgdmFsdWU9IjEiIG9uaW5wdXQ9InNldFZvbHVtZSgke2l9LCB0aGlzLnZhbHVlKSI+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+YDsKICB9KTsKCiAgLy8gTWl4ZXIKICBjb250YWluZXIuaW5uZXJIVE1MICs9IGAKICA8ZGl2IGNsYXNzPSJtaXhlci1zZWN0aW9uIj4KICAgIDxkaXY+CiAgICAgIDxkaXYgY2xhc3M9Im1peGVyLWxhYmVsIj5NYXN0ZXIgVm9sPC9kaXY+CiAgICAgIDxpbnB1dCB0eXBlPSJyYW5nZSIgbWluPSIwIiBtYXg9IjEiIHN0ZXA9IjAuMDEiIHZhbHVlPSIwLjgiIG9uaW5wdXQ9InNldE1hc3RlclZvbHVtZSh0aGlzLnZhbHVlKSIgc3R5bGU9IndpZHRoOjEyMHB4O2FjY2VudC1jb2xvcjp2YXIoLS1tYXN0ZXIpIj4KICAgIDwvZGl2PgogICAgPGRpdiBzdHlsZT0iZmxleDoxO21heC13aWR0aDo1MDBweCI+CiAgICAgIDxkaXYgY2xhc3M9Im1peGVyLWxhYmVsIiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXIiPkNyb3NzZmFkZXIgQSDihpDihpIgQjwvZGl2PgogICAgICA8aW5wdXQgdHlwZT0icmFuZ2UiIG1pbj0iMCIgbWF4PSIxIiBzdGVwPSIwLjAxIiB2YWx1ZT0iMC41IiBvbmlucHV0PSJzZXRDcm9zc2ZhZGVyKHRoaXMudmFsdWUpIiBzdHlsZT0id2lkdGg6MTAwJTthY2NlbnQtY29sb3I6dmFyKC0tYWNjZW50KSI+CiAgICA8L2Rpdj4KICA8L2Rpdj5gOwoKICAvLyBJbml0IGF1ZGlvIG5vZGVzCiAgZGVja3MuZm9yRWFjaCgoZCwgaSkgPT4gewogICAgZC5nYWluTm9kZSA9IGN0eC5jcmVhdGVHYWluKCk7CiAgICBkLmFuYWx5c2VyTm9kZSA9IGN0eC5jcmVhdGVBbmFseXNlcigpOwogICAgZC5lcUxvdyA9IGN0eC5jcmVhdGVCaXF1YWRGaWx0ZXIoKTsgZC5lcUxvdy50eXBlID0gJ2xvd3NoZWxmJzsgZC5lcUxvdy5mcmVxdWVuY3kudmFsdWUgPSAyMDA7CiAgICBkLmVxTWlkID0gY3R4LmNyZWF0ZUJpcXVhZEZpbHRlcigpOyBkLmVxTWlkLnR5cGUgPSAncGVha2luZyc7IGQuZXFNaWQuZnJlcXVlbmN5LnZhbHVlID0gMTAwMDsgZC5lcU1pZC5RLnZhbHVlID0gMC41OwogICAgZC5lcUhpZ2ggPSBjdHguY3JlYXRlQmlxdWFkRmlsdGVyKCk7IGQuZXFIaWdoLnR5cGUgPSAnaGlnaHNoZWxmJzsgZC5lcUhpZ2guZnJlcXVlbmN5LnZhbHVlID0gNjAwMDsKICAgIC8vIGNoYWluOiBnYWluIOKGkiBlcSDihpIgYW5hbHlzZXIg4oaSIG1hc3RlcgogICAgZC5nYWluTm9kZS5jb25uZWN0KGQuZXFMb3cpOwogICAgZC5lcUxvdy5jb25uZWN0KGQuZXFNaWQpOwogICAgZC5lcU1pZC5jb25uZWN0KGQuZXFIaWdoKTsKICAgIGQuZXFIaWdoLmNvbm5lY3QoZC5hbmFseXNlck5vZGUpOwogICAgZC5hbmFseXNlck5vZGUuY29ubmVjdChtYXN0ZXJHYWluKTsKICB9KTsKICB1cGRhdGVNYXN0ZXJVSSgpOwp9CmJ1aWxkRGVja3MoKTsKCi8vID09PT09PT09PT09PT09PT09PT0gTUFTVEVSID09PT09PT09PT09PT09PT09PT0KZnVuY3Rpb24gc2V0TWFzdGVyRGVjayhpbmRleCkgewogIG1hc3RlckRlY2tJbmRleCA9IGluZGV4OwogIHVwZGF0ZU1hc3RlclVJKCk7Cn0KZnVuY3Rpb24gdXBkYXRlTWFzdGVyVUkoKSB7CiAgZGVja3MuZm9yRWFjaCgoXywgaSkgPT4gewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGRlY2stJHtpfWApLmNsYXNzTGlzdC50b2dnbGUoJ21hc3Rlci1kZWNrJywgaSA9PT0gbWFzdGVyRGVja0luZGV4KTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBtYXN0ZXItYmFkZ2UtJHtpfWApLnN0eWxlLmRpc3BsYXkgPSBpID09PSBtYXN0ZXJEZWNrSW5kZXggPyAnaW5saW5lJyA6ICdub25lJzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBidG4tbWFzdGVyLSR7aX1gKS5zdHlsZS5vcGFjaXR5ID0gaSA9PT0gbWFzdGVyRGVja0luZGV4ID8gJzEnIDogJzAuNCc7CiAgfSk7CiAgLy8gVXBkYXRlIGFsbCBzeW5jIGJ1dHRvbnMKICBERUNLX05BTUVTLmZvckVhY2goKF8sIGkpID0+IHsKICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNkZWNrLSR7aX0gLmJ0bi1zeW5jYCk7CiAgICBpZiAoYnRuKSBidG4udGl0bGUgPSBgU3luYyBhbCBNYXN0ZXIgKERlY2sgJHtERUNLX05BTUVTW21hc3RlckRlY2tJbmRleF19KWA7CiAgfSk7Cn0KCi8vID09PT09PT09PT09PT09PT09PT0gTE9BRCBUUkFDSyA9PT09PT09PT09PT09PT09PT09CmFzeW5jIGZ1bmN0aW9uIGxvYWRUcmFjayhkZWNrSW5kZXgsIGlucHV0RWxlbWVudCkgewogIGNvbnN0IGZpbGUgPSBpbnB1dEVsZW1lbnQuZmlsZXNbMF07CiAgaWYgKCFmaWxlKSByZXR1cm47CiAgaWYgKGN0eC5zdGF0ZSA9PT0gJ3N1c3BlbmRlZCcpIGN0eC5yZXN1bWUoKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgdHJhY2stbmFtZS0ke2RlY2tJbmRleH1gKS5pbm5lclRleHQgPSBmaWxlLm5hbWU7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGRlY2stJHtkZWNrSW5kZXh9YCkuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CgogIGNvbnN0IGFyckJ1ZiA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKTsKICBjdHguZGVjb2RlQXVkaW9EYXRhKGFyckJ1ZiwgKGJ1ZmZlcikgPT4gewogICAgY29uc3QgZCA9IGRlY2tzW2RlY2tJbmRleF07CiAgICBkLmJ1ZmZlciA9IGJ1ZmZlcjsKICAgIGQuZHVyYXRpb24gPSBidWZmZXIuZHVyYXRpb247CiAgICBkLnBhdXNlUG9zaXRpb24gPSAwOwogICAgZC5ob3RjdWVzID0gW251bGwsbnVsbCxudWxsLG51bGwsbnVsbCxudWxsLG51bGwsbnVsbF07CiAgICBkLmxvb3BTdGFydCA9IG51bGw7IGQubG9vcEVuZCA9IG51bGw7IGQubG9vcEFjdGl2ZSA9IGZhbHNlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHRpbWUtdG90YWwtJHtkZWNrSW5kZXh9YCkudGV4dENvbnRlbnQgPSBmb3JtYXRUaW1lKGJ1ZmZlci5kdXJhdGlvbik7CiAgICAKICAgIC8vIEJQTQogICAgY29uc3QgYnBtID0gZGV0ZWN0QlBNKGJ1ZmZlcik7CiAgICBkLmJwbSA9IGJwbTsgZC5vcmlnaW5hbEJwbSA9IGJwbTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBicG0tJHtkZWNrSW5kZXh9YCkuaW5uZXJUZXh0ID0gYnBtLnRvRml4ZWQoMSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYnBtLWxpdmUtJHtkZWNrSW5kZXh9YCkuaW5uZXJUZXh0ID0gKGJwbSAqIGQuc3BlZWQpLnRvRml4ZWQoMSk7CiAgICAKICAgIC8vIERldGVjdCBiZWF0cwogICAgZC5iZWF0cyA9IGRldGVjdEJlYXRzKGJ1ZmZlciwgYnBtLCBkLmJlYXRPZmZzZXQpOwogICAgCiAgICAvLyBLZXkgZGV0ZWN0aW9uIChzaW1wbGlmaWVkKQogICAgZC5kZXRlY3RlZEtleSA9IGRldGVjdEtleShidWZmZXIpOwogICAgdXBkYXRlS2V5RGlzcGxheShkZWNrSW5kZXgpOwogICAgCiAgICAvLyBEcmF3IHdhdmVmb3JtCiAgICBidWlsZFdhdmVmb3JtKGRlY2tJbmRleCwgYnVmZmVyKTsKICAgIGRyYXdCZWF0TWFya2VycyhkZWNrSW5kZXgpOwogIH0sIChlKSA9PiB7IGNvbnNvbGUuZXJyb3IoIkRlY29kZSBlcnJvciIsIGUpOyBhbGVydCgiRXJyb3JlIG5lbGxhIGRlY29kaWZpY2EgYXVkaW8uIik7IH0pOwp9CgovLyA9PT09PT09PT09PT09PT09PT09IFdBVkVGT1JNID09PT09PT09PT09PT09PT09PT0KZnVuY3Rpb24gYnVpbGRXYXZlZm9ybShkZWNrSW5kZXgsIGJ1ZmZlcikgewogIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGB3Zi0ke2RlY2tJbmRleH1gKTsKICBjb25zdCB3cmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHdmLXdyYXAtJHtkZWNrSW5kZXh9YCk7CiAgY2FudmFzLndpZHRoID0gd3JhcC5vZmZzZXRXaWR0aCB8fCAzMDA7CiAgY2FudmFzLmhlaWdodCA9IDgwOwogIGNvbnN0IGMgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAKICBjb25zdCBkYXRhID0gYnVmZmVyLmdldENoYW5uZWxEYXRhKDApOwogIGNvbnN0IHcgPSBjYW52YXMud2lkdGgsIGggPSBjYW52YXMuaGVpZ2h0OwogIGNvbnN0IHN0ZXAgPSBNYXRoLmNlaWwoZGF0YS5sZW5ndGggLyB3KTsKICBjb25zdCBjb2xvciA9IGNvbG9yc1tkZWNrSW5kZXhdOwogIAogIGMuY2xlYXJSZWN0KDAsIDAsIHcsIGgpOwogIAogIC8vIEJhY2tncm91bmQgZ3JhZGllbnQKICBjb25zdCBncmFkID0gYy5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCAwLCBoKTsKICBncmFkLmFkZENvbG9yU3RvcCgwLCAnIzExMScpOwogIGdyYWQuYWRkQ29sb3JTdG9wKDAuNSwgJyMxYTFhMWEnKTsKICBncmFkLmFkZENvbG9yU3RvcCgxLCAnIzExMScpOwogIGMuZmlsbFN0eWxlID0gZ3JhZDsKICBjLmZpbGxSZWN0KDAsIDAsIHcsIGgpOwogIAogIC8vIENlbnRlciBsaW5lCiAgYy5zdHJva2VTdHlsZSA9ICcjMzMzJzsKICBjLmxpbmVXaWR0aCA9IDE7CiAgYy5iZWdpblBhdGgoKTsgYy5tb3ZlVG8oMCwgaC8yKTsgYy5saW5lVG8odywgaC8yKTsgYy5zdHJva2UoKTsKICAKICAvLyBXYXZlZm9ybQogIGNvbnN0IGhhbGZIID0gaCAvIDI7CiAgZm9yIChsZXQgeCA9IDA7IHggPCB3OyB4KyspIHsKICAgIGxldCBtaW4gPSAxLCBtYXggPSAtMTsKICAgIGZvciAobGV0IHMgPSAwOyBzIDwgc3RlcDsgcysrKSB7CiAgICAgIGNvbnN0IHYgPSBkYXRhW3ggKiBzdGVwICsgc10gfHwgMDsKICAgICAgaWYgKHYgPCBtaW4pIG1pbiA9IHY7CiAgICAgIGlmICh2ID4gbWF4KSBtYXggPSB2OwogICAgfQogICAgY29uc3QgYW1wID0gTWF0aC5hYnMobWF4IC0gbWluKTsKICAgIAogICAgLy8gQ29sb3IgYnkgYW1wbGl0dWRlCiAgICBjb25zdCBicmlnaHQgPSBNYXRoLm1pbigxLCBhbXAgKiAzKTsKICAgIGNvbnN0IHIgPSBwYXJzZUludChjb2xvci5zbGljZSgxLDMpLCAxNik7CiAgICBjb25zdCBnID0gcGFyc2VJbnQoY29sb3Iuc2xpY2UoMyw1KSwgMTYpOwogICAgY29uc3QgYiA9IHBhcnNlSW50KGNvbG9yLnNsaWNlKDUsNyksIDE2KTsKICAgIGMuZmlsbFN0eWxlID0gYHJnYmEoJHtyfSwke2d9LCR7Yn0sJHswLjMgKyBicmlnaHQgKiAwLjd9KWA7CiAgICAKICAgIGNvbnN0IHRvcFkgPSBoYWxmSCAtIG1heCAqIGhhbGZIOwogICAgY29uc3QgYm90WSA9IGhhbGZIIC0gbWluICogaGFsZkg7CiAgICBjLmZpbGxSZWN0KHgsIHRvcFksIDEsIE1hdGgubWF4KDEsIGJvdFkgLSB0b3BZKSk7CiAgfQogIAogIC8vIFNhdmUgZm9yIGxhdGVyIHJlZmVyZW5jZQogIGRlY2tzW2RlY2tJbmRleF0ud2F2ZWZvcm1EYXRhID0gYy5nZXRJbWFnZURhdGEoMCwgMCwgdywgaCk7Cn0KCmZ1bmN0aW9uIGRyYXdCZWF0TWFya2VycyhkZWNrSW5kZXgpIHsKICBjb25zdCBkID0gZGVja3NbZGVja0luZGV4XTsKICBpZiAoIWQuYnVmZmVyKSByZXR1cm47CiAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJlYXRjYW52YXMtJHtkZWNrSW5kZXh9YCk7CiAgY29uc3Qgd3JhcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGB3Zi13cmFwLSR7ZGVja0luZGV4fWApOwogIGNhbnZhcy53aWR0aCA9IHdyYXAub2Zmc2V0V2lkdGggfHwgMzAwOwogIGNhbnZhcy5oZWlnaHQgPSA4MDsKICBjb25zdCBjID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgYy5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAKICBjb25zdCB3ID0gY2FudmFzLndpZHRoOwogIGNvbnN0IGR1cmF0aW9uID0gZC5idWZmZXIuZHVyYXRpb247CiAgCiAgZC5iZWF0cy5mb3JFYWNoKChiZWF0VGltZSwgYmkpID0+IHsKICAgIGNvbnN0IHggPSAoYmVhdFRpbWUgLyBkdXJhdGlvbikgKiB3OwogICAgY29uc3QgaXNNZWFzdXJlID0gYmkgJSA0ID09PSAwOwogICAgYy5zdHJva2VTdHlsZSA9IGlzTWVhc3VyZSA/ICdyZ2JhKDI1NSwyNTUsMTAwLDAuOCknIDogJ3JnYmEoMjU1LDI1NSwyNTUsMC4zKSc7CiAgICBjLmxpbmVXaWR0aCA9IGlzTWVhc3VyZSA/IDEuNSA6IDAuODsKICAgIGMuYmVnaW5QYXRoKCk7IGMubW92ZVRvKHgsIGlzTWVhc3VyZSA/IDAgOiAyMCk7IGMubGluZVRvKHgsIGlzTWVhc3VyZSA/IDgwIDogNjApOyBjLnN0cm9rZSgpOwogICAgCiAgICBpZiAoaXNNZWFzdXJlICYmIGJpICUgMTYgPT09IDApIHsKICAgICAgYy5maWxsU3R5bGUgPSAncmdiYSgyNTUsMjU1LDEwMCwwLjYpJzsKICAgICAgYy5mb250ID0gJzhweCBtb25vc3BhY2UnOwogICAgICBjLmZpbGxUZXh0KE1hdGguZmxvb3IoYmkvNCkrMSwgeCsyLCAxMCk7CiAgICB9CiAgfSk7CiAgCiAgLy8gSG90Y3VlcwogIGQuaG90Y3Vlcy5mb3JFYWNoKChwb3MsIGhpKSA9PiB7CiAgICBpZiAocG9zID09PSBudWxsKSByZXR1cm47CiAgICBjb25zdCB4ID0gKHBvcyAvIGR1cmF0aW9uKSAqIHc7CiAgICBjb25zdCBoY0NvbG9ycyA9IFsnI2ZmNTU1NScsJyNmZmFhMDAnLCcjZmZmZjAwJywnIzU1ZmY1NScsJyM1NWZmZmYnLCcjNTU1NWZmJywnI2ZmNTVmZicsJyNmZjk5NTUnXTsKICAgIGMuc3Ryb2tlU3R5bGUgPSBoY0NvbG9yc1toaV07CiAgICBjLmxpbmVXaWR0aCA9IDI7CiAgICBjLmJlZ2luUGF0aCgpOyBjLm1vdmVUbyh4LCAwKTsgYy5saW5lVG8oeCwgODApOyBjLnN0cm9rZSgpOwogICAgYy5maWxsU3R5bGUgPSBoY0NvbG9yc1toaV07CiAgICBjLmZvbnQgPSAnYm9sZCA5cHggbW9ub3NwYWNlJzsKICAgIGMuZmlsbFRleHQoaGkrMSwgeCsyLCAyMCk7CiAgfSk7Cn0KCi8vID09PT09PT09PT09PT09PT09PT0gREVURUNUIEJFQVRTID09PT09PT09PT09PT09PT09PT0KZnVuY3Rpb24gZGV0ZWN0QmVhdHMoYnVmZmVyLCBicG0sIG9mZnNldE1zKSB7CiAgY29uc3Qgc2FtcGxlUmF0ZSA9IGJ1ZmZlci5zYW1wbGVSYXRlOwogIGNvbnN0IHNlY29uZHNQZXJCZWF0ID0gNjAgLyBicG07CiAgY29uc3Qgb2Zmc2V0U2VjID0gKG9mZnNldE1zIHx8IDApIC8gMTAwMDsKICBjb25zdCBkdXJhdGlvbiA9IGJ1ZmZlci5kdXJhdGlvbjsKICBjb25zdCBiZWF0cyA9IFtdOwogIGxldCB0ID0gb2Zmc2V0U2VjOwogIGlmICh0IDwgMCkgdCArPSBzZWNvbmRzUGVyQmVhdCAqIE1hdGguY2VpbCgtdCAvIHNlY29uZHNQZXJCZWF0KTsKICB3aGlsZSAodCA8IGR1cmF0aW9uKSB7CiAgICBiZWF0cy5wdXNoKHQpOwogICAgdCArPSBzZWNvbmRzUGVyQmVhdDsKICB9CiAgcmV0dXJuIGJlYXRzOwp9CgovLyA9PT09PT09PT09PT09PT09PT09IFBMQVlCQUNLID09PT09PT09PT09PT09PT09PT0KZnVuY3Rpb24gZ2V0Q3VycmVudFBvc2l0aW9uKGRlY2tJbmRleCkgewogIGNvbnN0IGQgPSBkZWNrc1tkZWNrSW5kZXhdOwogIGlmICghZC5pc1BsYXlpbmcpIHJldHVybiBkLnBhdXNlUG9zaXRpb247CiAgcmV0dXJuIGQucGF1c2VQb3NpdGlvbiArIChjdHguY3VycmVudFRpbWUgLSBkLnN0YXJ0VGltZSkgKiBkLnNwZWVkOwp9CgpmdW5jdGlvbiBwbGF5RGVjayhpbmRleCkgewogIGlmICghZGVja3NbaW5kZXhdLmJ1ZmZlcikgeyBhbGVydCgiQ2FyaWNhIHByaW1hIHVuYSB0cmFjY2lhISIpOyByZXR1cm47IH0KICBpZiAoY3R4LnN0YXRlID09PSAnc3VzcGVuZGVkJykgY3R4LnJlc3VtZSgpOwogIGNvbnN0IGQgPSBkZWNrc1tpbmRleF07CiAgCiAgaWYgKGQuc291cmNlKSB7IHRyeSB7IGQuc291cmNlLnN0b3AoKTsgfSBjYXRjaChlKXt9IGQuc291cmNlID0gbnVsbDsgfQogIAogIGNvbnN0IHNvdXJjZSA9IGN0eC5jcmVhdGVCdWZmZXJTb3VyY2UoKTsKICBzb3VyY2UuYnVmZmVyID0gZC5idWZmZXI7CiAgc291cmNlLnBsYXliYWNrUmF0ZS52YWx1ZSA9IGNvbXB1dGVQbGF5YmFja1JhdGUoaW5kZXgpOwogIGlmIChkLmxvb3BBY3RpdmUgJiYgZC5sb29wU3RhcnQgIT09IG51bGwgJiYgZC5sb29wRW5kICE9PSBudWxsKSB7CiAgICBzb3VyY2UubG9vcCA9IHRydWU7CiAgICBzb3VyY2UubG9vcFN0YXJ0ID0gZC5sb29wU3RhcnQ7CiAgICBzb3VyY2UubG9vcEVuZCA9IGQubG9vcEVuZDsKICB9IGVsc2UgewogICAgc291cmNlLmxvb3AgPSBmYWxzZTsKICB9CiAgc291cmNlLmNvbm5lY3QoZC5nYWluTm9kZSk7CiAgCiAgY29uc3Qgb2Zmc2V0ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oZC5wYXVzZVBvc2l0aW9uLCBkLmJ1ZmZlci5kdXJhdGlvbiAtIDAuMDEpKTsKICBzb3VyY2Uuc3RhcnQoMCwgb2Zmc2V0KTsKICBkLnNvdXJjZSA9IHNvdXJjZTsKICBkLnN0YXJ0VGltZSA9IGN0eC5jdXJyZW50VGltZTsKICBkLmlzUGxheWluZyA9IHRydWU7CiAgCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJ0bi1wbGF5LSR7aW5kZXh9YCkudGV4dENvbnRlbnQgPSAn4p2a4p2aIFBhdXNlJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYnRuLXBsYXktJHtpbmRleH1gKS5vbmNsaWNrID0gKCkgPT4gcGF1c2VEZWNrKGluZGV4KTsKICAKICBpZiAoZC5hbmltRnJhbWUpIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGQuYW5pbUZyYW1lKTsKICBhbmltYXRlRGVjayhpbmRleCk7Cn0KCmZ1bmN0aW9uIHBhdXNlRGVjayhpbmRleCkgewogIGNvbnN0IGQgPSBkZWNrc1tpbmRleF07CiAgZC5wYXVzZVBvc2l0aW9uID0gZ2V0Q3VycmVudFBvc2l0aW9uKGluZGV4KTsKICBpZiAoZC5zb3VyY2UpIHsgdHJ5IHsgZC5zb3VyY2Uuc3RvcCgpOyB9IGNhdGNoKGUpe30gZC5zb3VyY2UgPSBudWxsOyB9CiAgZC5pc1BsYXlpbmcgPSBmYWxzZTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYnRuLXBsYXktJHtpbmRleH1gKS50ZXh0Q29udGVudCA9ICfilrYgUGxheSc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJ0bi1wbGF5LSR7aW5kZXh9YCkub25jbGljayA9ICgpID0+IHBsYXlEZWNrKGluZGV4KTsKfQoKZnVuY3Rpb24gc3RvcERlY2soaW5kZXgpIHsKICBjb25zdCBkID0gZGVja3NbaW5kZXhdOwogIGlmIChkLnNvdXJjZSkgeyB0cnkgeyBkLnNvdXJjZS5zdG9wKCk7IH0gY2F0Y2goZSl7fSBkLnNvdXJjZSA9IG51bGw7IH0KICBkLmlzUGxheWluZyA9IGZhbHNlOwogIGQucGF1c2VQb3NpdGlvbiA9IDA7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJ0bi1wbGF5LSR7aW5kZXh9YCkudGV4dENvbnRlbnQgPSAn4pa2IFBsYXknOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBidG4tcGxheS0ke2luZGV4fWApLm9uY2xpY2sgPSAoKSA9PiBwbGF5RGVjayhpbmRleCk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHBsYXloZWFkLSR7aW5kZXh9YCkuc3R5bGUubGVmdCA9ICcwJSc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHRpbWUtZWxhcHNlZC0ke2luZGV4fWApLnRleHRDb250ZW50ID0gJzA6MDAuMCc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHRpbWUtcmVtYWluaW5nLSR7aW5kZXh9YCkudGV4dENvbnRlbnQgPSAnLScgKyBmb3JtYXRUaW1lKGQuZHVyYXRpb24pOwogIGlmIChkLmFuaW1GcmFtZSkgY2FuY2VsQW5pbWF0aW9uRnJhbWUoZC5hbmltRnJhbWUpOwp9CgpmdW5jdGlvbiBhbmltYXRlRGVjayhpbmRleCkgewogIGNvbnN0IGQgPSBkZWNrc1tpbmRleF07CiAgaWYgKCFkLmlzUGxheWluZykgcmV0dXJuOwogIAogIGNvbnN0IHBvcyA9IGdldEN1cnJlbnRQb3NpdGlvbihpbmRleCk7CiAgY29uc3QgZHVyID0gZC5idWZmZXIgPyBkLmJ1ZmZlci5kdXJhdGlvbiA6IDE7CiAgY29uc3QgcGN0ID0gTWF0aC5taW4oMSwgcG9zIC8gZHVyKTsKICAKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcGxheWhlYWQtJHtpbmRleH1gKS5zdHlsZS5sZWZ0ID0gKHBjdCAqIDEwMCkgKyAnJSc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHRpbWUtZWxhcHNlZC0ke2luZGV4fWApLnRleHRDb250ZW50ID0gZm9ybWF0VGltZVN1Yihwb3MpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGB0aW1lLXJlbWFpbmluZy0ke2luZGV4fWApLnRleHRDb250ZW50ID0gJy0nICsgZm9ybWF0VGltZVN1YihkdXIgLSBwb3MpOwogIAogIGQuYW5pbUZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IGFuaW1hdGVEZWNrKGluZGV4KSk7Cn0KCmZ1bmN0aW9uIGZvcm1hdFRpbWUocykgewogIGNvbnN0IG0gPSBNYXRoLmZsb29yKHMgLyA2MCk7CiAgY29uc3Qgc3MgPSBNYXRoLmZsb29yKHMgJSA2MCk7CiAgcmV0dXJuIGAke219OiR7c3MudG9TdHJpbmcoKS5wYWRTdGFydCgyLCcwJyl9YDsKfQpmdW5jdGlvbiBmb3JtYXRUaW1lU3ViKHMpIHsKICBpZiAocyA8IDApIHMgPSAwOwogIGNvbnN0IG0gPSBNYXRoLmZsb29yKHMgLyA2MCk7CiAgY29uc3Qgc3MgPSAocyAlIDYwKS50b0ZpeGVkKDEpOwogIHJldHVybiBgJHttfToke3NzLnBhZFN0YXJ0KDQsJzAnKX1gOwp9CgpmdW5jdGlvbiBzZWVrQnlDbGljayhpbmRleCwgZXZlbnQpIHsKICBjb25zdCBkID0gZGVja3NbaW5kZXhdOwogIGlmICghZC5idWZmZXIpIHJldHVybjsKICBjb25zdCB3cmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHdmLXdyYXAtJHtpbmRleH1gKTsKICBjb25zdCByZWN0ID0gd3JhcC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICBjb25zdCBwY3QgPSAoZXZlbnQuY2xpZW50WCAtIHJlY3QubGVmdCkgLyByZWN0LndpZHRoOwogIGNvbnN0IG5ld1BvcyA9IHBjdCAqIGQuYnVmZmVyLmR1cmF0aW9uOwogIGQucGF1c2VQb3NpdGlvbiA9IE1hdGgubWF4KDAsIE1hdGgubWluKG5ld1BvcywgZC5idWZmZXIuZHVyYXRpb24gLSAwLjAxKSk7CiAgaWYgKGQuaXNQbGF5aW5nKSB7CiAgICBwbGF5RGVjayhpbmRleCk7CiAgfSBlbHNlIHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBwbGF5aGVhZC0ke2luZGV4fWApLnN0eWxlLmxlZnQgPSAocGN0KjEwMCkrJyUnOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHRpbWUtZWxhcHNlZC0ke2luZGV4fWApLnRleHRDb250ZW50ID0gZm9ybWF0VGltZVN1YihkLnBhdXNlUG9zaXRpb24pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHRpbWUtcmVtYWluaW5nLSR7aW5kZXh9YCkudGV4dENvbnRlbnQgPSAnLScgKyBmb3JtYXRUaW1lU3ViKGQuYnVmZmVyLmR1cmF0aW9uIC0gZC5wYXVzZVBvc2l0aW9uKTsKICB9Cn0KCi8vID09PT09PT09PT09PT09PT09PT0gQ1VFIC8gTE9PUCAvIEhPVENVRSA9PT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIHNldEN1ZShpbmRleCkgewogIGNvbnN0IGQgPSBkZWNrc1tpbmRleF07CiAgZC5wYXVzZVBvc2l0aW9uID0gZ2V0Q3VycmVudFBvc2l0aW9uKGluZGV4KTsKICBpZiAoZC5pc1BsYXlpbmcpIHBhdXNlRGVjayhpbmRleCk7Cn0KCmZ1bmN0aW9uIHRvZ2dsZUxvb3AoaW5kZXgpIHsKICBjb25zdCBkID0gZGVja3NbaW5kZXhdOwogIGlmICghZC5pc1BsYXlpbmcgJiYgIWQubG9vcEFjdGl2ZSkgewogICAgLy8gU2V0IGxvb3Agc3RhcnQKICAgIGQubG9vcFN0YXJ0ID0gZ2V0Q3VycmVudFBvc2l0aW9uKGluZGV4KTsKICAgIGQubG9vcEVuZCA9IGQubG9vcFN0YXJ0ICsgKDYwIC8gKGQuYnBtIHx8IDEyMCkpICogNDsgLy8gNCBiZWF0cwogICAgZC5sb29wQWN0aXZlID0gdHJ1ZTsKICB9IGVsc2UgaWYgKGQubG9vcEFjdGl2ZSkgewogICAgZC5sb29wQWN0aXZlID0gZmFsc2U7CiAgICBpZiAoZC5zb3VyY2UpIGQuc291cmNlLmxvb3AgPSBmYWxzZTsKICB9IGVsc2UgewogICAgZC5sb29wU3RhcnQgPSBnZXRDdXJyZW50UG9zaXRpb24oaW5kZXgpOwogICAgZC5sb29wRW5kID0gZC5sb29wU3RhcnQgKyAoNjAgLyAoZC5icG0gfHwgMTIwKSkgKiA0OwogICAgZC5sb29wQWN0aXZlID0gdHJ1ZTsKICB9CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJ0bi1sb29wLSR7aW5kZXh9YCkuc3R5bGUuYmFja2dyb3VuZCA9IGQubG9vcEFjdGl2ZSA/ICcjZTY1MTAwJyA6ICcjRkY5ODAwJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYnRuLWxvb3AtJHtpbmRleH1gKS50ZXh0Q29udGVudCA9IGQubG9vcEFjdGl2ZSA/ICfwn5SBIExPT1AgT04nIDogJ0xPT1AnOwogIGlmIChkLmlzUGxheWluZykgcGxheURlY2soaW5kZXgpOwp9CgpmdW5jdGlvbiBob3RjdWVBY3Rpb24oZGVja0luZGV4LCBzbG90KSB7CiAgY29uc3QgZCA9IGRlY2tzW2RlY2tJbmRleF07CiAgY29uc3QgcG9zID0gZ2V0Q3VycmVudFBvc2l0aW9uKGRlY2tJbmRleCk7CiAgCiAgaWYgKGQuaG90Y3Vlc1tzbG90XSA9PT0gbnVsbCkgewogICAgLy8gU2V0IGhvdGN1ZQogICAgZC5ob3RjdWVzW3Nsb3RdID0gcG9zOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGhjLSR7ZGVja0luZGV4fS0ke3Nsb3R9YCkuc3R5bGUub3BhY2l0eSA9ICcxJzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBoYy0ke2RlY2tJbmRleH0tJHtzbG90fWApLnN0eWxlLmJveFNoYWRvdyA9ICcwIDAgNXB4ICNlOTFlNjMnOwogIH0gZWxzZSB7CiAgICAvLyBKdW1wIHRvIGhvdGN1ZQogICAgZC5wYXVzZVBvc2l0aW9uID0gZC5ob3RjdWVzW3Nsb3RdOwogICAgaWYgKGQuaXNQbGF5aW5nKSBwbGF5RGVjayhkZWNrSW5kZXgpOwogICAgZWxzZSB7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBwbGF5aGVhZC0ke2RlY2tJbmRleH1gKS5zdHlsZS5sZWZ0ID0gKGQuaG90Y3Vlc1tzbG90XS9kLmR1cmF0aW9uKjEwMCkrJyUnOwogICAgfQogIH0KICBkcmF3QmVhdE1hcmtlcnMoZGVja0luZGV4KTsKfQoKLy8gTG9uZyBwcmVzcyBob3RjdWUgYnV0dG9uIHRvIGRlbGV0ZSAocmlnaHQtY2xpY2spCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgKGUpID0+IHsKICBjb25zdCBidG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuaG90Y3VlLWJ0bicpOwogIGlmICghYnRuKSByZXR1cm47CiAgZS5wcmV2ZW50RGVmYXVsdCgpOwogIGNvbnN0IGlkID0gYnRuLmlkOyAvLyBoYy1ELVMKICBjb25zdCBwYXJ0cyA9IGlkLnNwbGl0KCctJyk7CiAgY29uc3QgZGkgPSBwYXJzZUludChwYXJ0c1sxXSksIHNsb3QgPSBwYXJzZUludChwYXJ0c1syXSk7CiAgZGVja3NbZGldLmhvdGN1ZXNbc2xvdF0gPSBudWxsOwogIGJ0bi5zdHlsZS5vcGFjaXR5ID0gJzAuNSc7CiAgYnRuLnN0eWxlLmJveFNoYWRvdyA9ICcnOwogIGRyYXdCZWF0TWFya2VycyhkaSk7Cn0pOwoKLy8gPT09PT09PT09PT09PT09PT09PSBTUEVFRCAvIEtFWSA9PT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIGNvbXB1dGVQbGF5YmFja1JhdGUoaW5kZXgpIHsKICBjb25zdCBkID0gZGVja3NbaW5kZXhdOwogIGxldCByYXRlID0gZC5zcGVlZDsKICBpZiAoIWQua2V5TG9jaykgewogICAgLy8gQWxzbyBhcHBseSBwaXRjaCAoc2VtaXRvbmVzICsgY2VudHMpCiAgICByYXRlICo9IE1hdGgucG93KDIsIChkLnNlbWl0b25lcyArIGQuY2VudHMvMTAwKSAvIDEyKTsKICB9CiAgcmV0dXJuIHJhdGU7Cn0KCmZ1bmN0aW9uIHNldFNwZWVkKGluZGV4LCB2YWwpIHsKICBjb25zdCBkID0gZGVja3NbaW5kZXhdOwogIGQuc3BlZWQgPSBwYXJzZUZsb2F0KHZhbCk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHJhdGUtdmFsLSR7aW5kZXh9YCkuaW5uZXJUZXh0ID0gcGFyc2VGbG9hdCh2YWwpLnRvRml4ZWQoMyk7CiAgY29uc3QgbGl2ZUJwbSA9IChkLm9yaWdpbmFsQnBtICogZC5zcGVlZCk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJwbS1saXZlLSR7aW5kZXh9YCkuaW5uZXJUZXh0ID0gbGl2ZUJwbS50b0ZpeGVkKDEpOwogIGlmIChkLnNvdXJjZSkgZC5zb3VyY2UucGxheWJhY2tSYXRlLnZhbHVlID0gY29tcHV0ZVBsYXliYWNrUmF0ZShpbmRleCk7CiAgdXBkYXRlS2V5RGlzcGxheShpbmRleCk7Cn0KCmZ1bmN0aW9uIHRvZ2dsZUtleUxvY2soaW5kZXgpIHsKICBjb25zdCBkID0gZGVja3NbaW5kZXhdOwogIGQua2V5TG9jayA9ICFkLmtleUxvY2s7CiAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGtleWxvY2stYnRuLSR7aW5kZXh9YCk7CiAgYnRuLmNsYXNzTGlzdC50b2dnbGUoJ2xvY2tlZCcsIGQua2V5TG9jayk7CiAgYnRuLnRleHRDb250ZW50ID0gZC5rZXlMb2NrID8gJ/CflJIgTE9DSycgOiAn8J+UkyBMT0NLJzsKICBpZiAoZC5zb3VyY2UpIGQuc291cmNlLnBsYXliYWNrUmF0ZS52YWx1ZSA9IGNvbXB1dGVQbGF5YmFja1JhdGUoaW5kZXgpOwp9CgpmdW5jdGlvbiB1cGRhdGVLZXlEaXNwbGF5KGluZGV4KSB7CiAgY29uc3QgZCA9IGRlY2tzW2luZGV4XTsKICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBrZXktZGV0ZWN0ZWQtJHtpbmRleH1gKTsKICBjb25zdCBlbDIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChga2V5LXJlc3VsdC0ke2luZGV4fWApOwogIGlmIChkLmRldGVjdGVkS2V5ICE9PSBudWxsKSB7CiAgICBlbC50ZXh0Q29udGVudCA9IE5PVEVfTkFNRVNbZC5kZXRlY3RlZEtleV0gKyAoZC5rZXlMb2NrID8gJ/CflJInIDogJycpOwogICAgZWwuY2xhc3NMaXN0LmFkZCgnZGV0ZWN0ZWQnKTsKICAgIGNvbnN0IHJlc3VsdEtleSA9ICgoZC5kZXRlY3RlZEtleSArIGQuc2VtaXRvbmVzKSAlIDEyICsgMTIpICUgMTI7CiAgICBlbDIudGV4dENvbnRlbnQgPSBOT1RFX05BTUVTW3Jlc3VsdEtleV0gKyAoZC5jZW50cyAhPT0gMCA/IGAgJHtkLmNlbnRzPjA/JysnOicnfSR7ZC5jZW50c33ComAgOiAnJyk7CiAgfSBlbHNlIHsKICAgIGVsLnRleHRDb250ZW50ID0gJ+KAlCc7IGVsMi50ZXh0Q29udGVudCA9ICfigJQnOwogIH0KfQoKLy8gPT09PT09PT09PT09PT09PT09PSBFUSA9PT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIHNldEVRKGluZGV4LCBiYW5kLCB2YWwpIHsKICBjb25zdCBkID0gZGVja3NbaW5kZXhdOwogIHZhbCA9IHBhcnNlRmxvYXQodmFsKTsKICBpZiAoYmFuZCA9PT0gJ2xvdycpIHsgZC5lcUxvdy5nYWluLnZhbHVlID0gdmFsOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZXEtbG93LXZhbC0ke2luZGV4fWApLnRleHRDb250ZW50ID0gdmFsOyB9CiAgaWYgKGJhbmQgPT09ICdtaWQnKSB7IGQuZXFNaWQuZ2Fpbi52YWx1ZSA9IHZhbDsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGVxLW1pZC12YWwtJHtpbmRleH1gKS50ZXh0Q29udGVudCA9IHZhbDsgfQogIGlmIChiYW5kID09PSAnaGlnaCcpIHsgZC5lcUhpZ2guZ2Fpbi52YWx1ZSA9IHZhbDsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGVxLWhpZ2gtdmFsLSR7aW5kZXh9YCkudGV4dENvbnRlbnQgPSB2YWw7IH0KfQoKZnVuY3Rpb24gc2V0Vm9sdW1lKGluZGV4LCB2YWwpIHsKICBkZWNrc1tpbmRleF0uZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IHZhbDsKfQpmdW5jdGlvbiBzZXRNYXN0ZXJWb2x1bWUodmFsKSB7IG1hc3RlckdhaW4uZ2Fpbi52YWx1ZSA9IHZhbDsgfQoKZnVuY3Rpb24gc2V0Q3Jvc3NmYWRlcih2YWwpIHsKICBjb25zdCB2b2xBID0gTWF0aC5jb3ModmFsICogTWF0aC5QSSAvIDIpOwogIGNvbnN0IHZvbEIgPSBNYXRoLnNpbih2YWwgKiBNYXRoLlBJIC8gMik7CiAgaWYgKGRlY2tzWzBdLmdhaW5Ob2RlKSBkZWNrc1swXS5nYWluTm9kZS5nYWluLnZhbHVlID0gdm9sQTsKICBpZiAoZGVja3NbMV0uZ2Fpbk5vZGUpIGRlY2tzWzFdLmdhaW5Ob2RlLmdhaW4udmFsdWUgPSB2b2xCOwp9CgovLyA9PT09PT09PT09PT09PT09PT09IFNZTkMgPT09PT09PT09PT09PT09PT09PQpmdW5jdGlvbiBzeW5jRGVjayhpbmRleCkgewogIGNvbnN0IG1hc3RlciA9IGRlY2tzW21hc3RlckRlY2tJbmRleF07CiAgY29uc3QgZCA9IGRlY2tzW2luZGV4XTsKICBpZiAoaW5kZXggPT09IG1hc3RlckRlY2tJbmRleCkgeyBhbGVydChgRGVjayAke0RFQ0tfTkFNRVNbaW5kZXhdfSDDqCBnacOgIGlsIE1hc3Rlci5gKTsgcmV0dXJuOyB9CiAgaWYgKG1hc3Rlci5icG0gPT09IDAgfHwgZC5icG0gPT09IDApIHsgYWxlcnQoIkJQTSBub24gcmlsZXZhdG8uIENhcmljYSBsZSB0cmFjY2UgcHJpbWEuIik7IHJldHVybjsgfQogIGNvbnN0IHJhdGlvID0gKG1hc3Rlci5icG0gKiBtYXN0ZXIuc3BlZWQpIC8gZC5vcmlnaW5hbEJwbTsKICBkLnNwZWVkID0gcmF0aW87CiAgY29uc3Qgc2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHNwZWVkLXNsaWRlci0ke2luZGV4fWApOwogIGlmIChzbGlkZXIpIHNsaWRlci52YWx1ZSA9IHJhdGlvOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGByYXRlLXZhbC0ke2luZGV4fWApLmlubmVyVGV4dCA9IHJhdGlvLnRvRml4ZWQoMyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJwbS1saXZlLSR7aW5kZXh9YCkuaW5uZXJUZXh0ID0gKGQub3JpZ2luYWxCcG0gKiByYXRpbykudG9GaXhlZCgxKTsKICBpZiAoZC5zb3VyY2UpIGQuc291cmNlLnBsYXliYWNrUmF0ZS52YWx1ZSA9IGNvbXB1dGVQbGF5YmFja1JhdGUoaW5kZXgpOwp9CgovLyA9PT09PT09PT09PT09PT09PT09IFBPUFVQUyA9PT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIG9wZW5Qb3B1cChpZCkgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkuY2xhc3NMaXN0LmFkZCgnb3BlbicpOyB9CmZ1bmN0aW9uIGNsb3NlUG9wdXAoaWQpIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTsgfQoKLy8gLS0tIEJQTSBQT1BVUCAtLS0KZnVuY3Rpb24gb3BlbkJwbVBvcHVwKGluZGV4KSB7CiAgcG9wdXBEZWNrID0gaW5kZXg7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwLWJwbS12YWwnKS52YWx1ZSA9IGRlY2tzW2luZGV4XS5icG0udG9GaXhlZCgxKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXAtYmVhdC1vZmZzZXQnKS52YWx1ZSA9IGRlY2tzW2luZGV4XS5iZWF0T2Zmc2V0OwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cC1iZWF0LW9mZnNldC1kaXNwbGF5JykudGV4dENvbnRlbnQgPSBkZWNrc1tpbmRleF0uYmVhdE9mZnNldCArICcgbXMnOwogIG9wZW5Qb3B1cCgncG9wdXAtYnBtJyk7Cn0KZnVuY3Rpb24gdXBkYXRlQmVhdE9mZnNldERpc3BsYXkodikgewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cC1iZWF0LW9mZnNldC1kaXNwbGF5JykudGV4dENvbnRlbnQgPSB2ICsgJyBtcyc7Cn0KZnVuY3Rpb24gY29uZmlybUJQTSgpIHsKICBjb25zdCBkID0gZGVja3NbcG9wdXBEZWNrXTsKICBjb25zdCBuZXdCcG0gPSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cC1icG0tdmFsJykudmFsdWUpOwogIGNvbnN0IG5ld09mZnNldCA9IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cC1iZWF0LW9mZnNldCcpLnZhbHVlKTsKICBpZiAobmV3QnBtID4gMCkgewogICAgZC5icG0gPSBuZXdCcG07IGQub3JpZ2luYWxCcG0gPSBuZXdCcG07CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYnBtLSR7cG9wdXBEZWNrfWApLmlubmVyVGV4dCA9IG5ld0JwbS50b0ZpeGVkKDEpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJwbS1saXZlLSR7cG9wdXBEZWNrfWApLmlubmVyVGV4dCA9IChuZXdCcG0gKiBkLnNwZWVkKS50b0ZpeGVkKDEpOwogIH0KICBkLmJlYXRPZmZzZXQgPSBuZXdPZmZzZXQ7CiAgaWYgKGQuYnVmZmVyKSB7CiAgICBkLmJlYXRzID0gZGV0ZWN0QmVhdHMoZC5idWZmZXIsIGQuYnBtLCBkLmJlYXRPZmZzZXQpOwogICAgZHJhd0JlYXRNYXJrZXJzKHBvcHVwRGVjayk7CiAgfQogIGNsb3NlUG9wdXAoJ3BvcHVwLWJwbScpOwp9CgovLyAtLS0gS0VZIFBPUFVQIC0tLQpsZXQgcG9wdXBTZW1pdG9uZXMgPSAwLCBwb3B1cENlbnRzID0gMDsKZnVuY3Rpb24gb3BlbktleVBvcHVwKGluZGV4KSB7CiAgcG9wdXBEZWNrID0gaW5kZXg7CiAgY29uc3QgZCA9IGRlY2tzW2luZGV4XTsKICBwb3B1cFNlbWl0b25lcyA9IGQuc2VtaXRvbmVzOwogIHBvcHVwQ2VudHMgPSBkLmNlbnRzOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cC1rZXlsb2NrJykudmFsdWUgPSBkLmtleUxvY2sgPyAnMScgOiAnMCc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwLXNlbWl0b25lLWRpc3BsYXknKS50ZXh0Q29udGVudCA9IHBvcHVwU2VtaXRvbmVzICsgJyBzdCc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwLWNlbnRzJykudmFsdWUgPSBwb3B1cENlbnRzOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cC1jZW50cy1kaXNwbGF5JykudGV4dENvbnRlbnQgPSBwb3B1cENlbnRzICsgJyDCoic7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwLWtleS1vcmlnaW5hbCcpLnRleHRDb250ZW50ID0gZC5kZXRlY3RlZEtleSAhPT0gbnVsbCA/IE5PVEVfTkFNRVNbZC5kZXRlY3RlZEtleV0gOiAn4oCUJzsKICB1cGRhdGVSZXN1bHRLZXkoKTsKICBvcGVuUG9wdXAoJ3BvcHVwLWtleScpOwp9CmZ1bmN0aW9uIGFkalNlbWl0b25lKGRlbHRhKSB7CiAgcG9wdXBTZW1pdG9uZXMgPSBNYXRoLm1heCgtMTIsIE1hdGgubWluKDEyLCBwb3B1cFNlbWl0b25lcyArIGRlbHRhKSk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwLXNlbWl0b25lLWRpc3BsYXknKS50ZXh0Q29udGVudCA9IHBvcHVwU2VtaXRvbmVzICsgJyBzdCc7CiAgdXBkYXRlUmVzdWx0S2V5KCk7Cn0KZnVuY3Rpb24gdXBkYXRlQ2VudHNEaXNwbGF5KHYpIHsKICBwb3B1cENlbnRzID0gcGFyc2VJbnQodik7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwLWNlbnRzLWRpc3BsYXknKS50ZXh0Q29udGVudCA9IHYgKyAnIMKiJzsKICB1cGRhdGVSZXN1bHRLZXkoKTsKfQpmdW5jdGlvbiB1cGRhdGVSZXN1bHRLZXkoKSB7CiAgY29uc3QgZCA9IGRlY2tzW3BvcHVwRGVja107CiAgaWYgKGQuZGV0ZWN0ZWRLZXkgIT09IG51bGwpIHsKICAgIGNvbnN0IHJrID0gKChkLmRldGVjdGVkS2V5ICsgcG9wdXBTZW1pdG9uZXMpICUgMTIgKyAxMikgJSAxMjsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cC1rZXktcmVzdWx0JykudGV4dENvbnRlbnQgPSBOT1RFX05BTUVTW3JrXSArIChwb3B1cENlbnRzICE9PSAwID8gYCAke3BvcHVwQ2VudHM+MD8nKyc6Jyd9JHtwb3B1cENlbnRzfcKiYCA6ICcnKTsKICB9Cn0KZnVuY3Rpb24gY29uZmlybUtleSgpIHsKICBjb25zdCBkID0gZGVja3NbcG9wdXBEZWNrXTsKICBkLmtleUxvY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXAta2V5bG9jaycpLnZhbHVlID09PSAnMSc7CiAgZC5zZW1pdG9uZXMgPSBwb3B1cFNlbWl0b25lczsKICBkLmNlbnRzID0gcG9wdXBDZW50czsKICAvLyBBcHBseSBwaXRjaCBzaGlmdCB2aWEgcGxheWJhY2tSYXRlIGlmIG5vdCBrZXkgbG9jawogIGlmIChkLnNvdXJjZSkgZC5zb3VyY2UucGxheWJhY2tSYXRlLnZhbHVlID0gY29tcHV0ZVBsYXliYWNrUmF0ZShwb3B1cERlY2spOwogIHVwZGF0ZUtleURpc3BsYXkocG9wdXBEZWNrKTsKICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChga2V5bG9jay1idG4tJHtwb3B1cERlY2t9YCk7CiAgYnRuLmNsYXNzTGlzdC50b2dnbGUoJ2xvY2tlZCcsIGQua2V5TG9jayk7CiAgYnRuLnRleHRDb250ZW50ID0gZC5rZXlMb2NrID8gJ/CflJIgTE9DSycgOiAn8J+UkyBMT0NLJzsKICBjbG9zZVBvcHVwKCdwb3B1cC1rZXknKTsKfQpmdW5jdGlvbiByZXNldEtleSgpIHsKICBwb3B1cFNlbWl0b25lcyA9IDA7IHBvcHVwQ2VudHMgPSAwOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cC1zZW1pdG9uZS1kaXNwbGF5JykudGV4dENvbnRlbnQgPSAnMCBzdCc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwLWNlbnRzJykudmFsdWUgPSAwOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cC1jZW50cy1kaXNwbGF5JykudGV4dENvbnRlbnQgPSAnMCDCoic7CiAgdXBkYXRlUmVzdWx0S2V5KCk7Cn0KCi8vIC0tLSBCRUFUIFBPUFVQIC0tLQpmdW5jdGlvbiBvcGVuQmVhdFBvcHVwKGluZGV4KSB7CiAgcG9wdXBEZWNrID0gaW5kZXg7CiAgY29uc3Qgb2Zmc2V0ID0gZGVja3NbaW5kZXhdLmJlYXRPZmZzZXQ7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwLW1hbnVhbC1iZWF0JykudmFsdWUgPSBvZmZzZXQ7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwLW1hbnVhbC1iZWF0LWRpc3BsYXknKS50ZXh0Q29udGVudCA9IG9mZnNldCArICcgbXMnOwogIG9wZW5Qb3B1cCgncG9wdXAtYmVhdCcpOwp9CmZ1bmN0aW9uIHVwZGF0ZU1hbnVhbEJlYXREaXNwbGF5KHYpIHsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXAtbWFudWFsLWJlYXQtZGlzcGxheScpLnRleHRDb250ZW50ID0gdiArICcgbXMnOwp9CmZ1bmN0aW9uIG51ZGdlQmVhdChkZWx0YSkgewogIGNvbnN0IHNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cC1tYW51YWwtYmVhdCcpOwogIGNvbnN0IG5ld1ZhbCA9IHBhcnNlSW50KHNsaWRlci52YWx1ZSkgKyBkZWx0YTsKICBzbGlkZXIudmFsdWUgPSBuZXdWYWw7CiAgdXBkYXRlTWFudWFsQmVhdERpc3BsYXkobmV3VmFsKTsKfQpmdW5jdGlvbiBjb25maXJtQmVhdCgpIHsKICBjb25zdCBkID0gZGVja3NbcG9wdXBEZWNrXTsKICBjb25zdCBvZmZzZXQgPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXAtbWFudWFsLWJlYXQnKS52YWx1ZSk7CiAgZC5iZWF0T2Zmc2V0ID0gb2Zmc2V0OwogIGlmIChkLmJ1ZmZlcikgewogICAgZC5iZWF0cyA9IGRldGVjdEJlYXRzKGQuYnVmZmVyLCBkLmJwbSwgZC5iZWF0T2Zmc2V0KTsKICAgIGRyYXdCZWF0TWFya2Vycyhwb3B1cERlY2spOwogIH0KICBjbG9zZVBvcHVwKCdwb3B1cC1iZWF0Jyk7Cn0KCi8vID09PT09PT09PT09PT09PT09PT0gQlBNIERFVEVDVElPTiA9PT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIGRldGVjdEJQTShidWZmZXIpIHsKICBjb25zdCBkYXRhID0gYnVmZmVyLmdldENoYW5uZWxEYXRhKDApOwogIGNvbnN0IHNhbXBsZVJhdGUgPSBidWZmZXIuc2FtcGxlUmF0ZTsKICBjb25zdCBzdGVwID0gNTEyOwogIGNvbnN0IHBlYWtzID0gW107CiAgbGV0IG1heFAgPSAwOwogIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGggLSBzdGVwOyBpICs9IHN0ZXApIHsKICAgIGxldCBzdW0gPSAwOwogICAgZm9yIChsZXQgaiA9IDA7IGogPCBzdGVwOyBqKyspIHN1bSArPSBkYXRhW2kral0gKiBkYXRhW2kral07CiAgICBjb25zdCBybXMgPSBNYXRoLnNxcnQoc3VtIC8gc3RlcCk7CiAgICBwZWFrcy5wdXNoKHJtcyk7CiAgICBpZiAocm1zID4gbWF4UCkgbWF4UCA9IHJtczsKICB9CiAgY29uc3QgdGhyZXNob2xkID0gbWF4UCAqIDAuNjsKICBjb25zdCBiZWF0cyA9IFtdOwogIGZvciAobGV0IGkgPSAwOyBpIDwgcGVha3MubGVuZ3RoOyBpKyspIHsKICAgIGlmIChwZWFrc1tpXSA+IHRocmVzaG9sZCkgewogICAgICBpZiAoYmVhdHMubGVuZ3RoID09PSAwIHx8IChpIC0gYmVhdHNbYmVhdHMubGVuZ3RoLTFdKSA+IDgpIGJlYXRzLnB1c2goaSk7CiAgICB9CiAgfQogIGNvbnN0IGludGVydmFscyA9IFtdOwogIGZvciAobGV0IGkgPSAxOyBpIDwgYmVhdHMubGVuZ3RoOyBpKyspIGludGVydmFscy5wdXNoKGJlYXRzW2ldIC0gYmVhdHNbaS0xXSk7CiAgCiAgY29uc3QgYnBtTWFwID0ge307CiAgaW50ZXJ2YWxzLmZvckVhY2goaXYgPT4gewogICAgaWYgKCFpdikgcmV0dXJuOwogICAgY29uc3QgYnBtID0gTWF0aC5yb3VuZCgoc2FtcGxlUmF0ZSAvIHN0ZXApICogNjAgLyBpdik7CiAgICBpZiAoYnBtID49IDYwICYmIGJwbSA8PSAyMTApIGJwbU1hcFticG1dID0gKGJwbU1hcFticG1dfHwwKSArIDE7CiAgfSk7CiAgCiAgLy8gQWxzbyBjaGVjayBoYWxmL2RvdWJsZQogIGxldCBtYXhDID0gMCwgYmVzdCA9IDEyMDsKICBmb3IgKGNvbnN0IGIgaW4gYnBtTWFwKSB7CiAgICBpZiAoYnBtTWFwW2JdID4gbWF4QykgeyBtYXhDID0gYnBtTWFwW2JdOyBiZXN0ID0gcGFyc2VJbnQoYik7IH0KICB9CiAgLy8gUmFuZ2Ugbm9ybWFsaXphdGlvbiA4MC0xNzUKICB3aGlsZSAoYmVzdCA+IDE3NSkgYmVzdCAvPSAyOwogIHdoaWxlIChiZXN0IDwgODApIGJlc3QgKj0gMjsKICByZXR1cm4gYmVzdCA+IDAgPyBiZXN0IDogMTIwOwp9CgovLyA9PT09PT09PT09PT09PT09PT09IEtFWSBERVRFQ1RJT04gKHNpbXBsaWZpZWQgY2hyb21hKSA9PT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIGRldGVjdEtleShidWZmZXIpIHsKICB0cnkgewogICAgY29uc3QgZGF0YSA9IGJ1ZmZlci5nZXRDaGFubmVsRGF0YSgwKTsKICAgIGNvbnN0IHNhbXBsZVJhdGUgPSBidWZmZXIuc2FtcGxlUmF0ZTsKICAgIC8vIFNhbXBsZSBmaXJzdCAzMCBzZWNvbmRzIG1heAogICAgY29uc3QgbGVuID0gTWF0aC5taW4oZGF0YS5sZW5ndGgsIHNhbXBsZVJhdGUgKiAzMCk7CiAgICBjb25zdCBjaHJvbWEgPSBuZXcgRmxvYXQzMkFycmF5KDEyKTsKICAgIGNvbnN0IGZmdFNpemUgPSA0MDk2OwogICAgCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbiAtIGZmdFNpemU7IGkgKz0gZmZ0U2l6ZSkgewogICAgICAvLyBBcHByb3hpbWF0ZSBjaHJvbWEgYnkgYW5hbHl6aW5nIGZyZXF1ZW5jeSBiYW5kcwogICAgICBmb3IgKGxldCBjID0gMDsgYyA8IDEyOyBjKyspIHsKICAgICAgICBsZXQgZW5lcmd5ID0gMDsKICAgICAgICBjb25zdCBmcmVxQ2VudGVyID0gMjYxLjYzICogTWF0aC5wb3coMiwgYy8xMik7IC8vIEM0IGFuZCB1cAogICAgICAgIGNvbnN0IGJpbkNlbnRlciA9IE1hdGgucm91bmQoZnJlcUNlbnRlciAqIGZmdFNpemUgLyBzYW1wbGVSYXRlKTsKICAgICAgICBmb3IgKGxldCBiID0gTWF0aC5tYXgoMCwgYmluQ2VudGVyLTIpOyBiIDw9IE1hdGgubWluKGZmdFNpemUvMiwgYmluQ2VudGVyKzIpOyBiKyspIHsKICAgICAgICAgIGVuZXJneSArPSAoZGF0YVtpK2JdIHx8IDApICoqIDI7CiAgICAgICAgfQogICAgICAgIGNocm9tYVtjXSArPSBlbmVyZ3k7CiAgICAgIH0KICAgIH0KICAgIC8vIEZpbmQgZG9taW5hbnQgbm90ZQogICAgbGV0IG1heEUgPSAwLCBrZXkgPSAwOwogICAgZm9yIChsZXQgYyA9IDA7IGMgPCAxMjsgYysrKSB7IGlmIChjaHJvbWFbY10gPiBtYXhFKSB7IG1heEUgPSBjaHJvbWFbY107IGtleSA9IGM7IH0gfQogICAgcmV0dXJuIGtleTsKICB9IGNhdGNoKGUpIHsgcmV0dXJuIG51bGw7IH0KfQoKLy8gPT09PT09PT09PT09PT09PT09PSBDTE9TRSBQT1BVUFMgT04gT1ZFUkxBWSBDTElDSyA9PT09PT09PT09PT09PT09PT09CmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3B1cC1vdmVybGF5JykuZm9yRWFjaChvdmVybGF5ID0+IHsKICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGlmIChlLnRhcmdldCA9PT0gb3ZlcmxheSkgb3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7CiAgfSk7Cn0pOwoKLy8gPT09PT09PT09PT09PT09PT09PSBSRVNJWkUgSEFORExFUiA9PT09PT09PT09PT09PT09PT09CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCAoKSA9PiB7CiAgZGVja3MuZm9yRWFjaCgoZCwgaSkgPT4gewogICAgaWYgKGQuYnVmZmVyKSB7IGJ1aWxkV2F2ZWZvcm0oaSwgZC5idWZmZXIpOyBkcmF3QmVhdE1hcmtlcnMoaSk7IH0KICB9KTsKfSk7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K", "Synth": "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9Iml0Ij4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCxpbml0aWFsLXNjYWxlPTEsdmlld3BvcnQtZml0PWNvdmVyIiAvPgogIDx0aXRsZT44LVZvaWNlIEZyZXF1ZW5jeSBTeW50aCAoV2ViQXVkaW8pPC90aXRsZT4KICA8c3R5bGU+CiAgICA6cm9vdHsKICAgICAgLS1iZzojMGIwZjE0OwogICAgICAtLXBhbmVsOiMxMDE4MjY7CiAgICAgIC0tcGFuZWwyOiMwZjE1MjA7CiAgICAgIC0tdHh0OiNlN2VlZmM7CiAgICAgIC0tbXV0ZWQ6IzkyYTRjNjsKICAgICAgLS1hY2NlbnQ6IzRlYTFmZjsKICAgICAgLS1hY2NlbnQyOiM2YWYwYzI7CiAgICAgIC0td2FybjojZmZjYzY2OwogICAgICAtLWJhZDojZmY1YzdhOwogICAgICAtLW9rOiM0YmYwOGE7CiAgICAgIC0tYnI6MTZweDsKICAgICAgLS1nYXA6MTJweDsKICAgICAgLS1zaGFkb3c6IDAgMTBweCAzMHB4IHJnYmEoMCwwLDAsLjM1KTsKICAgICAgLS1saW5lOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMDgpOwogICAgICBmb250LXN5bnRoZXNpcy13ZWlnaHQ6IG5vbmU7CiAgICB9CiAgICAqe2JveC1zaXppbmc6Ym9yZGVyLWJveH0KICAgIGh0bWwsYm9keXtoZWlnaHQ6MTAwJX0KICAgIGJvZHl7CiAgICAgIG1hcmdpbjowOwogICAgICBmb250LWZhbWlseTogdWktc2Fucy1zZXJpZiwgc3lzdGVtLXVpLCAtYXBwbGUtc3lzdGVtLCBTZWdvZSBVSSwgUm9ib3RvLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KDEyMDBweCA4MDBweCBhdCA0MCUgMjAlLCByZ2JhKDc4LDE2MSwyNTUsLjEyKSwgdHJhbnNwYXJlbnQgNjAlKSwKICAgICAgICAgICAgICAgICAgcmFkaWFsLWdyYWRpZW50KDkwMHB4IDcwMHB4IGF0IDgwJSAxMCUsIHJnYmEoMTA2LDI0MCwxOTQsLjEwKSwgdHJhbnNwYXJlbnQgNTUlKSwKICAgICAgICAgICAgICAgICAgdmFyKC0tYmcpOwogICAgICBjb2xvcjp2YXIoLS10eHQpOwogICAgICBvdmVyZmxvdy14OmhpZGRlbjsKICAgIH0KICAgIC53cmFwewogICAgICBtYXgtd2lkdGg6MTIwMHB4OwogICAgICBtYXJnaW46MCBhdXRvOwogICAgICBwYWRkaW5nOjE4cHg7CiAgICAgIHBhZGRpbmctYm90dG9tOjQwcHg7CiAgICB9CiAgICBoZWFkZXJ7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgZmxleC13cmFwOndyYXA7CiAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAganVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47CiAgICAgIGdhcDoxMnB4OwogICAgICBtYXJnaW4tYm90dG9tOjE0cHg7CiAgICB9CiAgICAudGl0bGV7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246Y29sdW1uOwogICAgICBnYXA6MnB4OwogICAgICBtaW4td2lkdGg6MjYwcHg7CiAgICB9CiAgICAudGl0bGUgaDF7CiAgICAgIGZvbnQtc2l6ZToxOHB4OwogICAgICBtYXJnaW46MDsKICAgICAgbGV0dGVyLXNwYWNpbmc6LjJweDsKICAgIH0KICAgIC50aXRsZSBwewogICAgICBtYXJnaW46MDsKICAgICAgY29sb3I6dmFyKC0tbXV0ZWQpOwogICAgICBmb250LXNpemU6MTIuNXB4OwogICAgfQoKICAgIC5jYXJkewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCByZ2JhKDI1NSwyNTUsMjU1LC4wNSksIHJnYmEoMjU1LDI1NSwyNTUsLjAyKSk7CiAgICAgIGJvcmRlcjogdmFyKC0tbGluZSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLWJyKTsKICAgICAgYm94LXNoYWRvdzogdmFyKC0tc2hhZG93KTsKICAgIH0KICAgIC50b3B7CiAgICAgIGRpc3BsYXk6Z3JpZDsKICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxLjJmciAxZnI7CiAgICAgIGdhcDogdmFyKC0tZ2FwKTsKICAgICAgbWFyZ2luLWJvdHRvbTogdmFyKC0tZ2FwKTsKICAgIH0KICAgIEBtZWRpYSAobWF4LXdpZHRoOiA5MDBweCl7CiAgICAgIC50b3B7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmcn0KICAgIH0KICAgIC5jb250cm9sc3sKICAgICAgcGFkZGluZzoxNHB4OwogICAgfQogICAgLmNvbnRyb2xzIC5yb3d7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgZmxleC13cmFwOndyYXA7CiAgICAgIGdhcDoxMnB4OwogICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgIG1hcmdpbi10b3A6MTBweDsKICAgIH0KICAgIC5idG57CiAgICAgIGFwcGVhcmFuY2U6bm9uZTsKICAgICAgYm9yZGVyOiB2YXIoLS1saW5lKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwuMDYpOwogICAgICBjb2xvcjp2YXIoLS10eHQpOwogICAgICBwYWRkaW5nOjEwcHggMTJweDsKICAgICAgYm9yZGVyLXJhZGl1czogMTRweDsKICAgICAgY3Vyc29yOnBvaW50ZXI7CiAgICAgIGZvbnQtd2VpZ2h0OjYwMDsKICAgICAgbGV0dGVyLXNwYWNpbmc6LjJweDsKICAgICAgZGlzcGxheTppbmxpbmUtZmxleDsKICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICBnYXA6OHB4OwogICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gLjA2cyBlYXNlLCBiYWNrZ3JvdW5kIC4xNXMgZWFzZSwgYm9yZGVyLWNvbG9yIC4xNXMgZWFzZTsKICAgICAgdXNlci1zZWxlY3Q6bm9uZTsKICAgIH0KICAgIC5idG46aG92ZXJ7YmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwuMTApfQogICAgLmJ0bjphY3RpdmV7dHJhbnNmb3JtOiB0cmFuc2xhdGVZKDFweCl9CiAgICAuYnRuLnByaW1hcnl7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSg3OCwxNjEsMjU1LC41NSk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoNzgsMTYxLDI1NSwuMTYpOwogICAgfQogICAgLmJ0bi5kYW5nZXJ7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsOTIsMTIyLC41NSk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDkyLDEyMiwuMTQpOwogICAgfQogICAgLnBpbGx7CiAgICAgIHBhZGRpbmc6NnB4IDEwcHg7CiAgICAgIGJvcmRlci1yYWRpdXM6OTk5cHg7CiAgICAgIGZvbnQtc2l6ZToxMnB4OwogICAgICBib3JkZXI6IHZhcigtLWxpbmUpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LC4wNCk7CiAgICAgIGNvbG9yOiB2YXIoLS1tdXRlZCk7CiAgICAgIGRpc3BsYXk6aW5saW5lLWZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgZ2FwOjhweDsKICAgICAgd2hpdGUtc3BhY2U6bm93cmFwOwogICAgfQogICAgLnBpbGwgYntjb2xvcjp2YXIoLS10eHQpfQogICAgLmdyaWQyewogICAgICBkaXNwbGF5OmdyaWQ7CiAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDFmcjsKICAgICAgZ2FwOjEycHg7CiAgICAgIG1hcmdpbi10b3A6MTBweDsKICAgIH0KICAgIEBtZWRpYSAobWF4LXdpZHRoOiA1NjBweCl7CiAgICAgIC5ncmlkMntncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyfQogICAgfQogICAgLmt2ewogICAgICBwYWRkaW5nOjEwcHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgIGJvcmRlcjogdmFyKC0tbGluZSk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsLjE4KTsKICAgIH0KICAgIC5rdiBsYWJlbHsKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjsKICAgICAgZm9udC1zaXplOjEycHg7CiAgICAgIGNvbG9yOnZhcigtLW11dGVkKTsKICAgICAgbWFyZ2luLWJvdHRvbTo2cHg7CiAgICB9CiAgICBpbnB1dFt0eXBlPSJyYW5nZSJdewogICAgICB3aWR0aDoxMDAlOwogICAgICBhY2NlbnQtY29sb3I6IHZhcigtLWFjY2VudCk7CiAgICB9CiAgICBpbnB1dFt0eXBlPSJudW1iZXIiXSwgc2VsZWN0ewogICAgICB3aWR0aDoxMDAlOwogICAgICBwYWRkaW5nOjlweCAxMHB4OwogICAgICBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICBib3JkZXI6IHZhcigtLWxpbmUpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC4yNSk7CiAgICAgIGNvbG9yOiB2YXIoLS10eHQpOwogICAgICBvdXRsaW5lOm5vbmU7CiAgICB9CiAgICAuc21hbGx7CiAgICAgIGZvbnQtc2l6ZToxMnB4OwogICAgICBjb2xvcjp2YXIoLS1tdXRlZCk7CiAgICB9CiAgICAuc2NvcGV7CiAgICAgIHBhZGRpbmc6MTRweDsKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgICAgIGdhcDoxMHB4OwogICAgfQogICAgY2FudmFzewogICAgICB3aWR0aDoxMDAlOwogICAgICBoZWlnaHQ6MTUwcHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgIGJvcmRlcjogdmFyKC0tbGluZSk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsLjI1KTsKICAgIH0KCiAgICAudm9pY2VzewogICAgICBkaXNwbGF5OmdyaWQ7CiAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDIsIG1pbm1heCgwLCAxZnIpKTsKICAgICAgZ2FwOiB2YXIoLS1nYXApOwogICAgfQogICAgQG1lZGlhIChtYXgtd2lkdGg6IDkwMHB4KXsKICAgICAgLnZvaWNlc3tncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyfQogICAgfQogICAgLnZvaWNlewogICAgICBwYWRkaW5nOjE0cHg7CiAgICB9CiAgICAudm9pY2VIZWFkewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAganVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47CiAgICAgIGdhcDoxMHB4OwogICAgICBtYXJnaW4tYm90dG9tOjEwcHg7CiAgICB9CiAgICAudm9pY2VIZWFkIC5sZWZ0ewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgZ2FwOjEwcHg7CiAgICAgIG1pbi13aWR0aDoyMDBweDsKICAgIH0KICAgIC5iYWRnZXsKICAgICAgd2lkdGg6MjhweDtoZWlnaHQ6MjhweDtib3JkZXItcmFkaXVzOjEwcHg7CiAgICAgIGRpc3BsYXk6Z3JpZDtwbGFjZS1pdGVtczpjZW50ZXI7CiAgICAgIGJvcmRlcjogdmFyKC0tbGluZSk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsLjA1KTsKICAgICAgZm9udC13ZWlnaHQ6ODAwOwogICAgICBjb2xvcjogdmFyKC0tdHh0KTsKICAgIH0KICAgIC50b2dnbGVzewogICAgICBkaXNwbGF5OmZsZXg7IGdhcDo4cHg7IGZsZXgtd3JhcDp3cmFwOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6ZmxleC1lbmQ7CiAgICB9CiAgICAuY2hpcHsKICAgICAgYm9yZGVyOiB2YXIoLS1saW5lKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwuMDQpOwogICAgICBjb2xvcjogdmFyKC0tdHh0KTsKICAgICAgcGFkZGluZzo4cHggMTBweDsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIGZvbnQtd2VpZ2h0OjcwMDsKICAgICAgY3Vyc29yOnBvaW50ZXI7CiAgICAgIHVzZXItc2VsZWN0Om5vbmU7CiAgICAgIGZvbnQtc2l6ZToxMnB4OwogICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIC4xNXMgZWFzZSwgYm9yZGVyLWNvbG9yIC4xNXMgZWFzZSwgdHJhbnNmb3JtIC4wNnMgZWFzZTsKICAgIH0KICAgIC5jaGlwOmhvdmVye2JhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsLjA4KX0KICAgIC5jaGlwOmFjdGl2ZXt0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMXB4KX0KICAgIC5jaGlwLm9uewogICAgICBib3JkZXItY29sb3I6IHJnYmEoMTA2LDI0MCwxOTQsLjU1KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgxMDYsMjQwLDE5NCwuMTQpOwogICAgfQogICAgLmNoaXAuc29sby5vbnsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDI1NSwyMDQsMTAyLC42NSk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDIwNCwxMDIsLjE2KTsKICAgIH0KCiAgICAucm93M3sKICAgICAgZGlzcGxheTpncmlkOwogICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnIgMWZyOwogICAgICBnYXA6MTJweDsKICAgICAgbWFyZ2luLXRvcDoxMHB4OwogICAgfQogICAgQG1lZGlhIChtYXgtd2lkdGg6IDcwMHB4KXsKICAgICAgLnJvdzN7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmcn0KICAgIH0KCiAgICAuZm9vdGVyTm90ZXsKICAgICAgbWFyZ2luLXRvcDoxMnB4OwogICAgICBjb2xvcjp2YXIoLS1tdXRlZCk7CiAgICAgIGZvbnQtc2l6ZToxMnB4OwogICAgICBsaW5lLWhlaWdodDoxLjQ1OwogICAgfQogICAgLm1vbm97Zm9udC1mYW1pbHk6IHVpLW1vbm9zcGFjZSwgU0ZNb25vLVJlZ3VsYXIsIE1lbmxvLCBNb25hY28sIENvbnNvbGFzLCAiTGliZXJhdGlvbiBNb25vIiwgbW9ub3NwYWNlO30KICA8L3N0eWxlPgo8L2hlYWQ+Cgo8Ym9keT4KPGRpdiBjbGFzcz0id3JhcCI+CiAgPGhlYWRlcj4KICAgIDxkaXYgY2xhc3M9InRpdGxlIj4KICAgICAgPGgxPjgtVm9pY2UgRnJlcXVlbmN5IFN5bnRoPC9oMT4KICAgICAgPHA+V2ViQXVkaW8g4oCiIFNvbW1hIGZpbm8gYSA4IHZvY2kg4oCiIExpbWl0ZXIgYW50aS1jbGlwcGluZyDigKIgQURTUiDigKIgUGFuPC9wPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJwaWxsIj48c3Bhbj5TdGF0bzo8L3NwYW4+IDxiIGlkPSJzdGF0dXMiPlNUT1A8L2I+IDxzcGFuIGNsYXNzPSJtb25vIiBpZD0ic3IiPjwvc3Bhbj48L2Rpdj4KICA8L2hlYWRlcj4KCiAgPHNlY3Rpb24gY2xhc3M9InRvcCI+CiAgICA8ZGl2IGNsYXNzPSJjYXJkIGNvbnRyb2xzIj4KICAgICAgPGRpdiBjbGFzcz0icm93IiBzdHlsZT0ibWFyZ2luLXRvcDowOyBqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjsiPgogICAgICAgIDxkaXYgY2xhc3M9InJvdyIgc3R5bGU9Im1hcmdpbi10b3A6MDsiPgogICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIHByaW1hcnkiIGlkPSJidG5TdGFydCI+4pa277iPIFN0YXJ0PC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gZGFuZ2VyIiBpZD0iYnRuU3RvcCIgZGlzYWJsZWQ+4o+5IFN0b3A8L2J1dHRvbj4KICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgaWQ9ImJ0blBhbmljIiB0aXRsZT0iU2lsZW56aWEgc3ViaXRvIGUgcmVzZXQgZW52ZWxvcGUiPvCfp68gUGFuaWM8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJwaWxsIiB0aXRsZT0iU29tbWEgZGVsbGUgdm9jaSAocHJlLWxpbWl0ZXIpIGUgbGl2ZWxsbyBpbiB1c2NpdGEgKHBvc3QtbGltaXRlcikiPgogICAgICAgICAgPHNwYW4+TWl4Ojwvc3Bhbj4gPGIgaWQ9Im1peEluZm8iPuKAlDwvYj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJncmlkMiI+CiAgICAgICAgPGRpdiBjbGFzcz0ia3YiPgogICAgICAgICAgPGxhYmVsPgogICAgICAgICAgICA8c3Bhbj5NYXN0ZXIgVm9sdW1lPC9zcGFuPgogICAgICAgICAgICA8c3BhbiBjbGFzcz0ibW9ubyIgaWQ9Im1hc3RlclZhbCI+MC4zNTwvc3Bhbj4KICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICA8aW5wdXQgaWQ9Im1hc3RlciIgdHlwZT0icmFuZ2UiIG1pbj0iMCIgbWF4PSIxIiBzdGVwPSIwLjAwMSIgdmFsdWU9IjAuMzUiPgogICAgICAgICAgPGRpdiBjbGFzcz0ic21hbGwiPkNvbnNpZ2xpbzogdGllbmlsbyBiYXNzbyBzZSBhbHppIGkgZ2FpbiBkZWxsZSB2b2NpLjwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJrdiI+CiAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgIDxzcGFuPkxpbWl0ZXIgKFRocmVzaG9sZCk8L3NwYW4+CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJtb25vIiBpZD0ibGltVmFsIj4tNiBkQjwvc3Bhbj4KICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICA8aW5wdXQgaWQ9ImxpbWl0ZXIiIHR5cGU9InJhbmdlIiBtaW49Ii0yNCIgbWF4PSItMSIgc3RlcD0iMSIgdmFsdWU9Ii02Ij4KICAgICAgICAgIDxkaXYgY2xhc3M9InNtYWxsIj5MaW1pdGVyIHNvZnQta25lZSBjb24gY29tcHJlc3Nvci4gUmlkdWNlIGlsIGNsaXBwaW5nIHF1YW5kbyBzb21taSBwacO5IHZvY2kuPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBjbGFzcz0icm93MyI+CiAgICAgICAgPGRpdiBjbGFzcz0ia3YiPgogICAgICAgICAgPGxhYmVsPjxzcGFuPkF0dGFjazwvc3Bhbj48c3BhbiBjbGFzcz0ibW9ubyIgaWQ9ImFWYWwiPjAuMDEgczwvc3Bhbj48L2xhYmVsPgogICAgICAgICAgPGlucHV0IGlkPSJhdGsiIHR5cGU9InJhbmdlIiBtaW49IjAuMDAxIiBtYXg9IjIiIHN0ZXA9IjAuMDAxIiB2YWx1ZT0iMC4wMSI+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ia3YiPgogICAgICAgICAgPGxhYmVsPjxzcGFuPkRlY2F5PC9zcGFuPjxzcGFuIGNsYXNzPSJtb25vIiBpZD0iZFZhbCI+MC4xNSBzPC9zcGFuPjwvbGFiZWw+CiAgICAgICAgICA8aW5wdXQgaWQ9ImRlYyIgdHlwZT0icmFuZ2UiIG1pbj0iMC4wMDEiIG1heD0iMiIgc3RlcD0iMC4wMDEiIHZhbHVlPSIwLjE1Ij4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJrdiI+CiAgICAgICAgICA8bGFiZWw+PHNwYW4+U3VzdGFpbjwvc3Bhbj48c3BhbiBjbGFzcz0ibW9ubyIgaWQ9InNWYWwiPjAuNzA8L3NwYW4+PC9sYWJlbD4KICAgICAgICAgIDxpbnB1dCBpZD0ic3VzIiB0eXBlPSJyYW5nZSIgbWluPSIwIiBtYXg9IjEiIHN0ZXA9IjAuMDAxIiB2YWx1ZT0iMC43MCI+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBjbGFzcz0icm93MyI+CiAgICAgICAgPGRpdiBjbGFzcz0ia3YiPgogICAgICAgICAgPGxhYmVsPjxzcGFuPlJlbGVhc2U8L3NwYW4+PHNwYW4gY2xhc3M9Im1vbm8iIGlkPSJyVmFsIj4wLjI1IHM8L3NwYW4+PC9sYWJlbD4KICAgICAgICAgIDxpbnB1dCBpZD0icmVsIiB0eXBlPSJyYW5nZSIgbWluPSIwLjAwMSIgbWF4PSIzIiBzdGVwPSIwLjAwMSIgdmFsdWU9IjAuMjUiPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Imt2Ij4KICAgICAgICAgIDxsYWJlbD48c3Bhbj5HbG9iYWwgRGV0dW5lPC9zcGFuPjxzcGFuIGNsYXNzPSJtb25vIiBpZD0iZ0RldFZhbCI+MCBjZW50czwvc3Bhbj48L2xhYmVsPgogICAgICAgICAgPGlucHV0IGlkPSJnRGV0IiB0eXBlPSJyYW5nZSIgbWluPSItNTAiIG1heD0iNTAiIHN0ZXA9IjEiIHZhbHVlPSIwIj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJrdiI+CiAgICAgICAgICA8bGFiZWw+PHNwYW4+UHJlc2V0PC9zcGFuPjxzcGFuIGNsYXNzPSJtb25vIj5RdWljazwvc3Bhbj48L2xhYmVsPgogICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4OyBnYXA6MTBweDsiPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJwcmVzZXRDaG9yZCIgc3R5bGU9ImZsZXg6MTsiPvCfjrkgQ2hvcmQ8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0icHJlc2V0SGFybSIgc3R5bGU9ImZsZXg6MTsiPvCfjrsgSGFybTwvYnV0dG9uPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBjbGFzcz0iZm9vdGVyTm90ZSI+CiAgICAgICAgTm90YTogc3UgYWxjdW5pIGJyb3dzZXIgbOKAmWF1ZGlvIHBhcnRlIHNvbG8gZG9wbyB1biBjbGljayAoU3RhcnQpLiDigJxQYW5pY+KAnSBmb3J6YSB2b2x1bWUgYSB6ZXJvIGUgcmVzZXR0YS4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJjYXJkIHNjb3BlIj4KICAgICAgPGRpdiBjbGFzcz0icm93IiBzdHlsZT0ibWFyZ2luLXRvcDowOyBqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjsiPgogICAgICAgIDxkaXYgY2xhc3M9InBpbGwiPjxzcGFuPk9zY2lsbG9zY29waW88L3NwYW4+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icGlsbCI+PHNwYW4+RlBTOjwvc3Bhbj4gPGIgaWQ9ImZwcyI+4oCUPC9iPjwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGNhbnZhcyBpZD0ic2NvcGUiIHdpZHRoPSI5MDAiIGhlaWdodD0iMjYwIj48L2NhbnZhcz4KICAgICAgPGRpdiBjbGFzcz0ic21hbGwiPgogICAgICAgIFZpc3VhbGl6emEgaWwgc2VnbmFsZSBpbiB1c2NpdGEgKHBvc3QtbGltaXRlcikuIFNlIHZlZGkgbGEgZm9ybWEg4oCcdGFnbGlhdGHigJ0sIGFiYmFzc2EgbWFzdGVyIG8gaSBnYWluLgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogIDwvc2VjdGlvbj4KCiAgPHNlY3Rpb24gY2xhc3M9InZvaWNlcyIgaWQ9InZvaWNlcyI+PC9zZWN0aW9uPgoKICA8ZGl2IGNsYXNzPSJmb290ZXJOb3RlIj4KICAgIFN1Z2dlcmltZW50bzogcGVyIGdlbmVyYXJlIOKAnGZyZXF1ZW56ZSBtdWx0aXBsZeKAnSwgYXR0aXZhIHBpw7kgdm9jaSBlIGltcG9zdGEgZnJlcXVlbnplIGRpdmVyc2UgKGVzLiA0NDAsIDU1MCwgNjYw4oCmKS4KICA8L2Rpdj4KPC9kaXY+Cgo8c2NyaXB0PgooKCkgPT4gewogIGNvbnN0IE1BWF9WT0lDRVMgPSA4OwoKICAvLyAtLS0tLS0tLS0tIFVJIHJlZnMgLS0tLS0tLS0tLQogIGNvbnN0IGVsID0gKGlkKSA9PiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgY29uc3Qgc3RhdHVzRWwgPSBlbCgic3RhdHVzIik7CiAgY29uc3Qgc3JFbCA9IGVsKCJzciIpOwogIGNvbnN0IG1peEluZm9FbCA9IGVsKCJtaXhJbmZvIik7CiAgY29uc3QgbWFzdGVyRWwgPSBlbCgibWFzdGVyIik7CiAgY29uc3QgbWFzdGVyVmFsRWwgPSBlbCgibWFzdGVyVmFsIik7CiAgY29uc3QgbGltaXRlckVsID0gZWwoImxpbWl0ZXIiKTsKICBjb25zdCBsaW1WYWxFbCA9IGVsKCJsaW1WYWwiKTsKICBjb25zdCBhdGtFbCA9IGVsKCJhdGsiKSwgZGVjRWwgPSBlbCgiZGVjIiksIHN1c0VsID0gZWwoInN1cyIpLCByZWxFbCA9IGVsKCJyZWwiKTsKICBjb25zdCBhVmFsRWwgPSBlbCgiYVZhbCIpLCBkVmFsRWwgPSBlbCgiZFZhbCIpLCBzVmFsRWwgPSBlbCgic1ZhbCIpLCByVmFsRWwgPSBlbCgiclZhbCIpOwogIGNvbnN0IGdEZXRFbCA9IGVsKCJnRGV0IiksIGdEZXRWYWxFbCA9IGVsKCJnRGV0VmFsIik7CiAgY29uc3QgYnRuU3RhcnQgPSBlbCgiYnRuU3RhcnQiKSwgYnRuU3RvcCA9IGVsKCJidG5TdG9wIiksIGJ0blBhbmljID0gZWwoImJ0blBhbmljIik7CiAgY29uc3QgcHJlc2V0Q2hvcmQgPSBlbCgicHJlc2V0Q2hvcmQiKSwgcHJlc2V0SGFybSA9IGVsKCJwcmVzZXRIYXJtIik7CiAgY29uc3QgY2FudmFzID0gZWwoInNjb3BlIik7CiAgY29uc3QgY3R4MmQgPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICBjb25zdCBmcHNFbCA9IGVsKCJmcHMiKTsKICBjb25zdCB2b2ljZXNSb290ID0gZWwoInZvaWNlcyIpOwoKICAvLyAtLS0tLS0tLS0tIEF1ZGlvIGdyYXBoIC0tLS0tLS0tLS0KICBsZXQgYWMgPSBudWxsOwogIGxldCBtYXN0ZXJHYWluID0gbnVsbDsKICBsZXQgY29tcHJlc3NvciA9IG51bGw7CiAgbGV0IGFuYWx5c2VyID0gbnVsbDsKCiAgLy8gUGVyIHZvaWNlOiBvc2MgLT4gZ2FpbiAtPiBwYW5uZXIgLT4gbWl4QnVzCiAgY29uc3Qgdm9pY2VzID0gW107CgogIGNvbnN0IHN0YXRlID0gewogICAgcnVubmluZzogZmFsc2UsCiAgICBhZHNyOiB7IGE6ICthdGtFbC52YWx1ZSwgZDogK2RlY0VsLnZhbHVlLCBzOiArc3VzRWwudmFsdWUsIHI6ICtyZWxFbC52YWx1ZSB9LAogICAgZ2xvYmFsRGV0dW5lOiArZ0RldEVsLnZhbHVlCiAgfTsKCiAgZnVuY3Rpb24gZGJUb0xpbihkYil7IHJldHVybiBNYXRoLnBvdygxMCwgZGIvMjApOyB9CgogIGZ1bmN0aW9uIGVuc3VyZUF1ZGlvKCkgewogICAgaWYgKGFjKSByZXR1cm47CgogICAgYWMgPSBuZXcgKHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dCkoeyBsYXRlbmN5SGludDogImludGVyYWN0aXZlIiB9KTsKCiAgICBtYXN0ZXJHYWluID0gYWMuY3JlYXRlR2FpbigpOwogICAgbWFzdGVyR2Fpbi5nYWluLnZhbHVlID0gK21hc3RlckVsLnZhbHVlOwoKICAgIC8vIFNvZnQgbGltaXRlciB2aWEgY29tcHJlc3NvcgogICAgY29tcHJlc3NvciA9IGFjLmNyZWF0ZUR5bmFtaWNzQ29tcHJlc3NvcigpOwogICAgY29tcHJlc3Nvci50aHJlc2hvbGQudmFsdWUgPSArbGltaXRlckVsLnZhbHVlOyAvLyBkQgogICAgY29tcHJlc3Nvci5rbmVlLnZhbHVlID0gMTg7CiAgICBjb21wcmVzc29yLnJhdGlvLnZhbHVlID0gODsKICAgIGNvbXByZXNzb3IuYXR0YWNrLnZhbHVlID0gMC4wMDI7CiAgICBjb21wcmVzc29yLnJlbGVhc2UudmFsdWUgPSAwLjEyOwoKICAgIGFuYWx5c2VyID0gYWMuY3JlYXRlQW5hbHlzZXIoKTsKICAgIGFuYWx5c2VyLmZmdFNpemUgPSAyMDQ4OwogICAgYW5hbHlzZXIuc21vb3RoaW5nVGltZUNvbnN0YW50ID0gMC44NTsKCiAgICAvLyBjaGFpbjogbWl4IC0+IGNvbXByZXNzb3IgLT4gbWFzdGVyIC0+IGFuYWx5c2VyIC0+IGRlc3RpbmF0aW9uCiAgICAvLyBXZSdsbCBjb25uZWN0IHZvaWNlcyB0byBjb21wcmVzc29yIGRpcmVjdGx5IChtaXggYnVzKS4KICAgIGNvbXByZXNzb3IuY29ubmVjdChtYXN0ZXJHYWluKTsKICAgIG1hc3RlckdhaW4uY29ubmVjdChhbmFseXNlcik7CiAgICBhbmFseXNlci5jb25uZWN0KGFjLmRlc3RpbmF0aW9uKTsKCiAgICBzckVsLnRleHRDb250ZW50ID0gYCDigKIgJHtNYXRoLnJvdW5kKGFjLnNhbXBsZVJhdGUpfSBIemA7CgogICAgLy8gYnVpbGQgdm9pY2VzCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IE1BWF9WT0lDRVM7IGkrKykgewogICAgICBjb25zdCBvc2MgPSBhYy5jcmVhdGVPc2NpbGxhdG9yKCk7CiAgICAgIG9zYy50eXBlID0gInNpbmUiOwogICAgICBvc2MuZnJlcXVlbmN5LnZhbHVlID0gNDQwOwogICAgICBvc2MuZGV0dW5lLnZhbHVlID0gMDsKCiAgICAgIGNvbnN0IHZHYWluID0gYWMuY3JlYXRlR2FpbigpOwogICAgICB2R2Fpbi5nYWluLnZhbHVlID0gMC4wOyAvLyBlbnZlbG9wZSBjb250cm9sbGVkCgogICAgICBjb25zdCBwYW5uZXIgPSBhYy5jcmVhdGVTdGVyZW9QYW5uZXIoKTsKICAgICAgcGFubmVyLnBhbi52YWx1ZSA9IDA7CgogICAgICBvc2MuY29ubmVjdCh2R2FpbikuY29ubmVjdChwYW5uZXIpLmNvbm5lY3QoY29tcHJlc3Nvcik7CiAgICAgIG9zYy5zdGFydCgpOwoKICAgICAgdm9pY2VzLnB1c2goewogICAgICAgIGlkeDogaSsxLAogICAgICAgIG9zYywKICAgICAgICBnYWluOiB2R2FpbiwKICAgICAgICBwYW5uZXIsCiAgICAgICAgdWk6IG51bGwsCiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBvbjogZmFsc2UsCiAgICAgICAgICBzb2xvOiBmYWxzZSwKICAgICAgICAgIG11dGU6IGZhbHNlLAogICAgICAgICAgd2F2ZWZvcm06ICJzaW5lIiwKICAgICAgICAgIGZyZXE6IDQ0MCwKICAgICAgICAgIGRldHVuZTogMCwKICAgICAgICAgIGxldmVsOiAwLjIwLCAvLyB0YXJnZXQgcGVhayAocHJlIGVudmVsb3BlKQogICAgICAgICAgcGFuOiAwCiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBidWlsZFZvaWNlVUkoKTsKICAgIHVwZGF0ZU1peEluZm8oKTsKICB9CgogIC8vIC0tLS0tLS0tLS0gRW52ZWxvcGUgaGVscGVycyAtLS0tLS0tLS0tCiAgZnVuY3Rpb24gbm93KCkgeyByZXR1cm4gYWMgPyBhYy5jdXJyZW50VGltZSA6IDA7IH0KCiAgZnVuY3Rpb24gYXBwbHlWb2ljZVBhcmFtcyh2KSB7CiAgICB2Lm9zYy50eXBlID0gdi5wYXJhbXMud2F2ZWZvcm07CiAgICB2Lm9zYy5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUodi5wYXJhbXMuZnJlcSwgbm93KCkpOwogICAgdi5vc2MuZGV0dW5lLnNldFZhbHVlQXRUaW1lKHYucGFyYW1zLmRldHVuZSArIHN0YXRlLmdsb2JhbERldHVuZSwgbm93KCkpOwogICAgdi5wYW5uZXIucGFuLnNldFZhbHVlQXRUaW1lKHYucGFyYW1zLnBhbiwgbm93KCkpOwogIH0KCiAgZnVuY3Rpb24gdm9pY2VUYXJnZXRHYWluKHYpIHsKICAgIC8vIElmIHNvbG8gaXMgYWN0aXZlIG9uIGFueSB2b2ljZSwgb25seSBzb2xvIHZvaWNlcyBwYXNzICh1bmxlc3MgbXV0ZWQpLgogICAgY29uc3QgYW55U29sbyA9IHZvaWNlcy5zb21lKHggPT4geC5wYXJhbXMuc29sbyk7CiAgICBpZiAoYW55U29sbyAmJiAhdi5wYXJhbXMuc29sbykgcmV0dXJuIDA7CiAgICBpZiAoIXYucGFyYW1zLm9uKSByZXR1cm4gMDsKICAgIGlmICh2LnBhcmFtcy5tdXRlKSByZXR1cm4gMDsKICAgIHJldHVybiB2LnBhcmFtcy5sZXZlbDsKICB9CgogIGZ1bmN0aW9uIGVudk9uKHYpIHsKICAgIGNvbnN0IHQgPSBub3coKTsKICAgIGNvbnN0IHthLGQsc30gPSBzdGF0ZS5hZHNyOwoKICAgIGNvbnN0IHRhcmdldCA9IHZvaWNlVGFyZ2V0R2Fpbih2KTsKICAgIHYuZ2Fpbi5nYWluLmNhbmNlbFNjaGVkdWxlZFZhbHVlcyh0KTsKCiAgICAvLyBTdGFydCBmcm9tIGN1cnJlbnQgdmFsdWUgKHByZXZlbnRzIGNsaWNrcyBpZiByZXRyaWdnZXIpCiAgICBjb25zdCBjdXJyZW50ID0gdi5nYWluLmdhaW4udmFsdWU7CiAgICB2LmdhaW4uZ2Fpbi5zZXRWYWx1ZUF0VGltZShjdXJyZW50LCB0KTsKCiAgICAvLyBBdHRhY2sgdG8gdGFyZ2V0CiAgICB2LmdhaW4uZ2Fpbi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSh0YXJnZXQsIHQgKyBhKTsKCiAgICAvLyBEZWNheSB0byBzdXN0YWluIGxldmVsIChyZWxhdGl2ZSB0byB0YXJnZXQpCiAgICBjb25zdCBzdXNMZXZlbCA9IHRhcmdldCAqIHM7CiAgICB2LmdhaW4uZ2Fpbi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZShzdXNMZXZlbCwgdCArIGEgKyBkKTsKICB9CgogIGZ1bmN0aW9uIGVudk9mZih2KSB7CiAgICBjb25zdCB0ID0gbm93KCk7CiAgICBjb25zdCB7cn0gPSBzdGF0ZS5hZHNyOwogICAgdi5nYWluLmdhaW4uY2FuY2VsU2NoZWR1bGVkVmFsdWVzKHQpOwogICAgdi5nYWluLmdhaW4uc2V0VmFsdWVBdFRpbWUodi5nYWluLmdhaW4udmFsdWUsIHQpOwogICAgdi5nYWluLmdhaW4ubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoMC4wLCB0ICsgcik7CiAgfQoKICBmdW5jdGlvbiByZWZyZXNoQWxsRW52ZWxvcGVzKCkgewogICAgLy8gQ2FsbGVkIHdoZW4gc29sby9tdXRlL21hc3RlciBjaGFuZ2VzIGV0Yy4KICAgIGlmICghYWMpIHJldHVybjsKICAgIHZvaWNlcy5mb3JFYWNoKHYgPT4gewogICAgICBhcHBseVZvaWNlUGFyYW1zKHYpOwogICAgICBjb25zdCB0Z3QgPSB2b2ljZVRhcmdldEdhaW4odik7CiAgICAgIC8vIFNtb290aGx5IGFwcHJvYWNoIG5ldyB0YXJnZXQgKGtlZXAgc3VzdGFpbiBmZWVsKQogICAgICBjb25zdCB0ID0gbm93KCk7CiAgICAgIHYuZ2Fpbi5nYWluLmNhbmNlbFNjaGVkdWxlZFZhbHVlcyh0KTsKICAgICAgdi5nYWluLmdhaW4uc2V0VmFsdWVBdFRpbWUodi5nYWluLmdhaW4udmFsdWUsIHQpOwogICAgICB2LmdhaW4uZ2Fpbi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSh0Z3QgKiBzdGF0ZS5hZHNyLnMsIHQgKyAwLjAzKTsKICAgIH0pOwogICAgdXBkYXRlTWl4SW5mbygpOwogIH0KCiAgLy8gLS0tLS0tLS0tLSBVSSBidWlsZGluZyAtLS0tLS0tLS0tCiAgZnVuY3Rpb24gYnVpbGRWb2ljZVVJKCkgewogICAgdm9pY2VzUm9vdC5pbm5lckhUTUwgPSAiIjsKICAgIHZvaWNlcy5mb3JFYWNoKHYgPT4gewogICAgICBjb25zdCBjYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGNhcmQuY2xhc3NOYW1lID0gImNhcmQgdm9pY2UiOwogICAgICBjYXJkLmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJ2b2ljZUhlYWQiPgogICAgICAgICAgPGRpdiBjbGFzcz0ibGVmdCI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJhZGdlIj4ke3YuaWR4fTwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsgZ2FwOjJweDsiPgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjgwMDsgbGV0dGVyLXNwYWNpbmc6LjJweDsiPlZvaWNlICR7di5pZHh9PC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic21hbGwgbW9ubyIgaWQ9InZJbmZvXyR7di5pZHh9Ij5mcmVxIDQ0MCBIeiDigKIgZ2FpbiAwLjIwIOKAoiBwYW4gMDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0idG9nZ2xlcyI+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImNoaXAgb24iIGlkPSJ2T25fJHt2LmlkeH0iPk9OPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImNoaXAiIGlkPSJ2TXV0ZV8ke3YuaWR4fSI+TVVURTwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJjaGlwIHNvbG8iIGlkPSJ2U29sb18ke3YuaWR4fSI+U09MTzwvYnV0dG9uPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9InJvdzMiPgogICAgICAgICAgPGRpdiBjbGFzcz0ia3YiPgogICAgICAgICAgICA8bGFiZWw+PHNwYW4+V2F2ZWZvcm08L3NwYW4+PHNwYW4gY2xhc3M9Im1vbm8iIGlkPSJ2V2F2ZUxibF8ke3YuaWR4fSI+JHt2LnBhcmFtcy53YXZlZm9ybX08L3NwYW4+PC9sYWJlbD4KICAgICAgICAgICAgPHNlbGVjdCBpZD0idldhdmVfJHt2LmlkeH0iPgogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9InNpbmUiPnNpbmU8L29wdGlvbj4KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJ0cmlhbmdsZSI+dHJpYW5nbGU8L29wdGlvbj4KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJzYXd0b290aCI+c2F3dG9vdGg8L29wdGlvbj4KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJzcXVhcmUiPnNxdWFyZTwvb3B0aW9uPgogICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgIDxkaXYgY2xhc3M9Imt2Ij4KICAgICAgICAgICAgPGxhYmVsPjxzcGFuPkZyZXF1ZW5jeTwvc3Bhbj48c3BhbiBjbGFzcz0ibW9ubyIgaWQ9InZGcmVxTGJsXyR7di5pZHh9Ij40NDAgSHo8L3NwYW4+PC9sYWJlbD4KICAgICAgICAgICAgPGlucHV0IGlkPSJ2RnJlcV8ke3YuaWR4fSIgdHlwZT0icmFuZ2UiIG1pbj0iMjAiIG1heD0iMjAwMCIgc3RlcD0iMSIgdmFsdWU9IjQ0MCI+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDsgZ2FwOjEwcHg7IG1hcmdpbi10b3A6OHB4OyI+CiAgICAgICAgICAgICAgPGlucHV0IGlkPSJ2RnJlcU51bV8ke3YuaWR4fSIgdHlwZT0ibnVtYmVyIiBtaW49IjEiIG1heD0iMjAwMDAiIHN0ZXA9IjEiIHZhbHVlPSI0NDAiPgogICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgaWQ9InZBNF8ke3YuaWR4fSIgdGl0bGU9IlNldCA0NDAgSHoiPkE0PC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CgogICAgICAgICAgPGRpdiBjbGFzcz0ia3YiPgogICAgICAgICAgICA8bGFiZWw+PHNwYW4+TGV2ZWw8L3NwYW4+PHNwYW4gY2xhc3M9Im1vbm8iIGlkPSJ2THZsTGJsXyR7di5pZHh9Ij4wLjIwPC9zcGFuPjwvbGFiZWw+CiAgICAgICAgICAgIDxpbnB1dCBpZD0idkx2bF8ke3YuaWR4fSIgdHlwZT0icmFuZ2UiIG1pbj0iMCIgbWF4PSIxIiBzdGVwPSIwLjAwMSIgdmFsdWU9IiR7di5wYXJhbXMubGV2ZWx9Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic21hbGwiPlF1ZXN0byDDqCBpbCBsaXZlbGxvIOKAnGJhc2XigJ0gcHJpbWEgZGVsbOKAmUFEU1IuPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBjbGFzcz0icm93MyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJrdiI+CiAgICAgICAgICAgIDxsYWJlbD48c3Bhbj5EZXR1bmU8L3NwYW4+PHNwYW4gY2xhc3M9Im1vbm8iIGlkPSJ2RGV0TGJsXyR7di5pZHh9Ij4wIGNlbnRzPC9zcGFuPjwvbGFiZWw+CiAgICAgICAgICAgIDxpbnB1dCBpZD0idkRldF8ke3YuaWR4fSIgdHlwZT0icmFuZ2UiIG1pbj0iLTEyMDAiIG1heD0iMTIwMCIgc3RlcD0iMSIgdmFsdWU9IjAiPgogICAgICAgICAgPC9kaXY+CgogICAgICAgICAgPGRpdiBjbGFzcz0ia3YiPgogICAgICAgICAgICA8bGFiZWw+PHNwYW4+UGFuPC9zcGFuPjxzcGFuIGNsYXNzPSJtb25vIiBpZD0idlBhbkxibF8ke3YuaWR4fSI+MDwvc3Bhbj48L2xhYmVsPgogICAgICAgICAgICA8aW5wdXQgaWQ9InZQYW5fJHt2LmlkeH0iIHR5cGU9InJhbmdlIiBtaW49Ii0xIiBtYXg9IjEiIHN0ZXA9IjAuMDAxIiB2YWx1ZT0iMCI+CiAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICA8ZGl2IGNsYXNzPSJrdiI+CiAgICAgICAgICAgIDxsYWJlbD48c3Bhbj5RdWljazwvc3Bhbj48c3BhbiBjbGFzcz0ibW9ubyI+QWN0aW9uczwvc3Bhbj48L2xhYmVsPgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGdhcDoxMHB4OyI+CiAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0idlRyaWdfJHt2LmlkeH0iIHN0eWxlPSJmbGV4OjE7Ij7wn5SKIFRyaWdnZXI8L2J1dHRvbj4KICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIGlkPSJ2T2ZmXyR7di5pZHh9IiBzdHlsZT0iZmxleDoxOyI+8J+UhyBPZmY8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgYDsKCiAgICAgIHZvaWNlc1Jvb3QuYXBwZW5kQ2hpbGQoY2FyZCk7CgogICAgICAvLyBCaW5kIFVJCiAgICAgIGNvbnN0IG9uQnRuID0gZWwoYHZPbl8ke3YuaWR4fWApOwogICAgICBjb25zdCBtdXRlQnRuID0gZWwoYHZNdXRlXyR7di5pZHh9YCk7CiAgICAgIGNvbnN0IHNvbG9CdG4gPSBlbChgdlNvbG9fJHt2LmlkeH1gKTsKICAgICAgY29uc3Qgd2F2ZVNlbCA9IGVsKGB2V2F2ZV8ke3YuaWR4fWApOwogICAgICBjb25zdCBmcmVxUiA9IGVsKGB2RnJlcV8ke3YuaWR4fWApOwogICAgICBjb25zdCBmcmVxTiA9IGVsKGB2RnJlcU51bV8ke3YuaWR4fWApOwogICAgICBjb25zdCBhNEJ0biA9IGVsKGB2QTRfJHt2LmlkeH1gKTsKICAgICAgY29uc3QgbHZsUiA9IGVsKGB2THZsXyR7di5pZHh9YCk7CiAgICAgIGNvbnN0IGRldFIgPSBlbChgdkRldF8ke3YuaWR4fWApOwogICAgICBjb25zdCBwYW5SID0gZWwoYHZQYW5fJHt2LmlkeH1gKTsKICAgICAgY29uc3QgdHJpZ0J0biA9IGVsKGB2VHJpZ18ke3YuaWR4fWApOwogICAgICBjb25zdCBvZmZCdG4gPSBlbChgdk9mZl8ke3YuaWR4fWApOwoKICAgICAgZnVuY3Rpb24gc3luY0luZm8oKSB7CiAgICAgICAgZWwoYHZXYXZlTGJsXyR7di5pZHh9YCkudGV4dENvbnRlbnQgPSB2LnBhcmFtcy53YXZlZm9ybTsKICAgICAgICBlbChgdkZyZXFMYmxfJHt2LmlkeH1gKS50ZXh0Q29udGVudCA9IGAke01hdGgucm91bmQodi5wYXJhbXMuZnJlcSl9IEh6YDsKICAgICAgICBlbChgdkx2bExibF8ke3YuaWR4fWApLnRleHRDb250ZW50ID0gdi5wYXJhbXMubGV2ZWwudG9GaXhlZCgyKTsKICAgICAgICBlbChgdkRldExibF8ke3YuaWR4fWApLnRleHRDb250ZW50ID0gYCR7di5wYXJhbXMuZGV0dW5lfDB9IGNlbnRzYDsKICAgICAgICBlbChgdlBhbkxibF8ke3YuaWR4fWApLnRleHRDb250ZW50ID0gYCR7di5wYXJhbXMucGFuLnRvRml4ZWQoMil9YDsKICAgICAgICBlbChgdkluZm9fJHt2LmlkeH1gKS50ZXh0Q29udGVudCA9CiAgICAgICAgICBgZnJlcSAke01hdGgucm91bmQodi5wYXJhbXMuZnJlcSl9IEh6IOKAoiBnYWluICR7di5wYXJhbXMubGV2ZWwudG9GaXhlZCgyKX0g4oCiIHBhbiAke3YucGFyYW1zLnBhbi50b0ZpeGVkKDIpfWA7CgogICAgICAgIG9uQnRuLmNsYXNzTGlzdC50b2dnbGUoIm9uIiwgdi5wYXJhbXMub24pOwogICAgICAgIG11dGVCdG4uY2xhc3NMaXN0LnRvZ2dsZSgib24iLCB2LnBhcmFtcy5tdXRlKTsKICAgICAgICBzb2xvQnRuLmNsYXNzTGlzdC50b2dnbGUoIm9uIiwgdi5wYXJhbXMuc29sbyk7CiAgICAgICAgb25CdG4udGV4dENvbnRlbnQgPSB2LnBhcmFtcy5vbiA/ICJPTiIgOiAiT0ZGIjsKICAgICAgfQoKICAgICAgb25CdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgdi5wYXJhbXMub24gPSAhdi5wYXJhbXMub247CiAgICAgICAgc3luY0luZm8oKTsKICAgICAgICBpZiAoIWFjKSByZXR1cm47CiAgICAgICAgYXBwbHlWb2ljZVBhcmFtcyh2KTsKICAgICAgICBpZiAodi5wYXJhbXMub24pIGVudk9uKHYpOyBlbHNlIGVudk9mZih2KTsKICAgICAgICByZWZyZXNoQWxsRW52ZWxvcGVzKCk7CiAgICAgIH0pOwoKICAgICAgbXV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgICB2LnBhcmFtcy5tdXRlID0gIXYucGFyYW1zLm11dGU7CiAgICAgICAgc3luY0luZm8oKTsKICAgICAgICByZWZyZXNoQWxsRW52ZWxvcGVzKCk7CiAgICAgIH0pOwoKICAgICAgc29sb0J0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgICB2LnBhcmFtcy5zb2xvID0gIXYucGFyYW1zLnNvbG87CiAgICAgICAgc3luY0luZm8oKTsKICAgICAgICByZWZyZXNoQWxsRW52ZWxvcGVzKCk7CiAgICAgIH0pOwoKICAgICAgd2F2ZVNlbC5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCAoKSA9PiB7CiAgICAgICAgdi5wYXJhbXMud2F2ZWZvcm0gPSB3YXZlU2VsLnZhbHVlOwogICAgICAgIHN5bmNJbmZvKCk7CiAgICAgICAgaWYgKGFjKSBhcHBseVZvaWNlUGFyYW1zKHYpOwogICAgICB9KTsKCiAgICAgIGZ1bmN0aW9uIHNldEZyZXEodmFsKSB7CiAgICAgICAgdi5wYXJhbXMuZnJlcSA9IE1hdGgubWF4KDEsIE1hdGgubWluKDIwMDAwLCBOdW1iZXIodmFsKSB8fCAwKSk7CiAgICAgICAgZnJlcVIudmFsdWUgPSBTdHJpbmcoTWF0aC5taW4oMjAwMCwgTWF0aC5tYXgoMjAsIHYucGFyYW1zLmZyZXEpKSk7CiAgICAgICAgZnJlcU4udmFsdWUgPSBTdHJpbmcoTWF0aC5yb3VuZCh2LnBhcmFtcy5mcmVxKSk7CiAgICAgICAgc3luY0luZm8oKTsKICAgICAgICBpZiAoYWMpIHsKICAgICAgICAgIHYub3NjLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZSh2LnBhcmFtcy5mcmVxLCBub3coKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmcmVxUi5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsICgpID0+IHNldEZyZXEoZnJlcVIudmFsdWUpKTsKICAgICAgZnJlcU4uYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCkgPT4gc2V0RnJlcShmcmVxTi52YWx1ZSkpOwogICAgICBhNEJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHNldEZyZXEoNDQwKSk7CgogICAgICBsdmxSLmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKCkgPT4gewogICAgICAgIHYucGFyYW1zLmxldmVsID0gTnVtYmVyKGx2bFIudmFsdWUpOwogICAgICAgIHN5bmNJbmZvKCk7CiAgICAgICAgcmVmcmVzaEFsbEVudmVsb3BlcygpOwogICAgICB9KTsKCiAgICAgIGRldFIuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCAoKSA9PiB7CiAgICAgICAgdi5wYXJhbXMuZGV0dW5lID0gTnVtYmVyKGRldFIudmFsdWUpOwogICAgICAgIHN5bmNJbmZvKCk7CiAgICAgICAgaWYgKGFjKSB2Lm9zYy5kZXR1bmUuc2V0VmFsdWVBdFRpbWUodi5wYXJhbXMuZGV0dW5lICsgc3RhdGUuZ2xvYmFsRGV0dW5lLCBub3coKSk7CiAgICAgIH0pOwoKICAgICAgcGFuUi5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsICgpID0+IHsKICAgICAgICB2LnBhcmFtcy5wYW4gPSBOdW1iZXIocGFuUi52YWx1ZSk7CiAgICAgICAgc3luY0luZm8oKTsKICAgICAgICBpZiAoYWMpIHYucGFubmVyLnBhbi5zZXRWYWx1ZUF0VGltZSh2LnBhcmFtcy5wYW4sIG5vdygpKTsKICAgICAgfSk7CgogICAgICB0cmlnQnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICAgIHYucGFyYW1zLm9uID0gdHJ1ZTsKICAgICAgICBzeW5jSW5mbygpOwogICAgICAgIGlmICghYWMpIHJldHVybjsKICAgICAgICBhcHBseVZvaWNlUGFyYW1zKHYpOwogICAgICAgIGVudk9uKHYpOwogICAgICAgIHJlZnJlc2hBbGxFbnZlbG9wZXMoKTsKICAgICAgfSk7CgogICAgICBvZmZCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgdi5wYXJhbXMub24gPSBmYWxzZTsKICAgICAgICBzeW5jSW5mbygpOwogICAgICAgIGlmICghYWMpIHJldHVybjsKICAgICAgICBlbnZPZmYodik7CiAgICAgICAgcmVmcmVzaEFsbEVudmVsb3BlcygpOwogICAgICB9KTsKCiAgICAgIC8vIGluaXRpYWwgVUkgc3RhdGUKICAgICAgdi5wYXJhbXMub24gPSBmYWxzZTsKICAgICAgc3luY0luZm8oKTsKCiAgICAgIHYudWkgPSB7IGNhcmQgfTsKICAgIH0pOwogIH0KCiAgLy8gLS0tLS0tLS0tLSBHbG9iYWwgVUkgYmluZGluZ3MgLS0tLS0tLS0tLQogIGZ1bmN0aW9uIHNldEFEU1JMYWJlbHMoKSB7CiAgICBhVmFsRWwudGV4dENvbnRlbnQgPSBgJHsoK2F0a0VsLnZhbHVlKS50b0ZpeGVkKDMpfSBzYDsKICAgIGRWYWxFbC50ZXh0Q29udGVudCA9IGAkeygrZGVjRWwudmFsdWUpLnRvRml4ZWQoMyl9IHNgOwogICAgc1ZhbEVsLnRleHRDb250ZW50ID0gYCR7KCtzdXNFbC52YWx1ZSkudG9GaXhlZCgzKX1gOwogICAgclZhbEVsLnRleHRDb250ZW50ID0gYCR7KCtyZWxFbC52YWx1ZSkudG9GaXhlZCgzKX0gc2A7CiAgfQogIGZ1bmN0aW9uIHNldExpbWl0ZXJMYWJlbCgpIHsKICAgIGxpbVZhbEVsLnRleHRDb250ZW50ID0gYCR7KCtsaW1pdGVyRWwudmFsdWUpfSBkQmA7CiAgfQogIGZ1bmN0aW9uIHNldE1hc3RlckxhYmVsKCkgewogICAgbWFzdGVyVmFsRWwudGV4dENvbnRlbnQgPSAoK21hc3RlckVsLnZhbHVlKS50b0ZpeGVkKDMpOwogIH0KICBmdW5jdGlvbiBzZXRHbG9iYWxEZXR1bmVMYWJlbCgpIHsKICAgIGdEZXRWYWxFbC50ZXh0Q29udGVudCA9IGAkeygrZ0RldEVsLnZhbHVlKXwwfSBjZW50c2A7CiAgfQoKICBhdGtFbC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsICgpID0+IHsgc3RhdGUuYWRzci5hID0gK2F0a0VsLnZhbHVlOyBzZXRBRFNSTGFiZWxzKCk7IHJlZnJlc2hBbGxFbnZlbG9wZXMoKTsgfSk7CiAgZGVjRWwuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCAoKSA9PiB7IHN0YXRlLmFkc3IuZCA9ICtkZWNFbC52YWx1ZTsgc2V0QURTUkxhYmVscygpOyByZWZyZXNoQWxsRW52ZWxvcGVzKCk7IH0pOwogIHN1c0VsLmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKCkgPT4geyBzdGF0ZS5hZHNyLnMgPSArc3VzRWwudmFsdWU7IHNldEFEU1JMYWJlbHMoKTsgcmVmcmVzaEFsbEVudmVsb3BlcygpOyB9KTsKICByZWxFbC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsICgpID0+IHsgc3RhdGUuYWRzci5yID0gK3JlbEVsLnZhbHVlOyBzZXRBRFNSTGFiZWxzKCk7IC8qIHJlbGVhc2UgYWZmZWN0cyBvZmYgKi8gfSk7CgogIG1hc3RlckVsLmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKCkgPT4gewogICAgc2V0TWFzdGVyTGFiZWwoKTsKICAgIGlmIChtYXN0ZXJHYWluKSBtYXN0ZXJHYWluLmdhaW4uc2V0VmFsdWVBdFRpbWUoK21hc3RlckVsLnZhbHVlLCBub3coKSk7CiAgfSk7CgogIGxpbWl0ZXJFbC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsICgpID0+IHsKICAgIHNldExpbWl0ZXJMYWJlbCgpOwogICAgaWYgKGNvbXByZXNzb3IpIGNvbXByZXNzb3IudGhyZXNob2xkLnNldFZhbHVlQXRUaW1lKCtsaW1pdGVyRWwudmFsdWUsIG5vdygpKTsKICB9KTsKCiAgZ0RldEVsLmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKCkgPT4gewogICAgc3RhdGUuZ2xvYmFsRGV0dW5lID0gK2dEZXRFbC52YWx1ZTsKICAgIHNldEdsb2JhbERldHVuZUxhYmVsKCk7CiAgICBpZiAoYWMpIHsKICAgICAgdm9pY2VzLmZvckVhY2godiA9PiB2Lm9zYy5kZXR1bmUuc2V0VmFsdWVBdFRpbWUodi5wYXJhbXMuZGV0dW5lICsgc3RhdGUuZ2xvYmFsRGV0dW5lLCBub3coKSkpOwogICAgfQogIH0pOwoKICBidG5TdGFydC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGFzeW5jICgpID0+IHsKICAgIGVuc3VyZUF1ZGlvKCk7CiAgICBpZiAoYWMuc3RhdGUgPT09ICJzdXNwZW5kZWQiKSBhd2FpdCBhYy5yZXN1bWUoKTsKICAgIHN0YXRlLnJ1bm5pbmcgPSB0cnVlOwogICAgc3RhdHVzRWwudGV4dENvbnRlbnQgPSAiUlVOIjsKICAgIGJ0blN0YXJ0LmRpc2FibGVkID0gdHJ1ZTsKICAgIGJ0blN0b3AuZGlzYWJsZWQgPSBmYWxzZTsKICAgIHN0YXJ0U2NvcGUoKTsKICB9KTsKCiAgYnRuU3RvcC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGFzeW5jICgpID0+IHsKICAgIGlmICghYWMpIHJldHVybjsKICAgIC8vIEZhZGUgb3V0IHNtb290aGx5IHRoZW4gc3VzcGVuZAogICAgY29uc3QgdCA9IG5vdygpOwogICAgbWFzdGVyR2Fpbi5nYWluLmNhbmNlbFNjaGVkdWxlZFZhbHVlcyh0KTsKICAgIG1hc3RlckdhaW4uZ2Fpbi5zZXRWYWx1ZUF0VGltZShtYXN0ZXJHYWluLmdhaW4udmFsdWUsIHQpOwogICAgbWFzdGVyR2Fpbi5nYWluLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKDAuMCwgdCArIDAuMDUpOwoKICAgIHZvaWNlcy5mb3JFYWNoKHYgPT4gZW52T2ZmKHYpKTsKCiAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKICAgICAgdHJ5IHsgYXdhaXQgYWMuc3VzcGVuZCgpOyB9IGNhdGNoIHt9CiAgICAgIG1hc3RlckdhaW4uZ2Fpbi5zZXRWYWx1ZUF0VGltZSgrbWFzdGVyRWwudmFsdWUsIG5vdygpKTsKICAgICAgc3RhdGUucnVubmluZyA9IGZhbHNlOwogICAgICBzdGF0dXNFbC50ZXh0Q29udGVudCA9ICJTVE9QIjsKICAgICAgYnRuU3RhcnQuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgYnRuU3RvcC5kaXNhYmxlZCA9IHRydWU7CiAgICB9LCA3MCk7CiAgfSk7CgogIGJ0blBhbmljLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgaWYgKCFhYykgcmV0dXJuOwogICAgY29uc3QgdCA9IG5vdygpOwogICAgdm9pY2VzLmZvckVhY2godiA9PiB7CiAgICAgIHYucGFyYW1zLm9uID0gZmFsc2U7CiAgICAgIHYucGFyYW1zLm11dGUgPSBmYWxzZTsKICAgICAgdi5wYXJhbXMuc29sbyA9IGZhbHNlOwogICAgICB2LmdhaW4uZ2Fpbi5jYW5jZWxTY2hlZHVsZWRWYWx1ZXModCk7CiAgICAgIHYuZ2Fpbi5nYWluLnNldFZhbHVlQXRUaW1lKDAsIHQpOwogICAgICAvLyB1cGRhdGUgVUkgY2hpcHMKICAgICAgY29uc3Qgb25CdG4gPSBlbChgdk9uXyR7di5pZHh9YCk7CiAgICAgIGNvbnN0IG11dGVCdG4gPSBlbChgdk11dGVfJHt2LmlkeH1gKTsKICAgICAgY29uc3Qgc29sb0J0biA9IGVsKGB2U29sb18ke3YuaWR4fWApOwogICAgICBpZiAob25CdG4pIHsgb25CdG4uY2xhc3NMaXN0LnJlbW92ZSgib24iKTsgb25CdG4udGV4dENvbnRlbnQgPSAiT0ZGIjsgfQogICAgICBpZiAobXV0ZUJ0bikgbXV0ZUJ0bi5jbGFzc0xpc3QucmVtb3ZlKCJvbiIpOwogICAgICBpZiAoc29sb0J0bikgc29sb0J0bi5jbGFzc0xpc3QucmVtb3ZlKCJvbiIpOwogICAgfSk7CgogICAgLy8gUXVpY2sgbWFzdGVyIGRpcCAobm8gY2xpY2tzKQogICAgbWFzdGVyR2Fpbi5nYWluLmNhbmNlbFNjaGVkdWxlZFZhbHVlcyh0KTsKICAgIG1hc3RlckdhaW4uZ2Fpbi5zZXRWYWx1ZUF0VGltZShtYXN0ZXJHYWluLmdhaW4udmFsdWUsIHQpOwogICAgbWFzdGVyR2Fpbi5nYWluLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKDAuMCwgdCArIDAuMDEpOwogICAgbWFzdGVyR2Fpbi5nYWluLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCttYXN0ZXJFbC52YWx1ZSwgdCArIDAuMDgpOwoKICAgIHVwZGF0ZU1peEluZm8oKTsKICB9KTsKCiAgcHJlc2V0Q2hvcmQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICBlbnN1cmVBdWRpbygpOwogICAgLy8gQSBtYWpvciBjaG9yZDogNDQwIChBNCksIDU1NC4zNyAoQyM1KSwgNjU5LjI1IChFNSkgKyBvY3RhdmUKICAgIGNvbnN0IGZyZXFzID0gWzQ0MCwgNTU0LjM3LCA2NTkuMjUsIDg4MCwgMTEwOC43MywgMTMxOC41MSwgMjIwLCAzMjkuNjNdOwogICAgdm9pY2VzLmZvckVhY2goKHYsaSkgPT4gewogICAgICB2LnBhcmFtcy53YXZlZm9ybSA9IChpIDwgNCkgPyAic2F3dG9vdGgiIDogInRyaWFuZ2xlIjsKICAgICAgdi5wYXJhbXMuZnJlcSA9IGZyZXFzW2ldIHx8IDQ0MDsKICAgICAgdi5wYXJhbXMubGV2ZWwgPSAoaSA8IDMpID8gMC4xOCA6IDAuMTA7CiAgICAgIHYucGFyYW1zLmRldHVuZSA9IChpJTI9PT0wKSA/IC02IDogNjsKICAgICAgdi5wYXJhbXMucGFuID0gKGklMj09PTApID8gLTAuMzUgOiAwLjM1OwogICAgICB2LnBhcmFtcy5vbiA9IGkgPCA2OwogICAgICB2LnBhcmFtcy5tdXRlID0gZmFsc2U7CiAgICAgIHYucGFyYW1zLnNvbG8gPSBmYWxzZTsKICAgICAgLy8gc3luYyBVSSBjb250cm9scyB2YWx1ZXMKICAgICAgY29uc3Qgd2F2ZVNlbCA9IGVsKGB2V2F2ZV8ke3YuaWR4fWApOyBpZiAod2F2ZVNlbCkgd2F2ZVNlbC52YWx1ZSA9IHYucGFyYW1zLndhdmVmb3JtOwogICAgICBjb25zdCBmcmVxUiA9IGVsKGB2RnJlcV8ke3YuaWR4fWApOyBpZiAoZnJlcVIpIGZyZXFSLnZhbHVlID0gU3RyaW5nKE1hdGgubWluKDIwMDAsIE1hdGgubWF4KDIwLCB2LnBhcmFtcy5mcmVxKSkpOwogICAgICBjb25zdCBmcmVxTiA9IGVsKGB2RnJlcU51bV8ke3YuaWR4fWApOyBpZiAoZnJlcU4pIGZyZXFOLnZhbHVlID0gU3RyaW5nKE1hdGgucm91bmQodi5wYXJhbXMuZnJlcSkpOwogICAgICBjb25zdCBsdmxSID0gZWwoYHZMdmxfJHt2LmlkeH1gKTsgaWYgKGx2bFIpIGx2bFIudmFsdWUgPSBTdHJpbmcodi5wYXJhbXMubGV2ZWwpOwogICAgICBjb25zdCBkZXRSID0gZWwoYHZEZXRfJHt2LmlkeH1gKTsgaWYgKGRldFIpIGRldFIudmFsdWUgPSBTdHJpbmcodi5wYXJhbXMuZGV0dW5lKTsKICAgICAgY29uc3QgcGFuUiA9IGVsKGB2UGFuXyR7di5pZHh9YCk7IGlmIChwYW5SKSBwYW5SLnZhbHVlID0gU3RyaW5nKHYucGFyYW1zLnBhbik7CiAgICAgIC8vIHVwZGF0ZSBjaGlwcyB0ZXh0IHF1aWNrbHkKICAgICAgY29uc3Qgb25CdG4gPSBlbChgdk9uXyR7di5pZHh9YCk7IGlmIChvbkJ0bil7IG9uQnRuLmNsYXNzTGlzdC50b2dnbGUoIm9uIiwgdi5wYXJhbXMub24pOyBvbkJ0bi50ZXh0Q29udGVudCA9IHYucGFyYW1zLm9uID8gIk9OIjoiT0ZGIjsgfQogICAgICBjb25zdCBtdXRlQnRuID0gZWwoYHZNdXRlXyR7di5pZHh9YCk7IGlmIChtdXRlQnRuKSBtdXRlQnRuLmNsYXNzTGlzdC50b2dnbGUoIm9uIiwgdi5wYXJhbXMubXV0ZSk7CiAgICAgIGNvbnN0IHNvbG9CdG4gPSBlbChgdlNvbG9fJHt2LmlkeH1gKTsgaWYgKHNvbG9CdG4pIHNvbG9CdG4uY2xhc3NMaXN0LnRvZ2dsZSgib24iLCB2LnBhcmFtcy5zb2xvKTsKICAgICAgLy8gaW5mbyBsYWJlbHMKICAgICAgY29uc3QgaW5mbyA9IGVsKGB2SW5mb18ke3YuaWR4fWApOwogICAgICBpZiAoaW5mbykgaW5mby50ZXh0Q29udGVudCA9IGBmcmVxICR7TWF0aC5yb3VuZCh2LnBhcmFtcy5mcmVxKX0gSHog4oCiIGdhaW4gJHt2LnBhcmFtcy5sZXZlbC50b0ZpeGVkKDIpfSDigKIgcGFuICR7di5wYXJhbXMucGFuLnRvRml4ZWQoMil9YDsKICAgICAgY29uc3Qgd2F2ZUxibCA9IGVsKGB2V2F2ZUxibF8ke3YuaWR4fWApOyBpZiAod2F2ZUxibCkgd2F2ZUxibC50ZXh0Q29udGVudCA9IHYucGFyYW1zLndhdmVmb3JtOwogICAgICBjb25zdCBmcmVxTGJsID0gZWwoYHZGcmVxTGJsXyR7di5pZHh9YCk7IGlmIChmcmVxTGJsKSBmcmVxTGJsLnRleHRDb250ZW50ID0gYCR7TWF0aC5yb3VuZCh2LnBhcmFtcy5mcmVxKX0gSHpgOwogICAgICBjb25zdCBsdmxMYmwgPSBlbChgdkx2bExibF8ke3YuaWR4fWApOyBpZiAobHZsTGJsKSBsdmxMYmwudGV4dENvbnRlbnQgPSB2LnBhcmFtcy5sZXZlbC50b0ZpeGVkKDIpOwogICAgICBjb25zdCBkZXRMYmwgPSBlbChgdkRldExibF8ke3YuaWR4fWApOyBpZiAoZGV0TGJsKSBkZXRMYmwudGV4dENvbnRlbnQgPSBgJHt2LnBhcmFtcy5kZXR1bmV8MH0gY2VudHNgOwogICAgICBjb25zdCBwYW5MYmwgPSBlbChgdlBhbkxibF8ke3YuaWR4fWApOyBpZiAocGFuTGJsKSBwYW5MYmwudGV4dENvbnRlbnQgPSBgJHt2LnBhcmFtcy5wYW4udG9GaXhlZCgyKX1gOwogICAgfSk7CgogICAgdm9pY2VzLmZvckVhY2godiA9PiB7CiAgICAgIGFwcGx5Vm9pY2VQYXJhbXModik7CiAgICAgIGlmICh2LnBhcmFtcy5vbikgZW52T24odik7IGVsc2UgZW52T2ZmKHYpOwogICAgfSk7CiAgICByZWZyZXNoQWxsRW52ZWxvcGVzKCk7CiAgfSk7CgogIHByZXNldEhhcm0uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICBlbnN1cmVBdWRpbygpOwogICAgLy8gSGFybW9uaWMgc2VyaWVzIGFyb3VuZCAxMTAgSHogKEEyKTogMS4uOCBwYXJ0aWFscwogICAgY29uc3QgYmFzZSA9IDExMDsKICAgIHZvaWNlcy5mb3JFYWNoKCh2LGkpID0+IHsKICAgICAgY29uc3QgbiA9IGkrMTsKICAgICAgdi5wYXJhbXMud2F2ZWZvcm0gPSAobiA8PSAyKSA/ICJzaW5lIiA6IChuIDw9IDUgPyAidHJpYW5nbGUiIDogInNxdWFyZSIpOwogICAgICB2LnBhcmFtcy5mcmVxID0gYmFzZSAqIG47CiAgICAgIHYucGFyYW1zLmxldmVsID0gMC4yMiAvIG47IC8vIGRlY3JlYXNpbmcKICAgICAgdi5wYXJhbXMuZGV0dW5lID0gMDsKICAgICAgdi5wYXJhbXMucGFuID0gKGklMj09PTApID8gLTAuMjUgOiAwLjI1OwogICAgICB2LnBhcmFtcy5vbiA9IHRydWU7CiAgICAgIHYucGFyYW1zLm11dGUgPSBmYWxzZTsKICAgICAgdi5wYXJhbXMuc29sbyA9IGZhbHNlOwoKICAgICAgY29uc3Qgd2F2ZVNlbCA9IGVsKGB2V2F2ZV8ke3YuaWR4fWApOyBpZiAod2F2ZVNlbCkgd2F2ZVNlbC52YWx1ZSA9IHYucGFyYW1zLndhdmVmb3JtOwogICAgICBjb25zdCBmcmVxUiA9IGVsKGB2RnJlcV8ke3YuaWR4fWApOyBpZiAoZnJlcVIpIGZyZXFSLnZhbHVlID0gU3RyaW5nKE1hdGgubWluKDIwMDAsIE1hdGgubWF4KDIwLCB2LnBhcmFtcy5mcmVxKSkpOwogICAgICBjb25zdCBmcmVxTiA9IGVsKGB2RnJlcU51bV8ke3YuaWR4fWApOyBpZiAoZnJlcU4pIGZyZXFOLnZhbHVlID0gU3RyaW5nKE1hdGgucm91bmQodi5wYXJhbXMuZnJlcSkpOwogICAgICBjb25zdCBsdmxSID0gZWwoYHZMdmxfJHt2LmlkeH1gKTsgaWYgKGx2bFIpIGx2bFIudmFsdWUgPSBTdHJpbmcodi5wYXJhbXMubGV2ZWwpOwogICAgICBjb25zdCBkZXRSID0gZWwoYHZEZXRfJHt2LmlkeH1gKTsgaWYgKGRldFIpIGRldFIudmFsdWUgPSBTdHJpbmcodi5wYXJhbXMuZGV0dW5lKTsKICAgICAgY29uc3QgcGFuUiA9IGVsKGB2UGFuXyR7di5pZHh9YCk7IGlmIChwYW5SKSBwYW5SLnZhbHVlID0gU3RyaW5nKHYucGFyYW1zLnBhbik7CgogICAgICBjb25zdCBvbkJ0biA9IGVsKGB2T25fJHt2LmlkeH1gKTsgaWYgKG9uQnRuKXsgb25CdG4uY2xhc3NMaXN0LnRvZ2dsZSgib24iLCB2LnBhcmFtcy5vbik7IG9uQnRuLnRleHRDb250ZW50PSJPTiI7IH0KICAgICAgY29uc3QgbXV0ZUJ0biA9IGVsKGB2TXV0ZV8ke3YuaWR4fWApOyBpZiAobXV0ZUJ0bikgbXV0ZUJ0bi5jbGFzc0xpc3QudG9nZ2xlKCJvbiIsIHYucGFyYW1zLm11dGUpOwogICAgICBjb25zdCBzb2xvQnRuID0gZWwoYHZTb2xvXyR7di5pZHh9YCk7IGlmIChzb2xvQnRuKSBzb2xvQnRuLmNsYXNzTGlzdC50b2dnbGUoIm9uIiwgdi5wYXJhbXMuc29sbyk7CgogICAgICBjb25zdCBpbmZvID0gZWwoYHZJbmZvXyR7di5pZHh9YCk7CiAgICAgIGlmIChpbmZvKSBpbmZvLnRleHRDb250ZW50ID0gYGZyZXEgJHtNYXRoLnJvdW5kKHYucGFyYW1zLmZyZXEpfSBIeiDigKIgZ2FpbiAke3YucGFyYW1zLmxldmVsLnRvRml4ZWQoMil9IOKAoiBwYW4gJHt2LnBhcmFtcy5wYW4udG9GaXhlZCgyKX1gOwogICAgICBjb25zdCB3YXZlTGJsID0gZWwoYHZXYXZlTGJsXyR7di5pZHh9YCk7IGlmICh3YXZlTGJsKSB3YXZlTGJsLnRleHRDb250ZW50ID0gdi5wYXJhbXMud2F2ZWZvcm07CiAgICAgIGNvbnN0IGZyZXFMYmwgPSBlbChgdkZyZXFMYmxfJHt2LmlkeH1gKTsgaWYgKGZyZXFMYmwpIGZyZXFMYmwudGV4dENvbnRlbnQgPSBgJHtNYXRoLnJvdW5kKHYucGFyYW1zLmZyZXEpfSBIemA7CiAgICAgIGNvbnN0IGx2bExibCA9IGVsKGB2THZsTGJsXyR7di5pZHh9YCk7IGlmIChsdmxMYmwpIGx2bExibC50ZXh0Q29udGVudCA9IHYucGFyYW1zLmxldmVsLnRvRml4ZWQoMik7CiAgICAgIGNvbnN0IGRldExibCA9IGVsKGB2RGV0TGJsXyR7di5pZHh9YCk7IGlmIChkZXRMYmwpIGRldExibC50ZXh0Q29udGVudCA9IGAke3YucGFyYW1zLmRldHVuZXwwfSBjZW50c2A7CiAgICAgIGNvbnN0IHBhbkxibCA9IGVsKGB2UGFuTGJsXyR7di5pZHh9YCk7IGlmIChwYW5MYmwpIHBhbkxibC50ZXh0Q29udGVudCA9IGAke3YucGFyYW1zLnBhbi50b0ZpeGVkKDIpfWA7CiAgICB9KTsKCiAgICB2b2ljZXMuZm9yRWFjaCh2ID0+IHsKICAgICAgYXBwbHlWb2ljZVBhcmFtcyh2KTsKICAgICAgZW52T24odik7CiAgICB9KTsKICAgIHJlZnJlc2hBbGxFbnZlbG9wZXMoKTsKICB9KTsKCiAgZnVuY3Rpb24gdXBkYXRlTWl4SW5mbygpIHsKICAgIC8vIFJvdWdoIGVzdGltYXRlOiBzdW0gb2YgdGFyZ2V0IGdhaW5zIChwcmUgQURTUiBzdXN0YWluKSwgbm90IGFjY291bnRpbmcgZm9yIHBoYXNlCiAgICBjb25zdCBhbnlTb2xvID0gdm9pY2VzLnNvbWUodiA9PiB2LnBhcmFtcy5zb2xvKTsKICAgIGxldCBzdW0gPSAwOwogICAgbGV0IGFjdGl2ZSA9IDA7CiAgICB2b2ljZXMuZm9yRWFjaCh2ID0+IHsKICAgICAgY29uc3QgcGFzcyA9ICghYW55U29sbyB8fCB2LnBhcmFtcy5zb2xvKSAmJiB2LnBhcmFtcy5vbiAmJiAhdi5wYXJhbXMubXV0ZTsKICAgICAgaWYgKHBhc3MpIHsgc3VtICs9IHYucGFyYW1zLmxldmVsOyBhY3RpdmUrKzsgfQogICAgfSk7CiAgICBjb25zdCBlc3RQZWFrID0gc3VtOyAvLyBzaW1wbGlzdGljCiAgICBtaXhJbmZvRWwudGV4dENvbnRlbnQgPSBgJHthY3RpdmV9LyR7TUFYX1ZPSUNFU30gYWN0aXZlIOKAoiBlc3RQZWFrICR7ZXN0UGVhay50b0ZpeGVkKDIpfWA7CiAgfQoKICAvLyAtLS0tLS0tLS0tIE9zY2lsbG9zY29wZSAtLS0tLS0tLS0tCiAgbGV0IHJhZiA9IDA7CiAgbGV0IGxhc3RGcHNUID0gMDsKICBsZXQgZnJhbWVzID0gMDsKCiAgZnVuY3Rpb24gZHJhd1Njb3BlKCkgewogICAgcmFmID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGRyYXdTY29wZSk7CiAgICBpZiAoIWFuYWx5c2VyKSByZXR1cm47CgogICAgY29uc3QgdyA9IGNhbnZhcy53aWR0aDsKICAgIGNvbnN0IGggPSBjYW52YXMuaGVpZ2h0OwoKICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShhbmFseXNlci5mZnRTaXplKTsKICAgIGFuYWx5c2VyLmdldEJ5dGVUaW1lRG9tYWluRGF0YShkYXRhKTsKCiAgICAvLyBiYWNrZ3JvdW5kCiAgICBjdHgyZC5jbGVhclJlY3QoMCwwLHcsaCk7CiAgICBjdHgyZC5maWxsU3R5bGUgPSAicmdiYSgwLDAsMCwwLjI1KSI7CiAgICBjdHgyZC5maWxsUmVjdCgwLDAsdyxoKTsKCiAgICAvLyBncmlkCiAgICBjdHgyZC5zdHJva2VTdHlsZSA9ICJyZ2JhKDI1NSwyNTUsMjU1LDAuMDgpIjsKICAgIGN0eDJkLmxpbmVXaWR0aCA9IDE7CiAgICBjdHgyZC5iZWdpblBhdGgoKTsKICAgIGZvciAobGV0IGk9MTtpPDY7aSsrKXsKICAgICAgY29uc3QgeSA9IChoKmkpLzY7CiAgICAgIGN0eDJkLm1vdmVUbygwLHkpOyBjdHgyZC5saW5lVG8odyx5KTsKICAgIH0KICAgIGZvciAobGV0IGk9MTtpPDEwO2krKyl7CiAgICAgIGNvbnN0IHggPSAodyppKS8xMDsKICAgICAgY3R4MmQubW92ZVRvKHgsMCk7IGN0eDJkLmxpbmVUbyh4LGgpOwogICAgfQogICAgY3R4MmQuc3Ryb2tlKCk7CgogICAgLy8gd2F2ZWZvcm0KICAgIGN0eDJkLnN0cm9rZVN0eWxlID0gInJnYmEoNzgsMTYxLDI1NSwwLjk1KSI7CiAgICBjdHgyZC5saW5lV2lkdGggPSAyOwogICAgY3R4MmQuYmVnaW5QYXRoKCk7CiAgICBjb25zdCBtaWQgPSBoLzI7CiAgICBmb3IgKGxldCBpPTA7aTxkYXRhLmxlbmd0aDtpKyspewogICAgICBjb25zdCB4ID0gKGkvKGRhdGEubGVuZ3RoLTEpKSp3OwogICAgICBjb25zdCB2ID0gKGRhdGFbaV0tMTI4KS8xMjg7IC8vIC0xLi4xCiAgICAgIGNvbnN0IHkgPSBtaWQgKyB2KihoKjAuMzgpOwogICAgICBpZiAoaT09PTApIGN0eDJkLm1vdmVUbyh4LHkpOwogICAgICBlbHNlIGN0eDJkLmxpbmVUbyh4LHkpOwogICAgfQogICAgY3R4MmQuc3Ryb2tlKCk7CgogICAgLy8gZnBzCiAgICBmcmFtZXMrKzsKICAgIGNvbnN0IHQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgIGlmICh0IC0gbGFzdEZwc1QgPiA2MDApIHsKICAgICAgY29uc3QgZnBzID0gZnJhbWVzICogMTAwMCAvICh0IC0gbGFzdEZwc1QpOwogICAgICBmcHNFbC50ZXh0Q29udGVudCA9IGZwcy50b0ZpeGVkKDApOwogICAgICBsYXN0RnBzVCA9IHQ7CiAgICAgIGZyYW1lcyA9IDA7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzdGFydFNjb3BlKCkgewogICAgaWYgKHJhZikgY2FuY2VsQW5pbWF0aW9uRnJhbWUocmFmKTsKICAgIGxhc3RGcHNUID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICBmcmFtZXMgPSAwOwogICAgZHJhd1Njb3BlKCk7CiAgfQoKICAvLyAtLS0tLS0tLS0tIGluaXQgbGFiZWxzIC0tLS0tLS0tLS0KICBzZXRNYXN0ZXJMYWJlbCgpOwogIHNldExpbWl0ZXJMYWJlbCgpOwogIHNldEFEU1JMYWJlbHMoKTsKICBzZXRHbG9iYWxEZXR1bmVMYWJlbCgpOwoKICAvLyBQcmUtYnVpbGQgdm9pY2UgVUkgcGxhY2Vob2xkZXJzICh3aXRob3V0IGF1ZGlvIHlldCkKICAvLyBXZSdsbCBjcmVhdGUgYSBsaWdodHdlaWdodCBwbGFjZWhvbGRlciBsaXN0LCB0aGVuIHJlYnVpbGQgYWZ0ZXIgYXVkaW8gaW5pdC4KICAoZnVuY3Rpb24gYnVpbGRQbGFjZWhvbGRlcigpewogICAgdm9pY2VzUm9vdC5pbm5lckhUTUwgPSAiIjsKICAgIGZvciAobGV0IGk9MTtpPD1NQVhfVk9JQ0VTO2krKyl7CiAgICAgIGNvbnN0IGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgZC5jbGFzc05hbWUgPSAiY2FyZCB2b2ljZSI7CiAgICAgIGQuaW5uZXJIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9InZvaWNlSGVhZCI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJsZWZ0Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmFkZ2UiPiR7aX08L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4OyBmbGV4LWRpcmVjdGlvbjpjb2x1bW47IGdhcDoycHg7Ij4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo4MDA7IGxldHRlci1zcGFjaW5nOi4ycHg7Ij5Wb2ljZSAke2l9PC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic21hbGwiPlByZW1pIFN0YXJ0IHBlciBpbml6aWFsaXp6YXJlIGzigJlhdWRpby48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InRvZ2dsZXMiPgogICAgICAgICAgICA8c3BhbiBjbGFzcz0icGlsbCI+4oCUPC9zcGFuPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iZm9vdGVyTm90ZSI+TGEgR1VJIGNvbXBsZXRhIHNpIGF0dGl2YSBkb3BvIFN0YXJ0IChwb2xpY3kgYXV0b3BsYXkgYXVkaW8pLjwvZGl2PgogICAgICBgOwogICAgICB2b2ljZXNSb290LmFwcGVuZENoaWxkKGQpOwogICAgfQogIH0pKCk7Cgp9KSgpOwo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+"}</script>

<script>
"use strict";
const $ = (q)=>document.querySelector(q);

const appData = JSON.parse($("#appData").textContent);
const home = $("#home");
const viewer = $("#viewer");
const frame = $("#appFrame");
const viewerTitle = $("#viewerTitle");
const btnHome = $("#btnHome");
const btnBack = $("#btnBack");
const btnOpenWin = $("#btnOpenWin");
const notice = $("#notice");

let currentAppKey = null;
let currentBlobUrl = null;

function b64ToUtf8(b64){
  const bin = atob(b64);
  const bytes = Uint8Array.from(bin, c => c.charCodeAt(0));
  return new TextDecoder("utf-8").decode(bytes);
}

function setMode(mode){
  if(mode === "home"){
    viewer.classList.remove("on");
    home.style.display = "block";
    btnOpenWin.disabled = true;
    currentAppKey = null;
    viewerTitle.textContent = "‚Äî";
    notice.style.display = "none";
    try{ frame.removeAttribute("srcdoc"); frame.src="about:blank"; }catch(e){}
    if(currentBlobUrl){ URL.revokeObjectURL(currentBlobUrl); currentBlobUrl=null; }
  } else {
    home.style.display = "none";
    viewer.classList.add("on");
    btnOpenWin.disabled = false;
    notice.style.display = "block";
  }
}

function openApp(key){
  if(!appData[key]) return;
  currentAppKey = key;
  viewerTitle.textContent = key;
  const html = b64ToUtf8(appData[key]);
  // Load inside iframe
  frame.srcdoc = html;
  // Prepare blob for "open in new tab"
  if(currentBlobUrl){ URL.revokeObjectURL(currentBlobUrl); currentBlobUrl=null; }
  currentBlobUrl = URL.createObjectURL(new Blob([html], {type:"text/html;charset=utf-8"}));
  setMode("viewer");
}

function openInNewTab(){
  if(!currentAppKey || !currentBlobUrl) return;
  window.open(currentBlobUrl, "_blank", "noopener");
}

function clickTile(el){ openApp(el.getAttribute("data-app")); }

document.getElementById("grid").addEventListener("click", (e)=>{
  const tile = e.target.closest(".tile");
  if(tile) clickTile(tile);
});
document.getElementById("grid").addEventListener("keydown", (e)=>{
  const tile = e.target.closest(".tile");
  if(!tile) return;
  if(e.key === "Enter" || e.key === " "){
    e.preventDefault();
    clickTile(tile);
  }
});

btnHome.addEventListener("click", ()=>setMode("home"));
btnBack.addEventListener("click", ()=>setMode("home"));
btnOpenWin.addEventListener("click", openInNewTab);

// Start on home
setMode("home");
</script>
</body>
</html>
